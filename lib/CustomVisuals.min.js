!function(e){function t(a){if(i[a])return i[a].exports;var r=i[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){e.exports=i(13)},,,,,,,,,,,,,function(e,t,i){function a(e){return e.keys().map(e)}window.jsCommon,window.powerbi,window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;window.jsCommon=window.jsCommon||{},window.powerbi=window.powerbi||{},window.debug=window.debug||{},window.InJs=window.InJs||{},a(i(14)),i(37)},function(e,t,i){function a(e){return i(r(e))}function r(e){return s[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var s={"./styles/styles.less":15,"./visuals/asterPlot/visual/styles/asterPlot.less":17,"./visuals/bulletChart/visual/styles/bulletChart.less":18,"./visuals/chicletSlicer/visual/styles/chicletSlicer.less":19,"./visuals/chordChart/visual/styles/chordChart.less":20,"./visuals/dotPlot/visual/styles/dotPlot.less":21,"./visuals/enhancedScatterChart/visual/styles/enhancedScatterChart.less":22,"./visuals/forceGraph/visual/styles/forceGraph.less":23,"./visuals/gantt/visual/styles/gantt.less":24,"./visuals/globeMap/visual/styles/globeMap.less":25,"./visuals/histogram/visual/styles/histogram.less":26,"./visuals/lineDotChart/visual/styles/lineDotChart.less":27,"./visuals/mekkoChart/visual/styles/mekkoChart.less":28,"./visuals/pulseChart/visual/styles/pulseChart.less":29,"./visuals/radarChart/visual/styles/radarChart.less":30,"./visuals/sankeyDiagram/visual/styles/sankeyDiagram.less":31,"./visuals/streamGraph/visual/styles/streamGraph.less":32,"./visuals/sunburst/visual/styles/sunburst.less":33,"./visuals/timeline/visual/styles/timeline.less":34,"./visuals/tornadoChart/visual/styles/tornadoChart.less":35,"./visuals/wordCloud/visual/styles/wordCloud.less":36};a.keys=function(){return Object.keys(s)},a.resolve=r,e.exports=a,a.id=14},function(e,t){},,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,i){window.jsCommon,window.powerbi,window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;i(38),i(39),i(40),i(41),i(42),i(43),i(44),i(45),i(46),i(47),i(48),i(49),i(50),i(51),i(52),i(53),i(54),i(55),i(56),i(57),i(58)},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.CssConstants.createClassAndSelector,r=a.PixelConverter,s=e.visuals.valueFormatter,o=e.visuals.LegendData,n=e.createEnumType,l=e.DataViewObjects,c=e.visuals.ObjectEnumerationBuilder,u=e.visuals.LegendPosition,h=e.visuals.dataLabelUtils,p=e.visuals.converterHelper,d=e.data.createDisplayNameGetter,g=e.visuals.legendPosition,m=e.visuals.ColorHelper,y=e.visuals.valueFormatter,f=e.visuals.TooltipBuilder,v=e.visuals.SelectionId,x=e.visuals.LegendIcon,b=e.visuals.appendClearCatcher,S=e.visuals.createInteractivityService,w=e.visuals.createLegend,C=e.visuals.AnimatorCommon.MinervaAnimationDuration,P=e.visuals.SVGUtil,A=e.visuals.TooltipManager,D=e.TextMeasurementService,T=e.DataLabelManager,V=e.visuals.Legend,N=e.VisualDataRoleKind,L="asterPlot",M=.9,k=.9,I=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.selection=e.selection,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.hasHighlights=e.hasHighlights,this.selection.on("click",function(e,i){t.handleSelection(e.data,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()}),this.renderSelection(this.interactivityService.hasSelection())},e.prototype.renderSelection=function(e){var t=this;this.selection.style("fill-opacity",function(i){return B.getFillOpacity(i.data.selected,i.data.highlight,e,t.hasHighlights)})},e}(),O=function(){function e(e){this.message=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"AsterPlotWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){return{message:this.message,title:e.get(""),detail:e.get("")}},e}();t.AsterPlotWarning=O;var F=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){var i=this;this.previousOriginalViewportValue=_.clone(this.originalViewportValue),this.originalViewportValue=_.clone(t),this.setUpdateObject(t,function(e){return i.viewportValue=e},function(t){return e.restrictToMinMax(t,i.minViewport)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportCopy",{get:function(){return _.clone(this.viewport)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue||{width:0,height:0}},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.minViewportValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.marginValue=this.defaultMargin)},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.marginValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportChanged",{get:function(){return!(!this.originalViewportValue||this.previousOriginalViewportValue&&this.previousOriginalViewportValue.height===this.originalViewportValue.height&&this.previousOriginalViewportValue.width===this.originalViewportValue.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.prototype.setUpdateObject=function(t,i,a){var r=this;t=_.clone(t),i(e.createNotifyChangedObject(t,function(e){a&&a(t),r.update()})),a&&a(t),this.update()},e.createNotifyChangedObject=function(e,t){var i={};return _.keys(e).forEach(function(a){return Object.defineProperty(i,a,{get:function(){return e[a]},set:function(i){e[a]=i,t(e,a)},enumerable:!0,configurable:!0})}),i},e.restrictToMinMax=function(e,t){return _.keys(e).forEach(function(i){return e[i]=Math.max(t&&t[i]||0,e[i])}),e},e}(),z=function(){function e(){}return e.setAttrThroughTransitionIfNotResized=function(e,t,i,a,r,s){s?e.attr(i,a):t(e.transition()).attrTween(i,r)},e.interpolateArc=function(e){return function(t){if(!this.oldData)return this.oldData=t,function(){return e(t)};var i=d3.interpolate(this.oldData,t);return this.oldData=i(0),function(t){return e(i(t))}}},e.addContext=function(e,t){return function(){return t.apply(e,[this].concat(_.toArray(arguments)))}},e}(),j=function(){function e(){this.legend={show:!1,position:u[u.Top],showTitle:!0,titleText:"",labelColor:o.DefaultLegendLabelFillColor,fontSize:8},this.labels={show:!1,color:h.defaultLabelColor,displayUnits:0,precision:h.defaultLabelPrecision,fontSize:h.DefaultFontSizeInPt},this.outerLine={show:!1,thickness:1}}return Object.defineProperty(e,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),e.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},e.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},e.createEnumTypeFromEnum=function(e){var t=!1;return n(Object.keys(e).filter(function(i,a){return!!(a%2)===t&&e[i]===i&&!void(t=!t)||!!(a%2)!==t}).map(function(e){return{value:e,displayName:e}}))},e.getValueFnByType=function(e){switch(_.keys(e)[0]){case"fill":return l.getFillColor;default:return l.getValue}},e.enumerateObjectInstances=function(e,t,i){void 0===e&&(e=new this);var a=new c,r=e&&e[t.objectName];if(!r)return a;var s={objectName:t.objectName,selector:null,properties:{}};for(var o in r)_.has(r,o)&&(s.properties[o]=r[o]);return a.pushInstance(s),a},e.prototype.createOriginalSettings=function(){this.originalSettings=_.cloneDeep(this)},e}();t.AsterPlotSettings=j;var G=function(){function e(){this.Category=null,this.Y=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return p.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();t.AsterPlotColumns=G;var R=function(){function t(){}return t.converter=function(e,i){var a=G.getCategoricalColumns(e),n=G.getCategoricalValues(e);if(a&&a.Category&&!_.isEmpty(a.Category.values)&&!_.isEmpty(a.Y)&&!_.isEmpty(a.Y[0].values)){for(var l=t.parseSettings(e,a.Category.source),c=j.getProperties(t.capabilities),u=[],h=[],p={dataPoints:[],title:null,fontSize:j.Default.legend.fontSize,labelColor:o.DefaultLegendLabelFillColor},d=new m(i),g=!!a.Y[0].highlights,b=Math.max(d3.min(a.Y[0].values)),S=Math.min(0,d3.min(a.Y[0].values)),w=s.create({format:s.getFormatString(a.Y[0].source,c.general.formatString),precision:l.labels.precision,value:0===l.labels.displayUnits&&null!=b?b:l.labels.displayUnits}),C=y.getFormatString(a.Category.source,c.general.formatString),P=r.fromPoint(l.labels.fontSize),A=0;A<n.Category.length;A++){var D=y.format(n.Category[A],C),T=a.Y[0].values[A],V=f.createTooltipInfo(c.general.formatString,e.categorical,D,T,null,null,0);if(a.Y.length>1){var N=f.createTooltipInfo(c.general.formatString,e.categorical,D,a.Y[1].values[A],null,null,1)[1];N&&V.push(N),T+=a.Y[1].values[A]}var L=a.Category.identity[A],M=d.getColorForMeasure(a.Category.objects&&a.Category.objects[A],L.key),k=v.createWithId(L),I=Math.max(0,a.Y.length>1?a.Y[1].values[A]:1);if(I>0&&u.push({sliceHeight:a.Y[0].values[A]-S,sliceWidth:I,label:w.format(T),color:M,identity:k,selected:!1,tooltipInfo:V,labelFontSize:P,highlight:!1}),l.legend.show&&p.dataPoints.push({label:D,color:M,icon:x.Box,selected:!1,identity:k}),g){var O=v.createWithHighlight(k),F=null!=a.Y[0].highlights[A];if(T=F?a.Y[0].highlights[A]:0,V=f.createTooltipInfo(c.general.formatString,e.categorical,D,T,null,null,0),a.Y.length>1){var N=f.createTooltipInfo(c.general.formatString,e.categorical,D,a.Y[1].highlights[A],null,null,1)[1];N&&V.push(N),T+=null!==a.Y[1].highlights[A]?a.Y[1].highlights[A]:0}h.push({sliceHeight:F?a.Y[0].highlights[A]-S:null,sliceWidth:Math.max(0,a.Y.length>1&&null!==a.Y[1].highlights[A]?a.Y[1].highlights[A]:I),label:w.format(T),color:M,identity:O,selected:!1,tooltipInfo:V,labelFontSize:P,highlight:!0})}}return u.length&&{dataPoints:u,settings:l,hasHighlights:g,legendData:p,highlightedDataPoints:h,labelFormatter:w,centerText:a.Category.source.displayName}}},t.parseSettings=function(e,i){var a=j.parse(e,t.capabilities);return a.labels.precision=Math.min(17,Math.max(0,a.labels.precision)),a.outerLine.thickness=Math.min(300,Math.max(1,a.outerLine.thickness)),a.createOriginalSettings(),_.isEmpty(a.legend.titleText)&&(a.legend.titleText=i.displayName),a},Object.defineProperty(t.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),t.prototype.init=function(i){this.hostServices=i.host,this.hostServices.canSelect=function(t){var i=_.map(t.visualObjects,function(t){return e.data.Selector.convertSelectorsByColumnToSelector(t.selectorsByColumn)});return!(i.length>1&&i.some(function(e){return e&&e.data&&e.data.length>1}))},this.layout=new F(i.viewport,{top:10,right:10,bottom:15,left:10});var a=i.element,r=this.svg=d3.select(a.get(0)).append("svg").classed(L,!0).style("position","absolute");this.colors=i.style.colorPalette.dataColors,this.mainGroupElement=r.append("g"),this.mainLabelsElement=r.append("g"),this.behavior=new I,this.clearCatcher=b(this.mainGroupElement),this.slicesElement=this.mainGroupElement.append("g").classed(t.AsterSlices["class"],!0);var s=i.interactivity;this.interactivityService=S(this.hostServices),this.legend=w(a,s&&s.isInteractiveLegend,this.interactivityService,!0)},t.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){this.layout.viewport=e.viewport;var i=e.suppressAnimations?0:C,a=t.converter(e.dataViews[0],this.colors);if(!a)return void this.clear();this.data=a,this.interactivityService&&(this.interactivityService.applySelectionStateToData(this.data.dataPoints),this.interactivityService.applySelectionStateToData(this.data.highlightedDataPoints)),this.renderLegend(),this.updateViewPortAccordingToLegend(),this.svg.attr(this.layout.viewport);var r=(this.layout.viewportIn.width+this.layout.margin.right)/2,s=(this.layout.viewportIn.height+this.layout.margin.bottom)/2;if(this.mainGroupElement.attr("transform",P.translate(r,s)),this.mainLabelsElement.attr("transform",P.translate(r,s)),this.clearCatcher.attr("transform",P.translate(-r,-s)),h.cleanDataLabels(this.mainLabelsElement,!0),this.renderArcsAndLabels(i),this.data.hasHighlights?this.renderArcsAndLabels(i,!0):this.slicesElement.selectAll(t.AsterHighlightedSlice.selector).remove(),this.interactivityService){var o={selection:this.slicesElement.selectAll(t.AsterSlice.selector+", "+t.AsterHighlightedSlice.selector),clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,hasHighlights:this.data.hasHighlights};this.interactivityService.bind(this.data.dataPoints.concat(this.data.highlightedDataPoints),this.behavior,o)}}},t.prototype.renderArcsAndLabels=function(e,i){var a=this;void 0===i&&(i=!1);var r=Math.min(this.layout.viewportIn.width,this.layout.viewportIn.height)/2,s=.3*(this.settings.labels.show?r*M:r),o=d3.max(this.data.dataPoints,function(e){return e.sliceHeight}),n=d3.sum(this.data.dataPoints,function(e){return e.sliceWidth}),l=d3.layout.pie().sort(null).value(function(e){return(e&&!isNaN(e.sliceWidth)?e.sliceWidth:0)/n}),c=d3.svg.arc().innerRadius(s).outerRadius(function(e){var t=(r-s)*(e&&e.data&&!isNaN(e.data.sliceHeight)?e.data.sliceHeight:1)/o,i=s+(a.settings.labels.show?t*M:t);return Math.max(i,s)}),u=l(i?this.data.highlightedDataPoints:this.data.dataPoints),p=i?t.AsterHighlightedSlice:t.AsterSlice,d=this.slicesElement.selectAll(p.selector).data(u,function(e,t){return e.data?e.data.identity.getKey():t});if(d.enter().append("path").classed(p["class"],!0).attr("stroke","#333"),d.attr("fill",function(e){return e.data.color}).call(function(t){return z.setAttrThroughTransitionIfNotResized(t,function(t){return t.duration(e)},"d",c,z.interpolateArc(c),a.layout.viewportChanged)}),d.exit().remove(),A.addTooltip(d,function(e){return e.data.data.tooltipInfo}),this.settings.labels.show&&(!this.data.hasHighlights||this.data.hasHighlights&&i)){var g=function(e){var t=r*(e&&!isNaN(e.sliceHeight)?e.sliceHeight:1)/o+s;return Math.max(t,s)},m=d3.svg.arc().innerRadius(function(e){return g(e.data)}).outerRadius(function(e){return g(e.data)}),y=function(e){var t=(r-s)*(e&&!isNaN(e.sliceHeight)?e.sliceHeight:1)/o;return t=s+t*M,Math.max(t,s)},f=d3.svg.arc().innerRadius(function(e){return y(e.data)}).outerRadius(function(e){return y(e.data)}),v=this.getLabelLayout(m,this.layout.viewport);this.drawLabels(u.filter(function(e){return!i||null!==e.data.sliceHeight}),this.mainLabelsElement,v,this.layout.viewport,f,m)}else h.cleanDataLabels(this.mainLabelsElement,!0);return i||(this.drawCenterText(s),this.drawOuterLine(s,_.max(u.map(function(e){return c.outerRadius()(e)})),u)),d},t.prototype.getLabelLayout=function(e,t){var i=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},a={fontFamily:h.StandardFontFamily,fontSize:r.fromPoint(this.settings.labels.fontSize),text:""},s=function(i){var r=e.centroid(i);a.text=i.data.label;var s=D.measureSvgTextWidth(a),o=t.width/2-Math.abs(r[0]),n=D.estimateSvgTextHeight(a),l=t.height/2-Math.abs(r[1]);return i.isLabelHasConflict=s>o||n>l,i.isLabelHasConflict};return{labelText:function(i){a.text=i.data.label;var r=e.centroid(i),o=s(i)?r[0]*k:r[0],n=t.width/2-Math.abs(o);return D.getTailoredTextOrDefault(a,n)},labelLayout:{x:function(t){var i=e.centroid(t);a.text=t.data.label;var r=t.isLabelHasConflict?i[0]*k:i[0];return r},y:function(t){var i=e.centroid(t),a=t.isLabelHasConflict?i[1]*k:i[1];return a}},filter:function(e){return null!=e&&!_.isEmpty(e.data.label)},style:{fill:this.settings.labels.color,"font-size":a.fontSize,"text-anchor":function(e){return i(e)<Math.PI?"start":"end"}}}},t.prototype.drawLabels=function(e,i,a,r,s,o){var n=this,l=new T,c=l.hideCollidedLabels(r,e,a,!0);if(0===c.length)return void h.cleanDataLabels(i,!0);i.select(t.labelGraphicsContextClass.selector).empty()&&i.append("g").classed(t.labelGraphicsContextClass["class"],!0);var u=i.select(t.labelGraphicsContextClass.selector).selectAll(".data-labels").data(c,function(e){return e.data.identity.getKey()});if(u.enter().append("text").classed("data-labels",!0),u){u.attr({x:function(e){return e.labelX},y:function(e){return e.labelY},dy:".35em"}).text(function(e){return e.labeltext}).style(a.style),u.exit().remove(),i.select(t.linesGraphicsContextClass.selector).empty()&&i.append("g").classed(t.linesGraphicsContextClass["class"],!0),c=_.filter(c,function(e){return null!==e.data.sliceHeight&&0!==e.data.sliceHeight});var p=i.select(t.linesGraphicsContextClass.selector).selectAll("polyline").data(c,function(e){return e.data.identity.getKey()}),d=4,g=1.02,m=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2};p.enter().append("polyline").classed("line-label",!0),p.attr("points",function(e){var t=[e.labelX,e.labelY];t[0]=t[0]+(m(e)<Math.PI?-1:1)*d;var i=s.centroid(e);return i[0]*=g,i[1]*=g,[i,t]}).style({opacity:.5,"fill-opacity":0,stroke:function(e){return n.settings.labels.color}}),p.exit().remove()}},t.prototype.renderLegend=function(){if(this.settings.legend.show){var e=_.clone(this.settings.legend);e.labelColor={solid:{color:e.labelColor}},o.update(this.data.legendData,e),this.legend.changeOrientation(u[this.settings.legend.position])}this.legend.drawLegend(this.data.legendData,this.layout.viewportCopy),V.positionChartArea(this.svg,this.legend)},t.prototype.updateViewPortAccordingToLegend=function(){if(this.settings.legend.show){var e=this.legend.getMargins(),t=u[this.settings.legend.position];switch(t){case u.Top:case u.TopCenter:case u.Bottom:case u.BottomCenter:this.layout.viewport.height-=e.height;break;case u.Left:case u.LeftCenter:case u.Right:case u.RightCenter:this.layout.viewport.width-=e.width}}},t.prototype.drawOuterLine=function(e,i,a){var r=this.mainGroupElement,s=d3.svg.arc().innerRadius(e).outerRadius(i);if(this.settings.outerLine.show){var o=this.settings.outerLine.thickness+"px",n=r.selectAll(t.OuterLine.selector).data(a);n.enter().append("path"),n.attr("fill","none").attr({stroke:"#333","stroke-width":o,d:s}).style("opacity",1).classed(t.OuterLine["class"],!0),n.exit().remove()}else r.selectAll(t.OuterLine.selector).remove()},t.prototype.drawCenterText=function(e){if(_.isEmpty(this.data.centerText))return void this.mainGroupElement.select(t.CenterLabelClass.selector).remove();var i={fontFamily:h.StandardFontFamily,fontWeight:"bold",fontSize:r.toString(e*t.CenterTextFontHeightCoefficient),text:this.data.centerText};this.mainGroupElement.select(t.CenterLabelClass.selector).empty()&&(this.centerText=this.mainGroupElement.append("text").classed(t.CenterLabelClass["class"],!0)),this.centerText.style({"line-height":1,"font-weight":i.fontWeight,"font-size":i.fontSize,fill:this.settings.labels.color}).attr({dy:"0.35em","text-anchor":"middle"}).text(D.getTailoredTextOrDefault(i,e*t.CenterTextFontWidthCoefficient))},t.prototype.clear=function(){this.mainGroupElement.selectAll("path").remove(),this.mainGroupElement.select(t.CenterLabelClass.selector).remove(),h.cleanDataLabels(this.mainLabelsElement,!0),this.legend.drawLegend({dataPoints:[]},this.layout.viewportCopy)},t.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},t.prototype.enumerateObjectInstances=function(e){var i=j.enumerateObjectInstances(this.settings&&this.settings.originalSettings,e,t.capabilities);return i.complete()},t.capabilities={dataRoles:[{displayName:"Category",name:G.Roles.Category,kind:N.Grouping},{displayName:"Y Axis",name:G.Roles.Y,kind:N.Measure}],dataViewMappings:[{conditions:[{Category:{max:1},Y:{max:2}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Y"}}]}}}],objects:{general:{displayName:d("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:"Legend",description:"Display legend options",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:g.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Legend Name",description:"Title text",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},label:{displayName:"Center Label",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Detail Labels",properties:{show:{type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},displayUnits:{displayName:"Display Units",type:{formatting:{displayUnits:!0}}},precision:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},outerLine:{displayName:"Outer line",properties:{show:{displayName:"Show",type:{bool:!0}},thickness:{displayName:"Thickness",type:{numeric:!0}}}}},supportsHighlight:!0},t.AsterSlices=i("asterSlices"),t.AsterSlice=i("asterSlice"),t.AsterHighlightedSlice=i("asterHighlightedSlice"),t.OuterLine=i("outerLine"),t.labelGraphicsContextClass=i("labels"),t.linesGraphicsContextClass=i("lines"),t.CenterLabelClass=i("centerLabel"),t.CenterTextFontHeightCoefficient=.4,t.CenterTextFontWidthCoefficient=1.9,t}();t.AsterPlot=R;var B;!function(e){function t(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getFillOpacity=t}(B=t.asterPlotUtils||(t.asterPlotUtils={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){function r(){return new l}var s=a.PixelConverter,o=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.columns=e.columns,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.columns.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var i=this.interactivityService.hasSelection();this.columns.style("fill-opacity",function(a){return t.ColumnUtil.getFillOpacity(a.selected,a.highlight,!a.highlight&&e,!a.selected&&i)})},e}(),n=function(){function e(e,t,i,a,r){this.scrollYBrush=d3.svg.brush(),this.getRoot=e,this.getViewport=t,this.isScrollable=r,this.getPrefferedHeight=a}return Object.defineProperty(e.prototype,"scrollViewport",{get:function(){return{height:this.viewport.height,width:this.viewport.width-(this.isYScrollBarVisible&&this.isScrollable?c.ScrollBarWidth:0)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.getViewport()},enumerable:!0,configurable:!0}),e.prototype.renderY=function(e,t){var i=this;if(this.isYScrollBarVisible=this.isScrollable&&this.getPrefferedHeight()>this.viewport.height&&this.viewport.height>0&&this.viewport.width>0,this.brushGraphicsContextY=this.createOrRemoveScrollbar(this.isYScrollBarVisible,this.brushGraphicsContextY,"y brush"),!this.isYScrollBarVisible)return void t.call(this,jQuery.extend(!0,{},e),0,1);var a=this.viewport.height,r=this.getExtentData(this.getPrefferedHeight(),a),s=function(s){void 0===s&&(s=0);var o=i.scrollYBrush.extent();if(0!==s){var n=(o[1]-o[0])/2;if(o[0]+=s>0?n:-n,o[1]+=s>0?n:-n,o[0]<0){var l=0-o[0];o[0]+=l,o[1]+=l}if(o[1]>a){var l=o[1]-a;o[0]-=l,o[1]-=l}i.scrollYBrush.extent(o),i.brushGraphicsContextY.select(".extent").attr("y",o[0])}var c=r.toScrollPosition(o,a);t.call(i,jQuery.extend(!0,{},e),c[0],c[1]),i.setScrollBarSize(i.brushGraphicsContextY,r.value[1],!0)},o=d3.scale.ordinal().rangeBands([0,a]);this.scrollYBrush.y(o).extent(r.value),this.renderScrollbar(this.scrollYBrush,this.brushGraphicsContextY,this.viewport.width,s),s()},e.prototype.createOrRemoveScrollbar=function(e,t,i){return e&&this.isScrollable?t||this.root.append("g").classed(i,!0):t?void t.remove():void 0},e.prototype.renderScrollbar=function(e,i,a,r){var s=this;e.on("brush",function(){return window.requestAnimationFrame(function(){return r(0)})}),this.root.on("wheel",function(){if(s.isYScrollBarVisible){var e=d3.event;r(e.deltaY)}}),i.attr({transform:t.SVGUtil.translate(a,0),"drag-resize-disabled":"true"}),i.call(e),i.selectAll(".resize").remove(),i.select(".background").remove(),i.selectAll(".extent").style({"fill-opacity":.125,cursor:"default"})},e.prototype.setScrollBarSize=function(e,t,i){e.selectAll("rect").attr(i?"width":"height",c.ScrollBarWidth),e.selectAll("rect").attr(i?"height":"width",t)},e.prototype.getExtentData=function(t,i){var a=i*i/t,r=e.ScrollBarMinLength<=a?1:a/e.ScrollBarMinLength;a=Math.max(a,e.ScrollBarMinLength);var s=function(e,t){var i=e[1]-e[0],a=e[0]/(t-i);i*=r;var s=a*(t-i),o=s+i;return[s/t,o/t]};return{value:[0,a],toScrollPosition:s}},e.prototype.clearData=function(){this.brushGraphicsContextY&&this.brushGraphicsContextY.selectAll("*").remove()},e.ScrollBarMinLength=15,e}(),l=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"TornadoChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){var t,i="This visual requires two distinct values to be returned for the Legend field.",a="",r="";return t={message:i,title:e.get(a),detail:e.get(r)}},e}();i.TornadoChartWarning=l,i.getTornadoChartWarning=r;var c=function(){function i(e){this.textOptions={},this.columnPadding=5,this.leftLabelMargin=4,this.InnerTextHeightDelta=2,this.margin={top:10,right:5,bottom:10,left:10},this.heightColumn=0,e&&(this.svg=e.svg||this.svg,this.margin=e.margin||this.margin,this.columnPadding=e.columnPadding||this.columnPadding,this.animator=e.animator)}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},i.converter=function(a,r,o){if(!(a&&a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[0].source&&a.categorical.values&&a.categorical.values[0]))return null;var n=a.categorical,l=n.categories||[],c=n.values,u=l[0],h=i.Properties.general.formatString,p=d3.max(c[0].values),d=i.parseSettings(a.metadata.objects,p,o),g=!!c.source,m=!!(c.length>0&&c[0].highlights),y=e.TextMeasurementService.estimateSvgTextHeight({fontFamily:t.dataLabelUtils.StandardFontFamily,fontSize:s.fromPoint(d.labelSettings.fontSize)}),f=[],v=[],x=[],b=t.valueFormatter.getFormatString(u.source,h),S=u.values.map(function(e){var a=t.valueFormatter.format(e,b);return i.getTextData(a,r,!0)}),w=c.grouped?c.grouped():null,C=Math.min(d3.min(c[0].values),0);c.length===i.MaxSeries&&(C=d3.min([C,d3.min(c[1].values)]),p=d3.max([p,d3.max(c[1].values)]));for(var P=0;P<c.length;P++){var A=w&&w.length>P&&w[P].values?w[P]:null,D=i.parseSeries(c,P,g,A,o);f.push(D);for(var T=c[P],V=T.source.queryName,N=0;N<u.values.length;N++){var L,M=null==T.values[N]||isNaN(T.values[N])?0:T.values[N],k=t.SelectionIdBuilder.builder().withCategory(u,N).withSeries(c,A).withMeasure(V).createSelectionId(),I=S[N].text;L=t.TooltipBuilder.createTooltipInfo(h,n,I,M,null,null,P,N,null);var O=D.categoryAxisEnd?Math.min(D.categoryAxisEnd,p):p,F=a.categorical.values[P].source.format;if(v.push({value:M,minValue:C,maxValue:O,formatString:F,color:D.fill,selected:!1,identity:k,tooltipData:L,categoryIndex:N}),m){var z=t.SelectionId.createWithHighlight(k),j=T.highlights[N],G=null!=j?j:0;L=t.TooltipBuilder.createTooltipInfo(h,n,I,M,null,null,P,N,G),x.push({value:G,minValue:C,maxValue:O,formatString:F,color:D.fill,selected:!1,identity:z,tooltipData:L,categoryIndex:N,highlight:!0})}}}return{categories:S,series:f,settings:d,legend:i.getLegendData(f,g),dataPoints:v,highlightedDataPoints:x,maxLabelsWidth:_.max(S.map(function(e){return e.width})),hasDynamicSeries:g,hasHighlights:m,labelHeight:y,legendObjectProperties:e.DataViewObjects.getObject(a.metadata.objects,"legend",{})}},i.parseSeries=function(e,a,r,s,o){var n,l,c=e?e[a]:null,u=c?c.source:null,h=s?s.identity:null,p=u?u.queryName:null,d=h?t.SelectionId.createWithId(h):t.SelectionIdBuilder.builder().withSeries(e,s).withMeasure(p).createSelectionId(),g=u?u.groupName?u.groupName:u.displayName:null;r&&s?(l=s.objects?s.objects.categoryAxis:null,n=s.objects):u&&(n=u.objects,l=n?n.categoryAxis:null);var m=i.getColor(i.Properties.dataPoint.fill,["purple","teal"][a],n,o),y=l?l.end:null;return{fill:m,name:g,selectionId:d,categoryAxisEnd:y}},i.getColor=function(e,i,a,r){var s=new t.ColorHelper(r,e,i);return s.getColorForMeasure(a,"")},i.getTextData=function(t,i,a,r,o){void 0===a&&(a=!1),void 0===r&&(r=!1);var n,l,c=0,u=0;return t=t||"",n=o?s.fromPoint(o):""+i.fontSize+i.sizeUnit,l={text:t,fontFamily:i.fontFamily,fontSize:n},a&&(c=e.TextMeasurementService.measureSvgTextWidth(l)),r&&(u=e.TextMeasurementService.estimateSvgTextHeight(l)),{text:t,width:c,height:u,textProperties:l}},Object.defineProperty(i.prototype,"allLabelsWidth",{
get:function(){return(this.dataView.settings.showCategories?Math.min(this.dataView.maxLabelsWidth,this.scrolling.scrollViewport.width/2):3)+i.CategoryLabelMargin},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"allColumnsWidth",{get:function(){return this.scrolling.scrollViewport.width-this.allLabelsWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"columnWidth",{get:function(){return this.dataView.series.length===i.MaxSeries?this.allColumnsWidth/2:this.allColumnsWidth},enumerable:!0,configurable:!0}),i.prototype.init=function(e){var a,r=this,s=e.style;this.hostService=e.host;var l=e.element;this.colors=s.colorPalette.dataColors;var c=e.interactivity;this.interactivityService=t.createInteractivityService(this.hostService);var u;this.svg?this.root=u=this.svg:this.root=u=d3.select(l.get(0)).append("svg"),u.classed(i.ClassName,!0).style("position","absolute"),a=u.style("font-size"),this.textOptions.sizeUnit=a.slice(a.length-2),this.textOptions.fontSize=Number(a.slice(0,a.length-2)),this.textOptions.fontFamily=u.style("font-family"),this.viewport=e.viewport,this.scrolling=new n(function(){return u},function(){return r.viewport},function(){return r.margin},function(){return r.dataView.categories.length*i.CategoryMinHeight},!0);var h=this.main=u.append("g");this.clearCatcher=t.appendClearCatcher(h),this.columns=h.append("g").classed(i.Columns["class"],!0),this.axes=h.append("g").classed(i.Axes["class"],!0),this.labels=h.append("g").classed(i.Labels["class"],!0),this.categories=h.append("g").classed(i.Categories["class"],!0),this.behavior=new o,this.legend=t.createLegend(l,c&&c.isInteractiveLegend,this.interactivityService,!0)},i.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){if(this.viewport={height:Math.max(0,e.viewport.height-this.margin.top-this.margin.bottom),width:Math.max(0,e.viewport.width-this.margin.left-this.margin.right)},this.animator?this.durationAnimations=t.AnimatorCommon.GetAnimationDuration(this.animator,e.suppressAnimations):this.durationAnimations=e.suppressAnimations?0:250,this.dataView=i.converter(this.validateDataView(e.dataViews[0]),this.textOptions,this.colors),!this.dataView||this.scrolling.scrollViewport.height<i.CategoryMinHeight)return void this.clearData();this.dataView&&this.interactivityService&&(this.interactivityService.applySelectionStateToData(this.dataView.dataPoints),this.interactivityService.applySelectionStateToData(this.dataView.highlightedDataPoints)),this.render()}},i.prototype.validateDataView=function(e){return e&&e.categorical&&e.categorical.values?e.categorical.values.length>i.MaxSeries?(this.hostService.setWarnings([r()]),null):e:null},i.prototype.updateElements=function(){var e=t.SVGUtil.translate(this.allLabelsWidth,0);this.root.attr({height:this.viewport.height+this.margin.top+this.margin.bottom,width:this.viewport.width+this.margin.left+this.margin.right}),this.columns.attr("transform",e),this.labels.attr("transform",e),this.axes.attr("transform",e)},i.parseSettings=function(a,r,s){var o=i.getPrecision(a),n=e.DataViewObjects.getValue(a,i.Properties.labels.labelDisplayUnits,i.DefaultTornadoChartSettings.labelSettings.displayUnits),l=i.DefaultTornadoChartSettings.labelSettings,c=function(e){return t.valueFormatter.create({format:e,precision:o,value:0===n&&null!=r?r:n})};return{labelOutsideFillColor:i.getColor(i.Properties.labels.outsideFill,i.DefaultTornadoChartSettings.labelOutsideFillColor,a,s),labelSettings:{show:e.DataViewObjects.getValue(a,i.Properties.labels.show,l.show),precision:o,fontSize:e.DataViewObjects.getValue(a,i.Properties.labels.fontSize,l.fontSize),displayUnits:n,labelColor:i.getColor(i.Properties.labels.insideFill,l.labelColor,a,s)},showCategories:e.DataViewObjects.getValue(a,i.Properties.categories.show,i.DefaultTornadoChartSettings.showCategories),showLegend:e.DataViewObjects.getValue(a,i.Properties.legend.show,i.DefaultTornadoChartSettings.showLegend),legendFontSize:e.DataViewObjects.getValue(a,i.Properties.legend.fontSize,i.DefaultTornadoChartSettings.legendFontSize),legendColor:i.getColor(i.Properties.legend.labelColor,i.DefaultTornadoChartSettings.legendColor,a,s),categoriesFillColor:i.getColor(i.Properties.categories.fill,i.DefaultTornadoChartSettings.categoriesFillColor,a,s),getLabelValueFormatter:c}},i.getPrecision=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.labels.labelPrecision,i.DefaultTornadoChartSettings.labelSettings.precision);return Math.min(Math.max(0,a),i.MaxPrecision)},i.getLegendData=function(e,i){var a=[];return i&&(a=e.map(function(e){return{label:e.name,color:e.fill,icon:t.LegendIcon.Box,selected:!1,identity:e.selectionId}})),{dataPoints:a}},i.prototype.render=function(){this.updateElements(),this.renderLegend(),this.scrolling.renderY(this.dataView,this.renderWithScrolling.bind(this))},i.prototype.clearData=function(){this.columns.selectAll("*").remove(),this.axes.selectAll("*").remove(),this.labels.selectAll("*").remove(),this.categories.selectAll("*").remove(),this.legend.drawLegend({dataPoints:[]},this.viewport),this.scrolling.clearData()},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.renderWithScrolling=function(e,t,a){if(this.dataView&&this.dataView.settings){var r=e.categories.length,s=t*r,o=a*r,n=Math.floor(s),l=Math.floor(o),c=Math.floor(this.scrolling.scrollViewport.height/i.CategoryMinHeight);1>a-t&&l-n>c&&(s-n>o-l?n++:o--),this.interactivityService&&(this.interactivityService.applySelectionStateToData(e.dataPoints),this.interactivityService.applySelectionStateToData(e.highlightedDataPoints)),e.categories=e.categories.slice(n,l),e.dataPoints=_.filter(e.dataPoints,function(e){return e.categoryIndex>=n&&e.categoryIndex<l}),e.highlightedDataPoints=_.filter(e.highlightedDataPoints,function(e){return e.categoryIndex>=n&&e.categoryIndex<l}),this.dataView=e,this.computeHeightColumn(),this.renderMiddleSection(),this.renderAxes(),this.renderCategories()}},i.prototype.updateViewport=function(){var e,i=this.legend.getMargins();switch(e=t.LegendPosition[this.dataView.legendObjectProperties[t.legendProps.position]]){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height-=i.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width-=i.width}},i.prototype.computeHeightColumn=function(){var e=this.dataView.categories.length;this.heightColumn=(this.scrolling.scrollViewport.height-(e-1)*this.columnPadding)/e},i.prototype.renderMiddleSection=function(){var e=this.dataView;this.calculateDataPoints(e.dataPoints),this.calculateDataPoints(e.highlightedDataPoints);var t=e.dataPoints.concat(e.highlightedDataPoints);this.renderColumns(t,2===e.series.length),this.renderLabels(this.dataView.hasHighlights?e.highlightedDataPoints:e.dataPoints,e.settings.labelSettings)},i.prototype.calculateDataPoints=function(e){for(var t=this.dataView.categories.length,a=this.dataView.settings,r=Math.max(this.heightColumn,0),s=r/2,o=r*i.HighlightedShapeFactor/2,n=this.dataView.series.length===i.MaxSeries,l=0;l<e.length;l++){var c=e[l],u=t>l&&n,h=l>t-1,p=this.getColumnWidth(c.value,c.minValue,c.maxValue,this.columnWidth),d=(this.columnWidth-p)*Number(u)+this.columnWidth*Number(h);d=Math.max(d,0);var g=this.dataView.hasHighlights&&c.highlight,m=g?r*(1-i.HighlightedShapeFactor)/2:0,y=(r+this.columnPadding)*(l%t)+m,f=this.getLabelData(c.value,d,p,u,c.formatString,a);c.dx=d,c.dy=y,c.px=p/2,c.py=g?o:s,c.angle=u?180:0,c.width=p,c.height=g?r*i.HighlightedShapeFactor:r,c.label=f}},i.prototype.renderColumns=function(e,a){var r=this;void 0===a&&(a=!1);var s=this.interactivityService&&this.interactivityService.hasSelection(),o=this.columns.selectAll(i.Column.selector).data(e);o.enter().append("svg:rect").classed(i.Column["class"],!0),o.style("fill",function(e){return e.color}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,s,r.dataView.hasHighlights)}).attr("transform",function(e){return t.SVGUtil.translateAndRotate(e.dx,e.dy,e.px,e.py,e.angle)}).attr("height",function(e){return e.height}).attr("width",function(e){return e.width}),o.exit().remove();var n=this.interactivityService;if(n){n.applySelectionStateToData(e);var l={columns:o,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};n.bind(e,this.behavior,l)}this.renderTooltip(o)},i.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipData})},i.prototype.getColumnWidth=function(e,t,i,a){if(t===i)return a;var r=a*(e-t)/(i-t);return Math.max(0,Math.min(a,r))},i.prototype.getLabelData=function(a,r,o,n,l,c){var u,h=c?c:this.dataView.settings,p=h.labelSettings,d=p.fontSize,g=p.labelColor,m=n?r-this.leftLabelMargin:this.allColumnsWidth-(r+o+this.leftLabelMargin),y=Math.max(m,o-this.leftLabelMargin),f={fontFamily:t.dataLabelUtils.StandardFontFamily,fontSize:s.fromPoint(d),text:h.getLabelValueFormatter(l).format(a)},v=e.TextMeasurementService.getTailoredTextOrDefault(f,y),x=i.getTextData(v,this.textOptions,!0,!1,d);return o>x.width+i.LabelPadding?u=r+o/2-x.width/2:(u=n?r-this.leftLabelMargin-x.width:r+o+this.leftLabelMargin,g=h.labelOutsideFillColor),{dx:u,source:a,value:v,color:g}},i.prototype.renderAxes=function(){var e,t,a=this.main.select(i.Axes.selector).selectAll(i.Axis.selector);return this.dataView.series.length!==i.MaxSeries?void a.remove():(e=this.generateAxesData(),t=a.data(e),t.enter().append("svg:line").classed(i.Axis["class"],!0),t.attr("x1",function(e){return e.x1}).attr("y1",function(e){return e.y1}).attr("x2",function(e){return e.x2}).attr("y2",function(e){return e.y2}),void t.exit().remove())},i.prototype.generateAxesData=function(){var e,t,i;return e=this.allColumnsWidth/2,t=0,i=this.scrolling.scrollViewport.height,[{x1:e,y1:t,x2:e,y2:i}]},i.prototype.renderLabels=function(e,a){var r,o=this,n=this.main.select(i.Labels.selector).selectAll(i.Label.selector).data(_.filter(e,function(e){return e.label.dx>=0}));if(!a.show||this.dataView.labelHeight>=this.heightColumn)return void this.labels.selectAll("*").remove();var l=s.fromPoint(a.fontSize),c=this.heightColumn/2+this.dataView.labelHeight/2-this.InnerTextHeightDelta,u=this.dataView.categories.length;r=n.enter().append("g"),r.append("svg:title").classed(i.LabelTitle["class"],!0),r.append("svg:text").attr("dy",t.dataLabelUtils.DefaultDy).classed(i.LabelText["class"],!0),n.attr("pointer-events","none").classed(i.Label["class"],!0),n.select(i.LabelTitle.selector).text(function(e){return e.label.source}),n.attr("transform",function(e,i){var a=(o.heightColumn+o.columnPadding)*(i%u);return t.SVGUtil.translate(e.label.dx,a+c)}),n.select(i.LabelText.selector).attr("fill",function(e){return e.label.color}).attr("font-size",function(e){return l}).text(function(e){return e.label.value}),n.exit().remove()},i.prototype.renderCategories=function(){var a,r,s=this,o=this.dataView.settings,n=o.categoriesFillColor,l=this.main.select(i.Categories.selector).selectAll(i.Category.selector);return o.showCategories?(r=l.data(this.dataView.categories),a=r.enter().append("g"),a.append("svg:title").classed(i.CategoryTitle["class"],!0),a.append("svg:text").classed(i.CategoryText["class"],!0),r.attr("transform",function(e,a){var r=(s.heightColumn+s.columnPadding)*a+s.heightColumn/2,o=i.getTextData(e,s.textOptions,!1,!0);return r=r+o.height/2-s.InnerTextHeightDelta,t.SVGUtil.translate(0,r)}).classed(i.Category["class"],!0),r.select(i.CategoryTitle.selector).text(function(e){return e.text}),r.select(i.CategoryText.selector).attr("fill",n).text(function(t){return s.dataView.settings.showCategories?e.TextMeasurementService.getTailoredTextOrDefault(i.getTextData(t.text,s.textOptions).textProperties,s.allLabelsWidth):""}),void r.exit().remove()):void l.remove()},i.prototype.renderLegend=function(){var e=this.dataView.legend;if(e){var i=this.dataView.settings,a={title:e.title,dataPoints:e.dataPoints,fontSize:i.legendFontSize,labelColor:i.legendColor};if(this.dataView.legendObjectProperties){var r;t.LegendData.update(a,this.dataView.legendObjectProperties),r=this.dataView.legendObjectProperties[t.legendProps.position],r&&this.legend.changeOrientation(t.LegendPosition[r])}var s={height:this.viewport.height+this.margin.top+this.margin.bottom,width:this.viewport.width+this.margin.left+this.margin.right};this.legend.drawLegend(a,s),t.Legend.positionChartArea(this.root,this.legend),a.dataPoints.length>0&&i.showLegend&&this.updateViewport()}},i.prototype.enumerateObjectInstances=function(i){var a,r=new t.ObjectEnumerationBuilder;if(!this.dataView||!this.dataView.settings)return[];switch(a=this.dataView.settings,i.objectName){case"dataPoint":this.enumerateDataPoint(r);break;case"categoryAxis":this.enumerateCategoryAxis(r);break;case"labels":var s=a.labelSettings,o={objectName:"labels",displayName:"Labels",selector:null,properties:{show:s.show,fontSize:s.fontSize,labelPrecision:s.precision,labelDisplayUnits:s.displayUnits,insideFill:s.labelColor,outsideFill:a.labelOutsideFillColor}};r.pushInstance(o);break;case"legend":if(!this.dataView.hasDynamicSeries)return;var n,l=!0,c="";l=e.DataViewObject.getValue(this.dataView.legendObjectProperties,t.legendProps.showTitle,l),c=e.DataViewObject.getValue(this.dataView.legendObjectProperties,t.legendProps.titleText,c),n={objectName:"legend",displayName:"Legend",selector:null,properties:{show:a.showLegend,position:t.LegendPosition[this.legend.getOrientation()],showTitle:l,titleText:c,fontSize:a.legendFontSize,labelColor:a.legendColor}},r.pushInstance(n);break;case"categories":var u={objectName:"categories",displayName:"Categories",selector:null,properties:{show:a.showCategories,fill:a.categoriesFillColor}};r.pushInstance(u)}return r.complete()},i.prototype.enumerateDataPoint=function(e){if(this.dataView&&this.dataView.series)for(var i=this.dataView.series,a=0,r=i.length;r>a;a++)e.pushInstance({objectName:"dataPoint",displayName:i[a].name,selector:t.ColorHelper.normalizeSelector(i[a].selectionId.getSelector(),!1),properties:{fill:{solid:{color:i[a].fill}}}})},i.prototype.enumerateCategoryAxis=function(e){if(this.dataView&&this.dataView.series)for(var t=this.dataView.series,i=0,a=t.length;a>i;i++)e.pushInstance({objectName:"categoryAxis",displayName:t[i].name,selector:t[i].selectionId?t[i].selectionId.getSelector():null,properties:{end:t[i].categoryAxisEnd}})},i.prototype.destroy=function(){this.root=null},i.ClassName="tornado-chart",i.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Group")},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Legend")},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Values")}],dataViewMappings:[{conditions:[{Category:{max:1},Values:{min:0,max:1},Series:{min:0,max:1}},{Category:{max:1},Values:{min:2,max:2},Series:{max:0}}],categorical:{categories:{"for":{"in":"Category"}},values:{group:{by:"Series",select:[{"for":{"in":"Values"}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},dataPoint:{displayName:"Data Colors",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},categoryAxis:{displayName:"X-Axis",properties:{end:{displayName:"End",type:{numeric:!0},suppressFormatPainterCopy:!0}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},labelPrecision:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},insideFill:{displayName:"Inside fill",type:{fill:{solid:{color:!0}}}},outsideFill:{displayName:"Outside fill",type:{fill:{solid:{color:!0}}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:e.data.createDisplayNameGetter("Visual_LegendPositionDescription"),type:{enumeration:t.legendPosition.type}},showTitle:{displayName:"Title",description:e.data.createDisplayNameGetter("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:"Legend Name",description:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"TextSize",type:{formatting:{fontSize:!0}}}}},categories:{displayName:"Group",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}}},supportsHighlight:!0},i.Properties=i.getProperties(i.capabilities),i.Columns={"class":"columns",selector:".columns"},i.Column={"class":"column",selector:".column"},i.Axes={"class":"axes",selector:".axes"},i.Axis={"class":"axis",selector:".axis"},i.Labels={"class":"labels",selector:".labels"},i.Label={"class":"label",selector:".label"},i.LabelTitle={"class":"label-title",selector:".label-title"},i.LabelText={"class":"label-text",selector:".label-text"},i.Categories={"class":"categories",selector:".categories"},i.Category={"class":"category",selector:".category"},i.CategoryTitle={"class":"category-title",selector:".category-title"},i.CategoryText={"class":"category-text",selector:".category-text"},i.MaxSeries=2,i.MaxPrecision=17,i.LabelPadding=2.5,i.CategoryMinHeight=25,i.DefaultFontSize=9,i.DefaultLegendFontSize=8,i.HighlightedShapeFactor=.5,i.CategoryLabelMargin=10,i.ScrollBarWidth=22,i.DefaultTornadoChartSettings={labelOutsideFillColor:t.dataLabelUtils.defaultLabelColor,labelSettings:{show:!0,precision:null,fontSize:i.DefaultFontSize,displayUnits:0,labelColor:t.dataLabelUtils.defaultInsideLabelColor},showCategories:!0,showLegend:!0,legendFontSize:i.DefaultLegendFontSize,legendColor:t.LegendData.DefaultLegendLabelFillColor,categoriesFillColor:"#777"},i}();i.TornadoChart=c}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){function i(e,t,i,a,r,s,o,n,l,c,u,h,d,g,y){var f=35,v=r.x,x=r.y1,b=r.y2,S=v.values,w=x.values,C=0,P=0,A=0,D=0,T=0,V=v.categoryThickness?v.categoryThickness/2:0,N=m.isOrdinalScale(v.scale),L=0;if(void 0!==v.outerPadding?L=v.outerPadding:void 0!==v.xLabelMaxWidth&&(L=Math.max(0,(e.width-v.xLabelMaxWidth*S.length)/2)),0!==m.getRecommendedNumberOfTicksForXAxis(e.width)||0!==m.getRecommendedNumberOfTicksForYAxis(e.height)){var M;if(M=u?m.LabelLayoutStrategy.DefaultRotationWithScrollbar:m.LabelLayoutStrategy.DefaultRotation,g)for(var k=0,I=w.length;I>k;k++)n.text=w[k],A=Math.max(A,i(n));if(b&&y)for(var O=b.values,k=0,I=O.length;I>k;k++)l.text=O[k],D=Math.max(D,i(l));var F=a(o),z=Math.floor(s/F),j=v.scale,G=j.domain();if(d&&S.length>0){for(var k=0,I=S.length;I>k;k++){var R;o.text=S[k];var B=i(o);if(v.willLabelsWordBreak){var H=p.splitByWidth(o.text,o,i,v.xLabelMaxWidth,z);R=H.length*F,B=v.xLabelMaxWidth}else!v.willLabelsFit&&N?(R=B*M.sine,B*=M.cosine):R=F;if(0===k){if(N)C=v.willLabelsFit?B/2-V-L:B-V-L,C=Math.max(C,0);else if(G.length>1){var E=j(G[0]);C=B/2-E,C=Math.max(C,0)}}else if(k===I-1)if(N)(v.willLabelsFit||v.willLabelsWordBreak)&&(P=B/2-V-L,P=Math.max(P,0));else if(G.length>1){var E=j(G[1]);P=B/2-(e.width-E),P=Math.max(P,0)}T=Math.max(T,R)}C=c?Math.min(C,f):0,P=c?Math.min(P,f):0}}var _=0,W=0,U=Math.min(Math.ceil(T),s);return h?(W=Math.min(Math.max(C,D),t),_=Math.min(Math.max(P,A),t)):(W=Math.min(Math.max(C,A),t),_=Math.min(Math.max(P,D),t)),{xMax:Math.ceil(U),yLeft:Math.ceil(W),yRight:Math.ceil(_)}}function r(e,t,i){return i>1?e&&e.length>t?[e[t]]:[]:e}function s(e,t,i){return 0===e&&!!t&&!!t.showAxisTitle||1===e&&!i&&!!t&&!!t.secShowAxisTitle}function o(e,t,i,a,r,o,n){var l={viewport:t,margin:i,forcedXDomain:[a?a.start:null,a?a.end:null],forceMerge:r&&r.secShow===!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:a&&null!=a.axisScale?a.axisScale:z.linear,valueAxisScaleType:r&&null!=r.axisScale?r.axisScale:z.linear,trimOrdinalDataOnOverflow:!1},c=!1;r&&(l.forcedYDomain=m.applyCustomizedDomain([r.start,r.end],l.forcedYDomain));for(var u,h=0,p=e.length;p>h;h++){var d=e[h];l.showCategoryAxisLabel=!!a&&!!a.showAxisTitle,l.showValueAxisLabel=s(h,r,c);var g=d.calculateAxesProperties(l);0===h&&(u={x:g[0],y1:g[1]}),u.x.willLabelsFit=!1,u.x.willLabelsWordBreak=!1}return u}function n(e,t,i,a,r){void 0===r&&(r=!0);var s=[],o={isScrollable:r,animator:a,interactivityService:i};return s.push(l(te.hundredPercentStackedColumn,o)),s}function l(e,t){var i={animator:t.animator,interactivityService:t.interactivityService,isScrollable:t.isScrollable,chartType:e};return new oe(i)}var c=a.EnumExtensions,u=a.PixelConverter,h=a.ArrayExtensions,p=a.WordBreaker,d=a.CssConstants.createClassAndSelector,g=e.visuals.NewDataLabelUtils,m=e.visuals.AxisHelper,y=e.visuals.valueFormatter,f=e.Double,v=e.TextMeasurementService,x=e.VisualDataRoleKind,b=e.data.createDisplayNameGetter,S=e.visuals.LegendData,w=e.DataViewObject,C=e.visuals.InteractivityUtils,P=e.visuals.yAxisPosition,A=e.visuals.appendClearCatcher,D=e.visuals.createInteractivityService,T=e.visuals.createLegend,V=e.visuals.SVGUtil,N=e.DataViewObjects,L=e.visuals.axisType,M=e.visuals.getInvalidValueWarnings,k=e.visuals.dataLabelUtils,I=e.visuals.ObjectEnumerationBuilder,O=e.visuals.legendProps,F=e.visuals.LegendPosition,z=e.visuals.axisScale,j=e.visuals.axisStyle,G=e.Prototype,R=e.visuals.AnimatorCommon.GetAnimationDuration,B=e.LabelLayout,H=e.visuals.converterHelper,E=e.visuals.SelectionIdBuilder,W=e.visuals.TooltipBuilder,U=e.visuals.SelectionId,Y=e.visuals.GradientUtils,X=e.visuals.ColorHelper,q=e.visuals.LegendIcon,K=e.visuals.TooltipManager,Z=2,J=4,Q=8,$=16,ee=32|$;!function(e){e[e.clusteredBar=Z|Q]="clusteredBar",e[e.clusteredColumn=J|Q]="clusteredColumn",e[e.hundredPercentStackedBar=Z|ee]="hundredPercentStackedBar",e[e.hundredPercentStackedColumn=J|ee]="hundredPercentStackedColumn",e[e.stackedBar=Z|$]="stackedBar",e[e.stackedColumn=J|$]="stackedColumn"}(t.MekkoVisualChartType||(t.MekkoVisualChartType={}));var te=t.MekkoVisualChartType;!function(e){e[e.HundredPercentStackedColumn=0]="HundredPercentStackedColumn"}(t.MekkoChartType||(t.MekkoChartType={}));var ie=(t.MekkoChartType,function(){function e(e,t){this.data=e,this.isScalar=t}return e.prototype.lookupXValue=function(e,t){var i=m.isDateTime(t);if(i&&this.isScalar)return new Date(e);var a=this.data;if(t.text)return a.categories[e];var r=a.series[0];if(r){var s=r.data;if(s){this.data.hasHighlights&&(e=2*e);var o=s[e];if(o)return i?new Date(o.categoryValue):o.categoryValue}}return e},e}());t.MekkoDataWrapper=ie;var ae=function(){function e(){}return e.prototype.setupVisualProps=function(e){this.graphicsContext=e,this.margin=e.margin,this.width=this.graphicsContext.width,this.height=this.graphicsContext.height,this.categoryLayout=e.layout,this.animator=e.animator,this.interactivityService=e.interactivityService,this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth},e.prototype.setData=function(e){this.data=e},e.createFormatter=function(e,t,i,a,r,s,o,n,l){void 0===l&&(l=!1);var c;if(i.dateTime)if(a){var u=new Date(e[0]),h=new Date(e[1]);1===s&&(u=h=new Date(t[0])),c=y.create({format:r,value:u,value2:h,tickCount:s})}else{var p=n(0,i),d=n(e.length-1,i);c=y.create({format:r,value:p,value2:d,tickCount:s})}else if(l&&a&&o.length>1){var g=o[1]-o[0],m=0;c=y.create({format:r,value:g,value2:m,allowFormatBeautification:!0})}else c=y.createDefaultFormatter(r,!0);return c},e.formatAxisTickValues=function(e,t,i,a,r,s){var o=[];return i?!s||a.numeric&&r?(e.tickFormat(function(e){return i.format(e)}),o=t.map(function(e){return i.format(e)})):(e.tickFormat(function(e){return i.format(s(e,a))}),o=t.map(function(e){return i.format(s(e,a))})):o=t.map(function(e){return s(e,a)}),o},e.prototype.createAxis=function(t){var i=t.pixelSpan,a=t.dataDomain,r=t.metaDataColumn,s=t.formatStringProp,o=t.outerPadding||0,n=!!t.isCategoryAxis,l=!!t.isScalar,c=!!t.isVertical,u=!!t.useTickIntervalForDisplayUnits,h=t.getValueFn,p=t.categoryThickness,d=y.getFormatString(r,s),g=m.getCategoryValueType(r,l),f=m.isLogScalePossible(a,g),v=d3.scale.linear(),x=[0,1],b=a.length||1,S=oe.getBorderWidth(t.borderSettings),w=i-S*(b-1);w<re.MinOrdinalRectThickness&&(w=re.MinOrdinalRectThickness),v.domain(x).range([0,w]);var C=a,P=e.createFormatter(x,a,g,l,d,b,C,h,u),A=d3.svg.axis().scale(v).tickSize(6,0).orient(c?"left":"bottom").ticks(b).tickValues(a),D=[];r&&(D=e.formatAxisTickValues(A,C,P,g,l,h));var T;if(!l&&p)T=Math.max(1,p-2*re.TickLabelPadding);else{var V=C.length>1?C.length+1:C.length;T=V>1?i/V:i,T=Math.max(1,T-2*re.TickLabelPadding)}return{scale:v,axis:A,formatter:P,values:D,axisType:g,axisLabel:null,isCategoryAxis:n,xLabelMaxWidth:T,categoryThickness:p,outerPadding:o,usingDefaultDomain:!1,isLogScaleAllowed:f}},e.prototype.getCategoryAxis=function(e,t,i,a,r,s,o){var n=i.categoryThickness,l=i.isScalar,c=i.outerPaddingRatio,u=new ie(e,l),h=[];if(e.series&&e.series.length>0&&e.series[0].data&&e.series[0].data.length>0){var p=e.series[0].data.map(function(e){return e.originalPosition+e.value/2});h=p.filter(function(e,t){return p.indexOf(e)===t})}var d=this.createAxis({pixelSpan:t,dataDomain:h,metaDataColumn:e.categoryMetadata,formatStringProp:re.Properties.general.formatString,outerPadding:n*c,isCategoryAxis:!0,isScalar:l,isVertical:a,categoryThickness:n,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){var i=h.indexOf(e),a=u.lookupXValue(i,t);return a},scaleType:o,borderSettings:e.borderSettings});return i.categoryThickness=d.categoryThickness,d},e.prototype.setXScale=function(e,t,i,a){var r,s,o=this.width;i&&2===i.length&&(r=i[0],s=i[1]);var n=this.xProps=this.getCategoryAxis(this.data,o,this.categoryLayout,!1,r,s,a);return n},e.prototype.setYScale=function(e,t,i,a){var r=this.viewportHeight,s=ue.calcValueDomain(this.data.series,e),o=[s.min,s.max],n=m.combineDomain(i,o),l=m.scaleShouldClamp(n,o),c=this.data.valuesMetadata[0],u=e?this.graphicsContext.hostService.getLocalizedString("Percentage"):y.getFormatString(c,re.Properties.general.formatString),h={pixelSpan:r,dataDomain:n,metaDataColumn:c,formatString:u,outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:t,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:a,axisDisplayUnits:0,axisPrecision:0,is100Pct:e,shouldClamp:l,formatStringProp:void 0};return this.yProps=m.createAxis(h),this.yProps},e.prototype.drawColumns=function(t){var i=this.data;this.columnsCenters=null;var a,r,s={columnWidth:0,xScale:this.xProps.scale,yScale:this.yProps.scale,isScalar:this.categoryLayout.isScalar,margin:this.margin},o=this.layout=e.getLayout(i,s),n=this.createMekkoLabelDataPoints(),l=ue.drawSeries(i,this.graphicsContext.mainGraphicsContext,s);return this.animator&&t&&(a=this.animator.animate({viewModel:i,series:l,layout:o,itemCS:e.Classes.item,interactivityService:this.interactivityService,mainGraphicsContext:this.graphicsContext.mainGraphicsContext,viewPort:{height:this.height,width:this.width}}),r=a.shapes),this.animator&&t&&!a.failed||(r=e.drawDefaultShapes(i,l,o,e.Classes.item,!this.animator,this.interactivityService&&this.interactivityService.hasSelection())),ue.applyInteractivity(r,this.graphicsContext.onDragStart),{shapesSelection:r,viewport:{height:this.height,width:this.width},axisOptions:s,labelDataPoints:n}},e.drawDefaultShapes=function(e,t,i,a,r,s){var o="rect";r=!1;var n;n=r?function(e){var t=_.filter(e.data,function(e){return!!e.value});return t}:function(e){return e.data};var l=t.selectAll(a.selector),c=l.data(n,function(e){return e.key});c.enter().append(o).attr("class",function(e){return a["class"].concat(e.highlight?" highlight":"")}),c.style("fill",function(e){return e.color}).style("fill-opacity",function(t){return ue.getFillOpacity(t.selected,t.highlight,s,e.hasHighlights)}).attr(i.shapeLayout),c.exit().remove();var u=t.selectAll(oe.BorderClass.selector),h=u.data(n,function(e){return e.key}),p=oe.getBorderColor(e.borderSettings);return h.enter().append(o).classed(oe.BorderClass["class"],!0),h.style("fill",function(e){return p}).style("fill-opacity",function(t){return e.hasHighlights?ue.DimmedOpacity:ue.DefaultOpacity}).attr(i.shapeBorder),h.exit().remove(),c},e.prototype.selectColumn=function(t,i){ue.setChosenColumnOpacity(this.graphicsContext.mainGraphicsContext,e.Classes.item.selector,t,i),this.moveHandle(t)},e.prototype.getClosestColumnIndex=function(e,t){return ue.getClosestColumnIndex(e,this.getColumnsCenters())},e.prototype.getColumnsCenters=function(){var e=this;if(!this.columnsCenters){var t=this.categoryLayout.categoryThickness*(1-re.InnerPaddingRatio);if(this.data.series.length>0){var i=0;this.categoryLayout.isScalar||(i=t/2);var a=this.data.series[0];a&&a.data&&(this.columnsCenters=a.data.map(function(t){return e.xProps.scale(e.categoryLayout.isScalar?t.categoryValue:t.categoryIndex)+i}))}}return this.columnsCenters},e.prototype.moveHandle=function(e){var t=this.getColumnsCenters(),i=t[e];if(this.columnSelectionLineHandle){var a=this.columnSelectionLineHandle;a.select("line").attr({x1:i,x2:i}),a.select("circle").attr({cx:i})}else{var a=this.columnSelectionLineHandle=this.graphicsContext.mainGraphicsContext.append("g");a.append("line").classed("interactive-hover-line",!0).attr({x1:i,x2:i,y1:0,y2:this.height}),a.append("circle").attr({cx:i,cy:this.height,r:"6px"}).classed("drag-handle",!0)}},e.getLayout=function(e,t){var i=t.xScale,a=t.yScale,r=a(0),s=i(0),o=oe.getBorderWidth(e.borderSettings),n=function(e){var t=m.diffScaled(i,e.value,0);return t},l=function(e){var t=s+m.diffScaled(i,e.originalPosition,0)+o*e.categoryIndex;return t},c=function(e){var t=s+m.diffScaled(i,e.originalPosition,0)+m.diffScaled(i,e.value,0)+o*e.categoryIndex;return t};return{shapeLayout:{width:n,x:l,y:function(e){return r+m.diffScaled(a,e.position,0)},height:function(e){return ue.getSize(a,e.valueAbsolute)}},shapeBorder:{width:function(e){return o},x:c,y:function(e){return r+m.diffScaled(a,e.position,0)},height:function(e){return ue.getSize(a,e.valueAbsolute)}},shapeLayoutWithoutHighlights:{width:n,x:l,y:function(e){return r+m.diffScaled(a,e.position,0)},height:function(e){return ue.getSize(a,e.originalValueAbsolute)}},zeroShapeLayout:{width:n,x:l,y:function(e){return r+m.diffScaled(a,e.position,0)+ue.getSize(a,e.valueAbsolute)},height:function(e){return 0}},shapeXAxis:{width:n,x:l,y:function(e){return r+m.diffScaled(a,e.position,0)},height:function(e){return ue.getSize(a,e.valueAbsolute)}}}},e.prototype.createMekkoLabelDataPoints=function(){for(var t=[],i=this.data,a=i.series,r=g.createColumnFormatterCacheManager(),s=this.layout.shapeLayout,o=0,n=a.length;n>o;o++){var l=a[o],c=l.labelSettings?l.labelSettings:i.labelSettings;if(c.show&&l.data)for(var u=g.getDisplayUnitValueFromAxisFormatter(this.yProps.formatter,c),h=0;h<l.data.length;h++){var p=l.data[h];if((!i.hasHighlights||p.highlight)&&null!=p.value){var d={left:s.x(p),top:s.y(p),width:s.width(p),height:s.height(p)},m=null,y=p.valueOriginal;c.displayUnits||(m=g.hundredPercentFormat,y=p.valueAbsolute);var f=r.getOrCreate(m,c,u),x=g.getLabelFormattedText(f.format(y)),b={text:x,fontFamily:g.LabelTextProperties.fontFamily,fontSize:g.LabelTextProperties.fontSize,fontWeight:g.LabelTextProperties.fontWeight},S=v.measureSvgTextWidth(b),w=v.estimateSvgTextHeight(b);t.push({isPreferred:!0,text:x,textSize:{width:S,height:w},outsideFill:c.labelColor?c.labelColor:g.defaultLabelColor,insideFill:c.labelColor?c.labelColor:g.defaultInsideLabelColor,isParentRect:!0,parentShape:{rect:d,orientation:1,
validPositions:e.validLabelPositions},identity:p.identity,parentType:1})}}}return t},e.Classes={item:d("column"),highlightItem:d("highlightColumn")},e.validLabelPositions=[1],e}();t.MekkoChartStrategy=ae;var re=function(){function e(e){this.isScrollable=!1,e?(this.type=e.chartType,e.isScrollable&&(this.isScrollable=e.isScrollable),this.animator=e.animator,e.cartesianSmallViewPortProperties&&(this.cartesianSmallViewPortProperties=e.cartesianSmallViewPortProperties),e.behavior&&(this.behavior=e.behavior)):this.behavior=new le([new ce])}return e.getTextProperties=function(t){return void 0===t&&(t=e.FontSize),{fontFamily:"wf_segoe-ui_normal",fontSize:u.toString(t)}},e.prototype.init=function(t){this.visualInitOptions=t,this.layers=[];var i=this.element=t.element,a=this.currentViewport=t.viewport;this.hostServices=t.host,this.brush=d3.svg.brush(),i.addClass(e.ClassName),this.margin={top:1,right:1,bottom:1,left:1},this.yAxisOrientation=P.left,this.adjustMargins(a),this.sharedColorPalette=new he(t.style.colorPalette.dataColors);var r=!0,s=!0,o=this.svg=d3.select(i.get(0)).append("svg");o.style("position","absolute");var n=this.axisGraphicsContext=o.append("g").classed(e.AxisGraphicsContextClassName,!0);this.svgScrollable=o.append("svg").classed("svgScrollable",!0).style("overflow","hidden");var l=this.axisGraphicsContextScrollable=this.svgScrollable.append("g").classed(e.AxisGraphicsContextClassName,!0);this.labelGraphicsContextScrollable=this.svgScrollable.append("g").classed(g.labelGraphicsContextClass["class"],!0),this.behavior&&(this.clearCatcher=A(this.axisGraphicsContextScrollable));var c=r?l:n;this.xAxisGraphicsContext=r?n.append("g").attr("class","x axis"):l.append("g").attr("class","x axis"),this.y1AxisGraphicsContext=c.append("g").attr("class","y axis"),this.y2AxisGraphicsContext=c.append("g").attr("class","y axis"),this.xAxisGraphicsContext.classed("showLinesOnAxis",r),this.y1AxisGraphicsContext.classed("showLinesOnAxis",s),this.y2AxisGraphicsContext.classed("showLinesOnAxis",s),this.xAxisGraphicsContext.classed("hideLinesOnAxis",!r),this.y1AxisGraphicsContext.classed("hideLinesOnAxis",!s),this.y2AxisGraphicsContext.classed("hideLinesOnAxis",!s),this.behavior&&(this.interactivityService=D(this.hostServices)),this.legend=T(i,t.interactivity&&t.interactivity.isInteractiveLegend,this.interactivityService,!0)},e.prototype.renderAxesLabels=function(t){this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();var i=this.margin,a=t.viewport.width-(i.left+i.right),r=t.viewport.height,s=e.FontSize,o=s,n=this.yAxisOrientation===P.right;if(!t.hideXAxisTitle){var l=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.axisLabels.x).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"xAxisLabel",transform:V.translate(a/2,r-o)})})});l.style("fill",t.xLabelColor?t.xLabelColor.solid.color:null),l.call(m.LabelLayoutStrategy.clip,a,v.svgEllipsis)}if(!t.hideYAxisTitle){var c=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.axisLabels.y).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:n?a+i.right-s:-i.left,x:-((r-i.top-t.legendMargin)/2),dy:"1em"})})});c.style("fill",t.yLabelColor?t.yLabelColor.solid.color:null),c.call(m.LabelLayoutStrategy.clip,r-(i.bottom+i.top),v.svgEllipsis)}if(!t.hideY2AxisTitle&&t.axisLabels.y2){var u=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.axisLabels.y2).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:n?-i.left:a+i.right-s,x:-((r-i.top-t.legendMargin)/2),dy:"1em"})})});u.style("fill",t.y2LabelColor?t.y2LabelColor.solid.color:null),u.call(m.LabelLayoutStrategy.clip,r-(i.bottom+i.top),v.svgEllipsis)}},e.prototype.adjustMargins=function(e){var t=this.margin,i=e.width-(t.left+t.right),a=e.height-(t.top+t.bottom),r=this.element.find(".x.axis");0===m.getRecommendedNumberOfTicksForXAxis(i)&&0===m.getRecommendedNumberOfTicksForYAxis(a)?(this.margin={top:0,right:0,bottom:0,left:0},r.hide()):r.show()},e.prototype.translateAxes=function(t){this.adjustMargins(t);var i=this.margin,a=t.width-(i.left+i.right),r=t.height-(i.top+i.bottom),s=this.yAxisOrientation===P.right;this.xAxisGraphicsContext.attr("transform",V.translate(0,r)),this.y1AxisGraphicsContext.attr("transform",V.translate(s?a:0,0)),this.y2AxisGraphicsContext.attr("transform",V.translate(s?0:a,0)),this.svg.attr({width:t.width,height:t.height}),this.svg.style("top",this.legend.isVisible()?this.legend.getMargins().height+"px":0),this.svgScrollable.attr({width:t.width,height:t.height}),this.svgScrollable.attr({x:0}),this.axisGraphicsContext.attr("transform",V.translate(i.left,i.top)),this.axisGraphicsContextScrollable.attr("transform",V.translate(i.left,i.top)),this.labelGraphicsContextScrollable.attr("transform",V.translate(i.left,i.top)),this.isXScrollBarVisible?(this.svgScrollable.attr({x:this.margin.left}),this.axisGraphicsContextScrollable.attr("transform",V.translate(0,i.top)),this.labelGraphicsContextScrollable.attr("transform",V.translate(0,i.top)),this.svgScrollable.attr("width",a),this.svg.attr("width",t.width).attr("height",t.height+e.ScrollBarWidth)):this.isYScrollBarVisible&&(this.svgScrollable.attr("height",r+i.top),this.svg.attr("width",t.width+e.ScrollBarWidth).attr("height",t.height))},e.getPreferredCategorySpan=function(t,i,a){var r=i*t;return a?r:r+i*e.OuterPaddingRatio*2},e.getIsScalar=function(e,t,i){var a=N.getValue(e,t);return e&&void 0!==a?a===L.scalar&&!m.isOrdinal(i):!m.isOrdinal(i)},e.prototype.populateObjectProperties=function(e){if(e&&e.length>0){var t=e[0].metadata;if(t?(this.legendObjectProperties=N.getObject(t.objects,"legend",{}),this.borderObjectProperties=N.getObject(t.objects,"columnBorder",{})):(this.legendObjectProperties={},this.borderObjectProperties={}),this.categoryAxisProperties=pe.getCategoryAxisProperties(t),this.valueAxisProperties=pe.getValueAxisProperties(t),t&&t.objects){var i=t.objects.categoryAxis,a=t.objects.valueAxis;i&&(this.categoryAxisProperties.showBorder=i.showBorder,this.categoryAxisProperties.fontSize=i.fontSize),a&&(this.valueAxisProperties.fontSize=a.fontSize)}var r=this.valueAxisProperties.position;this.yAxisOrientation=r?r.toString():P.left}},e.prototype.update=function(t){var i=this.dataViews=t.dataViews;if(this.currentViewport=t.viewport,!i)return void this.clearViewport();if(this.currentViewport.width<e.MinWidth||this.currentViewport.height<e.MinHeight)return void this.clearViewport();0===this.layers.length&&(this.layers=this.createAndInitLayers(i));var a=this.layers;if(i&&i.length>0){var s=M(i,!1,!1,!1);s&&s.length>0&&this.hostServices.setWarnings(s),this.populateObjectProperties(i)}this.sharedColorPalette.clearPreferredScale();for(var o=0,n=a.length;n>o;o++)a[o].setData(r(i,o,n)),n>1&&this.sharedColorPalette.rotateScale();this.visualInitOptions.interactivity&&this.visualInitOptions.interactivity.isInteractiveLegend||this.renderLegend(),this.render(!this.hasSetData||t.suppressAnimations),this.hasSetData=this.hasSetData||i&&i.length>0},e.prototype.clearViewport=function(){this.legend.reset(),this.setVisibility(!1)},e.prototype.setVisibility=function(e){void 0===e&&(e=!0),this.svg.style("display",e?"block":"none"),this.element.find(".legend").toggle(e)},e.getLayout=function(t,i){var a=i.categoryCount,r=i.availableWidth,s=i.domain,o=i.trimOrdinalDataOnOverflow,n=!!i.isScalar,l=!!i.isScrollable,c=e.getCategoryThickness(t?t.series:null,a,r,s,n,o),u=c*e.OuterPaddingRatio*2,h=f.floorWithPrecision((r-u)/c),p=Math.min(h,a),d=a>p&&l,g=e.OuterPaddingRatio;if(!n&&!d){var m=(r-c*p)/2;g=m/c}return!n&&l&&(p=a),{categoryCount:p,categoryThickness:c,outerPaddingRatio:g,isScalar:n}},e.getCategoryThickness=function(t,i,a,r,s,o){var n;if(2>i)n=a*(1-e.OuterPaddingRatio);else if(s&&r&&r.length>1){var l=e.getMinInterval(t),c=r[r.length-1]-r[0],u=l/(c+l*e.OuterPaddingRatio*2);n=a*u,n=Math.max(n,e.MinScalarRectThickness)}else n=a/(i+2*e.OuterPaddingRatio),o&&(n=Math.max(n,e.MinOrdinalRectThickness));var h=a/(3+2*e.OuterPaddingRatio);return n=Math.min(n,h),!s&&i>=3&&o?Math.max(n,e.MinOrdinalRectThickness):n},e.getMinInterval=function(e){var t=Number.MAX_VALUE;if(e.length>0)for(var i=e[0].data.filter(function(e){return!e.highlight}),a=0,r=i.length-1;r>a;a++)t=Math.min(t,Math.abs(i[a+1].categoryValue-i[a].categoryValue));return t},e.parseLabelSettings=function(t){var i=k.getDefaultColumnLabelSettings(!0),a=t.labels,r=e.DefaultSettings.labelSettings.minPrecision,s=e.DefaultSettings.labelSettings.maxPrecision;return k.updateLabelSettingsFromLabelsObject(a,i),i.precision<r&&(i.precision=r),i.precision>s&&(i.precision=s),i},e.parseBorderSettings=function(t){var i=N.getValue(t,e.Properties.columnBorder.show,e.DefaultSettings.columnBorder.show),a=N.getFillColor(t,e.Properties.columnBorder.color,e.DefaultSettings.columnBorder.color),r=N.getValue(t,e.Properties.columnBorder.width,e.DefaultSettings.columnBorder.width),s=e.DefaultSettings.columnBorder.maxWidth;return r>s?r=s:0>r&&(r=0),i||(r=0),{show:i,color:a,width:r}},e.prototype.enumerateBorder=function(t){var i={columnBorder:this.borderObjectProperties},a=N.getValue(i,e.Properties.columnBorder.show,e.DefaultSettings.columnBorder.show),r=N.getFillColor(i,e.Properties.columnBorder.color,e.DefaultSettings.columnBorder.color),s=N.getValue(i,e.Properties.columnBorder.width,e.DefaultSettings.columnBorder.width),o=e.DefaultSettings.columnBorder.maxWidth;s>o?s=o:0>s&&(s=0);var n={objectName:"columnBorder",selector:null,properties:{show:a,color:r,width:s}};t.pushInstance(n)},e.prototype.enumerateObjectInstances=function(e){var t=new I,i=this.layers?this.layers.length:0;if("columnBorder"===e.objectName)this.enumerateBorder(t);else if("legend"===e.objectName){if(!this.shouldShowLegendCard())return;var a=w.getValue(this.legendObjectProperties,O.show,this.legend.isVisible()),r=w.getValue(this.legendObjectProperties,O.showTitle,!0),s=w.getValue(this.legendObjectProperties,O.titleText,this.layerLegendData&&this.layerLegendData.title?this.layerLegendData.title:""),o=w.getValue(this.legendObjectProperties,O.fontSize,this.layerLegendData&&this.layerLegendData.fontSize?this.layerLegendData.fontSize:g.DefaultLabelFontSizeInPt);t.pushInstance({selector:null,properties:{show:a,position:F[this.legend.getOrientation()],showTitle:r,titleText:s,fontSize:o},objectName:e.objectName})}else"categoryAxis"===e.objectName&&this.hasCategoryAxis?this.getCategoryAxisValues(t):"valueAxis"===e.objectName&&this.getValueAxisValues(t);for(var n=0,l=i;l>n;n++){var c=this.layers[n];c.enumerateObjectInstances&&c.enumerateObjectInstances(t,e)}return t.complete()},e.prototype.shouldShowLegendCard=function(){var e=this.layers,t=this.dataViews;if(e&&t)for(var i=e.length,a=0,r=0;i>r;r++){if(e[r].hasLegend())return!0;var s=t[r];if(s&&s.categorical&&s.categorical.values&&s.categorical.values.length>0&&(a++,a>1))return!0}return!1},e.prototype.getCategoryAxisValues=function(e){var t=L.both,i=!1,a=!!this.axes.x.isLogScaleAllowed,r=[z.log,z.linear];this.layers&&this.layers[0].getSupportedCategoryAxisType&&(t=this.layers[0].getSupportedCategoryAxisType(),i=t===L.scalar?!0:pe.isScalar(t===L.both,this.categoryAxisProperties)),i||this.categoryAxisProperties&&(this.categoryAxisProperties.start=null,this.categoryAxisProperties.end=null);var s={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:r}};s.properties.show=this.categoryAxisProperties&&null!=this.categoryAxisProperties.show?this.categoryAxisProperties.show:!0,this.yAxisIsCategorical&&(s.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:P.left),t===L.both&&(s.properties.axisType=i?L.scalar:L.categorical),i&&(s.properties.axisScale=this.categoryAxisProperties&&null!=this.categoryAxisProperties.axisScale&&a?this.categoryAxisProperties.axisScale:z.linear,s.properties.start=this.categoryAxisProperties?this.categoryAxisProperties.start:null,s.properties.end=this.categoryAxisProperties?this.categoryAxisProperties.end:null),s.properties.showAxisTitle=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showAxisTitle?this.categoryAxisProperties.showAxisTitle:!1,s.properties.showBorder=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showBorder?this.categoryAxisProperties.showAxisTitle:!1,s.properties.fontSize=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:g.DefaultLabelFontSizeInPt,e.pushInstance(s).pushInstance({selector:null,properties:{axisStyle:this.categoryAxisProperties&&this.categoryAxisProperties.axisStyle?this.categoryAxisProperties.axisStyle:j.showTitleOnly,labelColor:this.categoryAxisProperties?this.categoryAxisProperties.labelColor:null,fontSize:this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:g.DefaultLabelFontSizeInPt},objectName:"categoryAxis",validValues:{axisStyle:this.categoryAxisHasUnitType?[j.showTitleOnly,j.showUnitOnly,j.showBoth]:[j.showTitleOnly]}})},e.prototype.getValueAxisValues=function(e){var t=[z.log,z.linear],i=!!this.axes.y1.isLogScaleAllowed,a={selector:null,properties:{},objectName:"valueAxis",validValues:{axisScale:t,secAxisScale:t}};a.properties.show=this.valueAxisProperties&&null!=this.valueAxisProperties.show?this.valueAxisProperties.show:!0,this.yAxisIsCategorical||(a.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:P.left),a.properties.axisScale=this.valueAxisProperties&&null!=this.valueAxisProperties.axisScale&&i?this.valueAxisProperties.axisScale:z.linear,a.properties.start=this.valueAxisProperties?this.valueAxisProperties.start:null,a.properties.end=this.valueAxisProperties?this.valueAxisProperties.end:null,a.properties.showAxisTitle=this.valueAxisProperties&&null!=this.valueAxisProperties.showAxisTitle?this.valueAxisProperties.showAxisTitle:!1,a.properties.fontSize=this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:g.DefaultLabelFontSizeInPt,e.pushInstance(a).pushInstance({selector:null,properties:{axisStyle:this.valueAxisProperties&&null!=this.valueAxisProperties.axisStyle?this.valueAxisProperties.axisStyle:j.showTitleOnly,labelColor:this.valueAxisProperties?this.valueAxisProperties.labelColor:null,fontSize:this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:g.DefaultLabelFontSizeInPt},objectName:"valueAxis",validValues:{axisStyle:this.valueAxisHasUnitType?[j.showTitleOnly,j.showUnitOnly,j.showBoth]:[j.showTitleOnly]}}),2===this.layers.length&&(a.properties.secShow=this.valueAxisProperties&&null!=this.valueAxisProperties.secShow?this.valueAxisProperties.secShow:this.y2AxisExists,a.properties.secShow&&(a.properties.axisLabel=""))},e.prototype.onClearSelection=function(){if(this.hasSetData)for(var e=0,t=this.layers.length;t>e;e++){var i=this.layers[e];i.onClearSelection(),i.render(!0)}},e.prototype.createAndInitLayers=function(e){var t,i=this;if(e&&e.length>0){var a=e[0].metadata;a&&(t=a.objects)}var r=n(this.type,t,this.interactivityService,this.animator,this.isScrollable),s=G.inherit(this.visualInitOptions);s.svg=this.axisGraphicsContextScrollable,s.cartesianHost={updateLegend:function(e){return i.legend.drawLegend(e,i.currentViewport)},getSharedColors:function(){return i.sharedColorPalette},triggerRender:void 0};for(var o=0,l=r.length;l>o;o++)r[o].init(s);return r},e.prototype.renderLegend=function(){for(var e=this.layers,t={title:"",dataPoints:[]},i=0,a=e.length;a>i;i++)this.layerLegendData=e[i].calculateLegend(),this.layerLegendData&&(t.title=0===i?this.layerLegendData.title||"":t.title,t.dataPoints=t.dataPoints.concat(this.layerLegendData.dataPoints||[]),this.layerLegendData.grouped&&(t.grouped=!0));var r=this.legendObjectProperties;if(r){r.fontSize||(r.fontSize=g.DefaultLabelFontSizeInPt),S.update(t,r);var s=r[O.position];s&&this.legend.changeOrientation(F[s])}else this.legend.changeOrientation(F.Top);(1===t.dataPoints.length&&!t.grouped||this.hideLegends())&&(t.dataPoints=[]),this.legend.drawLegend(t,this.currentViewport)},e.prototype.hideLegends=function(){return!!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideLegendOnSmallViewPort&&this.currentViewport.height<this.cartesianSmallViewPortProperties.MinHeightLegendVisible)},e.prototype.addUnitTypeToAxisLabel=function(t){var i=e.getUnitType(t,function(e){return e.x});if(t.x.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,t.x.axisLabel&&i&&(t.x.isCategoryAxis?t.x.axisLabel=m.createAxisLabel(this.categoryAxisProperties,t.x.axisLabel,i):t.x.axisLabel=m.createAxisLabel(this.valueAxisProperties,t.x.axisLabel,i)),i=e.getUnitType(t,function(e){return e.y1}),t.y1.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,t.y1.axisLabel&&i&&(t.y1.isCategoryAxis?t.y1.axisLabel=m.createAxisLabel(this.categoryAxisProperties,t.y1.axisLabel,i):t.y1.axisLabel=m.createAxisLabel(this.valueAxisProperties,t.y1.axisLabel,i)),t.y2){var i=e.getUnitType(t,function(e){return e.y2});this.secValueAxisHasUnitType=null!==i,t.y2.axisLabel&&i&&this.valueAxisProperties&&this.valueAxisProperties.secAxisStyle&&(this.valueAxisProperties.secAxisStyle===j.showBoth?t.y2.axisLabel=t.y2.axisLabel+" ("+i+")":this.valueAxisProperties.secAxisStyle===j.showUnitOnly&&(t.y2.axisLabel=i))}},e.prototype.shouldRenderSecondaryAxis=function(e){return e&&(!this.valueAxisProperties||null==this.valueAxisProperties.secShow||this.valueAxisProperties.secShow)?e.values&&e.values.length>0:!1},e.prototype.shouldRenderAxis=function(e,t){return void 0===t&&(t="show"),e?(!e.isCategoryAxis||this.categoryAxisProperties&&null!=this.categoryAxisProperties[t]&&!this.categoryAxisProperties[t])&&(e.isCategoryAxis||this.valueAxisProperties&&null!=this.valueAxisProperties[t]&&!this.valueAxisProperties[t])?!1:e.values&&e.values.length>0:!1},e.prototype.render=function(t){this.setVisibility(!0);var a=this.legendMargins=this.legend.getMargins(),r={height:this.currentViewport.height-a.height,width:this.currentViewport.width-a.width},s=this.getMaxMarginFactor(),n=this.leftRightMarginLimit=r.width*s;this.bottomMarginLimit=Math.max(e.MinBottomMargin,Math.ceil(r.height*s));var l=e.getTextProperties(this.categoryAxisProperties&&parseFloat(this.categoryAxisProperties.fontSize)||void 0),c=e.getTextProperties(this.valueAxisProperties&&parseFloat(this.valueAxisProperties.fontSize)||void 0),u=this.margin;u.top=parseFloat(c.fontSize)/2,u.bottom=e.MinBottomMargin,u.right=0;var h=this.axes=o(this.layers,r,u,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,null);this.yAxisIsCategorical=h.y1.isCategoryAxis,this.hasCategoryAxis=this.yAxisIsCategorical?h.y1&&h.y1.values.length>0:h.x&&h.x.values.length>0;var p,d,g=this.shouldRenderAxis(h.x),m=this.shouldRenderAxis(h.y1),y=this.shouldRenderSecondaryAxis(h.y2),f=r.width-(u.left+u.right),x=!1;this.isXScrollBarVisible=!1,this.isYScrollBarVisible=!1;var b=this.yAxisOrientation,S=b===P.right;if(this.layers&&(this.layers[0].getVisualCategoryAxisIsScalar&&(x=this.layers[0].getVisualCategoryAxisIsScalar()),!x&&this.isScrollable&&this.layers[0].getPreferredPlotArea)){var w=this.scrollX?h.x.categoryThickness:h.y1.categoryThickness,C=this.scrollX?h.x.values.length:h.y1.values.length;d=this.layers[0].getPreferredPlotArea(x,C,w),this.scrollX&&d&&d.width>r.width&&(this.isXScrollBarVisible=!0,r.height-=e.ScrollBarWidth),this.scrollY&&d&&d.height>r.height&&(this.isYScrollBarVisible=!0,r.width-=e.ScrollBarWidth,f=r.width-(u.left+u.right))}this.isXScrollBarVisible||this.isYScrollBarVisible?this.brushGraphicsContext||(this.brushGraphicsContext=this.svg.append("g").classed("x brush",!0)):(this.svg.selectAll(".brush").remove(),this.brushGraphicsContext=void 0),h=o(this.layers,r,u,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,null);for(var A=!1,D=2,T=0,V=void 0,N=void 0,L=void 0;!A&&D>T;){T++,V=i({width:f,height:r.height},n,v.measureSvgTextWidth,v.estimateSvgTextHeight,h,this.bottomMarginLimit,l,c,null,!1,this.isXScrollBarVisible||this.isYScrollBarVisible,S,g,m,y);var M=S?V.yRight:V.yLeft,k=S?V.yLeft:V.yRight,I=g?V.xMax/1.8:0;M+=e.LeftPadding,k+=e.RightPadding,I+=e.BottomPadding,this.hideAxisLabels(a)&&(h.x.axisLabel=null,h.y1.axisLabel=null,h.y2&&(h.y2.axisLabel=null)),this.addUnitTypeToAxisLabel(h),L={x:h.x.axisLabel,y:h.y1.axisLabel,y2:h.y2?h.y2.axisLabel:null},N=null!=L.x||null!=L.y||null!=L.y2,null!=L.x&&(I+=e.XAxisLabelPadding),null!=L.y&&(M+=e.YAxisLabelPadding),null!=L.y2&&(k+=e.YAxisLabelPadding),u.left=S?k:M,u.right=S?M:k,u.bottom=I,this.margin=u,f=r.width-(u.left+u.right);var O=h.y1.values.length,F=h.y2&&h.y2.values.length;h=o(this.layers,r,u,this.categoryAxisProperties,this.valueAxisProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,h),h.y1.values.length!==O||h.y2&&h.y2.values.length!==F||(A=!0)}this.renderChart(p,h,f,V,N,L,r,t)},e.prototype.hideAxisLabels=function(e){return!(!(this.cartesianSmallViewPortProperties&&this.cartesianSmallViewPortProperties.hideAxesOnSmallViewPort&&this.currentViewport.height+e.height<this.cartesianSmallViewPortProperties.MinHeightAxesVisible)||this.visualInitOptions.interactivity.isInteractiveLegend)},e.getUnitType=function(e,t){return t(e).formatter&&t(e).formatter.displayUnit&&t(e).formatter.displayUnit.value>1?t(e).formatter.displayUnit.title:null},e.prototype.getMaxMarginFactor=function(){return this.visualInitOptions.style.maxMarginFactor||e.MaxMarginFactor},e.getChartViewport=function(e,t){return{width:e.width-t.left-t.right,height:e.height-t.top-t.bottom}},e.wordBreak=function(e,t,i,a,r){e.each(function(e,r){var s,o,n=d3.select(this);i.length>=r?(s=i[r],o=t.scale(s)):o=t.xLabelMaxWidth,n.style("text-anchor","middle").attr({dx:"0em",dy:"1em",transform:"rotate(0)"}),v.wordBreak(this,o,t.willLabelsWordBreak?a:0)})},e.prototype.renderChart=function(t,i,a,r,s,o,n,l,c,u){var h,p,d,y,f,x=this.bottomMarginLimit,b=this.leftRightMarginLimit,S=this.layers,w=R(this.animator,l),C=e.getChartViewport(n,this.margin);if(this.shouldRenderAxis(i.x)){i.x.isCategoryAxis?(h=this.categoryAxisProperties&&this.categoryAxisProperties.labelColor?this.categoryAxisProperties.labelColor:null,y=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:g.DefaultLabelFontSizeInPt):(h=this.valueAxisProperties&&this.valueAxisProperties.labelColor?this.valueAxisProperties.labelColor:null,y=this.valueAxisProperties&&this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:g.DefaultLabelFontSizeInPt),i.x.axis.orient("bottom"),i.x.willLabelsFit||i.x.axis.tickPadding(e.TickPaddingRotatedX);var A=this.xAxisGraphicsContext;w?A.transition().duration(w).call(i.x.axis):A.call(i.x.axis),A.call(e.darkenZeroLine).call(e.setAxisLabelColor,h).call(e.setAxisLabelFontSize,y);var D=A.selectAll("text"),T=[],V=0;this.layers&&this.layers.length&&(T=this.layers[0].getColumnsWidth(),V=this.layers[0].getBorderWidth()),A.call(e.moveBorder,i.x.scale,V,y/2-8),D.call(e.wordBreak,i.x,T,x,V)}else this.xAxisGraphicsContext.selectAll("*").remove();if(this.shouldRenderAxis(i.y1)){i.y1.isCategoryAxis?(p=this.categoryAxisProperties&&this.categoryAxisProperties.labelColor?this.categoryAxisProperties.labelColor:null,f=this.categoryAxisProperties&&null!=this.categoryAxisProperties.fontSize?this.categoryAxisProperties.fontSize:g.DefaultLabelFontSizeInPt):(p=this.valueAxisProperties&&this.valueAxisProperties.labelColor?this.valueAxisProperties.labelColor:null,f=this.valueAxisProperties&&null!=this.valueAxisProperties.fontSize?this.valueAxisProperties.fontSize:g.DefaultLabelFontSizeInPt);var N=this.yAxisOrientation,L=N===P.right;i.y1.axis.tickSize(-a).tickPadding(e.TickPaddingY).orient(N.toLowerCase());var M=this.y1AxisGraphicsContext;w?M.transition().duration(w).call(i.y1.axis):M.call(i.y1.axis),M.call(e.darkenZeroLine).call(e.setAxisLabelColor,p).call(e.setAxisLabelFontSize,f),r.yLeft>=b&&M.selectAll("text").call(m.LabelLayoutStrategy.clip,b-e.LeftPadding,v.svgEllipsis),!i.y2||this.valueAxisProperties&&null!=this.valueAxisProperties.secShow&&!this.valueAxisProperties.secShow?this.y2AxisGraphicsContext.selectAll("*").remove():(d=this.valueAxisProperties&&this.valueAxisProperties.secLabelColor?this.valueAxisProperties.secLabelColor:null,i.y2.axis.tickPadding(e.TickPaddingY).orient(L?P.left.toLowerCase():P.right.toLowerCase()),w?this.y2AxisGraphicsContext.transition().duration(w).call(i.y2.axis):this.y2AxisGraphicsContext.call(i.y2.axis),this.y2AxisGraphicsContext.call(e.darkenZeroLine).call(e.setAxisLabelColor,d),r.yRight>=b&&this.y2AxisGraphicsContext.selectAll("text").call(m.LabelLayoutStrategy.clip,b-e.RightPadding,v.svgEllipsis))}else this.y1AxisGraphicsContext.selectAll("*").remove(),this.y2AxisGraphicsContext.selectAll("*").remove();if(s){var k=!this.shouldRenderAxis(i.x,"showAxisTitle"),I=!this.shouldRenderAxis(i.y1,"showAxisTitle"),O=this.valueAxisProperties&&null!=this.valueAxisProperties.secShowAxisTitle&&this.valueAxisProperties.secShowAxisTitle===!1,F={axisLabels:o,legendMargin:this.legendMargins.height,viewport:n,hideXAxisTitle:k,hideYAxisTitle:I,hideY2AxisTitle:O,xLabelColor:h,yLabelColor:p,y2LabelColor:d,margin:void 0};this.renderAxesLabels(F)}else this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();this.translateAxes(n);var z=[],j=[],G=[];if(this.behavior){for(var H=0,E=S.length;E>H;H++){var _=S[H].render(l);if(_)if(z=z.concat(_.dataPoints),j.push(_.behaviorOptions),_.labelDataPointGroups)for(var W=_.labelDataPointGroups,U=0,Y=W.length;Y>U;U++){var X=W[U];G.push({labelDataPoints:X.labelDataPoints,maxNumberOfLabels:X.maxNumberOfLabels})}else{var q=_.labelDataPoints,K=q;G.push({labelDataPoints:K,maxNumberOfLabels:K.length})}}var Z={maximumOffset:g.maxLabelOffset,startingOffset:g.startingLabelOffset},J=new B(Z),Q=J.layout(G,C);if(S.length>1&&g.drawLabelBackground(this.labelGraphicsContextScrollable,Q,"#FFFFFF",.7),this.animator&&!l?g.animateDefaultLabels(this.labelGraphicsContextScrollable,Q,this.animator.getDuration()):g.drawDefaultLabels(this.labelGraphicsContextScrollable,Q),this.labelGraphicsContextScrollable.selectAll("text.label").style("pointer-events","none"),this.interactivityService){var $={layerOptions:j,clearCatcher:this.clearCatcher};this.interactivityService.bind(z,this.behavior,$)}}},e.darkenZeroLine=function(e){var t=e.selectAll("g.tick").filter(function(e){return 0===e}).node();t&&d3.select(t).select("line").classed("zero-line",!0)},e.setAxisLabelColor=function(e,t){e.selectAll("g.tick text").style("fill",t?t.solid.color:null)},e.setAxisLabelFontSize=function(e,t){var i=u.toString(t);e.selectAll("g.tick text").attr("font-size",i)},e.moveBorder=function(e,t,i,a){void 0===a&&(a=0),e.selectAll("g.tick").attr("transform",function(e,r){return V.translate(t(e)+i*r,a)})},e.Classes={series:d("series")},e.capabilities={dataRoles:[{name:"Category",kind:x.Grouping,displayName:"Category"},{name:"Series",kind:x.Grouping,displayName:"Series"},{name:"Y",kind:x.Measure,displayName:"Y Axis"},{name:"Width",kind:x.Measure,displayName:"Axis width"}],objects:{columnBorder:{displayName:"Column Border",properties:{show:{displayName:b("Visual_Show"),type:{bool:!0}},color:{displayName:b("Visual_LabelsFill"),description:b("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},width:{displayName:"Width",type:{numeric:!0}}}},labels:{displayName:b("Visual_DataPointsLabels"),description:b("Visual_DataPointsLabelsDescription"),properties:{show:{displayName:b("Visual_Show"),type:{bool:!0}},showSeries:{displayName:b("Visual_Show"),type:{bool:!0}},color:{displayName:b("Visual_LabelsFill"),description:b("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:b("Visual_DisplayUnits"),description:b("Visual_DisplayUnitsDescription"),type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:b("Visual_Precision"),description:b("Visual_PrecisionDescription"),placeHolderText:b("Visual_Precision_Auto"),type:{numeric:!0},suppressFormatPainterCopy:!0},showAll:{displayName:b("Visual_ShowAll"),type:{bool:!0}},fontSize:{displayName:b("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},legend:{displayName:b("Visual_Legend"),properties:{show:{displayName:b("Visual_Show"),type:{bool:!0}},position:{displayName:b("Visual_LegendPosition"),type:{formatting:{legendPosition:!0}}},showTitle:{displayName:b("Visual_LegendShowTitle"),type:{bool:!0}},titleText:{displayName:"Title text",type:{text:!0}},fontSize:{displayName:"Text size",type:{formatting:{fontSize:!0}}}}},categoryAxis:{displayName:b("Visual_XAxis"),properties:{show:{displayName:b("Visual_Show"),type:{bool:!0}},position:{displayName:b("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:b("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},axisType:{displayName:b("Visual_Axis_Type"),type:{formatting:{axisType:!0}}},showAxisTitle:{displayName:b("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:b("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},labelColor:{displayName:b("Visual_Axis_LabelColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:b("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},valueAxis:{displayName:b("Visual_YAxis"),properties:{show:{displayName:b("Visual_Show"),type:{bool:!0}},position:{displayName:b("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:b("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},intersection:{displayName:b("Visual_Axis_Intersection"),type:{numeric:!0}},showAxisTitle:{displayName:b("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:b("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},labelColor:{displayName:b("Visual_Axis_LabelColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:b("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},dataPoint:{displayName:b("Visual_DataPoint"),properties:{defaultColor:{displayName:b("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:b("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:b("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:b("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}}},dataViewMappings:[{conditions:[{Category:{min:0,max:1},Series:{min:0,max:1},Y:{min:0,max:1},Width:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Y"}},{"for":{"in":"Width"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:1,max:1},supported:{min:0}}}}],supportsHighlight:!0,sorting:{"default":{}},drilldown:{roles:["Category"]}},e.Properties={dataPoint:{defaultColor:{objectName:"dataPoint",propertyName:"defaultColor"},fill:{objectName:"dataPoint",propertyName:"fill"},showAllDataPoints:{objectName:"dataPoint",propertyName:"showAllDataPoints"}},general:{formatString:{objectName:"general",propertyName:"formatString"}},columnBorder:{show:{objectName:"columnBorder",propertyName:"show"},color:{objectName:"columnBorder",propertyName:"color"},width:{objectName:"columnBorder",propertyName:"width"}}},e.DefaultSettings={columnBorder:{show:!0,color:"#fff",width:2,maxWidth:5},labelSettings:{maxPrecision:4,minPrecision:0}},e.MinOrdinalRectThickness=20,e.MinScalarRectThickness=2,e.OuterPaddingRatio=.4,e.InnerPaddingRatio=.2,e.TickLabelPadding=2,e.ClassName="cartesianChart",e.AxisGraphicsContextClassName="axisGraphicsContext",e.MaxMarginFactor=.25,e.MinBottomMargin=50,e.LeftPadding=10,
e.RightPadding=10,e.BottomPadding=16,e.YAxisLabelPadding=20,e.XAxisLabelPadding=20,e.TickPaddingY=10,e.TickPaddingRotatedX=5,e.FontSize=11,e.MaxNumberOfLabels=100,e.MinWidth=100,e.MinHeight=100,e.ScrollBarWidth=10,e}();t.MekkoChart=re,t.createLayers=n;var se={category:"Category",series:"Series",y:"Y",width:"Width"},oe=function(){function e(e){var t=e.chartType;this.chartType=t,this.categoryAxisType=null,this.animator=e.animator,this.isScrollable=e.isScrollable,this.interactivityService=e.interactivityService}return e.prototype.init=function(t){this.svg=t.svg,this.unclippedGraphicsContext=this.svg.append("g").classed("columnChartUnclippedGraphicsContext",!0),this.mainGraphicsContext=this.unclippedGraphicsContext.append("svg").classed("columnChartMainGraphicsContext",!0),this.labelGraphicsContext=this.svg.append("g").classed(g.labelGraphicsContextClass["class"],!0),this.style=t.style,this.currentViewport=t.viewport,this.hostService=t.host,this.interactivity=t.interactivity,this.colors=this.style.colorPalette.dataColors,this.cartesianVisualHost=t.cartesianHost,this.options=t,this.supportsOverflow=!c.hasFlag(this.chartType,$);var i=this.element=t.element;i.addClass(e.ColumnChartClassName),this.columnChart=new ae},e.prototype.getCategoryLayout=function(e,t){var i=this.currentViewport.width-(this.margin.left+this.margin.right),a=this.data?this.data.categoryMetadata:void 0,r=m.getCategoryValueType(a),s=this.data?this.data.scalarCategoryAxis:!1,o=m.createDomain(this.data.series,r,s,t.forcedXDomain);return re.getLayout(this.data,{availableWidth:i,categoryCount:e,domain:o,isScalar:s,isScrollable:this.isScrollable,trimOrdinalDataOnOverflow:!1})},e.getBorderWidth=function(e){if(!e||!e.show||!e.width)return 0;var t=e.width;return 0>t?0:t>e.maxWidth?e.maxWidth:t},e.getBorderColor=function(e){return e?e.color:re.DefaultSettings.columnBorder.color},e.converter=function(t,i,a,r,s,o,n){void 0===a&&(a=!1),void 0===r&&(r=!1),void 0===s&&(s=!1),void 0===o&&(o=null);var l=pe.getCategoryAxisProperties(o),c=pe.getValueAxisProperties(o);r=pe.isScalar(r,l),t=ue.applyUserMinMax(r,t,l);var u=new ne(t),h=H.getPivotedCategories(t,re.Properties.general.formatString),p=h.categories,d=h.categoryFormatter,g=h.categoryIdentities,m=t.categories&&t.categories.length>0?t.categories[0].source:void 0,y=re.DefaultSettings.columnBorder,f=k.getDefaultColumnLabelSettings(!0),v=void 0,x=void 0;if(o&&o.objects){var b=o.objects;v=N.getFillColor(b,re.Properties.dataPoint.defaultColor),x=N.getValue(b,re.Properties.dataPoint.showAllDataPoints),f=re.parseLabelSettings(b),y=re.parseBorderSettings(b)}for(var S=u.getLegend(i,v),w=S.legend.dataPoints,C=S.seriesSources,P=e.createDataPoints(t,p,g,w,S.seriesObjects,u,f,a,r,s,H.categoryIsAlsoSeriesRole(t,se.series,se.category),h.categoryObjects,v,n,m),A=P.series,D=[],T=0,V=w.length;V>T;T++)D.push(C[T]);var L=H.createAxesLabels(l,c,m,D);return{categories:p,categoriesWidth:P.categoriesWidth,categoryFormatter:d,series:A,valuesMetadata:D,legendData:S.legend,hasHighlights:P.hasHighlights,categoryMetadata:m,scalarCategoryAxis:r,borderSettings:y,labelSettings:f,axesLabels:{x:L.xAxisLabel,y:L.yAxisLabel},hasDynamicSeries:P.hasDynamicSeries,defaultDataPointColor:v,showAllDataPoints:x,isMultiMeasure:!1}},e.getStackedMultiplier=function(e,t,i,a){for(var r=0,s=0,o=0;i>o;o++){var n=e[o][t];n=m.normalizeNonFiniteNumber(n),n>0?r+=n:0>n&&(s-=n)}var l=r+s;return{pos:r?r/l/r:1,neg:s?s/l/s:1}},e.createDataPoints=function(t,i,a,r,s,o,n,l,u,h,p,d,g,y,f){void 0===l&&(l=!1),void 0===u&&(u=!1),void 0===h&&(h=!1);var v=t&&t.values?t.values.grouped():void 0,x=i.length,b=r.length,S=[];if(1>b||1>x||null===i[0])return{series:S,hasHighlights:!1,hasDynamicSeries:!1,categoriesWidth:[]};var w=t.categories;f=w&&w.length>0?w[0].source:null;var C=m.getCategoryValueType(f),P=m.isDateTime(C),A=[],D=[],T=[],V=[],N=!(!t.values||!t.values.source),L=[],M=-1,I=0,O=!1,F=o.hasHighlightValues(0);for(I=0;I<t.values.length;I++)if(t.values[I].source.roles&&t.values[I].source.roles[se.width]&&!t.values[I].source.roles[se.y]){M=I;for(var z=t.values[I].values,j=0,R=z.length;R>j;j++)L[j]=d3.sum([0,L[j],z[j]])}else{for(var B=[],H=[],_=0;x>_;_++){var Y=o.getValueBySeriesAndCategory(I,_);if(B[_]=Y,F){var X=o.getHighlightBySeriesAndCategory(I,_);H[_]=X,Y>=0&&X>=0&&Y>=X||0>=Y&&0>=X&&X>=Y||(O=!0)}}T.push(B),F&&V.push(H)}if(O&&!h&&(O=!1,F=!1,T=V),L.length<1)for(I=0;I<t.values.length;I++)if(t.values[I].source.roles&&t.values[I].source.roles[se.width]){M=I;for(var z=t.values[I].values,j=0,R=z.length;R>j;j++)L[j]=d3.sum([0,L[j],z[j]])}else;if(L.length<1)for(I=0;x>I;I++)L.push(1);var q=d3.sum(L),K=d3.scale.linear().domain([0,q]).range([0,1]),Z=[0],J=[];for(I=0;x-1>I;I++){var Q=Z[Z.length-1]+(L[I]||0);Z.push(Q)}for(I=0;x>I;I++)Z[I]=K(Z[I]),J[I]=K(L[I]);var ee=d,te=re.Properties.general.formatString;for(I=0;b>I;I++){var ie,ae=[],oe=r[I];if(!N){var ne=v&&v.length>0&&v[0].values?v[0].values[I]:null,le=ne&&ne.source&&ne.source.objects?ne.source.objects.labels:null;le&&(ie=G.inherit(n),k.updateLabelSettingsFromLabelsObject(le,ie))}var ce={displayName:oe.label,key:"series"+I,index:I,data:ae,identity:oe.identity,color:oe.color,labelSettings:ie};b>1&&(ee=s[I]);for(var ue=t.values[I].source,_=0;x>_;_++){0===I&&(A.push(0),D.push(0));var Y=m.normalizeNonFiniteNumber(T[I][_]);if(!(null==Y&&I>0)){var he=Y,pe=i[_];if(P&&pe&&(pe=pe.getTime()),!u||null!=pe&&!isNaN(pe)){var de;l&&(de=e.getStackedMultiplier(T,_,b,x));var ge=Y,me=0>Y;de&&(Y*=me?de.neg:de.pos);var ye,fe=Math.abs(Y);me?(ye=D[_],isNaN(fe)||(D[_]-=fe)):(isNaN(fe)||(A[_]+=fe),ye=A[_]);var ve=v&&v.length>I&&v[I].values?v[I]:null,xe=t.categories&&t.categories.length>0?t.categories[0]:null,be=E.builder().withCategory(xe,_).withSeries(t.values,ve).withMeasure(o.getMeasureNameByIndex(I)).createSelectionId(),Se=i[_],we=e.getDataPointColor(oe,_,ee),Ce=[];if(ve){var Pe={values:[],source:t.values.source};Ce.push({value:ve.name,metadata:Pe});for(var Ae=0;Ae<ve.values.length;Ae++){var De=ve.values[Ae];Ce.push({value:De.values[_],metadata:De})}}var Te=W.createTooltipInfo(te,null,Se,he,[xe],Ce,null,_),Ve=ce&&ce.labelSettings?ce.labelSettings:n,Ne=Ve.labelColor,Le=void 0;c.hasFlag(y,$)&&(Le=this.getStackedLabelColor(me,I,b,_,T),Ne=Le||I===b-1&&!me?Ne:k.defaultInsideLabelColor),Y=J[_];var Me=Z[_],ke={categoryValue:pe,value:Y,position:ye,valueAbsolute:fe,valueOriginal:ge,seriesIndex:I,labelSettings:Ve,categoryIndex:_,color:we,selected:!1,originalValue:Y,originalPosition:Me,originalValueAbsolute:fe,identity:be,key:be.getKey(),tooltipInfo:Te,labelFill:Ne,labelFormatString:ue.format,lastSeries:Le,chartType:y};if(ae.push(ke),F){var Ie=V[I][_],Oe=Ie,Fe=!0;null===Ie&&(Ie=0,Fe=!1),l&&(Ie*=de.pos);var ze=Math.abs(Ie),je=ye;Ie>0?je-=fe-ze:0===Ie&&Y>0&&(je-=fe);var Ge=U.createWithHighlight(be),Se=i[_];Fe&&(ke.tooltipInfo=Te);var Re={categoryValue:pe,value:Y,position:je,valueAbsolute:ze,valueOriginal:Oe,seriesIndex:I,labelSettings:Ve,categoryIndex:_,color:we,selected:!1,highlight:!0,originalValue:Y,originalPosition:Me,originalValueAbsolute:fe,drawThinner:O,identity:Ge,key:Ge.getKey(),tooltipInfo:Te,labelFormatString:ue.format,labelFill:Ne,lastSeries:Le,chartType:y};ae.push(Re)}}}}S.push(ce)}return{series:S,categoriesWidth:J,hasHighlights:F,hasDynamicSeries:N}},e.getDataPointColor=function(e,t,i){if(i){var a=N.getFillColor(i[t],re.Properties.dataPoint.fill);if(a)return a}return e.color},e.getStackedLabelColor=function(e,t,i,a,r){for(var s=!(e&&t===i-1&&1!==i),o=t+1;i>o;o++){var n=m.normalizeNonFiniteNumber(r[o][a]);if(null!==n&&((!e||e&&0===t)&&n>0||e&&0!==t)){s=!1;break}}return s},e.sliceSeries=function(e,t,i){void 0===i&&(i=0);var a=[];if(e&&e.length>0)for(var r=0,s=e.length;s>r;r++){var o=a[r]=G.inherit(e[r]);o.data=e[r].data.filter(function(e){return e.categoryIndex>=i&&e.categoryIndex<t})}return a},e.getInteractiveColumnChartDomElement=function(e){return e.children("svg").get(0)},e.prototype.getColumnsWidth=function(){var e=this.data;return e&&e.series&&e.series[0]&&e.series[0].data?e.categoriesWidth:[]},e.prototype.getBorderWidth=function(){return e.getBorderWidth(this.data.borderSettings)},e.prototype.setData=function(t){var i=!0;if(this.data={categories:[],categoriesWidth:[],categoryFormatter:null,series:[],valuesMetadata:[],legendData:null,hasHighlights:!1,categoryMetadata:null,scalarCategoryAxis:!1,borderSettings:null,labelSettings:k.getDefaultColumnLabelSettings(i),axesLabels:{x:null,y:null},hasDynamicSeries:!1,defaultDataPointColor:null,isMultiMeasure:!1},t.length>0){var a=t[0];if(a&&a.categorical){var r=this.dataViewCat=a.categorical;this.data=e.converter(r,this.cartesianVisualHost.getSharedColors(),!0,!1,this.supportsOverflow,a.metadata,this.chartType);for(var s=this.data.series,o=0,n=s.length;n>o;o++){var l=s[o];this.interactivityService&&this.interactivityService.applySelectionStateToData(l.data)}}}},e.prototype.calculateLegend=function(){if(this.interactivity&&this.interactivity.isInteractiveLegend)return this.createInteractiveMekkoLegendDataPoints(0);var e=this.data?this.data.legendData:null,t=e?e.dataPoints:[];return h.isUndefinedOrEmpty(t)?null:e},e.prototype.hasLegend=function(){return this.data&&(this.data.hasDynamicSeries||this.data.series&&this.data.series.length>1)},e.prototype.enumerateObjectInstances=function(e,t){switch(t.objectName){case"dataPoint":Y.hasGradientRole(this.dataViewCat)||this.enumerateDataPoints(e);break;case"labels":this.enumerateDataLabels(e)}},e.prototype.enumerateDataLabels=function(e){var t=this.data,i=this.data.labelSettings,a=t.series.length;if(k.enumerateDataLabels(this.getLabelSettingsOptions(e,i,!1)),0!==a&&!t.hasDynamicSeries&&(a>1||!t.categoryMetadata))for(var r=0;a>r;r++){var s=t.series[r],i=s.labelSettings?s.labelSettings:this.data.labelSettings;k.enumerateDataLabels(this.getLabelSettingsOptions(e,i,!0,s))}},e.prototype.getLabelSettingsOptions=function(e,t,i,a){var r=!0;return{enumeration:e,dataLabelsSettings:t,show:!i,displayUnits:r,precision:!0,selector:a&&a.identity?a.identity.getSelector():null}},e.prototype.enumerateDataPoints=function(e){var t=this.data;if(t&&t.series){var i=t.series.length;if(0!==i)if(t.hasDynamicSeries||i>1||!t.categoryMetadata)for(var a=0;i>a;a++){var r=t.series[a];e.pushInstance({objectName:"dataPoint",displayName:r.displayName,selector:X.normalizeSelector(r.identity.getSelector()),properties:{fill:{solid:{color:r.color}}}})}else{var s=t.series[0].data,o=t.categoryFormatter;e.pushInstance({objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:t.defaultDataPointColor||this.colors.getColorByIndex(0).value}}}}).pushInstance({objectName:"dataPoint",selector:null,properties:{showAllDataPoints:!!t.showAllDataPoints}});for(var a=0;a<s.length;a++){var n=s[a],l=t.categories[a];e.pushInstance({objectName:"dataPoint",displayName:o?o.format(l):l,selector:X.normalizeSelector(n.identity.getSelector(),!0),properties:{fill:{solid:{color:n.color}}}})}}}},e.prototype.calculateAxesProperties=function(e){var t=this.data;this.currentViewport=e.viewport;var i=this.margin=e.margin,a=t&&t.categories?t.categories.length:0,r=t?this.getCategoryLayout(a,e):{categoryCount:0,categoryThickness:re.MinOrdinalRectThickness,outerPaddingRatio:re.OuterPaddingRatio,isScalar:!1};this.categoryAxisType=r.isScalar?L.scalar:null,this.columnChart.setData(t);var s=this.getPreferredPlotArea(r.isScalar,r.categoryCount,r.categoryThickness);s.width===this.currentViewport.width&&(s.width-=i.left+i.right),s.height-=i.top+i.bottom;var o=!0,n={height:s.height,width:s.width,duration:0,hostService:this.hostService,unclippedGraphicsContext:this.unclippedGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,labelGraphicsContext:this.labelGraphicsContext,margin:this.margin,layout:r,animator:this.animator,interactivityService:this.interactivityService,viewportHeight:this.currentViewport.height-(i.top+i.bottom),viewportWidth:this.currentViewport.width-(i.left+i.right),is100Pct:o,isComboChart:!0};this.ApplyInteractivity(n),this.columnChart.setupVisualProps(n);var l=c.hasFlag(this.chartType,Z);if(l){var u=e.forcedXDomain;e.forcedXDomain=e.forcedYDomain,e.forcedYDomain=u}return this.xAxisProperties=this.columnChart.setXScale(o,e.forcedTickCount,e.forcedXDomain,l?e.valueAxisScaleType:e.categoryAxisScaleType),this.yAxisProperties=this.columnChart.setYScale(o,e.forcedTickCount,e.forcedYDomain,l?e.categoryAxisScaleType:e.valueAxisScaleType),e.showCategoryAxisLabel&&this.xAxisProperties.isCategoryAxis||e.showValueAxisLabel&&!this.xAxisProperties.isCategoryAxis?this.xAxisProperties.axisLabel=t.axesLabels.x:this.xAxisProperties.axisLabel=null,e.showValueAxisLabel&&!this.yAxisProperties.isCategoryAxis||e.showCategoryAxisLabel&&this.yAxisProperties.isCategoryAxis?this.yAxisProperties.axisLabel=t.axesLabels.y:this.yAxisProperties.axisLabel=null,[this.xAxisProperties,this.yAxisProperties]},e.prototype.getPreferredPlotArea=function(e,t,i){var a={height:this.currentViewport.height,width:this.currentViewport.width};if(this.isScrollable&&!e){var r=re.getPreferredCategorySpan(t,i);c.hasFlag(this.chartType,Z)?a.height=Math.max(r,a.height):a.width=Math.max(r,a.width)}return a},e.prototype.ApplyInteractivity=function(t){var i=this,a=this.interactivity;if(a&&(a.dragDataPoint&&(t.onDragStart=function(e){e.identity&&i.hostService.onDragStart({event:d3.event,data:{data:e.identity.getSelector()}})}),a.isInteractiveLegend)){var r=function(){var e=d3.mouse(i.mainGraphicsContext[0][0]),t=e[0],a=e[1],r=i.columnChart.getClosestColumnIndex(t,a);i.selectColumn(r)},s=e.getInteractiveColumnChartDomElement(this.element);this.svg.on("click",r),d3.select(s).on("click",r);var o=d3.behavior.drag().origin(Object).on("drag",r);this.svg.call(o),d3.select(s).call(o)}},e.prototype.selectColumn=function(e,t){if(void 0===t&&(t=!1),t||this.lastInteractiveSelectedColumnIndex!==e){var i=this.createInteractiveMekkoLegendDataPoints(e),a=i.dataPoints;this.cartesianVisualHost.updateLegend(i),a.length>0&&this.columnChart.selectColumn(e,this.lastInteractiveSelectedColumnIndex),this.lastInteractiveSelectedColumnIndex=e}},e.prototype.createInteractiveMekkoLegendDataPoints=function(e){var t=this.data;if(!t||h.isUndefinedOrEmpty(t.series))return{dataPoints:[]};for(var i=re.Properties.general.formatString,a=[],r=t.categories&&t.categories[e],s=t.series,o=t.legendData&&t.legendData.dataPoints,n=new ne(this.dataViewCat),l=0,c=s.length;c>l;l++){var u,p=n.getValueBySeriesAndCategory(l,e),d=t.valuesMetadata[l],g=H.getFormattedLegendLabel(d,this.dataViewCat.values,i);if(1===s.length){var m=s[0];u=m.data.length>e&&m.data[e].color}else u=o.length>l&&o[l].color;a.push({color:u,icon:q.Box,label:g,category:t.categoryFormatter?t.categoryFormatter.format(r):r,measure:y.format(p,y.getFormatString(d,i)),identity:U.createNull(),selected:!1})}return{dataPoints:a}},e.prototype.overrideXScale=function(e){this.xAxisProperties=e},e.prototype.render=function(e){var t=this.columnChart.drawColumns(!e),i=this.data,a=this.margin,r=this.currentViewport,s=r.height-(a.top+a.bottom),o=r.width-(a.left+a.right);this.mainGraphicsContext.attr("height",s).attr("width",o),K.addTooltip(t.shapesSelection,function(e){return e.data.tooltipInfo});var n=[],l=void 0;if(this.interactivityService){for(var c=0,u=i.series.length;u>c;c++)n=n.concat(i.series[c].data);l={datapoints:n,bars:t.shapesSelection,hasHighlights:i.hasHighlights,eventGroup:this.mainGraphicsContext,mainGraphicsContext:this.mainGraphicsContext,viewport:t.viewport,axisOptions:t.axisOptions,showLabel:i.labelSettings.show}}return this.interactivity&&this.interactivity.isInteractiveLegend&&this.data.series.length>0&&this.selectColumn(0,!0),V.flushAllD3TransitionsIfNeeded(this.options),{dataPoints:n,behaviorOptions:l,labelDataPoints:t.labelDataPoints,labelsAreNumeric:!0}},e.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},e.prototype.getVisualCategoryAxisIsScalar=function(){return this.data?this.data.scalarCategoryAxis:!1},e.prototype.getSupportedCategoryAxisType=function(){var e=this.data?this.data.categoryMetadata:void 0,t=m.getCategoryValueType(e),i=m.isOrdinal(t);return i?L.categorical:L.both},e.prototype.setFilteredData=function(t,i){var a=G.inherit(this.data);return a.series=e.sliceSeries(a.series,i,t),a.categories=a.categories.slice(t,i),this.columnChart.setData(a),a},e.ColumnChartClassName="columnChart",e.SeriesClasses=d("series"),e.BorderClass=d("mekkoborder"),e}();t.MekkoColumnChart=oe;var ne=function(){function e(e){this.dataView=e}return e.hasRole=function(e,t){var i=e.roles;return i&&i[t]},e.prototype.getLegend=function(t,i){var a=[],r=[],s=[],o=!1,n=new X(t,re.Properties.dataPoint.fill,i),l=void 0;if(this.dataView&&this.dataView.values){for(var c=this.dataView.values,u=c.grouped(),h=!(!c||!c.source),p=re.Properties.general.formatString,d=0,g=u.length;g>d;d++)for(var m=u[d],y=m.objects,f=m.values,v=0,x=f.length;x>v;v++){var b=f[v],S=b.source;if(!e.hasRole(S,"Width")||e.hasRole(S,"Y")){r.push(S),s.push(b.objects);var w=b.identity?U.createWithIdAndMeasure(b.identity,S.queryName):U.createWithMeasure(this.getMeasureNameByIndex(v)),C=H.getFormattedLegendLabel(S,c,p),P=h?n.getColorForSeriesValue(y||S.objects,c.identityFields,S.groupName):n.getColorForMeasure(y||S.objects,S.queryName);a.push({icon:q.Box,color:P,label:C,identity:w,selected:!1}),b.identity&&void 0!==S.groupName&&(o=!0)}}var A=this.dataView.values;l=A&&A.source?A.source.displayName:""}var D={title:l,dataPoints:a,grouped:o};return{legend:D,seriesSources:r,seriesObjects:s}},e.prototype.getValueBySeriesAndCategory=function(e,t){return this.dataView.values[e].values[t]},e.prototype.getMeasureNameByIndex=function(e){return this.dataView.values[e].source.queryName},e.prototype.hasHighlightValues=function(e){var t=this.dataView&&this.dataView.values?this.dataView.values[e]:void 0;return t&&!!t.highlights},e.prototype.getHighlightBySeriesAndCategory=function(e,t){return this.dataView.values[e].highlights[t]},e}(),le=function(){function e(e){this.behaviors=e||[]}return e.prototype.bindEvents=function(e,t){for(var i=this.behaviors,a=0,r=i.length;r>a;a++)i[a].bindEvents(e.layerOptions[a],t);e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){for(var t in this.behaviors)this.behaviors[t].renderSelection(e)},e}(),ce=function(){function e(){}return e.prototype.bindEvents=function(t,i){this.options=t;var a=t.eventGroup;a.on("click",function(){var t=e.getDatumForLastInputEvent();i.handleSelection(t,d3.event.ctrlKey)}),a.on("contextmenu",function(){if(!d3.event.ctrlKey){d3.event.preventDefault();var t=e.getDatumForLastInputEvent(),a=C.getPositionOfLastInputEvent();i.handleContextMenu(t,a)}})},e.prototype.renderSelection=function(e){var t=this.options;t.bars.style("fill-opacity",function(i){return ue.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&t.hasHighlights)})},e.getDatumForLastInputEvent=function(){var e=d3.event.target;return d3.select(e).datum()},e}();t.MekkoChartWebBehavior=ce;var ue;!function(e){function t(e,t,i){return void 0===i&&(i=0),m.diffScaled(e,i,t)}function i(e,t){var i={min:0,max:10};if(0===e.length)return i;var a=d3.min(e,function(e){return d3.min(e.data,function(e){return e.position-e.valueAbsolute})}),r=d3.max(e,function(e){return d3.max(e.data,function(e){return e.position})});return t&&(a=f.roundToPrecision(a,u),r=f.roundToPrecision(r,u)),{min:a,max:r}}function a(e,t,i){var a=t.selectAll(re.Classes.series.selector),r=a.data(e.series,function(e){return e.key});return r.enter().append("g").classed(re.Classes.series["class"],!0),r.style({fill:function(e){return e.color}}),r.exit().remove(),r}function r(e,t){t&&e.attr("draggable","true").on("dragstart",t)}function s(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}function o(t,i,a,r){var s=t.selectAll(re.Classes.series.selector),o="undefined"==typeof r;s.selectAll(h+i).filter(function(e){return e.categoryIndex!==a&&(o||e.categoryIndex===r)}).transition().style("fill-opacity",e.DimmedOpacity),s.selectAll(h+i).filter(function(e){return e.categoryIndex===a}).style("fill-opacity",e.DefaultOpacity)}function n(e,t){for(var i=0,a=Number.MAX_VALUE,r=0,s=t.length;s>r;r++){var o=Math.abs(e-t[r]);a>o&&(a=o,i=r)}return i}function l(t,i,a){if(t){var r=a.start,s=a.end;return e.transformDomain(i,r,s)}return i}function c(e,t,i){if(!e.categories||!e.values||0===e.categories.length||0===e.values.length)return e;if("number"!=typeof t&&"number"!=typeof i)return e;var a=e.categories[0],r=a?a.source.type:null;if(!m.isOrdinal(r)){var s=a.values,o=a.objects;if(!s||!o)return e;var n=[],l=[],c=[];if("number"!=typeof t&&(t=s[0]),"number"!=typeof i&&(i=s[s.length-1]),t>i)return e;for(var u=0,h=e.values.length;h>u;u++)l.push([]);for(var p=0,h=s.length;h>p;p++)if(s[p]>=t&&s[p]<=i&&(n.push(s[p]),o&&c.push(o[p]),e.values))for(var d=0;d<e.values.length;d++)l[d].push(e.values[d].values[p]);var g=G.inherit(e),y=g.values=G.inherit(g.values),f=g.categories=G.inherit(e.categories),v=g.categories[0]=G.inherit(f[0]);v.values=n,v.objects&&(v.objects=c);for(var p=0,h=e.values.length;h>p;p++){var x=y[p]=G.inherit(y[p]);x.values=l[p]}return g}}var u=1e-4,h="rect";e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getSize=t,e.calcValueDomain=i,e.drawSeries=a,e.applyInteractivity=r,e.getFillOpacity=s,e.setChosenColumnOpacity=o,e.getClosestColumnIndex=n,e.applyUserMinMax=l,e.transformDomain=c}(ue=t.MekkoChartUtils||(t.MekkoChartUtils={}));var he=function(){function e(e){this.palette=e,this.clearPreferredScale()}return e.prototype.getColorScaleByKey=function(e){return this.setPreferredScale(e),this.preferredScale},e.prototype.getNewColorScale=function(){return this.preferredScale},e.prototype.getColorByIndex=function(e){return this.palette.getColorByIndex(e)},e.prototype.getSentimentColors=function(){return this.palette.getSentimentColors()},e.prototype.getBasePickerColors=function(){return this.palette.getBasePickerColors()},e.prototype.clearPreferredScale=function(){this.preferredScale=this.palette.getNewColorScale(),this.rotated=!1},e.prototype.rotateScale=function(){this.preferredScale=this.preferredScale.clone(),this.preferredScale.clearAndRotateScale(),this.rotated=!0},e.prototype.setPreferredScale=function(e){this.rotated||(this.preferredScale=this.palette.getColorScaleByKey(e))},e}();t.MekkoChartSharedColorPalette=he;var pe;!function(e){function t(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.categoryAxis;r&&(i={show:r.show,axisType:r.axisType,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelColor:r.labelColor,labelDisplayUnits:r.labelDisplayUnits,labelPrecision:r.labelPrecision,duration:r.duration})}return i}function i(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.valueAxis;r&&(i={show:r.show,position:r.position,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelColor:r.labelColor,labelDisplayUnits:r.labelDisplayUnits,labelPrecision:r.labelPrecision,secShow:r.secShow,secPosition:r.secPosition,secAxisScale:r.secAxisScale,secStart:r.secStart,secEnd:r.secEnd,secShowAxisTitle:r.secShowAxisTitle,secAxisStyle:r.secAxisStyle,secLabelColor:r.secLabelColor,secLabelDisplayUnits:r.secLabelDisplayUnits,secLabelPrecision:r.secLabelPrecision})}return i}function a(e,t){return e&&(e=t&&t.axisType?t.axisType===L.scalar:!0),e}e.getCategoryAxisProperties=t,e.getValueAxisProperties=i,e.isScalar=a}(pe=t.MekkochartHelper||(t.MekkochartHelper={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=t.utility.SelectionManager,s=e.visuals.valueFormatter,o=a.PixelConverter.fromPoint,n=function(){function i(e){this.margin={top:10,right:10,bottom:10,left:10},this.nodeWidth=21.5,this.curvatureOfLinks=.5,e&&(this.svg=e.svg,this.margin=e.margin||this.margin,this.curvatureOfLinks=e.curvatureOfLinks||this.curvatureOfLinks)}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},Object.defineProperty(i.prototype,"textProperties",{get:function(){return{fontFamily:this.root.style("font-family"),fontSize:o(this.dataView?this.dataView.settings.fontSize:i.DefaultSettings.fontSize)}},enumerable:!0,configurable:!0}),i.prototype.init=function(e){this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg"),this.selectionManager=new r({hostServices:e.host});var a=e.style;this.colours=a&&a.colorPalette?a.colorPalette.dataColors:new t.DataColorPalette,this.root.classed(i.ClassName,!0),this.main=this.root.append("g"),this.links=this.main.append("g").classed(i.Links["class"],!0),this.nodes=this.main.append("g").classed(i.Nodes["class"],!0)},i.prototype.update=function(e){if(e&&e.dataViews){var t,i=e.dataViews[0];this.updateViewport(e.viewport),t=this.converter(i),this.computePositions(t),this.dataView=t,this.render(t)}},i.prototype.updateViewport=function(e){var t,i;t=this.getPositiveNumber(e.height),i=this.getPositiveNumber(e.width),this.viewport={height:this.getPositiveNumber(t-this.margin.top-this.margin.bottom),width:this.getPositiveNumber(i-this.margin.left-this.margin.right)},this.updateElements(t,i)},i.prototype.getPositiveNumber=function(e){return 0>e||isNaN(e)||null===e||e===1/0||e===-(1/0)?0:e},i.prototype.updateElements=function(e,i){this.root.attr({height:e,width:i}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top))},i.prototype.converter=function(a){var r=this;if(!(a&&a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[1]&&a.categorical.categories[0].values&&a.categorical.categories[1].values))return{nodes:[],links:[],columns:[],settings:{scale:{x:1,y:1},colourOfLabels:i.DefaultSettings.colourOfLabels,fontSize:i.DefaultSettings.fontSize}};var o,n,l,c,u,h,p,d=[],g=[],m=[],y=a.categorical.categories[0].values,f=a.categorical.categories[1].values,v=a.categorical.values&&a.categorical.values[0],x=[],b="g",S=a.categorical.categories[0].objects||[],w=[];return v&&v.values&&v.values.map&&(x=v.values.map(function(e){return e?e:0})),a.categorical.categories[0].identity&&(w=w.concat(a.categorical.categories[0].identity)),a.categorical.categories[1].identity&&(w=w.concat(a.categorical.categories[1].identity)),c=this.getObjectsFromDataView(a),u=this.getColour(i.Properties.labels.fill,i.DefaultSettings.colourOfLabels,c),v&&v.source&&(b=s.getFormatString(v.source,i.Properties.general.formatString)),m=y.map(function(e,t){return{source:e,destination:f[t],weigth:v?Math.max(x[t]||0,0):1}}),o=y.concat(f),n=s.create({format:s.getFormatString(a.categorical.categories[0].source,i.Properties.general.formatString),value:o[0],value2:o[o.length-1]}),l=s.create({format:b,value:Math.max(d3.max(x)||1,1)}),o.forEach(function(a,s){if(!d.some(function(e){return a===e.label.name?(e.selectionIds.push(t.SelectionId.createWithId(w[s])),!0):!1})){var o,l,c=n.format(a),h={text:c,fontFamily:r.textProperties.fontFamily,fontSize:r.textProperties.fontSize};o={name:a,formattedName:n.format(a),width:e.TextMeasurementService.measureSvgTextWidth(h),height:e.TextMeasurementService.estimateSvgTextHeight(h),colour:u},l=t.SelectionId.createWithId(w[s]),d.push({label:o,links:[],inputWeight:0,outputWeight:0,width:r.nodeWidth,height:0,colour:i.DefaultColourOfNode,tooltipData:[],selectionIds:[l]})}}),p=this.colours.getAllColors().length/d.length,d.forEach(function(e,t){e.colour=r.colours.getColorByIndex(Math.floor(t*p)).value}),m.forEach(function(e,a){var s,o,n,c;e.source!==e.destination&&(d.forEach(function(t){t.label.name===e.source&&(s=t),t.label.name===e.destination&&(o=t)}),c=r.getColour(i.Properties.links.fill,i.DefaultColourOfLink,S[a]),n={source:s,destination:o,weigth:e.weigth,height:e.weigth,colour:c,tooltipData:r.getTooltipDataForLink(l,s.label.formattedName,o.label.formattedName,e.weigth),selectionId:t.SelectionId.createWithId(w[a])},g.push(n),s.links.push(n),o.links.push(n),r.updateValueOfNode(s),r.updateValueOfNode(o),s.tooltipData=r.getTooltipForNode(l,s.label.formattedName,s.inputWeight?s.inputWeight:s.outputWeight),o.tooltipData=r.getTooltipForNode(l,o.label.formattedName,o.inputWeight?o.inputWeight:o.outputWeight))}),h=this.parseSettings(c),h.colourOfLabels=u,{nodes:d,links:g,settings:h,columns:[]}},i.prototype.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},i.prototype.getColour=function(e,i,a){var r;return r=new t.ColorHelper(this.colours,e,i),r.getColorForMeasure(a,"")},i.prototype.getTooltipDataForLink=function(e,t,a,r){var s;return s=e&&e.format?e.format(r):r.toString(),[{displayName:i.RoleNames.rows,value:t},{displayName:i.RoleNames.columns,value:a},{displayName:i.RoleNames.values,value:s}]},i.prototype.updateValueOfNode=function(e){e.inputWeight=e.links.reduce(function(t,i){return t+(i.destination===e?i.weigth:0)},0),e.outputWeight=e.links.reduce(function(t,i){return t+(i.source===e?i.weigth:0)},0)},i.prototype.getTooltipForNode=function(e,t,a){var r;return r=e&&e.format?e.format(a):a.toString(),[{displayName:"Name",value:t},{displayName:i.RoleNames.values,value:r}]},i.prototype.parseSettings=function(t){var a=!1;return a=e.DataViewObjects.getValue(t,i.Properties.labels.show,i.DefaultSettings.isVisibleLabels),{isVisibleLabels:a,scale:{x:i.DefaultSettings.scale.x,y:i.DefaultSettings.scale.y},colourOfLabels:i.DefaultSettings.colourOfLabels,fontSize:e.DataViewObjects.getValue(t,i.Properties.labels.fontSize,i.DefaultSettings.fontSize)}},i.prototype.computePositions=function(e){var t,i,a;t=this.computeXPositions(e),this.sortNodesByX(e.nodes),a=this.getColumns(e.nodes),i=this.getMaxColumn(a),e.settings.scale.x=this.getScaleByAxisX(t),e.settings.scale.y=this.getScaleByAxisY(i.sumValueOfNodes),this.scalePositionsByAxes(e.nodes,a,e.settings.scale,this.viewport.height),this.computeYPosition(e.nodes,e.settings.scale.y)},i.prototype.computeXPositions=function(e){for(var t=e.nodes,i=[],a=[],r=0,s=!1;t.length>0;)i=[],t.forEach(function(e){e.x=r,e.links.forEach(function(t){e===t.source&&e!==t.destination&&i.every(function(e){return e!==t.destination})&&i.push(t.destination)})}),s=i.length===a.length&&a.every(function(e){return i.some(function(t){return t===e})}),s?(a.forEach(function(e){e.x=r,r++}),t=[]):(t=i,a=t,r++);return r-1},i.prototype.getScaleByAxisX=function(e){return void 0===e&&(e=1),this.getPositiveNumber((this.viewport.width-this.nodeWidth)/e)},i.prototype.sortNodesByX=function(e){return e.sort(function(e,t){return e.x-t.x})},i.prototype.getColumns=function(e){var t=[],i=-Number.MAX_VALUE;return e.forEach(function(e,a){i!==e.x&&(t.push({countOfNodes:0,sumValueOfNodes:0}),i=e.x),t[e.x]&&(t[e.x].sumValueOfNodes+=Math.max(e.inputWeight,e.outputWeight),t[e.x].countOfNodes++)}),t},i.prototype.getMaxColumn=function(e){void 0===e&&(e=[]);var t={sumValueOfNodes:0,countOfNodes:0};return e.forEach(function(e){e&&e.sumValueOfNodes>t.sumValueOfNodes&&(t=e)}),t},i.prototype.getScaleByAxisY=function(e){return this.getPositiveNumber((this.viewport.height-this.getAvailableSumNodeMarginByY())/e)},i.prototype.getAvailableSumNodeMarginByY=function(){return this.viewport?this.viewport.height*i.NodeBottomMargin/100:0},i.prototype.scalePositionsByAxes=function(e,t,i,a){var r=0,s=0,o=0;e.forEach(function(e){var n=0,l=0;s!==e.x&&(s=e.x,r=0,o=0),t[s]&&(l=a-t[s].sumValueOfNodes*i.y,n=l/t[s].countOfNodes),e.x*=i.x,e.height=Math.max(e.inputWeight,e.outputWeight)*i.y,e.y=r+n*o,r+=e.height,o++})},i.prototype.computeYPosition=function(e,t){e.forEach(function(e){e.links=e.links.sort(function(t,i){var a,r;return a=t.source===e?t.destination.y:t.source.y,r=i.source===e?i.destination.y:i.source.y,a-r});var i=0,a=0;e.links.forEach(function(r){var s=0;r.height=r.weigth*t,
r.source.x<e.x||r.destination.x<e.x?(s=i,i+=r.height):(r.source.x>e.x||r.destination.x>e.x)&&(s=a,a+=r.height),r.source===e?r.dySource=s:r.destination===e&&(r.dyDestination=s)})})},i.prototype.render=function(e){var t,i;i=this.renderLinks(e),this.renderTooltip(i),t=this.renderNodes(e),this.renderTooltip(t),this.bindSelectionHandler(e,t,i)},i.prototype.renderNodes=function(a){var r,s,o,n=this;return o=this.main.select(i.Nodes.selector).selectAll(i.Node.selector),s=o.data(a.nodes.filter(function(e){return e.height>0})),r=s.enter().append("g"),s.attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)}).classed(i.Node["class"],!0),r.append("rect").classed(i.NodeRect["class"],!0),r.append("text").classed(i.NodeLabel["class"],!0),s.select(i.NodeRect.selector).style({fill:function(e){return e.colour},stroke:function(e){return d3.rgb(e.colour).darker(1.5)}}).attr({x:0,y:0,height:function(e){return e.height},width:function(e){return e.width}}),s.select(i.NodeLabel.selector).attr({x:function(e){return n.getLabelPositionByAxisX(e)},y:function(e){return e.height/2},dy:"0.35em"}).style("fill",function(e){return e.label.colour}).style("font-size",this.textProperties.fontSize).style("display",function(e){var t=!1,r=n.getCurrentPositionOfLabelByAxisX(e);return t=r>=n.viewport.width||0>=r||e.height+i.NodeMargin<e.label.height,t||!a.settings.isVisibleLabels||a.settings.scale.x/2<i.MinWidthOfLabel?"none":null}).style("text-anchor",function(e){return n.isLabelLargerThanWidth(e)?"end":null}).text(function(t){var r=a.settings.scale.x/2-t.width-i.NodeMargin;return n.getCurrentPositionOfLabelByAxisX(t)>r?e.TextMeasurementService.getTailoredTextOrDefault({text:t.label.formattedName,fontFamily:n.textProperties.fontFamily,fontSize:n.textProperties.fontSize},r):t.label.formattedName}),s.exit().remove(),s},i.prototype.getLabelPositionByAxisX=function(e){return this.isLabelLargerThanWidth(e)?-i.LabelMargin:e.width+i.LabelMargin},i.prototype.isLabelLargerThanWidth=function(e){var t=e.x+e.width+i.LabelMargin;return t+e.label.width>this.viewport.width},i.prototype.getCurrentPositionOfLabelByAxisX=function(e){var t=this.getLabelPositionByAxisX(e);return t=t>0?t+e.x+e.label.width+e.width:e.x+t-e.label.width-e.width},i.prototype.renderLinks=function(e){var t,a,r=this;return a=this.main.select(i.Links.selector).selectAll(i.Link.selector),t=a.data(e.links.filter(function(e){return e.height>0})),t.enter().append("path").classed(i.Link["class"],!0),t.attr("d",function(e){return r.getSvgPath(e)}).style({"stroke-width":function(e){return e.height},stroke:function(e){return e.colour}}),t.exit().remove(),t},i.prototype.getSvgPath=function(e){var t,i,a,r,s,o,n;return e.destination.x<e.source.x?(t=e.source.x,i=e.destination.x+e.destination.width):(t=e.source.x+e.source.width,i=e.destination.x),a=d3.interpolateNumber(t,i),r=a(this.curvatureOfLinks),s=a(1-this.curvatureOfLinks),o=e.source.y+e.dySource+e.height/2,n=e.destination.y+e.dyDestination+e.height/2,"M "+t+" "+o+" C "+r+" "+o+", "+s+" "+n+", "+i+" "+n},i.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipData})},i.prototype.bindSelectionHandler=function(e,t,i){var a=this;t.on("click",function(e){var r=_.isEqual(e.selectionIds.map(function(e){return e.getKey()}),a.selectionManager.getSelectionIds().map(function(e){return e.getKey()}))?[]:e.selectionIds;a.selectMany(r,!0).then(function(){return a.setSelection(t,i)}),d3.event.stopPropagation()}),i.on("click",function(e){a.selectionManager.select(e.selectionId,d3.event.ctrlKey).then(function(){return a.setSelection(t,i)}),d3.event.stopPropagation()}),this.root.on("click",function(){a.selectionManager.clear().then(function(){return a.setSelection(t,i)})}),this.setSelection(t,i)},i.prototype.selectMany=function(e,t){var i=this;if(void 0===t&&(t=!1),t)return this.selectionManager.clear().then(function(){return i.selectMany(e,!1)});var a=e.map(function(e){return i.selectionManager.select(e,!0)});return $.when.apply(null,a)},i.prototype.setSelection=function(e,t){var i=this.selectionManager.getSelectionIds();if(e.classed("selected",i.length>0),t.classed("selected",!1),0!==i.length){var a=e.filter(function(e){return i.some(function(t){return e.selectionIds.some(function(e){return e.getKey()===t.getKey()})})}),r=t.filter(function(e){return i.some(function(t){return t.getKey()===e.selectionId.getKey()})});a.classed("selected",!1),r.classed("selected",!0)}},i.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;if(!this.dataView)return[];switch(e.objectName){case"labels":this.enumerateLabels(i);break;case"links":this.enumerateLinks(i)}return i.complete()},i.prototype.enumerateLabels=function(e){var t,i=this.dataView.settings;i&&(t={objectName:"labels",displayName:"labels",selector:null,properties:{show:i.isVisibleLabels,fill:i.colourOfLabels,fontSize:i.fontSize}},e.pushInstance(t))},i.prototype.enumerateLinks=function(e){var i=this.dataView.links;i&&i.length>0&&i.forEach(function(i){e.pushInstance({objectName:"links",displayName:i.source.label.formattedName+" - "+i.destination.label.formattedName,selector:t.ColorHelper.normalizeSelector(i.selectionId.getSelector(),!1),properties:{fill:{solid:{color:i.colour}}}})})},i.ClassName="sankeyDiagram",i.Nodes={"class":"nodes",selector:".nodes"},i.Node={"class":"node",selector:".node"},i.NodeRect={"class":"nodeRect",selector:".nodeRect"},i.NodeLabel={"class":"nodeLabel",selector:".nodeLabel"},i.Links={"class":"links",selector:".links"},i.Link={"class":"link",selector:".link"},i.DefaultColourOfNode="rgb(62, 187, 162)",i.DefaultColourOfLink="black",i.DefaultSettings={isVisibleLabels:!0,scale:{x:1,y:1},colourOfLabels:"black",fontSize:12},i.MinWidthOfLabel=35,i.NodeBottomMargin=5,i.NodeMargin=5,i.LabelMargin=4,i.RoleNames={rows:"Source",columns:"Destination",values:"Weight"},i.capabilities={dataRoles:[{name:i.RoleNames.rows,kind:e.VisualDataRoleKind.Grouping,displayName:i.RoleNames.rows},{name:i.RoleNames.columns,kind:e.VisualDataRoleKind.Grouping,displayName:i.RoleNames.columns},{name:i.RoleNames.values,kind:e.VisualDataRoleKind.Measure,displayName:i.RoleNames.values}],dataViewMappings:[{conditions:[{Source:{min:0,max:1},Destination:{min:0,max:1},Weight:{min:0,max:0}},{Source:{min:0,max:1},Destination:{min:0,max:1},Weight:{min:1,max:1}}],categorical:{categories:{"for":{"in":i.RoleNames.rows},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:i.RoleNames.columns}},{bind:{to:i.RoleNames.values}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},links:{displayName:"Links",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}}}},i.Properties=i.getProperties(i.capabilities),i}();i.SankeyDiagram=n}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.PixelConverter,r=e.createEnumType,s=e.VisualDataRoleKind,o=e.data.createDisplayNameGetter,n=e.DataViewObjects,l=e.TextMeasurementService,c=e.visuals.valueFormatter,u=e.visuals.SelectionId,h=e.visuals.TooltipBuilder,p=e.visuals.appendClearCatcher,d=e.visuals.createInteractivityService,g=e.visuals.TooltipManager;t.bulletChartRoleNames={value:"Value",targetValue:"TargetValue",minValue:"Minimum",needsImprovementValue:"NeedsImprovement",satisfactoryValue:"Satisfactory",goodValue:"Good",veryGoodValue:"VeryGood",maxValue:"Maximum",targetValue2:"TargetValue2"};var m;!function(e){e.HORIZONTALLEFT="Horizontal Left",e.HORIZONTALRIGHT="Horizontal Right",e.VERTICALTOP="Vertical Top",e.VERTICALBOTTOM="Vertical Bottom",e.type=r([{value:e.HORIZONTALLEFT,displayName:e.HORIZONTALLEFT},{value:e.HORIZONTALRIGHT,displayName:e.HORIZONTALRIGHT},{value:e.VERTICALTOP,displayName:e.VERTICALTOP},{value:e.VERTICALBOTTOM,displayName:e.VERTICALBOTTOM}])}(m||(m={})),t.bulletChartProps={values:{targetValue:{objectName:"values",propertyName:"targetValue"},minimumPercent:{objectName:"values",propertyName:"minimumPercent"},needsImprovementPercent:{objectName:"values",propertyName:"needsImprovementPercent"},satisfactoryPercent:{objectName:"values",propertyName:"satisfactoryPercent"},goodPercent:{objectName:"values",propertyName:"goodPercent"},veryGoodPercent:{objectName:"values",propertyName:"veryGoodPercent"},maximumPercent:{objectName:"values",propertyName:"maximumPercent"},targetValue2:{objectName:"values",propertyName:"targetValue2"},secondTargetVisibility:{objectName:"values",propertyName:"secondTargetVisibility"}},orientation:{orientation:{objectName:"orientation",propertyName:"orientation"}},colors:{badColor:{objectName:"colors",propertyName:"badColor"},needsImprovementColor:{objectName:"colors",propertyName:"needsImprovementColor"},satisfactoryColor:{objectName:"colors",propertyName:"satisfactoryColor"},goodColor:{objectName:"colors",propertyName:"goodColor"},veryGoodColor:{objectName:"colors",propertyName:"veryGoodColor"},bulletColor:{objectName:"colors",propertyName:"bulletColor"}},axis:{axis:{objectName:"axis",propertyName:"axis"},axisColor:{objectName:"axis",propertyName:"axisColor"},measureUnits:{objectName:"axis",propertyName:"measureUnits"},unitsColor:{objectName:"axis",propertyName:"unitsColor"}},general:{formatString:{objectName:"general",propertyName:"formatString"}},labels:{fontSize:{objectName:"labels",propertyName:"fontSize"},show:{objectName:"labels",propertyName:"show"},labelColor:{objectName:"labels",propertyName:"labelColor"}}};var y=function(){function e(){this.baselineDelta=0}return Object.defineProperty(e.prototype,"reverse",{get:function(){return this.model.bulletChartSettings.orientation.reverse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertical",{get:function(){return this.model.bulletChartSettings.orientation.vertical},enumerable:!0,configurable:!0}),e.DefaultStyleProperties=function(){return{values:{targetValue:0,targetValue2:0,minimumPercent:0,needsImprovementPercent:25,satisfactoryPercent:50,goodPercent:100,veryGoodPercent:125,maximumPercent:200,secondTargetVisibility:!1},orientation:{orientation:m.HORIZONTALLEFT,reverse:!1,vertical:!1},colors:{badColor:"Darkred",needsImprovementColor:"Red",satisfactoryColor:"Yellow",goodColor:"Green",veryGoodColor:"Darkgreen",bulletColor:"Black"},axis:{axis:!0,axisColor:"Grey",measureUnits:"",unitsColor:"Grey"},labelSettings:{fontSize:11,show:!0,labelColor:"Black"}}},Object.defineProperty(e.prototype,"viewportIn",{get:function(){return{width:this.viewport.width,height:this.viewport.height}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportScroll",{get:function(){var t=this.viewportIn;return{width:t.width-e.ScrollBarSize,height:t.height-e.ScrollBarSize}},enumerable:!0,configurable:!0}),e.getTextProperties=function(t,a){return{fontFamily:e.FontFamily,fontSize:i.fromPoint(a),text:t}},e.converter=function(a,r){var s=e.DefaultStyleProperties(),o={bulletValueFormatString:null,bulletChartSettings:s,bars:[],barRects:[],valueRects:[],targetValues:[],viewportLength:0};if(!(a&&a.categorical&&a.categorical.values&&0!==a.categorical.values.length&&a.metadata&&a.metadata.columns&&0!==a.metadata.columns.length))return o;var h=a.metadata.objects,p=o.bulletChartSettings;h&&(p.values.targetValue=n.getValue(h,t.bulletChartProps.values.targetValue,s.values.targetValue),p.values.targetValue2=n.getValue(h,t.bulletChartProps.values.targetValue2,s.values.targetValue2),p.values.secondTargetVisibility=n.getValue(h,t.bulletChartProps.values.secondTargetVisibility,s.values.secondTargetVisibility),p.values.minimumPercent=n.getValue(h,t.bulletChartProps.values.minimumPercent,s.values.minimumPercent),p.values.needsImprovementPercent=n.getValue(h,t.bulletChartProps.values.needsImprovementPercent,s.values.needsImprovementPercent),p.values.satisfactoryPercent=n.getValue(h,t.bulletChartProps.values.satisfactoryPercent,s.values.satisfactoryPercent),p.values.goodPercent=n.getValue(h,t.bulletChartProps.values.goodPercent,s.values.goodPercent),p.values.veryGoodPercent=n.getValue(h,t.bulletChartProps.values.veryGoodPercent,s.values.veryGoodPercent),p.values.maximumPercent=n.getValue(h,t.bulletChartProps.values.maximumPercent,s.values.maximumPercent),p.orientation.orientation=n.getValue(h,t.bulletChartProps.orientation.orientation,s.orientation.orientation),p.colors.badColor=n.getFillColor(h,t.bulletChartProps.colors.badColor,s.colors.badColor),p.colors.needsImprovementColor=n.getFillColor(h,t.bulletChartProps.colors.needsImprovementColor,s.colors.needsImprovementColor),p.colors.satisfactoryColor=n.getFillColor(h,t.bulletChartProps.colors.satisfactoryColor,s.colors.satisfactoryColor),p.colors.goodColor=n.getFillColor(h,t.bulletChartProps.colors.goodColor,s.colors.goodColor),p.colors.veryGoodColor=n.getFillColor(h,t.bulletChartProps.colors.veryGoodColor,s.colors.veryGoodColor),p.colors.bulletColor=n.getFillColor(h,t.bulletChartProps.colors.bulletColor,s.colors.bulletColor),p.axis.axis=n.getValue(h,t.bulletChartProps.axis.axis,s.axis.axis),p.axis.axisColor=n.getFillColor(h,t.bulletChartProps.axis.axisColor,s.axis.axisColor),p.axis.measureUnits=l.getTailoredTextOrDefault(e.getTextProperties(n.getValue(h,t.bulletChartProps.axis.measureUnits,s.axis.measureUnits),e.DefaultSubtitleFontSizeInPt),e.MaxLabelWidth),p.axis.unitsColor=n.getFillColor(h,t.bulletChartProps.axis.unitsColor,s.axis.unitsColor),p.labelSettings.fontSize=n.getValue(h,t.bulletChartProps.labels.fontSize,s.labelSettings.fontSize),p.labelSettings.show=n.getValue(h,t.bulletChartProps.labels.show,s.labelSettings.show),p.labelSettings.labelColor=n.getFillColor(h,t.bulletChartProps.labels.labelColor,s.labelSettings.labelColor)),p.orientation.orientation!==m.HORIZONTALRIGHT&&p.orientation.orientation!==m.VERTICALBOTTOM||(p.orientation.reverse=!0),p.orientation.orientation!==m.VERTICALTOP&&p.orientation.orientation!==m.VERTICALBOTTOM||(p.orientation.vertical=!0);var d,g,y,f=1;a.categorical.categories&&(d=a.categorical.categories[0],g=d.values,f=g.length,y=c.getFormatString(d.source,t.bulletChartProps.general.formatString)),o.labelHeight=(p.labelSettings.show||0)&&parseFloat(i.fromPoint(p.labelSettings.fontSize)),o.labelHeightTop=(p.labelSettings.show||0)&&parseFloat(i.fromPoint(p.labelSettings.fontSize))/1.4,o.spaceRequiredForBarHorizontally=Math.max(60,o.labelHeight+20),o.bulletValueFormatString=c.getFormatString(a.categorical.values[0].source,t.bulletChartProps.general.formatString),o.viewportLength=(p.orientation.vertical?r.viewport.height-o.labelHeightTop-e.SubtitleMargin-20-2*e.YMarginVertical:r.viewport.width-e.MaxLabelWidth-3*e.XMarginHorizontal)-e.ScrollBarSize;for(var v=0;f>v;v++){var x=[],b=void 0,S=void 0,w=void 0,C=void 0,P=void 0,A=void 0,D=void 0,T=void 0,V=void 0,N=void 0,L=!1,M=void 0;if(g){var k=g[v];b=c.format(k,y),M=d.identity?d.identity[v]:null;var I=e.getTextProperties(b,p.labelSettings.fontSize);b=l.getTailoredTextOrDefault(I,e.MaxLabelWidth)}var O=a.categorical.values;w=p.values.targetValue,C=p.values.targetValue2,o.hasHighlights=!!(O.length>0&&O[0].highlights);for(var F=0;F<O.length;F++){var z=O[F].source,j=O[F].values[v]||0;z&&z.roles&&(z.roles[t.bulletChartRoleNames.value]?(O[F].highlights&&(L=null!==O[F].highlights[v]),x.push({value:j,metadata:O[F]}),S=j):z.roles[t.bulletChartRoleNames.targetValue]?(x.push({value:j,metadata:O[F]}),w=j):z.roles[t.bulletChartRoleNames.targetValue2]?(x.push({value:j,metadata:O[F]}),C=j):z.roles[t.bulletChartRoleNames.minValue]?P=j:z.roles[t.bulletChartRoleNames.needsImprovementValue]?V=j:z.roles[t.bulletChartRoleNames.satisfactoryValue]?A=j:z.roles[t.bulletChartRoleNames.goodValue]?D=j:z.roles[t.bulletChartRoleNames.veryGoodValue]?N=j:z.roles[t.bulletChartRoleNames.maxValue]&&(T=j))}P||(P=p.values.minimumPercent*w/100),V||(V=p.values.needsImprovementPercent*w/100),A||(A=p.values.satisfactoryPercent*w/100),D||(D=p.values.goodPercent*w/100),N||(N=p.values.veryGoodPercent*w/100),T||(T=p.values.maximumPercent*w/100);var G=[P,V,A,D,N,T].sort(d3.descending),R=d3.scale.linear().clamp(!0).domain([P,Math.max(G[0],w,S)]).range(p.orientation.vertical?[o.viewportLength,0]:[0,o.viewportLength]),B=R(P),H=R(V),E=R(A),_=R(D),W=R(N),U=R(T),Y=R(S),X=p.colors.badColor,q=p.colors.needsImprovementColor,K=p.colors.satisfactoryColor,Z=p.colors.goodColor,J=p.colors.veryGoodColor;e.addItemToBarArray(o.barRects,v,B,H,X,x,M,L),e.addItemToBarArray(o.barRects,v,H,E,q,x,M,L),e.addItemToBarArray(o.barRects,v,E,_,K,x,M,L),e.addItemToBarArray(o.barRects,v,_,W,Z,x,M,L),e.addItemToBarArray(o.barRects,v,W,U,J,x,M,L),e.addItemToBarArray(o.valueRects,v,B,Y,p.colors.bulletColor,x,M,L),o.targetValues.push({barIndex:v,value:R(w),fill:p.colors.bulletColor,key:u.createWithIdAndMeasure(M,R(w).toString()).getKey(),value2:R(C)});var Q=null;if(p.axis.axis){Q=d3.svg.axis(),Q.orient(p.orientation.vertical?"left":"bottom");var $=Math.round(Math.max(3,o.viewportLength/100)),ee=[S,w,D,A,T,P,V,N].filter(function(e){return!isNaN(e)});Q.tickFormat(c.create({format:o.bulletValueFormatString,value:ee.length?Math.max.apply(null,ee):0}).format),Q.ticks($),Q.scale(R)}var te={scale:R,barIndex:v,categoryLabel:b,x:p.orientation.vertical?e.XMarginVertical+e.SpaceRequiredForBarVertically*v:e.XMarginHorizontal,y:p.orientation.vertical?e.YMarginVertical:e.YMarginHorizontal+o.spaceRequiredForBarHorizontally*v,axis:Q,key:u.createWithIdAndMeasure(M,v.toString()).getKey()};o.bars.push(te)}return o},e.addItemToBarArray=function(e,i,a,r,s,o,n,l){isNaN(a)||isNaN(r)||e.push({barIndex:i,start:a,end:r,fill:s,tooltipInfo:h.createTooltipInfo(t.bulletChartProps.general.formatString,null,null,null,null,o),selected:!1,identity:u.createWithId(n),key:u.createWithIdAndMeasure(n,a+" "+r).getKey(),highlight:l})},e.prototype.init=function(e){var t=d3.select(e.element.get(0));this.hostService=e.host,this.bulletBody=t.append("div").classed("bulletChart",!0).attr("drag-resize-disabled",!0),this.scrollContainer=this.bulletBody.append("svg").classed("bullet-scroll-region",!0),this.clearCatcher=p(this.scrollContainer),this.labelGraphicsContext=this.scrollContainer.append("g"),this.bulletGraphicsContext=this.scrollContainer.append("g"),this.behavior=new v,this.interactivityService=d(e.host)},e.prototype.update=function(t){if(t.dataViews&&t.dataViews[0]){var i=t.dataViews[0];this.viewport=t.viewport,this.model=e.converter(i,t),this.baselineDelta=f.estimateSvgTextBaselineDelta(e.getTextProperties("1",this.model.bulletChartSettings.labelSettings.fontSize)),this.ClearViewport(),this.model&&(this.interactivityService&&this.interactivityService.applySelectionStateToData(this.model.barRects),this.bulletBody.style({height:this.viewportIn.height+"px",width:this.viewportIn.width+"px"}),this.vertical?this.scrollContainer.attr({width:this.model.bars.length*e.SpaceRequiredForBarVertically+e.XMarginVertical+"px",height:this.viewportScroll.height+"px"}):this.scrollContainer.attr({height:this.model.bars.length*this.model.spaceRequiredForBarHorizontally+"px",width:this.viewportScroll.width+"px"}),this.vertical?this.setUpBulletsVertically(this.bulletBody,this.model,this.reverse):this.setUpBulletsHorizontally(this.bulletBody,this.model,this.reverse))}},e.prototype.ClearViewport=function(){this.labelGraphicsContext.selectAll("text").remove(),this.bulletGraphicsContext.selectAll("rect").remove(),this.bulletGraphicsContext.selectAll("text").remove(),this.bulletGraphicsContext.selectAll("axis").remove(),this.bulletGraphicsContext.selectAll("path").remove(),this.bulletGraphicsContext.selectAll("line").remove(),this.bulletGraphicsContext.selectAll("tick").remove(),this.bulletGraphicsContext.selectAll("g").remove()},e.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},e.prototype.calculateLabelWidth=function(t,i,a){return(a?0:t.x+e.MaxLabelWidth)+e.XMarginHorizontal+(i?i.start:0)},e.prototype.calculateLabelHeight=function(t,i,a){return e.YMarginVertical+(a?5:t.y+this.model.labelHeightTop+e.BarMargin+e.SubtitleMargin)+(i?i.end:0)},e.prototype.setUpBulletsHorizontally=function(t,a,r){var s=this,o=a.bars,n=a.barRects,c=a.valueRects,u=a.targetValues,h=this.labelGraphicsContext.selectAll("text").data(o,function(e){return e.key}),p=this.bulletGraphicsContext.selectAll("rect.range").data(n,function(e){return e.key}),d=this.interactivityService&&this.interactivityService.hasSelection(),m=a.hasHighlights,y=p.enter().append("rect").attr({x:function(e){return s.calculateLabelWidth(o[e.barIndex],e,r)},y:function(t){return o[t.barIndex].y-e.BulletSize/2},width:function(e){return e.end-e.start},height:e.BulletSize}).classed("range",!0).style({fill:function(e){return e.fill},opacity:function(e){return x.getFillOpacity(e.selected,e.highlight,d,m)}});p.exit();var f=this.bulletGraphicsContext.selectAll("rect").data(c,function(e){return e.key});f.enter().append("rect").attr({x:function(e){return s.calculateLabelWidth(o[e.barIndex],e,r)},y:function(t){return o[t.barIndex].y-e.BulletSize/8},width:function(e){return e.end-e.start},height:1*e.BulletSize/4}).classed("value",!0).style({fill:function(e){return e.fill},opacity:function(e){return x.getFillOpacity(e.selected,e.highlight,d,m)}}),f.exit();var v=this.bulletGraphicsContext.selectAll("values").data(u,function(e){return isNaN(e.value)||isNaN(e.value2)?void 0:e.key});if(v.enter().append("line").attr({x1:function(e){return s.calculateLabelWidth(o[e.barIndex],null,r)+e.value},x2:function(e){return s.calculateLabelWidth(o[e.barIndex],null,r)+e.value},y1:function(t){return o[t.barIndex].y-e.MarkerMarginHorizontal},y2:function(t){return o[t.barIndex].y+e.MarkerMarginHorizontal}}).style({stroke:function(e){return e.fill},"stroke-width":2}),a.bulletChartSettings.values.secondTargetVisibility&&this.drawSecondTarget(v.enter(),function(e){return s.calculateLabelWidth(o[e.barIndex],null,r)+e.value2},function(e){return o[e.barIndex].y}),v.exit(),a.bulletChartSettings.axis.axis)for(var b=0;b<o.length;b++){var S=o[b];this.bulletGraphicsContext.append("g").attr({transform:function(){var t=s.calculateLabelWidth(S,null,r),i=S.y+e.BulletSize/2;return"translate("+t+","+i+")"}}).classed("axis",!0).call(S.axis.scale(S.scale)).style({fill:a.bulletChartSettings.axis.axisColor,"font-size":i.fromPoint(e.AxisFontSizeInPt)}).selectAll("line").style({stroke:a.bulletChartSettings.axis.axisColor})}a.bulletChartSettings.labelSettings.show&&h.enter().append("text").classed("title",!0).attr({x:function(t){return r?2*e.XMarginHorizontal+a.viewportLength:t.x},y:function(e){return e.y+s.baselineDelta},fill:a.bulletChartSettings.labelSettings.labelColor,"font-size":i.fromPoint(a.bulletChartSettings.labelSettings.fontSize)}).text(function(e){return e.categoryLabel});var w=l.getTailoredTextOrDefault(e.getTextProperties(a.bulletChartSettings.axis.measureUnits,e.DefaultSubtitleFontSizeInPt),e.MaxMeasureUnitWidth);if(a.bulletChartSettings.axis.measureUnits&&h.enter().append("text").attr({x:function(t){return r?2*e.XMarginHorizontal+a.viewportLength+e.SubtitleMargin:t.x-e.SubtitleMargin},y:function(e){return e.y+s.model.labelHeight/2+12},fill:a.bulletChartSettings.axis.unitsColor,"font-size":i.fromPoint(e.DefaultSubtitleFontSizeInPt)}).text(w),this.interactivityService){var C={rects:y,valueRects:f,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,bulletChartSettings:this.model.bulletChartSettings,hasHighlights:!1},P=this.model.barRects.concat(this.model.valueRects);this.interactivityService.bind(P,this.behavior,C)}h.exit(),g.addTooltip(f,function(e){return e.data.tooltipInfo},!0),g.addTooltip(p,function(e){return e.data.tooltipInfo},!0)},e.prototype.setUpBulletsVertically=function(t,a,r){var s=this,o=a.bars,n=a.barRects,c=a.valueRects,u=a.targetValues,h=this.labelGraphicsContext.selectAll("text").data(o,function(e){return e.key}),p=this.bulletGraphicsContext.selectAll("rect.range").data(n,function(e){return e.key}),d=this.interactivityService&&this.interactivityService.hasSelection(),m=a.hasHighlights,y=p.enter().append("rect").attr({x:function(e){return o[e.barIndex].x},y:function(e){return s.calculateLabelHeight(o[e.barIndex],e,r)},height:function(e){return e.start-e.end},width:e.BulletSize}).classed("range",!0).style({fill:function(e){return e.fill},opacity:function(e){return x.getFillOpacity(e.selected,e.highlight,d,m)}});p.exit();var f=this.bulletGraphicsContext.selectAll("rect").data(c,function(e){return e.key});f.enter().append("rect").attr({x:function(t){return o[t.barIndex].x+e.BulletSize/3},y:function(e){return s.calculateLabelHeight(o[e.barIndex],e,r)},height:function(e){return e.start-e.end},width:1*e.BulletSize/4}).classed("value",!0).style({fill:function(e){return e.fill},opacity:function(e){return x.getFillOpacity(e.selected,e.highlight,d,m)}}),f.exit();var v=this.bulletGraphicsContext.selectAll("values").data(u,function(e){return isNaN(e.value)||isNaN(e.value2)?void 0:e.key});if(v.enter().append("line").attr({x2:function(t){return o[t.barIndex].x+3*e.MarkerMarginVertical},x1:function(t){return o[t.barIndex].x+e.MarkerMarginVertical},y2:function(e){return s.calculateLabelHeight(o[e.barIndex],null,r)+e.value},y1:function(e){return s.calculateLabelHeight(o[e.barIndex],null,r)+e.value}}).style({stroke:function(e){return e.fill},"stroke-width":2}),a.bulletChartSettings.values.secondTargetVisibility&&this.drawSecondTarget(v.enter(),function(t){return o[t.barIndex].x+e.BulletSize/3+e.BulletSize/8},function(e){return s.calculateLabelHeight(o[e.barIndex],null,r)+e.value2}),v.exit(),a.bulletChartSettings.axis.axis)for(var b=0;b<o.length;b++){var S=o[b];this.bulletGraphicsContext.append("g").attr({transform:function(){var e=S.x,t=s.calculateLabelHeight(S,null,r);return"translate("+e+","+t+")"}}).classed("axis",!0).call(S.axis.scale(S.scale)).style({fill:a.bulletChartSettings.axis.axisColor,"font-size":i.fromPoint(e.AxisFontSizeInPt)}).selectAll("line").style({stroke:a.bulletChartSettings.axis.axisColor})}var w=e.YMarginVertical+(r?a.viewportLength+15:0)+this.model.labelHeightTop;a.bulletChartSettings.labelSettings.show&&h.enter().append("text").classed("title",!0).attr({x:function(e){return e.x},y:function(e){return w},fill:a.bulletChartSettings.labelSettings.labelColor,"font-size":i.fromPoint(a.bulletChartSettings.labelSettings.fontSize)}).text(function(e){return e.categoryLabel});var C=l.getTailoredTextOrDefault(e.getTextProperties(a.bulletChartSettings.axis.measureUnits,e.DefaultSubtitleFontSizeInPt),e.MaxMeasureUnitWidth);if(a.bulletChartSettings.axis.measureUnits&&h.enter().append("text").attr({x:function(t){return t.x+e.BulletSize},y:function(t){return w+e.SubtitleMargin+12},fill:a.bulletChartSettings.axis.unitsColor,"font-size":i.fromPoint(e.DefaultSubtitleFontSizeInPt)}).text(C),this.interactivityService){var P={rects:y,valueRects:f,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService,bulletChartSettings:this.model.bulletChartSettings,hasHighlights:!1},A=this.model.barRects.concat(this.model.valueRects);this.interactivityService.bind(A,this.behavior,P)}h.exit(),g.addTooltip(f,function(e){return e.data.tooltipInfo},!0),g.addTooltip(p,function(e){return e.data.tooltipInfo},!0)},e.prototype.drawSecondTarget=function(t,i,a){var r={stroke:function(e){return e.fill},"stroke-width":2};t.append("line").attr({x1:function(t){return i(t)-e.SecondTargetLineSize},y1:function(t){return a(t)-e.SecondTargetLineSize},x2:function(t){return i(t)+e.SecondTargetLineSize},y2:function(t){return a(t)+e.SecondTargetLineSize}}).style(r),t.append("line").attr({x1:function(t){return i(t)+e.SecondTargetLineSize},y1:function(t){return a(t)-e.SecondTargetLineSize},x2:function(t){return i(t)-e.SecondTargetLineSize},y2:function(t){return a(t)+e.SecondTargetLineSize}}).style(r)},e.prototype.destroy=function(){},e.prototype.enumerateObjectInstances=function(e){var t=this.model;if(t){var i=e.objectName;switch(i){case"labels":return this.enumerateLabels(t);case"values":return this.enumerateValues(t);case"orientation":return this.enumerateOrientation(t);case"axis":return this.enumerateAxis(t);case"colors":return this.enumerateColors(t)}}},e.prototype.enumerateLabels=function(e){return[{selector:null,objectName:"labels",properties:{show:this.model.bulletChartSettings.labelSettings.show,labelColor:this.model.bulletChartSettings.labelSettings.labelColor,fontSize:this.model.bulletChartSettings.labelSettings.fontSize}}]},e.prototype.enumerateValues=function(e){return[{selector:null,objectName:"values",properties:{targetValue:this.model.bulletChartSettings.values.targetValue,targetValue2:this.model.bulletChartSettings.values.targetValue2,secondTargetVisibility:this.model.bulletChartSettings.values.secondTargetVisibility,minimumPercent:this.model.bulletChartSettings.values.minimumPercent,needsImprovementPercent:this.model.bulletChartSettings.values.needsImprovementPercent,satisfactoryPercent:this.model.bulletChartSettings.values.satisfactoryPercent,goodPercent:this.model.bulletChartSettings.values.goodPercent,veryGoodPercent:this.model.bulletChartSettings.values.veryGoodPercent,maximumPercent:this.model.bulletChartSettings.values.maximumPercent}}]},e.prototype.enumerateOrientation=function(e){return[{selector:null,objectName:"orientation",properties:{orientation:this.model.bulletChartSettings.orientation.orientation}}]},e.prototype.enumerateAxis=function(e){return[{selector:null,objectName:"axis",properties:{axis:this.model.bulletChartSettings.axis.axis,axisColor:this.model.bulletChartSettings.axis.axisColor,measureUnits:this.model.bulletChartSettings.axis.measureUnits,unitsColor:this.model.bulletChartSettings.axis.unitsColor}}]},e.prototype.enumerateColors=function(e){return[{selector:null,objectName:"colors",properties:{badColor:this.model.bulletChartSettings.colors.badColor,needsImprovementColor:this.model.bulletChartSettings.colors.needsImprovementColor,satisfactoryColor:this.model.bulletChartSettings.colors.satisfactoryColor,goodColor:this.model.bulletChartSettings.colors.goodColor,veryGoodColor:this.model.bulletChartSettings.colors.veryGoodColor,bulletColor:this.model.bulletChartSettings.colors.bulletColor}}]},e.ScrollBarSize=22,e.SpaceRequiredForBarVertically=100,e.XMarginHorizontal=20,e.YMarginHorizontal=30,e.XMarginVertical=50,e.YMarginVertical=10,e.BulletSize=25,e.DefaultSubtitleFontSizeInPt=9,e.BarMargin=10,e.MaxLabelWidth=80,e.MaxMeasureUnitWidth=e.MaxLabelWidth-20,e.SubtitleMargin=10,e.AxisFontSizeInPt=8,e.SecondTargetLineSize=7,e.MarkerMarginHorizontal=e.BulletSize/3,e.MarkerMarginVertical=e.BulletSize/4,e.FontFamily="Segoe UI",e.capabilities={dataRoles:[{name:"Category",kind:s.Grouping,displayName:"Category"},{name:"Value",kind:s.Measure,displayName:"Value"},{name:"TargetValue",kind:s.Measure,displayName:"Target Value"},{name:"Minimum",kind:s.Measure,displayName:"Minimum"},{name:"NeedsImprovement",kind:s.Measure,displayName:"Needs Improvement"},{name:"Satisfactory",kind:s.Measure,displayName:"Satisfactory"},{name:"Good",kind:s.Measure,displayName:"Good"},{name:"VeryGood",kind:s.Measure,displayName:"Very Good"},{name:"Maximum",kind:s.Measure,displayName:"Maximum"},{name:"TargetValue2",kind:s.Measure,displayName:"Target Value 2"}],objects:{general:{displayName:o("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},values:{displayName:"Data values",properties:{targetValue:{displayName:"Target Value",type:{numeric:!0}},targetValue2:{displayName:"Target Value 2",type:{numeric:!0}},secondTargetVisibility:{
displayName:"Second Target Visibility",type:{bool:!0}},minimumPercent:{displayName:"Minimum %",type:{numeric:!0}},needsImprovementPercent:{displayName:"Needs Improvement %",type:{numeric:!0}},satisfactoryPercent:{displayName:"Satisfactory %",type:{numeric:!0}},goodPercent:{displayName:"Good %",type:{numeric:!0}},veryGoodPercent:{displayName:"Very Good %",type:{numeric:!0}},maximumPercent:{displayName:"Maximum %",type:{numeric:!0}}}},labels:{displayName:"Category labels",properties:{show:{displayName:o("Visual_Show"),type:{bool:!0}},labelColor:{displayName:o("Visual_LabelsFill"),description:o("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:o("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},orientation:{displayName:"Orientation",properties:{orientation:{displayName:"Orientation",type:{enumeration:m.type}}}},colors:{displayName:"Colors",properties:{badColor:{type:{fill:{solid:{color:!0}}},displayName:"Bad Color"},needsImprovementColor:{type:{fill:{solid:{color:!0}}},displayName:"Needs Improvement Color"},satisfactoryColor:{type:{fill:{solid:{color:!0}}},displayName:"Satisfactory Color"},goodColor:{type:{fill:{solid:{color:!0}}},displayName:"Good Color"},veryGoodColor:{type:{fill:{solid:{color:!0}}},displayName:"Very Good Color"},bulletColor:{type:{fill:{solid:{color:!0}}},displayName:"Bullet Color"}}},axis:{displayName:"Axis",properties:{axis:{displayName:"Axis",type:{bool:!0}},axisColor:{type:{fill:{solid:{color:!0}}},displayName:"Axis Color"},measureUnits:{type:{text:!0},displayName:"Measure Units "},unitsColor:{type:{fill:{solid:{color:!0}}},displayName:"Units Color"}}}},dataViewMappings:[{conditions:[{Category:{max:1},Value:{max:1},TargetValue:{max:1},Minimum:{max:1},NeedsImprovement:{max:1},Satisfactory:{max:1},Good:{max:1},VeryGood:{max:1},Maximum:{max:1},TargetValue2:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Value"}},{bind:{to:"TargetValue"}},{bind:{to:"TargetValue2"}},{bind:{to:"Minimum"}},{bind:{to:"NeedsImprovement"}},{bind:{to:"Satisfactory"}},{bind:{to:"Good"}},{bind:{to:"VeryGood"}},{bind:{to:"Maximum"}}]}}}],supportsHighlight:!0,sorting:{"default":{}},drilldown:{roles:["Category"]}},e}();t.BulletChart=y;var f;!function(e){function t(e){var t=r(e);return t.y+t.height}function i(){s||(s=$("<span/>"),$("body").append(s),o=d3.select($("body").get(0)).append("svg").style({height:"0px",width:"0px",position:"absolute"}).append("text"),n=$("<canvas/>").get(0).getContext("2d"))}function a(e){return i(),o.style(null),o.text(e.text).attr({visibility:"hidden","font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,"font-style":e.fontStyle,"white-space":e.whiteSpace||"nowrap"}),o.node().getBBox()}function r(e){var t={fontFamily:e.fontFamily,fontSize:e.fontSize,text:"M"},i=a(t);return i}var s,o,n;e.estimateSvgTextBaselineDelta=t}(f=t.TextMeasurementHelper||(t.TextMeasurementHelper={}));var v=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.options=e;var i=e.clearCatcher;e.valueRects.on("click",function(e,i){d3.event.stopPropagation(),t.handleSelection(e,d3.event.ctrlKey)}),e.rects.on("click",function(e,i){d3.event.stopPropagation(),t.handleSelection(e,d3.event.ctrlKey)}),i.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var t=this.options,i=t.hasHighlights;t.valueRects.style("opacity",function(t){return x.getFillOpacity(t.selected,t.highlight,!t.highlight&&e,!t.selected&&i)}),t.rects.style("opacity",function(t){return x.getFillOpacity(t.selected,t.highlight,!t.highlight&&e,!t.selected&&i)})},e}();t.BulletWebBehavior=v;var x;!function(e){function t(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getFillOpacity=t}(x=t.bulletChartUtils||(t.bulletChartUtils={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var a=e.visuals.valueFormatter,r=t.AnimatorCommon.GetAnimationDuration;!function(e){e[e.logn=0]="logn",e[e.sqrt=1]="sqrt",e[e.value=2]="value"}(i.WordCloudScaleType||(i.WordCloudScaleType={}));var s=i.WordCloudScaleType,o=function(){function e(e){this.selectionIdsValue=[],this.hostServices=e}return Object.defineProperty(e.prototype,"selectionIds",{get:function(){return this.selectionIdsValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSelection",{get:function(){return this.selectionIds.length>0},enumerable:!0,configurable:!0}),e.prototype.selectAndSendSelection=function(e,t){void 0===t&&(t=!1);var i=_.isArray(e)?e:[e];return this.hostServices.shouldRetainSelection()?this.sendSelectionToHost(i):(this.selectInternal(i,t),this.sendSelection())},e.prototype.select=function(e,t){void 0===t&&(t=!1);var i=_.isArray(e)?e:[e];this.selectInternal(i,t)},e.prototype.isSelected=function(e){var i=this,a=_.isArray(e)?e:[e];return a.every(function(e){return t.utility.SelectionManager.containsSelection(i.selectionIds,e)})},e.prototype.sendSelection=function(){return this.sendSelectionToHost(this.selectionIds)},e.prototype.clear=function(e){return void 0===e&&(e=!0),this.selectionIds.length=0,e?this.sendSelection():$.Deferred().resolve()},e.prototype.selectInternal=function(e,i){var a=this,r=[];r=e.every(function(e){return a.isSelected(e)})?i?this.selectionIds.filter(function(i){return!t.utility.SelectionManager.containsSelection(e,i)}):this.selectionIds.length===e.length?[]:e:i?e.filter(function(e){return!a.isSelected(e)}).concat(this.selectionIds):e,this.selectionIds.length=0,r.forEach(function(e){return a.selectionIds.push(e)})},e.prototype.sendSelectionToHost=function(e){var t=$.Deferred(),i={visualObjects:_.chain(e).filter(function(e){return e.hasIdentity()}).map(function(e){return{objectName:void 0,selectorsByColumn:e.getSelectorsByColumn()}}).value()};return this.hostServices.onSelect(i),t.resolve(this.selectionIds),t},e}(),n=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){var i=this;this.previousOriginalViewportValue=_.clone(this.originalViewportValue),this.originalViewportValue=_.clone(t),this.setUpdateObject(t,function(e){return i.viewportValue=e},function(t){return e.restrictToMinMax(t,i.minViewport)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportCopy",{get:function(){return _.clone(this.viewport)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue||{width:0,height:0}},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.minViewportValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.marginValue=this.defaultMargin)},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.marginValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportChanged",{get:function(){return!(!this.originalViewportValue||this.previousOriginalViewportValue&&this.previousOriginalViewportValue.height===this.originalViewportValue.height&&this.previousOriginalViewportValue.width===this.originalViewportValue.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.prototype.setUpdateObject=function(t,i,a){var r=this;t=_.clone(t),i(e.createNotifyChangedObject(t,function(e){a&&a(t),r.update()})),a&&a(t),this.update()},e.createNotifyChangedObject=function(e,t){var i={};return _.keys(e).forEach(function(a){return Object.defineProperty(i,a,{get:function(){return e[a]},set:function(i){e[a]=i,t(e,a)},enumerable:!0,configurable:!0})}),i},e.restrictToMinMax=function(e,t){return _.keys(e).forEach(function(i){return e[i]=Math.max(t&&t[i]||0,e[i])}),e},e}(),l=function(){function i(){this.general={maxNumberOfWords:200,minFontSize:20/u.FontSizePercentageCoefficent,maxFontSize:100/u.FontSizePercentageCoefficent,isBrokenText:!0},this.stopWords={show:!0,isDefaultStopWords:!1,words:null},this.rotateText={show:!0,minAngle:-60,maxAngle:90,maxNumberOfOrientations:2}}return Object.defineProperty(i,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),i.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},i.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},i.createEnumTypeFromEnum=function(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i=!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))},i.getValueFnByType=function(t){switch(_.keys(t)[0]){case"fill":return e.DataViewObjects.getFillColor;default:return e.DataViewObjects.getValue}},i.enumerateObjectInstances=function(e,i,a){void 0===e&&(e=new this);var r=new t.ObjectEnumerationBuilder,s=e&&e[i.objectName];if(!s)return r;var o={objectName:i.objectName,selector:null,properties:{}};for(var n in s)_.has(s,n)&&(o.properties[n]=s[n]);return r.pushInstance(o),r},i.prototype.createOriginalSettings=function(){this.originalSettings=_.cloneDeep(this)},i}();i.WordCloudSettings=l;var c=function(){function e(){this.Category=null,this.Values=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return t.converterHelper.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();i.WordCloudColumns=c;var u=function(){function i(e){this.durationAnimations=500,this.fakeViewport={width:1500,height:1e3},this.canvasViewport={width:128,height:2048},e&&(this.svg=e.svg||this.svg,this.layout=new n(null,e.margin||i.DefaultMargin),e.animator&&(this.animator=e.animator)),this.isUpdating=!1}return i.converter=function(e,r,s){var o=c.getCategoricalColumns(e);if(!o||!o.Category||_.isEmpty(o.Category.values))return null;var n=c.getCategoricalValues(e),u=l.getProperties(i.capabilities),p=i.parseSettings(e,s&&s.settings),d=a.create({format:a.getFormatString(o.Category.source,u.general.formatString),value:n.Category[0]}),g=_.isString(p.stopWords.words)?p.stopWords.words.split(i.StopWordsDelemiter):[];g=p.stopWords.isDefaultStopWords?g.concat(i.StopWords):g;var m=new t.ColorHelper(r,u.dataPoint.fill,h.util.getRandomColor()),y=n.Category.map(function(i,a){var r;r=o.Category.objects&&o.Category.objects[a]?h.util.hexToRgb(m.getColorForMeasure(o.Category.objects[a],"")):s&&s.texts&&s.texts[a]?s.texts[a].color:h.util.getRandomColor();var l=(new t.SelectionIdBuilder).withCategory(e.categorical.categories[0],a).createSelectionId();return{text:i,count:n.Values&&n.Values[a]&&!isNaN(n.Values[a])?n.Values[a]:1,index:a,selectionId:l,color:r,textGroup:i}}),f=i.getReducedText(y,g,p),v=i.getDataPoints(f,p,d);return{dataView:e,settings:p,texts:y,dataPoints:v}},i.parseSettings=function(e,t){var a=l.parse(e,i.capabilities);return a.general.minFontSize=Math.max(a.general.minFontSize,1),a.general.maxFontSize=Math.max(a.general.maxFontSize,1),a.general.maxFontSize=Math.max(a.general.maxFontSize,a.general.minFontSize),a.rotateText.minAngle=Math.max(Math.min(a.rotateText.minAngle,i.MaxAngle),i.MinAngle),a.rotateText.maxAngle=Math.max(Math.min(a.rotateText.maxAngle,i.MaxAngle),i.MinAngle),a.rotateText.maxAngle=Math.max(a.rotateText.maxAngle,a.rotateText.minAngle),a.general.maxNumberOfWords=Math.max(Math.min(a.general.maxNumberOfWords,i.MaxNumberOfWords),1),a.rotateText.maxNumberOfOrientations=Math.max(Math.min(a.rotateText.maxNumberOfOrientations,i.MaxNumberOfWords),1),a.createOriginalSettings(),a},i.getReducedText=function(e,t,a){var r=i.getBrokenWords(e,t,a),s=_.values(_.groupBy(r,function(e){return e.text}));return s=s.map(function(e){return _.sortBy(e,function(e){return e.textGroup.length})})},i.getBrokenWords=function(e,t,a){var r=[],s=/\s/,o=new RegExp("["+i.Punctuation.join("\\")+"]","gim");return a.general.isBrokenText?(e.forEach(function(e){if("string"==typeof e.text){var i=e.text.replace(o," ").split(s);a.stopWords.show&&(i=i.filter(function(e){return e.length>0&&!t.some(function(t){return e.toLocaleLowerCase()===t.toLocaleLowerCase()})})),i.forEach(function(t){t.length>0&&!s.test(t)&&r.push({text:t,textGroup:e.textGroup,count:e.count,index:e.index,selectionId:e.selectionId,color:e.color})})}else r.push(e)}),r):e},i.getDataPoints=function(e,t,a){if(_.isEmpty(e))return[];var r=e.map(function(e){return{text:a.format(e[0].text),x:0,y:0,rotate:i.getAngle(t),padding:1,width:0,height:0,xOff:0,yOff:0,x0:0,y0:0,x1:0,y1:0,color:e[0].color,selectionIds:e.map(function(e){return e.selectionId}),wordIndex:e[0].index,count:_.sum(e,function(e){return e.count})}}),s=_.min(r,function(e){return e.count}).count,o=_.max(r,function(e){return e.count}).count,n=e.map(function(e){return e[0]});return r.forEach(function(e){return e.size=i.getWordFontSize(n,t,e.count,s,o)}),r.sort(function(e,t){return t.count-e.count})},i.getWordFontSize=function(e,t,a,r,o,n){void 0===n&&(n=s.value);var l,c,u=t.general.minFontSize*i.FontSizePercentageCoefficent,h=t.general.maxFontSize*i.FontSizePercentageCoefficent;if(e.length<2)return h;switch(n){case s.logn:l=Math.log(a);case s.sqrt:l=Math.sqrt(a);case s.value:l=a}return c=l>r&&o-r!==0?h*(l-r)/(o-r):0,c=100*c/h,c=c*(h-u)/100+u},i.getAngle=function(e){if(!e.rotateText.show)return 0;var t=(e.rotateText.maxAngle-e.rotateText.minAngle)/e.rotateText.maxNumberOfOrientations*Math.floor(Math.random()*e.rotateText.maxNumberOfOrientations);return e.rotateText.minAngle+t},Object.defineProperty(i.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),i.prototype.init=function(e){var t=this;this.svg?this.root=this.svg:this.root=d3.select(e.element.get(0)).append("svg"),this.colors=e.style.colorPalette.dataColors,this.hostService=e.host,this.selectionManager=new o(this.hostService),this.layout=new n(null,i.DefaultMargin),this.root.classed(i.ClassName,!0),this.root.on("click",function(){t.setSelection(null)}),this.fontFamily=this.root.style("font-family"),this.main=this.root.append("g"),this.wordsContainerSelection=this.main.append("g").classed(i.Words["class"],!0),this.canvas=document.createElement("canvas")},i.prototype.update=function(e){var t=this;if(e&&e.viewport&&e.dataViews&&e.dataViews[0]&&e.viewport&&e.viewport.height>=0&&e.viewport.width>=0&&(e!==this.visualUpdateOptions&&(this.incomingUpdateOptions=e),!this.isUpdating&&this.incomingUpdateOptions!==this.visualUpdateOptions)){this.visualUpdateOptions=this.incomingUpdateOptions,this.layout.viewport=this.visualUpdateOptions.viewport;var a=e.dataViews[0];if(this.layout.viewportInIsZero)return;this.durationAnimations=r(this.animator,e.suppressAnimations),this.UpdateSize();var s=i.converter(a,this.colors,this.data);if(!s)return;this.data=s,this.computePositions(function(e){return t.render(e)})}},i.prototype.computePositions=function(t){var a=this,r=this.data.dataPoints;return _.isEmpty(r)?null:void requestAnimationFrame(function(){var s=_.range(0,(a.specialViewport.width>>5)*a.specialViewport.height,0);r.length>a.settings.general.maxNumberOfWords&&(r=r.slice(0,a.settings.general.maxNumberOfWords)),r.forEach(function(t){t.widthOfWord=e.TextMeasurementService.measureSvgTextWidth({fontFamily:a.fontFamily,fontSize:t.size+1+i.Size,text:t.text})+2}),a.computeCycle(r,a.getCanvasContext(),s,null,t,[],0)})},i.prototype.computeCycle=function(e,t,i,a,r,s,o){void 0===s&&(s=[]),void 0===o&&(o=0);var n=e[o],l=1;e.length<=10?l=5:e.length<=25?l=3:e.length<=75?l=1.5:e.length<=100&&(l=1.25),n.x=this.specialViewport.width/l*(Math.random()+.5)>>1,n.y=this.specialViewport.height/l*(Math.random()+.5)>>1,n.sprite||this.generateSprites(t,e,o),n.sprite&&this.findPosition(i,n,a)&&(s.push(n),a=this.updateBorders(n,a),n.x-=this.specialViewport.width>>1,n.y-=this.specialViewport.height>>1),++o<e.length&&this.root?this.computeCycle(e,t,i,a,r,s,o):r({data:s,leftBorder:a&&a[0],rightBorder:a&&a[1]})},i.prototype.updateBorders=function(e,t){if(t&&2===t.length){var i=t[0],a=t[1];e.x+e.x0<i.x&&(i.x=e.x+e.x0),e.y+e.y0<i.y&&(i.y=e.y+e.y0),e.x+e.x1>a.x&&(a.x=e.x+e.x1),e.y+e.y1>a.y&&(a.y=e.y+e.y1)}else t=[{x:e.x+e.x0,y:e.y+e.y0},{x:e.x+e.x1,y:e.y+e.y1}];return t},i.prototype.generateSprites=function(e,t,a){e.clearRect(0,0,this.canvasViewport.width<<5,this.canvasViewport.height);for(var r=0,s=0,o=0,n=a,l=t.length;l>n;n++){var c=t[n],u=c.widthOfWord,h=c.size<<1;if(c.rotate){var p=Math.sin(c.rotate*i.Radians),d=Math.cos(c.rotate*i.Radians),g=u*d,m=u*p,y=h*d,f=h*p;u=Math.max(Math.abs(g+f),Math.abs(g-f))+31>>5<<5,h=Math.floor(Math.max(Math.abs(m+y),Math.abs(m-y)))}else u=u+31>>5<<5;h>o&&(o=h),r+u>=this.canvasViewport.width<<5&&(r=0,s+=o,o=0),e.save(),e.font="normal normal "+(c.size+1)+i.Size+" "+this.fontFamily,e.translate(r+(u>>1),s+(h>>1)),c.rotate&&e.rotate(c.rotate*i.Radians),e.fillText(c.text,0,0),c.padding&&(e.lineWidth=2*c.padding,e.strokeText(c.text,0,0)),e.restore(),c.width=u,c.height=h,c.xOff=r,c.yOff=s,c.x1=u>>1,c.y1=h>>1,c.x0=-c.x1,c.y0=-c.y1,r+=u}this.setSprites(e,t)},i.prototype.setSprites=function(e,t){for(var i=e.getImageData(0,0,this.canvasViewport.width<<5,this.canvasViewport.height).data,a=[],r=t.length-1;r>=0;r--){var s=t[r],o=s.width,n=o>>5,l=s.y1-s.y0,c=0,u=0,h=0,p=0;if(s.xOff+o>=this.canvasViewport.width<<5||s.yOff+l>=this.canvasViewport.height)s.sprite=null;else{for(var d=0;l*n>d;d++)a[d]=0;if(null===s.xOff)return;c=s.xOff,u=s.yOff,h=0,p=-1;for(var d=0;l>d;d++){for(var g=0;o>g;g++){var m=n*d+(g>>5),y=(u+d)*(this.canvasViewport.width<<5)+(c+g)<<2,f=i[y]?1<<31-g%32:0;a[m]|=f,h|=f}h?p=d:(s.y0++,l--,d--,u++)}s.y1=s.y0+p,s.sprite=a.slice(0,(s.y1-s.y0)*n)}}},i.prototype.findPosition=function(e,t,i){for(var a,r,s,o={x:t.x,y:t.y},n=Math.sqrt(this.specialViewport.width*this.specialViewport.width+this.specialViewport.height*this.specialViewport.height),l=Math.random()<.5?1:-1,c=-l;;){if(c+=l,a=this.archimedeanSpiral(c),r=Math.floor(a.x),s=Math.floor(a.y),Math.min(Math.abs(r),Math.abs(s))>=n)break;if(t.x=o.x+r,t.y=o.y+s,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>this.specialViewport.width||t.y+t.y1>this.specialViewport.height)&&(!i||!this.checkIntersect(t,e))&&(!i||this.checkIntersectOfRectangles(t,i[0],i[1]))){for(var u=t.sprite,h=t.width>>5,p=this.specialViewport.width>>5,d=t.x-(h<<4),g=127&d,m=32-g,y=t.y1-t.y0,f=(t.y+t.y0)*p+(d>>5),v=0;y>v;v++){for(var x=0,b=0;h>=b;b++){var S,w=x<<m;h>b&&(x=u[v*h+b]),S=h>b?x>>>g:0,e[f+b]|=w|S}f+=p}return t.sprite=null,!0}}return!1},i.prototype.archimedeanSpiral=function(e){var t=this.specialViewport.width/this.specialViewport.height;return e=.1*e,{x:t*e*Math.cos(e),y:e*Math.sin(e)}},i.prototype.checkIntersect=function(e,t){for(var i=this.specialViewport.width>>5,a=e.sprite,r=e.width>>5,s=e.x-(r<<4),o=127&s,n=32-o,l=e.y1-e.y0,c=(e.y+e.y0)*i+(s>>5),u=0;l>u;u++){for(var h=0,p=0;r>=p;p++){var d,g=0,m=0;if(d=h<<n,r>p&&(h=a[u*r+p]),g=r>p?h>>>o:0,m=(d|g)&t[c+p])return!0}c+=i}return!1},i.prototype.checkIntersectOfRectangles=function(e,t,i){return e.x+e.x1>t.x&&e.x+e.x0<i.x&&e.y+e.y1>t.y&&e.y+e.y0<i.y},i.prototype.getCanvasContext=function(){if(!this.canvasViewport)return null;this.canvas.width=1,this.canvas.height=1;var e=this.canvas.getContext("2d");return this.canvas.width=this.canvasViewport.width<<5,this.canvas.height=this.canvasViewport.height,e=this.canvas.getContext("2d"),e.fillStyle=e.strokeStyle="red",e.textAlign="center",e},i.prototype.UpdateSize=function(){var e,t,i;i=Math.sqrt(this.fakeViewport.width*this.fakeViewport.height/(this.layout.viewportIn.width*this.layout.viewportIn.height)),isNaN(i)?t=e=1:(t=this.layout.viewportIn.height*i,e=this.layout.viewportIn.width*i),this.specialViewport={height:t,width:e},this.root.attr({height:this.layout.viewport.height,width:this.layout.viewport.width})},i.prototype.render=function(e){var a=this;if(e&&e.data){this.scaleMainView(e),this.wordsGroupUpdateSelection=this.main.select(i.Words.selector).selectAll("g").data(e.data);var r=this.wordsGroupUpdateSelection.enter().append("svg:g").classed(i.WordGroup["class"],!0);r.append("svg:text").style("font-size","1px").attr("pointer-events","none"),r.append("svg:rect"),this.wordsGroupUpdateSelection.exit().remove(),this.wordsGroupUpdateSelection.attr("transform",function(e){return t.SVGUtil.translate(e.x,e.y)+" rotate("+e.rotate+")"}).sort(function(e,t){return t.height*t.width-e.height*e.width}),this.wordsTextUpdateSelection=this.wordsGroupUpdateSelection.selectAll("text").data(function(e){return[e]}),this.wordsTextUpdateSelection.text(function(e){return e.text}),this.animation(this.wordsTextUpdateSelection,this.durationAnimations).style({"font-size":function(e){return""+e.size+i.Size},fill:function(e){return e.color}}),this.wordsGroupUpdateSelection.selectAll("rect").data(function(e){return[e]}).attr({x:function(e){return.5*-e.widthOfWord},width:function(e){return e.widthOfWord},y:function(e){return.75*-e.size},height:function(e){return.85*e.size},fill:function(e){return"rgba(63, 191, 191, 0.0)"}}).on("click",function(e){a.setSelection(e),d3.event.stopPropagation()}),this.renderSelection(),this.isUpdating=!1,this.incomingUpdateOptions!==this.visualUpdateOptions&&this.update(this.incomingUpdateOptions)}},i.prototype.setSelection=function(e){var i=this;if(!e)return void this.selectionManager.clear().then(function(){return i.renderSelection()});var a=e.selectionIds;if(this.selectionManager.isSelected(a)&&d3.event.ctrlKey){var r=this.wordsGroupUpdateSelection.data().filter(function(t){return t.text!==e.text});a=a.filter(function(e){return!r.some(function(a){return i.selectionManager.isSelected(a.selectionIds)&&t.utility.SelectionManager.containsSelection(a.selectionIds,e)})})}this.selectionManager.selectAndSendSelection(a,d3.event.ctrlKey),this.renderSelection()},i.prototype.scaleMainView=function(e){var i=e.data.map(function(e){var t=e.width/2,i=e.height/2;return{left:e.x-t,top:e.y-i,right:e.x+t,bottom:e.y+i}}),a={left:_.min(i,function(e){return e.left}).left,top:_.min(i,function(e){return e.top}).top,right:_.max(i,function(e){return e.right}).right,bottom:_.max(i,function(e){return e.bottom}).bottom};a.width=a.right-a.left,a.height=a.bottom-a.top;var r=this.layout.viewportIn.width/a.width,s=this.layout.viewportIn.height/a.height,o=Math.min(r,s),n=-a.left*o+5,l=-a.top*o+5;this.main.style("line-height","5px"),this.main.attr("transform",t.SVGUtil.translate(n,l)+" scale("+o+")").style("line-height","10px")},i.prototype.renderSelection=function(){var e=this;if(this.selectionManager.selectionIds.some(function(t){return!e.wordsGroupUpdateSelection.data().some(function(e){return e.selectionIds.some(function(e){return e.getKey()===t.getKey()})})})&&this.selectionManager.clear(!1),!this.selectionManager.hasSelection)return void this.setOpacity(this.wordsTextUpdateSelection,i.MaxOpacity);var t=this.wordsTextUpdateSelection.filter(function(t){return e.selectionManager.isSelected(t.selectionIds[0])});this.setOpacity(this.wordsTextUpdateSelection,i.MinOpacity),this.setOpacity(t,i.MaxOpacity)},i.prototype.setOpacity=function(e,t){e.style("fill-opacity",t),this.main&&(this.main.style("line-height","14px"),this.animation(this.main,0,this.durationAnimations).style("line-height","15px"))},i.prototype.enumerateObjectInstances=function(e){var a=this,r=l.enumerateObjectInstances(this.settings&&this.settings.originalSettings,e,i.capabilities);switch(e.objectName){case"dataPoint":if(this.data&&this.data.dataPoints){var s=[];_.unique(this.data.dataPoints,function(e){return e.wordIndex}).forEach(function(i){-1===s.indexOf(i.wordIndex)&&(s.push(i.wordIndex),r.pushInstance({objectName:e.objectName,displayName:a.data.texts[i.wordIndex].text,selector:t.ColorHelper.normalizeSelector(i.selectionIds[0].getSelector(),!1),properties:{fill:{solid:{color:i.color}}}}))})}}return r.complete()},i.prototype.animation=function(e,t,i,a){return void 0===t&&(t=0),void 0===i&&(i=0),e.transition().delay(i).duration(t).each("end",a)},i.prototype.destroy=function(){this.root=null,this.canvas=null},i.ClassName="wordCloud",i.Words={"class":"words",selector:".words"},i.WordGroup={"class":"word",selector:".word"},i.Size="px",i.StopWordsDelemiter=" ",i.Radians=Math.PI/180,i.MinAngle=-180,i.MaxAngle=180,i.MaxNumberOfWords=2500,i.MinOpacity=.2,i.MaxOpacity=1,i.FontSizePercentageCoefficent=1,i.capabilities={dataRoles:[{name:c.Roles.Category,kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:c.Roles.Values,kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{min:1,max:1},Values:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{count:i.MaxNumberOfWords}}},values:{"for":{"in":"Values"}}}}],sorting:{implicit:{clauses:[{role:"Values",direction:2}]}},objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},maxNumberOfWords:{displayName:"Max number of words",type:{numeric:!0}},minFontSize:{displayName:"Min Font",type:{formatting:{fontSize:!0}}},maxFontSize:{displayName:"Max Font",type:{formatting:{fontSize:!0}}},isBrokenText:{displayName:"Word-breaking",type:{bool:!0}}}},dataPoint:{displayName:"Data colors",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},stopWords:{displayName:"Stop Words",properties:{show:{displayName:"Show",type:{bool:!0}},isDefaultStopWords:{displayName:"Default Stop Words",type:{bool:!0}},words:{displayName:"Words",type:{text:!0}}}},rotateText:{displayName:"Rotate Text",properties:{show:{displayName:"Show",type:{bool:!0}},minAngle:{displayName:"Min Angle",type:{numeric:!0}},maxAngle:{displayName:"Max Angle",type:{numeric:!0}},maxNumberOfOrientations:{displayName:"Max number of orientations",type:{numeric:!0}}}}}},i.Punctuation=["!",".",":","'",";",",","!","@","#","$","%","^","&","*","(",")","[","]",'"',"\\","/","-","_","+","="],i.StopWords=["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"],i.DefaultMargin={top:10,right:10,bottom:10,left:10},i}();i.WordCloud=u;var h;!function(e){var t;!function(e){function t(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,a){return t+t+i+i+a+a});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?"rgb("+parseInt(i[1],16)+","+parseInt(i[2],16)+","+parseInt(i[3],16)+")":null}function i(){var e=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),i=Math.floor(255*Math.random());return"rgb("+e+","+t+","+i+")"}e.hexToRgb=t,e.getRandomColor=i}(t=e.util||(e.util={}))}(h||(h={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r,s=a.CssConstants.createClassAndSelector,o=a.PixelConverter,n=e.data.SQExprConverter,l=e.visuals.SelectionIdBuilder,c=e.data.Selector;!function(e){function t(e){return new u(e)}e.createTableView=t}(r=i.TableViewFactory||(i.TableViewFactory={}));var u=function(){function e(t){this.options=$.extend(!0,{},t),this.options.baseContainer.style("overflow-y","auto").attr("drag-resize-disabled",!0),this.scrollContainer=t.baseContainer.append("div").attr("class","scrollRegion"),this.visibleGroupContainer=this.scrollContainer.append("div").attr("class","visibleGroup"),e.SetDefaultOptions(t)}return e.SetDefaultOptions=function(t){t.rowHeight=t.rowHeight||e.defaultRowHeight},e.prototype.rowHeight=function(e){return this.options.rowHeight=Math.ceil(e),this},e.prototype.columnWidth=function(e){return this.options.columnWidth=Math.ceil(e),this},e.prototype.orientation=function(e){return this.options.orientation=e,this},e.prototype.rows=function(e){return this.options.rows=Math.ceil(e),this},e.prototype.columns=function(e){return this.options.columns=Math.ceil(e),this},e.prototype.data=function(e,t,i){return void 0===i&&(i=!1),this._data=e,this.getDatumIndex=t,this.setTotalRows(),i&&$(this.options.baseContainer.node()).scrollTop(0),this},e.prototype.viewport=function(e){return this.options.viewport=e,this},e.prototype.empty=function(){this._data=[],this.render()},e.prototype.setTotalRows=function(){var t=this._data.length,i=Math.min(this.options.rows,t),a=Math.min(this.options.columns,t);a>0&&i>0?(this._totalColumns=a,this._totalRows=i):i>0?(this._totalRows=i,this._totalColumns=Math.ceil(t/i)):a>0?(this._totalColumns=a,this._totalRows=Math.ceil(t/a)):(this._totalColumns=e.defaultColumns,this._totalRows=Math.ceil(t/e.defaultColumns))},e.prototype.render=function(){var t=this.options,i=this.visibleGroupContainer,a=t.rowHeight||e.defaultRowHeight,r=[],s=t.rows,o=t.columns,n=this._data.length,s=t.rows>n?n:t.rows,o=t.columns>n?n:t.columns;if(0===o&&0===s?t.orientation===d.HORIZONTAL?(o=n,s=1):(o=1,s=n):0===o&&s>0?o=Math.ceil(n/s):o>0&&0===s&&(s=Math.ceil(n/o)),
this.options.orientation===d.VERTICAL){var l=s;s=o,o=l}else this.options.orientation===d.HORIZONTAL&&(0===s&&(s=this._totalRows),0===o&&(o=this._totalColumns));for(var c=0,u=0,h=0;s>h;h++)if(this.options.orientation===d.VERTICAL&&0===t.rows&&n%t.columns>0&&t.columns<=n)n%t.columns>h?(c=h*Math.ceil(n/t.columns),u=c+Math.ceil(n/t.columns),r.push(this._data.slice(c,u))):(r.push(this._data.slice(u,u+Math.floor(n/t.columns))),u+=Math.floor(n/t.columns));else if(this.options.orientation===d.HORIZONTAL&&0===t.columns&&n%t.rows>0&&t.rows<=n)n%t.rows>h?(c=h*Math.ceil(n/t.rows),u=c+Math.ceil(n/t.rows),r.push(this._data.slice(c,u))):(r.push(this._data.slice(u,u+Math.floor(n/t.rows))),u+=Math.floor(n/t.rows));else{var u=h*o;r.push(this._data.slice(u,u+o))}i.selectAll(".row").remove();var p=i.selectAll(".row").data(r).enter().append("div").classed("row",!0).selectAll(".cell").data(function(e){return e});p.enter().append("div").classed("cell",!0).call(function(e){return t.enter(e)}),p.order();var g=i.selectAll(".cell:not(.transitioning)");if(g.call(function(e){return t.update(e)}),g.style({height:a>0?a+"px":"auto"}),this.options.orientation===d.VERTICAL){for(var m=0,h=0;h<r.length;h++)0!==r[h].length&&(m=h+1);g.style({width:"100%"});var y=i.selectAll("div.row");y.style({width:t.columnWidth>0?t.columnWidth+"px":100/m+"%"})}else g.style({width:t.columnWidth>0?t.columnWidth+"px":100/o+"%"});p.exit().call(function(e){return t.exit(e)}).remove()},e.defaultRowHeight=0,e.defaultColumns=1,e}();i.chicletSlicerProps={general:{orientation:{objectName:"general",propertyName:"orientation"},columns:{objectName:"general",propertyName:"columns"},rows:{objectName:"general",propertyName:"rows"},showDisabled:{objectName:"general",propertyName:"showDisabled"},multiselect:{objectName:"general",propertyName:"multiselect"},selection:{objectName:"general",propertyName:"selection"},selfFilterEnabled:{objectName:"general",propertyName:"selfFilterEnabled"}},header:{show:{objectName:"header",propertyName:"show"},title:{objectName:"header",propertyName:"title"},fontColor:{objectName:"header",propertyName:"fontColor"},background:{objectName:"header",propertyName:"background"},outline:{objectName:"header",propertyName:"outline"},textSize:{objectName:"header",propertyName:"textSize"},outlineColor:{objectName:"header",propertyName:"outlineColor"},outlineWeight:{objectName:"header",propertyName:"outlineWeight"}},rows:{fontColor:{objectName:"rows",propertyName:"fontColor"},textSize:{objectName:"rows",propertyName:"textSize"},height:{objectName:"rows",propertyName:"height"},width:{objectName:"rows",propertyName:"width"},background:{objectName:"rows",propertyName:"background"},transparency:{objectName:"rows",propertyName:"transparency"},selectedColor:{objectName:"rows",propertyName:"selectedColor"},hoverColor:{objectName:"rows",propertyName:"hoverColor"},unselectedColor:{objectName:"rows",propertyName:"unselectedColor"},disabledColor:{objectName:"rows",propertyName:"disabledColor"},outline:{objectName:"rows",propertyName:"outline"},outlineColor:{objectName:"rows",propertyName:"outlineColor"},outlineWeight:{objectName:"rows",propertyName:"outlineWeight"},borderStyle:{objectName:"rows",propertyName:"borderStyle"}},images:{imageSplit:{objectName:"images",propertyName:"imageSplit"},stretchImage:{objectName:"images",propertyName:"stretchImage"},bottomImage:{objectName:"images",propertyName:"bottomImage"}},selectedPropertyIdentifier:{objectName:"general",propertyName:"selected"},filterPropertyIdentifier:{objectName:"general",propertyName:"filter"},formatString:{objectName:"general",propertyName:"formatString"},hasSavedSelection:!0};var h;!function(t){t.ROUNDED="Rounded",t.CUT="Cut",t.SQUARE="Square",t.type=e.createEnumType([{value:t.ROUNDED,displayName:t.ROUNDED},{value:t.CUT,displayName:t.CUT},{value:t.SQUARE,displayName:t.SQUARE}])}(h||(h={}));var p;!function(t){t.INPLACE="Inplace",t.BOTTOM="Bottom",t.HIDE="Hide",t.type=e.createEnumType([{value:t.INPLACE,displayName:t.INPLACE},{value:t.BOTTOM,displayName:t.BOTTOM},{value:t.HIDE,displayName:t.HIDE}])}(p||(p={}));var d;!function(t){t.HORIZONTAL="Horizontal",t.VERTICAL="Vertical",t.type=e.createEnumType([{value:t.HORIZONTAL,displayName:t.HORIZONTAL},{value:t.VERTICAL,displayName:t.VERTICAL}])}(d||(d={}));var g=function(){function a(e){e&&e.behavior&&(this.behavior=e.behavior),this.behavior||(this.behavior=new f)}return a.DefaultStyleProperties=function(){return{general:{orientation:d.VERTICAL,columns:3,rows:0,multiselect:!0,showDisabled:p.INPLACE,selection:null,selfFilterEnabled:!1},margin:{top:50,bottom:50,right:50,left:50},header:{borderBottomWidth:1,show:!0,outline:"BottomOnly",fontColor:"#a6a6a6",background:null,textSize:10,outlineColor:"#a6a6a6",outlineWeight:1,title:""},headerText:{marginLeft:8,marginTop:0},slicerText:{textSize:10,height:0,width:0,fontColor:"#666666",hoverColor:"#212121",selectedColor:"#BDD7EE",unselectedColor:"#ffffff",disabledColor:"grey",marginLeft:8,outline:"Frame",background:null,transparency:0,outlineColor:"#000000",outlineWeight:1,borderStyle:"Cut"},slicerItemContainer:{marginTop:5,marginLeft:0},images:{imageSplit:50,stretchImage:!1,bottomImage:!1}}},a.getValidImageSplit=function(e){return e<a.MinImageSplit?a.MinImageSplit:e>a.MaxImageSplit?a.MaxImageSplit:e},a.converter=function(a,r,s,o){if(a&&a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[0].values&&a.categorical.categories[0].values.length>0){var n=new m.ChicletSlicerConverter(a,o);n.convert();var l,c=this.DefaultStyleProperties(),u=a.metadata.objects;u&&(c.general.orientation=e.DataViewObjects.getValue(u,i.chicletSlicerProps.general.orientation,c.general.orientation),c.general.columns=e.DataViewObjects.getValue(u,i.chicletSlicerProps.general.columns,c.general.columns),c.general.rows=e.DataViewObjects.getValue(u,i.chicletSlicerProps.general.rows,c.general.rows),c.general.multiselect=e.DataViewObjects.getValue(u,i.chicletSlicerProps.general.multiselect,c.general.multiselect),c.general.showDisabled=e.DataViewObjects.getValue(u,i.chicletSlicerProps.general.showDisabled,c.general.showDisabled),c.general.selection=e.DataViewObjects.getValue(a.metadata.objects,i.chicletSlicerProps.general.selection,c.general.selection),c.general.selfFilterEnabled=e.DataViewObjects.getValue(u,i.chicletSlicerProps.general.selfFilterEnabled,c.general.selfFilterEnabled),c.header.show=e.DataViewObjects.getValue(u,i.chicletSlicerProps.header.show,c.header.show),c.header.title=e.DataViewObjects.getValue(u,i.chicletSlicerProps.header.title,c.header.title),c.header.fontColor=e.DataViewObjects.getFillColor(u,i.chicletSlicerProps.header.fontColor,c.header.fontColor),c.header.background=e.DataViewObjects.getFillColor(u,i.chicletSlicerProps.header.background,c.header.background),c.header.textSize=e.DataViewObjects.getValue(u,i.chicletSlicerProps.header.textSize,c.header.textSize),c.header.outline=e.DataViewObjects.getValue(u,i.chicletSlicerProps.header.outline,c.header.outline),c.header.outlineColor=e.DataViewObjects.getFillColor(u,i.chicletSlicerProps.header.outlineColor,c.header.outlineColor),c.header.outlineWeight=e.DataViewObjects.getValue(u,i.chicletSlicerProps.header.outlineWeight,c.header.outlineWeight),c.slicerText.textSize=e.DataViewObjects.getValue(u,i.chicletSlicerProps.rows.textSize,c.slicerText.textSize),c.slicerText.height=e.DataViewObjects.getValue(u,i.chicletSlicerProps.rows.height,c.slicerText.height),c.slicerText.width=e.DataViewObjects.getValue(u,i.chicletSlicerProps.rows.width,c.slicerText.width),c.slicerText.selectedColor=e.DataViewObjects.getFillColor(u,i.chicletSlicerProps.rows.selectedColor,c.slicerText.selectedColor),c.slicerText.hoverColor=e.DataViewObjects.getFillColor(u,i.chicletSlicerProps.rows.hoverColor,c.slicerText.hoverColor),c.slicerText.unselectedColor=e.DataViewObjects.getFillColor(u,i.chicletSlicerProps.rows.unselectedColor,c.slicerText.unselectedColor),c.slicerText.disabledColor=e.DataViewObjects.getFillColor(u,i.chicletSlicerProps.rows.disabledColor,c.slicerText.disabledColor),c.slicerText.background=e.DataViewObjects.getFillColor(u,i.chicletSlicerProps.rows.background,c.slicerText.background),c.slicerText.transparency=e.DataViewObjects.getValue(u,i.chicletSlicerProps.rows.transparency,c.slicerText.transparency),c.slicerText.fontColor=e.DataViewObjects.getFillColor(u,i.chicletSlicerProps.rows.fontColor,c.slicerText.fontColor),c.slicerText.outline=e.DataViewObjects.getValue(u,i.chicletSlicerProps.rows.outline,c.slicerText.outline),c.slicerText.outlineColor=e.DataViewObjects.getFillColor(u,i.chicletSlicerProps.rows.outlineColor,c.slicerText.outlineColor),c.slicerText.outlineWeight=e.DataViewObjects.getValue(u,i.chicletSlicerProps.rows.outlineWeight,c.slicerText.outlineWeight),c.slicerText.borderStyle=e.DataViewObjects.getValue(u,i.chicletSlicerProps.rows.borderStyle,c.slicerText.borderStyle),c.images.imageSplit=e.DataViewObjects.getValue(u,i.chicletSlicerProps.images.imageSplit,c.images.imageSplit),c.images.stretchImage=e.DataViewObjects.getValue(u,i.chicletSlicerProps.images.stretchImage,c.images.stretchImage),c.images.bottomImage=e.DataViewObjects.getValue(u,i.chicletSlicerProps.images.bottomImage,c.images.bottomImage)),c.general.selfFilterEnabled&&s&&(s=s.toLowerCase(),n.dataPoints.forEach(function(e){return e.filtered=e.category.toLowerCase().indexOf(s)<0}));var h=a.categorical.categories[0];return l={categorySourceName:h.source.displayName,formatString:t.valueFormatter.getFormatString(h.source,i.chicletSlicerProps.formatString),slicerSettings:c,slicerDataPoints:n.dataPoints},l.hasSelectionOverride=n.hasSelectionOverride,l}},a.prototype.init=function(e){this.element=e.element,this.currentViewport=e.viewport,this.behavior&&(this.interactivityService=t.createInteractivityService(e.host)),this.hostServices=e.host,this.hostServices.canSelect=a.canSelect,this.settings=a.DefaultStyleProperties(),this.initContainer()},a.canSelect=function(e){var t=_.map(e.visualObjects,function(e){return c.convertSelectorsByColumnToSelector(e.selectorsByColumn)});return!(t&&t.length>1&&t.some(function(e){return e&&e.data&&e.data.length>1}))},a.prototype.update=function(t){if(t&&t.dataViews&&t.dataViews[0]&&t.viewport){var i=this.dataView;this.dataView=t.dataViews[0];var a=!0;i&&(a=!e.DataViewAnalysis.hasSameCategoryIdentity(i,this.dataView)),t.viewport.height===this.currentViewport.height&&t.viewport.width===this.currentViewport.width?this.waitingForData=!1:this.currentViewport=t.viewport,this.updateInternal(a)}},a.prototype.onResizing=function(e){this.currentViewport=e,this.updateInternal(!1)},a.prototype.enumerateObjectInstances=function(e){var t=this.slicerData;if(t){var i=e.objectName;switch(i){case"rows":return this.enumerateRows(t);case"header":return this.enumerateHeader(t);case"general":return this.enumerateGeneral(t);case"images":return this.enumerateImages(t)}}},a.prototype.enumerateHeader=function(e){var t=this.settings;return[{selector:null,objectName:"header",properties:{show:t.header.show,title:t.header.title,fontColor:t.header.fontColor,background:t.header.background,textSize:t.header.textSize,outline:t.header.outline,outlineColor:t.header.outlineColor,outlineWeight:t.header.outlineWeight}}]},a.prototype.enumerateRows=function(e){var t=this.settings;return[{selector:null,objectName:"rows",properties:{textSize:t.slicerText.textSize,height:t.slicerText.height,width:t.slicerText.width,background:t.slicerText.background,transparency:t.slicerText.transparency,selectedColor:t.slicerText.selectedColor,hoverColor:t.slicerText.hoverColor,unselectedColor:t.slicerText.unselectedColor,disabledColor:t.slicerText.disabledColor,outline:t.slicerText.outline,outlineColor:t.slicerText.outlineColor,outlineWeight:t.slicerText.outlineWeight,fontColor:t.slicerText.fontColor,borderStyle:t.slicerText.borderStyle}}]},a.prototype.enumerateGeneral=function(e){var t=this.settings;return[{selector:null,objectName:"general",properties:{orientation:t.general.orientation,columns:t.general.columns,rows:t.general.rows,showDisabled:t.general.showDisabled,multiselect:t.general.multiselect,selfFilterEnabled:t.general.selfFilterEnabled}}]},a.prototype.enumerateImages=function(e){var t=this.settings;return[{selector:null,objectName:"images",properties:{imageSplit:t.images.imageSplit,stretchImage:t.images.stretchImage,bottomImage:t.images.bottomImage}}]},a.prototype.updateInternal=function(t){var i=this;this.updateSlicerBodyDimensions();var r="Select All",s=a.converter(this.dataView,r,this.searchInput.val(),this.interactivityService);if(!s)return void this.tableView.empty();this.interactivityService&&this.interactivityService.applySelectionStateToData(s.slicerDataPoints),s.slicerSettings.header.outlineWeight=s.slicerSettings.header.outlineWeight<0?0:s.slicerSettings.header.outlineWeight,s.slicerSettings.slicerText.outlineWeight=s.slicerSettings.slicerText.outlineWeight<0?0:s.slicerSettings.slicerText.outlineWeight,s.slicerSettings.slicerText.height=s.slicerSettings.slicerText.height<0?0:s.slicerSettings.slicerText.height,s.slicerSettings.slicerText.width=s.slicerSettings.slicerText.width<0?0:s.slicerSettings.slicerText.width,s.slicerSettings.images.imageSplit=a.getValidImageSplit(s.slicerSettings.images.imageSplit),s.slicerSettings.general.columns=s.slicerSettings.general.columns<0?0:s.slicerSettings.general.columns,s.slicerSettings.general.rows=s.slicerSettings.general.rows<0?0:s.slicerSettings.general.rows,s.slicerSettings.general.getSavedSelection=function(){try{return JSON.parse(i.slicerData.slicerSettings.general.selection)||[]}catch(e){return[]}},s.slicerSettings.general.setSavedSelection=function(e,t){i.isSelectionSaved=!0,i.hostServices.persistProperties({merge:[{objectName:"general",selector:null,properties:{filter:e,selection:t&&JSON.stringify(t)||""}}]})},this.slicerData?this.isSelectionSaved?this.isSelectionLoaded=!0:this.isSelectionLoaded=this.slicerData.slicerSettings.general.selection===s.slicerSettings.general.selection:this.isSelectionLoaded=!1,this.slicerData=s,this.settings=this.slicerData.slicerSettings,this.settings.general.showDisabled===p.BOTTOM?s.slicerDataPoints.sort(function(e,t){return e.selectable===t.selectable?0:e.selectable&&!t.selectable?-1:1}):this.settings.general.showDisabled===p.HIDE&&(s.slicerDataPoints=s.slicerDataPoints.filter(function(e){return e.selectable}));var o=this.settings.slicerText.height;if(0===o){var n=a.cellTotalInnerPaddings+a.cellTotalInnerBorders,l=a.getChicletTextProperties(this.settings.slicerText.textSize);o=e.TextMeasurementService.estimateSvgTextHeight(l)+e.TextMeasurementService.estimateSvgTextBaselineDelta(l)+n;var c=_.any(s.slicerDataPoints,function(e){return""!==e.imageURL&&"undefined"!=typeof e.imageURL});c&&(o+=100)}this.tableView.rowHeight(o).columnWidth(this.settings.slicerText.width).orientation(this.settings.general.orientation).rows(this.settings.general.rows).columns(this.settings.general.columns).data(s.slicerDataPoints.filter(function(e){return!e.filtered}),function(e){return $.inArray(e,s.slicerDataPoints)},t).viewport(this.getSlicerBodyViewport(this.currentViewport)).render(),this.updateSearchHeader()},a.prototype.initContainer=function(){var i=this,s=this.settings,n=this.getSlicerBodyViewport(this.currentViewport),l=d3.select(this.element.get(0)).append("div").classed(a.Container["class"],!0);this.slicerHeader=l.append("div").classed(a.Header["class"],!0),this.slicerHeader.append("span").classed(a.Clear["class"],!0).attr("title","Clear"),this.slicerHeader.append("div").classed(a.HeaderText["class"],!0).style({"margin-left":o.toString(s.headerText.marginLeft),"margin-top":o.toString(s.headerText.marginTop),"border-style":this.getBorderStyle(s.header.outline),"border-color":s.header.outlineColor,"border-width":this.getBorderWidth(s.header.outline,s.header.outlineWeight),"font-size":o.fromPoint(s.header.textSize)}),this.createSearchHeader($(l.node())),this.slicerBody=l.append("div").classed(a.Body["class"],!0).classed("slicerBody-horizontal",s.general.orientation===d.HORIZONTAL).classed("slicerBody-vertical",s.general.orientation===d.VERTICAL).style({height:o.toString(n.height),width:"100%"});var c=function(e){var t=i.settings,r=e.append("ul").append("li").classed(a.ItemContainer["class"],!0).style({"margin-left":o.toString(t.slicerItemContainer.marginLeft)});r.append("img").classed("slicer-img-wrapper",!0),r.append("div").classed("slicer-text-wrapper",!0).append("span").classed(a.LabelText["class"],!0).style({"font-size":o.fromPoint(t.slicerText.textSize)})},u=function(r){var s=i.settings,n=i.slicerData;if(n&&s){i.slicerHeader.classed("hidden",!s.header.show),i.slicerHeader.select(a.HeaderText.selector).text(""!==s.header.title.trim()?s.header.title.trim():i.slicerData.categorySourceName).style({"border-style":i.getBorderStyle(s.header.outline),"border-color":s.header.outlineColor,"border-width":i.getBorderWidth(s.header.outline,s.header.outlineWeight),color:s.header.fontColor,"background-color":s.header.background,"font-size":o.fromPoint(s.header.textSize)}),i.slicerBody.classed("slicerBody-horizontal",s.general.orientation===d.HORIZONTAL).classed("slicerBody-vertical",s.general.orientation===d.VERTICAL);var l=r.selectAll(a.LabelText.selector),c=a.getChicletTextProperties(s.slicerText.textSize),u=n.formatString;l.text(function(r){var o=t.valueFormatter.format(r.category,u);return c.text=o,0===i.settings.slicerText.width?e.TextMeasurementService.getTailoredTextOrDefault(c,i.currentViewport.width/i.settings.general.columns-a.chicletTotalInnerRightLeftPaddings-a.cellTotalInnerBorders-s.slicerText.outlineWeight):e.TextMeasurementService.getTailoredTextOrDefault(c,i.settings.slicerText.width-a.chicletTotalInnerRightLeftPaddings-a.cellTotalInnerBorders-s.slicerText.outlineWeight)});var h=r.selectAll(".slicer-img-wrapper");if(h.style("max-height",s.images.imageSplit+"%").classed("hidden",function(e){return e.imageURL?s.images.imageSplit<10?!0:void 0:!0}).style("display",function(e){return e.imageURL?"flex":"none"}).classed("stretchImage",s.images.stretchImage).classed("bottomImage",s.images.bottomImage).attr("src",function(e){return e.imageURL?e.imageURL:""}),r.selectAll(".slicer-text-wrapper").style("height",function(e){return e.imageURL?100-s.images.imageSplit+"%":"100%"}).classed("hidden",function(e){return s.images.imageSplit>90?!0:void 0}),r.selectAll(".slicerItemContainer").style({color:s.slicerText.fontColor,"border-style":i.getBorderStyle(s.slicerText.outline),"border-color":s.slicerText.outlineColor,"border-width":i.getBorderWidth(s.slicerText.outline,s.slicerText.outlineWeight),"font-size":o.fromPoint(s.slicerText.textSize),"border-radius":i.getBorderRadius(s.slicerText.borderStyle)}),s.slicerText.background?i.slicerBody.style("background-color",v.util.hexToRGBString(s.slicerText.background,(100-s.slicerText.transparency)/100)):i.slicerBody.style("background-color",null),i.interactivityService&&i.slicerBody){i.interactivityService.applySelectionStateToData(n.slicerDataPoints);var p=i.slicerBody.attr("width",i.currentViewport.width),g=p.selectAll(a.ItemContainer.selector),m=p.selectAll(a.LabelText.selector),y=p.selectAll(a.Input.selector),f=i.slicerHeader.select(a.Clear.selector),x={dataPoints:n.slicerDataPoints,slicerItemContainers:g,slicerItemLabels:m,slicerItemInputs:y,slicerClear:f,interactivityService:i.interactivityService,slicerSettings:n.slicerSettings,isSelectionLoaded:i.isSelectionLoaded};i.interactivityService.bind(n.slicerDataPoints,i.behavior,x,{overrideSelectionFromData:!0,hasSelectionOverride:n.hasSelectionOverride}),i.behavior.styleSlicerInputs(r.select(a.ItemContainer.selector),i.interactivityService.hasSelection())}else i.behavior.styleSlicerInputs(r.select(a.ItemContainer.selector),!1)}},h=function(e){e.remove()},p={rowHeight:this.getRowHeight(),columnWidth:this.settings.slicerText.width,orientation:this.settings.general.orientation,rows:this.settings.general.rows,columns:this.settings.general.columns,enter:c,exit:h,update:u,loadMoreData:function(){return i.onLoadMoreData()},scrollEnabled:!0,viewport:this.getSlicerBodyViewport(this.currentViewport),baseContainer:this.slicerBody};this.tableView=r.createTableView(p)},a.prototype.createSearchHeader=function(e){var t=this;this.searchHeader=$("<div>").appendTo(e).addClass("searchHeader").addClass("collapsed"),$("<div>").appendTo(this.searchHeader).attr("title","Search").addClass("search");var i=0;this.searchInput=$("<input>").appendTo(this.searchHeader).attr("type","text").attr("drag-resize-disabled","true").addClass("searchInput").on("input",function(){return t.hostServices.persistProperties({merge:[{objectName:"general",selector:null,properties:{counter:i++}}]})})},a.prototype.updateSearchHeader=function(){this.searchHeader.toggleClass("show",this.slicerData.slicerSettings.general.selfFilterEnabled),this.searchHeader.toggleClass("collapsed",!this.slicerData.slicerSettings.general.selfFilterEnabled)},a.prototype.onLoadMoreData=function(){!this.waitingForData&&this.dataView.metadata&&this.dataView.metadata.segment&&(this.hostServices.loadMoreData(),this.waitingForData=!0)},a.prototype.getSlicerBodyViewport=function(e){var t=this.settings,i=t.header.show?this.getHeaderHeight():0,a=e.height-(i+t.header.borderBottomWidth);return{height:a,width:e.width}},a.prototype.updateSlicerBodyDimensions=function(){var e=this.getSlicerBodyViewport(this.currentViewport);this.slicerBody.style({height:o.toString(e.height),width:"100%"})},a.getChicletTextProperties=function(e){return{fontFamily:a.DefaultFontFamily,fontSize:o.fromPoint(e||a.DefaultFontSizeInPt)}},a.prototype.getHeaderHeight=function(){return e.TextMeasurementService.estimateSvgTextHeight(a.getChicletTextProperties(this.settings.header.textSize))},a.prototype.getRowHeight=function(){var t=this.settings.slicerText;return 0!==t.height?t.height:e.TextMeasurementService.estimateSvgTextHeight(a.getChicletTextProperties(t.textSize))},a.prototype.getBorderStyle=function(e){return"0px"===e?"none":"solid"},a.prototype.getBorderWidth=function(e,t){switch(e){case"None":return"0px";case"BottomOnly":return"0px 0px "+t+"px 0px";case"TopOnly":return t+"px 0px 0px 0px";case"TopBottom":return t+"px 0px "+t+"px 0px";case"LeftRight":return"0px "+t+"px 0px "+t+"px";case"Frame":return t+"px";default:return e.replace("1",t.toString())}},a.prototype.getBorderRadius=function(e){switch(e){case h.ROUNDED:return"10px";case h.SQUARE:return"0px";default:return"5px"}},a.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"},{name:"Image",kind:e.VisualDataRoleKind.Grouping,displayName:"Image"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{selection:{displayName:"Selection",type:{text:!0}},orientation:{displayName:"Orientation",type:{enumeration:d.type}},columns:{displayName:"Columns",type:{numeric:!0}},rows:{displayName:"Rows",type:{numeric:!0}},showDisabled:{displayName:"Show Disabled",type:{enumeration:p.type}},multiselect:{displayName:"Multiple selection",type:{bool:!0}},selected:{type:{bool:!0}},filter:{type:{filter:{}}},selfFilter:{type:{filter:{selfFilter:!0}}},selfFilterEnabled:{type:{operations:{searchEnabled:!0}}},formatString:{type:{formatting:{formatString:!0}}}}},header:{displayName:e.data.createDisplayNameGetter("Visual_Header"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},title:{displayName:"Title",type:{text:!0}},fontColor:{displayName:e.data.createDisplayNameGetter("Visual_FontColor"),type:{fill:{solid:{color:!0}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Background"),type:{fill:{solid:{color:!0}}}},outline:{displayName:e.data.createDisplayNameGetter("Visual_Outline"),type:{formatting:{outline:!0}}},textSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{numeric:!0}},outlineColor:{displayName:"Outline Color",type:{fill:{solid:{color:!0}}}},outlineWeight:{displayName:"Outline Weight",type:{numeric:!0}}}},rows:{displayName:"Chiclets",properties:{fontColor:{displayName:"Text color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{numeric:!0}},height:{displayName:"Height",type:{numeric:!0}},width:{displayName:"Width",type:{numeric:!0}},selectedColor:{displayName:"Selected Color",type:{fill:{solid:{color:!0}}}},hoverColor:{displayName:"Hover Color",type:{fill:{solid:{color:!0}}}},unselectedColor:{displayName:"Unselected Color",type:{fill:{solid:{color:!0}}}},disabledColor:{displayName:"Disabled Color",type:{fill:{solid:{color:!0}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Background"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:"Transparency",description:"Set transparency for background color",type:{numeric:!0}},outline:{displayName:e.data.createDisplayNameGetter("Visual_Outline"),type:{formatting:{outline:!0}}},outlineColor:{displayName:"Outline Color",type:{fill:{solid:{color:!0}}}},outlineWeight:{displayName:"Outline Weight",type:{numeric:!0}},borderStyle:{displayName:"Outline Style",type:{enumeration:h.type}}}},images:{displayName:"Images",properties:{imageSplit:{displayName:"Image Split",type:{numeric:!0}},stretchImage:{displayName:"Stretch image",type:{bool:!0}},bottomImage:{displayName:"Bottom image",type:{bool:!0}}}}},dataViewMappings:[{conditions:[{Category:{max:1},Image:{min:0,max:1},Values:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{count:1e4}}},values:{group:{by:"Image",select:[{bind:{to:"Values"}}],dataReductionAlgorithm:{top:{count:1e4}}}},includeEmptyGroups:!0}}],supportsHighlight:!0,sorting:{"default":{}},suppressDefaultTitle:!0},a.DefaultFontFamily="Segoe UI, Tahoma, Verdana, Geneva, sans-serif",a.DefaultFontSizeInPt=11,a.cellTotalInnerPaddings=8,a.cellTotalInnerBorders=2,a.chicletTotalInnerRightLeftPaddings=14,a.MinImageSplit=0,a.MaxImageSplit=100,a.ItemContainer=s("slicerItemContainer"),a.HeaderText=s("headerText"),a.Container=s("chicletSlicer"),a.LabelText=s("slicerText"),a.Header=s("slicerHeader"),a.Input=s("slicerCheckbox"),a.Clear=s("clear"),a.Body=s("slicerBody"),a}();i.ChicletSlicer=g;var m;!function(e){var a=function(){function e(e,a){var r=e.categorical;this.dataViewCategorical=r,this.dataViewMetadata=e.metadata,r.categories&&r.categories.length>0&&(this.category=r.categories[0],this.categoryIdentities=this.category.identity,this.categoryValues=this.category.values,this.categoryColumnRef=this.category.identityFields,this.categoryFormatString=t.valueFormatter.getFormatString(this.category.source,i.chicletSlicerProps.formatString)),this.dataPoints=[],this.interactivityService=a,this.hasSelectionOverride=!1}return e.prototype.convert=function(){if(this.dataPoints=[],this.numberOfCategoriesSelectedInData=0,this.categoryValues){var e,a=this.dataViewMetadata?this.dataViewMetadata.objects:void 0,r=void 0;if(a&&a.general&&a.general.filter){if(!this.categoryColumnRef)return;var s=a.general.filter,o=n.asScopeIdsContainer(s,this.categoryColumnRef);o?(r=o.isNot,e=o.scopeIds?o.scopeIds.length:0):r=!1}this.interactivityService&&(void 0===r?r=this.interactivityService.isSelectionModeInverted():this.interactivityService.setSelectionModeInverted(r));for(var c=void 0,u=0;u<this.categoryValues.length;u++){var h=t.isCategoryColumnSelected(i.chicletSlicerProps.selectedPropertyIdentifier,this.category,u);if(null!=h){c=h;break}}for(var p=this.dataViewCategorical,d=i.chicletSlicerProps.formatString,g=-(1/0),m="",y=0,f=this.categoryValues.length;f>y;y++){var v=t.isCategoryColumnSelected(i.chicletSlicerProps.selectedPropertyIdentifier,this.category,y),x=!0;null!=c&&(r?(null==this.category.objects&&(v=void 0),null!=v?v=c:null==v&&(v=!c)):null==v&&(v=!c)),v&&this.numberOfCategoriesSelectedInData++;var b=this.categoryValues[y],S=t.valueFormatter.format(b,this.categoryFormatString);if(this.dataViewCategorical.values)for(var w=0;w<this.dataViewCategorical.values.length;w++){var C=p.values[w];null!=C.values[y]&&(g=C.values[y],C.highlights&&(x=!(null===C.highlights[y])),C.source.groupName&&""!==C.source.groupName&&(m=t.converterHelper.getFormattedLegendLabel(C.source,p.values,d),/^(ftp|http|https):\/\/[^ "]+$/.test(m)||(m=void 0)))}var P=l.builder().withCategory(this.category,y).createSelectionId();this.dataPoints.push({identity:P,category:S,imageURL:m,value:g,selected:v,selectable:x})}null!=e&&e>this.numberOfCategoriesSelectedInData&&(this.hasSelectionOverride=!0)}},e}();e.ChicletSlicerConverter=a}(m||(m={}));var y;!function(e){function t(e){var t=r(e);return t.y+t.height}function i(){s||(s=$("<span/>"),$("body").append(s),o=d3.select($("body").get(0)).append("svg").style({height:"0px",width:"0px",position:"absolute"}).append("text"),n=$("<canvas/>").get(0).getContext("2d"))}function a(e){return i(),o.style(null),o.text(e.text).attr({visibility:"hidden","font-family":e.fontFamily,"font-size":e.fontSize,"font-weight":e.fontWeight,"font-style":e.fontStyle,"white-space":e.whiteSpace||"nowrap"}),o.node().getBBox()}function r(e){var t={fontFamily:e.fontFamily,fontSize:e.fontSize,text:"M"},i=a(t);return i}var s,o,n;e.estimateSvgTextBaselineDelta=t}(y=i.ChicletSlicerTextMeasurementHelper||(i.ChicletSlicerTextMeasurementHelper={}));var f=function(){function t(){}return t.prototype.bindEvents=function(e,t){var i=this,a=this.slicers=e.slicerItemContainers;this.slicerItemLabels=e.slicerItemLabels,this.slicerItemInputs=e.slicerItemInputs;var r=e.slicerClear;this.dataPoints=e.dataPoints,this.interactivityService=e.interactivityService,this.slicerSettings=e.slicerSettings,this.options=e,this.options.isSelectionLoaded||this.loadSelection(t),a.on("mouseover",function(e){e.selectable&&(e.mouseOver=!0,e.mouseOut=!1,i.renderMouseover())}),a.on("mouseout",function(e){e.selectable&&(e.mouseOver=!1,e.mouseOut=!0,i.renderMouseover())}),a.on("click",function(e,a){if(e.selectable){var r=i.slicerSettings;if(d3.event.preventDefault(),d3.event.altKey&&r.general.multiselect){var s=jQuery.map(i.dataPoints,function(e,t){return e.selected?t:void 0}),o=s.length>0?s[s.length-1]:0;if(o>a){var n=a;a=o,o=n}t.handleClearSelection();for(var l=o;a>=l;l++)t.handleSelection(i.dataPoints[l],!0)}else d3.event.ctrlKey&&r.general.multiselect?t.handleSelection(e,!0):t.handleSelection(e,!1);i.saveSelection(t)}}),r.on("click",function(e){t.handleClearSelection(),i.saveSelection(t)})},t.prototype.loadSelection=function(e){e.handleClearSelection();var t=this.slicerSettings.general.getSavedSelection();if(t.length){var a=this.dataPoints.filter(function(e){return t.some(function(t){return e.identity.getKey()===t})});a.forEach(function(t){return e.handleSelection(t,!0)}),e.persistSelectionFilter(i.chicletSlicerProps.filterPropertyIdentifier)}},t.getFilterFromSelectors=function(t,i){var a=[],r=t.selectedIds;r.length>0&&(a=_.chain(r).filter(function(e){return e.hasIdentity()}).map(function(e){return e.getSelector()}).value());var s=e.data.Selector.filterFromSelector(a,i);return s},t.prototype.saveSelection=function(e){var i=t.getFilterFromSelectors(e,this.interactivityService.isSelectionModeInverted()),a=e.selectedIds.map(function(e){return e.getKey()});this.slicerSettings.general.setSavedSelection(i,a)},t.prototype.renderSelection=function(e){e||this.interactivityService.isSelectionModeInverted()?this.styleSlicerInputs(this.slicers,e):this.slicers.style("background",this.slicerSettings.slicerText.unselectedColor)},t.prototype.renderMouseover=function(){var e=this;this.slicerItemLabels.style({color:function(t){return t.mouseOver?e.slicerSettings.slicerText.hoverColor:t.mouseOut?t.selected?e.slicerSettings.slicerText.fontColor:e.slicerSettings.slicerText.fontColor:void 0}})},t.prototype.styleSlicerInputs=function(e,t){var i=this.slicerSettings,a=[];e.each(function(e){e.selectable&&e.selected&&a.push(e),d3.select(this).style({background:e.selectable?e.selected?i.slicerText.selectedColor:i.slicerText.unselectedColor:i.slicerText.disabledColor
}),d3.select(this).classed("slicerItem-disabled",!e.selectable)})},t}();i.ChicletSlicerWebBehavior=f;var v;!function(e){var t;!function(e){function t(e,t){var i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(i,function(e,t,i,a){return t+t+i+i+a+a});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),r=a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null;return null===r?"":t||0===t?"rgba("+r.r+","+r.g+","+r.b+","+t+")":"rgb("+r.r+","+r.g+","+r.b+")"}e.hexToRGBString=t}(t=e.util||(e.util={}))}(v||(v={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.PixelConverter,r=e.createEnumType,s=e.DataViewObjects,o=e.visuals.ObjectEnumerationBuilder,n=e.visuals.dataLabelUtils,l=e.visuals.converterHelper,c=e.VisualDataRoleKind,u=e.data.createDisplayNameGetter,h=e.visuals.utility.SelectionManager,p=e.visuals.ColorHelper,d=e.visuals.valueFormatter,g=e.visuals.SelectionId,m=e.visuals.SelectionIdBuilder,y=e.visuals.TooltipBuilder,f=e.visuals.AnimatorCommon,v=e.DataLabelManager,x=e.visuals.shapes,b=e.visuals.SVGUtil,S=e.visuals.TooltipManager,w=e.Double.lessWithPrecision,C=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.margin=this.defaultMargin)},set:function(t){this.marginValue=e.restrictToMinMax(t),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){this.viewportValue=e.restrictToMinMax(t,this.minViewport),this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue},set:function(e){this.minViewportValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.restrictToMinMax=function(e,t){var i=$.extend({},e);return _.keys(e).forEach(function(a){return i[a]=Math.max(t&&t[a]||0,e[a])}),i},e}(),P=function(){function e(){}return e.interpolateArc=function(e){return function(t){if(!this.oldData)return this.oldData=t,function(){return e(t)};var i=d3.interpolate(this.oldData,t);return this.oldData=i(0),function(t){return e(i(t))}}},e.addContext=function(e,t){return function(){return t.apply(e,[this].concat(_.toArray(arguments)))}},e}(),A=function(){function e(){this.dataPoint={defaultColor:null,showAllDataPoints:!1},this.axis={show:!0},this.labels={show:!0,color:n.defaultLabelColor,fontSize:n.DefaultFontSizeInPt}}return Object.defineProperty(e,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),e.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},e.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},e.createEnumTypeFromEnum=function(e){var t=!1;return r(Object.keys(e).filter(function(i,a){return!!(a%2)===t&&e[i]===i&&!void(t=!t)||!!(a%2)!==t}).map(function(e){return{value:e,displayName:e}}))},e.getValueFnByType=function(e){switch(_.keys(e)[0]){case"fill":return s.getFillColor;default:return s.getValue}},e.enumerateObjectInstances=function(e,t,i){var a=new o,r=e&&e[t.objectName];if(!r)return a;var s={objectName:t.objectName,selector:null,properties:{}};for(var n in r)_.has(r,n)&&(s.properties[n]=r[n]);return a.pushInstance(s),a},e}();t.ChordChartSettings=A;var D=function(){function e(){this.Category=null,this.Series=null,this.Y=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return l.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();t.ChordChartColumns=D;var T=function(){function e(){}return Object.defineProperty(e.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerRadius",{get:function(){return this.radius*e.InnerArcRadiusRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outerRadius",{get:function(){return this.radius*e.OuterArcRadiusRatio},enumerable:!0,configurable:!0}),e.converter=function(t,a,r){var s=A.getProperties(e.capabilities),o=e.parseSettings(t),n=D.getCategoricalColumns(t),c=D.getColumnSources(t),u=D.getCategoricalValues(t);if(!u||_.isEmpty(u.Category)||_.isEmpty(u.Y))return null;u.Series=u.Series||D.getSeriesValues(t);var h=[],f={dataPoints:[],title:c.Y.displayName||""},v=[],x=[],b=1e3,S=_.mapValues(_.invert(u.Series),parseFloat),w=_.mapValues(_.invert(u.Category),parseFloat),C=!1,P=[],T=new p(a,s.dataPoint.fill,o.dataPoint.defaultColor),V=this.union_arrays(u.Category,u.Series).reverse();e.getValidArrayLength(V)===e.getValidArrayLength(u.Category)+e.getValidArrayLength(u.Series)&&(C=!0);for(var N=d.create({format:d.getFormatString(c.Category,s.general.formatString,!0)||c.Category.format}),L=d.create({format:d.getFormatString(c.Y,s.general.formatString,!0)||c.Y.format}),M=0,k=V.length;k>M;M++){var I=null,O="",F=!1;if(void 0!==w[V[M]]){var z=w[V[M]];I=m.builder().withCategory(n.Category,w[V[M]]).createSelectionId(),F=!0;var j=n.Category.objects?n.Category.objects[z]:void 0;O=T.getColorForSeriesValue(j,void 0,u.Category[z])}else if(void 0!==S[V[M]]){var z=S[V[M]],G=n.Y[z],R=G&&G.objects&&G.objects[0],B=l.getSeriesName(G.source);I=g.createWithId(G.identity),F=!1,O=T.getColorForSeriesValue(R,void 0,B)}P.push({label:V[M],labelColor:o.labels.color,barColor:O,isCategory:F,identity:I,selected:!1,labelFontSize:i.fromPointToPixel(o.labels.fontSize)}),h.push([]),v.push([]);for(var H=0,E=V.length;E>H;H++){var W=0,U=[];if(void 0!==w[V[M]]&&void 0!==S[V[H]]){var Y=w[V[M]],X=S[V[H]];null!==n.Y[X].values[Y]&&(W=n.Y[X].values[Y],W>b&&(b=W),U=y.createTooltipInfo(s.general.formatString,t.categorical,N.format(u.Category[M]),L.format(W),null,null,X,Y))}else if(C&&void 0!==w[V[H]]&&void 0!==S[V[M]]){var Y=w[V[H]],X=S[V[M]];null!==n.Y[X].values[Y]&&(W=n.Y[X].values[Y])}h[M].push(W||0),v[M].push({tooltipInfo:U})}var q=d3.sum(h[M]);x.push({tooltipInfo:[{displayName:V[M],value:L.format(q)}]})}var K=d3.layout.chord().padding(.1).matrix(h),Z=Math.round(b/5).toString().length-1;return{dataMatrix:h,dataView:t,settings:o,labelDataPoints:e.getChordArcDescriptors(K.groups(),P),legendData:f,tooltipData:v,sliceTooltipData:x,tickUnit:Math.pow(10,Z),differentFromTo:C,prevAxisVisible:void 0===r?o.axis.show:r}},e.parseSettings=function(t){return A.parse(t,e.capabilities)},e.getValidArrayLength=function(e){for(var t=0,i=0,a=e.length;a>i;i++)void 0!==e[i]&&t++;return t},e.getChordArcDescriptors=function(e,t){var i=e;return i.forEach(function(e,i){return e.data=t[i]}),i},e.prototype.init=function(t){var i=this.element=t.element;this.selectionManager=new h({hostServices:t.host}),this.layout=new C(t.viewport,e.DefaultMargin),this.layout.minViewport={width:150,height:150},this.svg=d3.select(i.get(0)).append("svg").style("position","absolute").classed(e.VisualClassName,!0),this.mainGraphicsContext=this.svg.append("g"),this.mainGraphicsContext.append("g").classed("chords",!0),this.slices=this.mainGraphicsContext.append("g").classed("slices",!0),this.mainGraphicsContext.append("g").classed("ticks",!0),this.labels=this.mainGraphicsContext.append("g").classed(e.labelGraphicsContextClass["class"],!0),this.lines=this.mainGraphicsContext.append("g").classed(e.linesGraphicsContextClass["class"],!0),this.colors=t.style.colorPalette.dataColors},e.prototype.update=function(t){if(t.dataViews&&t.dataViews[0]){if(this.layout.viewport=t.viewport,this.duration=t.suppressAnimations?0:f.MinervaAnimationDuration,this.data=e.converter(t.dataViews[0],this.colors,this.settings&&this.settings.axis.show),!this.data)return void this.clear();this.layout.resetMargin(),this.layout.margin.top=this.layout.margin.bottom=i.fromPointToPixel(this.settings.labels.fontSize)/2,this.render()}},e.prototype.enumerateObjectInstances=function(t){var i=A.enumerateObjectInstances(this.settings,t,e.capabilities);if(this.settings&&"dataPoint"===t.objectName&&!_.isEmpty(this.data.labelDataPoints)&&this.settings.dataPoint.showAllDataPoints)for(var a=0,r=this.data.labelDataPoints.length;r>a;a++){var s=this.data.labelDataPoints[a].data;if(s.isCategory){var o={objectName:"dataPoint",displayName:s.label,selector:p.normalizeSelector(s.identity.getSelector()),properties:{fill:{solid:{color:s.barColor}}}};i.pushInstance(o)}}return i.complete()},e.prototype.calculateRadius=function(){if(this.settings.labels.show){var e=this.layout.viewportIn.height/this.layout.viewportIn.width,t=2+1/(1+Math.exp(-5*(e-1)));return Math.min(this.layout.viewportIn.height,this.layout.viewportIn.width)/t}return Math.min(this.layout.viewportIn.height,this.layout.viewportIn.width)/2},e.prototype.drawCategoryLabels=function(){var e=d3.svg.arc().innerRadius(0).outerRadius(this.innerRadius),t=d3.svg.arc().innerRadius(this.outerRadius).outerRadius(this.outerRadius);if(this.settings.labels.show){var i=this.getChordChartLabelLayout(t),a=this.getDataLabelManager().hideCollidedLabels(this.layout.viewportIn,this.data.labelDataPoints,i,!0);this.renderLabels(a,i,!0),this.renderLines(a,e,t)}else n.cleanDataLabels(this.labels),n.cleanDataLabels(this.lines,!0)},e.prototype.getDataLabelManager=function(){function e(e,t,i,a){if(e.hasConflict(i))return!0;var r={left:0,top:i.height/2,width:a.width,height:a.height};return r=x.Rect.inflate(r,{left:v.InflateAmount,top:0,right:v.InflateAmount,bottom:0}),r=x.Rect.intersect(r,i),x.Rect.isEmpty(r)?!0:w(r.height,i.height/2)}var t=new v;return t.hasCollisions=e.bind(t),t},e.prototype.render=function(){var t=this;this.chordLayout=d3.layout.chord().padding(.1).matrix(this.data.dataMatrix),this.radius=this.calculateRadius();var i=d3.svg.arc().innerRadius(this.radius).outerRadius(this.innerRadius);this.svg.attr({width:this.layout.viewport.width,height:this.layout.viewport.height}),this.mainGraphicsContext.attr("transform",b.translate(this.layout.viewport.width/2,this.layout.viewport.height/2));var a=this.slices.selectAll("path"+e.sliceClass.selector).data(this.getChordTicksArcDescriptors());a.enter().insert("path").classed(e.sliceClass["class"],!0),a.style("fill",function(e,i){return t.data.labelDataPoints[i].data.barColor}).style("stroke",function(e,i){return t.data.labelDataPoints[i].data.barColor}).on("click",P.addContext(this,function(e,i,r){t.selectionManager.select(t.data.labelDataPoints[r].data.identity).then(function(i){i.length>0?(t.mainGraphicsContext.selectAll(".chords path.chord").style("opacity",1),t.slices.selectAll("path.slice").style("opacity",.3),t.mainGraphicsContext.selectAll(".chords path.chord").filter(function(e){return e.source.index!==r&&e.target.index!==r}).style("opacity",.3),d3.select(e).style("opacity",1)):(a.style("opacity",1),t.mainGraphicsContext.selectAll(".chords path.chord").filter(function(e){return e.source.index!==r&&e.target.index!==r}).style("opacity",1))}),d3.event.stopPropagation()})).transition().duration(this.duration).attrTween("d",P.interpolateArc(i)),a.exit().remove(),S.addTooltip(a,function(e){return t.data.sliceTooltipData[e.data.index].tooltipInfo});var r=this.svg.select(".chords").selectAll("path"+e.chordClass.selector).data(this.chordLayout.chords);r.enter().insert("path").classed(e.chordClass["class"],!0),r.style("fill",function(e,i){return t.data.labelDataPoints[e.target.index].data.barColor}).style("opacity",1).transition().duration(this.duration).attr("d",d3.svg.chord().radius(this.radius)),r.exit().remove(),this.svg.on("click",function(){return t.selectionManager.clear().then(function(){a.style("opacity",1),r.style("opacity",1)})}),this.drawTicks(),this.drawCategoryLabels(),S.addTooltip(r,function(e){var i=[];return t.data.differentFromTo?i=t.data.tooltipData[e.data.source.index][e.data.source.subindex].tooltipInfo:(i.push({displayName:t.data.labelDataPoints[e.data.source.index].data.label+"->"+t.data.labelDataPoints[e.data.source.subindex].data.label,value:t.data.dataMatrix[e.data.source.index][e.data.source.subindex].toString()}),i.push({displayName:t.data.labelDataPoints[e.data.target.index].data.label+"->"+t.data.labelDataPoints[e.data.target.subindex].data.label,value:t.data.dataMatrix[e.data.target.index][e.data.target.subindex].toString()})),i})},e.prototype.clear=function(){this.mainGraphicsContext.selectAll(e.sliceClass.selector).remove(),this.mainGraphicsContext.selectAll(e.sliceTicksClass.selector).remove(),this.mainGraphicsContext.selectAll(e.chordClass.selector).remove(),this.mainGraphicsContext.selectAll(e.labelsClass.selector).remove(),this.mainGraphicsContext.selectAll(e.lineClass.selector).remove()},e.prototype.clearTicks=function(){var t=[],i=this.mainGraphicsContext.selectAll(e.tickLineClass.selector).data(t);i.exit().remove();var a=this.mainGraphicsContext.selectAll(e.tickTextClass.selector).data(t);a.exit().remove(),this.mainGraphicsContext.selectAll(e.tickPairClass.selector).remove(),this.mainGraphicsContext.selectAll(e.sliceTicksClass.selector).remove()},e.prototype.getChordTicksArcDescriptors=function(){var t=this.chordLayout.groups(),i=!_.isEmpty(t)&&_.max(t,function(e){return e.value}).value||0,a=!_.isEmpty(t)&&_.min(t,function(e){return e.value}).value||0,r=this.radius/Math.abs(i-a)*1.25,s=d.create({format:"0.##",value:i});return t.forEach(function(t){var i=(t.endAngle-t.startAngle)/t.value,a=Math.abs(t.value),o=d3.range(0,a,.15>a-1?.15:a-1);t.value<0&&(o=o.map(function(e){return-1*e}).reverse());for(var n=1;n<o.length;n++){var l=Math.abs(o[n]-o[n-1])*r;l<e.TicksFontSize&&(o.length>2&&n===o.length-1?o.splice(--n,1):o.splice(n--,1))}t.angleLabels=o.map(function(e,a){return{angle:e*i+t.startAngle,label:s.format(e)}})}),t},e.prototype.drawTicks=function(){var t=this;if(this.settings.axis.show){var i=this.mainGraphicsContext.select(".ticks").selectAll("g"+e.sliceTicksClass.selector).data(this.chordLayout.groups),a=this.data.prevAxisVisible===this.settings.axis.show?this.duration:0;i.enter().insert("g").classed(e.sliceTicksClass["class"],!0);var r=i.selectAll("g"+e.tickPairClass.selector).data(function(e){return e.angleLabels});r.enter().insert("g").classed(e.tickPairClass["class"],!0),r.transition().duration(a).attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+t.innerRadius+",0)"}),r.selectAll("line"+e.tickLineClass.selector).data(function(e){return[e]}).enter().insert("line").classed(e.tickLineClass["class"],!0).style("stroke","#000").attr("x1",1).attr("y1",0).attr("x2",5).attr("y2",0),r.selectAll("text"+e.tickTextClass.selector).data(function(e){return[e]}).enter().insert("text").classed(e.tickTextClass["class"],!0).style("pointer-events","none").attr("x",8).attr("dy",".35em"),r.selectAll("text"+e.tickTextClass.selector).text(function(e){return e.label}).style("text-anchor",function(e){return e.angle>Math.PI?"end":null}).attr("transform",function(e){return e.angle>Math.PI?"rotate(180)translate(-16)":null}),r.exit().remove(),i.exit().remove()}else this.clearTicks()},e.prototype.renderLabels=function(t,i,a,r){if(void 0===a&&(a=!1),void 0===r&&(r=!1),0===t.length)return n.cleanDataLabels(this.labels,!0),null;var s=null!==t[0].key,o=null!==t[0].identity,l=s?function(e){return e.key}:o?function(e){return e.identity.getKey()}:void 0,c=a?this.labels.selectAll(e.labelsClass.selector).data(t,function(e){return e.data.identity.getKey()}):null!==l?this.labels.selectAll(e.labelsClass.selector).data(t,l):this.labels.selectAll(e.labelsClass.selector).data(t),u=c.enter().append("text").classed(e.labelsClass["class"],!0);r&&u.style("opacity",0),c.attr({x:function(e){return e.labelX},y:function(e){return e.labelY},dy:".35em"}).text(function(e){return e.labeltext}).style(i.style),c.exit().remove()},e.prototype.renderLines=function(t,i,a){var r=this,s=this.lines.selectAll("polyline").data(t,function(e){return e.data.identity.getKey()}),o=2.05,n=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2};s.enter().append("polyline").classed(e.lineClass["class"],!0),s.attr("points",function(t){var s=a.centroid(t);s[0]=(r.radius+e.LabelMargin/2)*(n(t)<Math.PI?1:-1);var l=a.centroid(t),c=i.centroid(t);return c[0]*=o,c[1]*=o,[c,l,s]}).style({opacity:function(t){return e.PolylineOpacity},stroke:function(e){return e.data.labelColor},"pointer-events":"none"}),s.exit().remove()},e.prototype.getChordChartLabelLayout=function(t){var a=this,r=function(e){return e.startAngle+(e.endAngle-e.startAngle)/2},s=(this.layout.viewportIn.width-2*this.radius-2*e.LabelMargin)/1.6;return{labelText:function(e){return n.getLabelFormattedText({label:e.data.label,maxWidth:s,fontSize:i.fromPointToPixel(a.settings.labels.fontSize)})},labelLayout:{x:function(t){return(a.radius+e.LabelMargin)*(r(t)<Math.PI?1:-1)},y:function(e){var i=t.centroid(e);return i[1]}},filter:function(e){return null!==e&&null!==e.data&&null!==e.data.label},style:{fill:function(e){return e.data.labelColor},"text-anchor":function(e){return r(e)<Math.PI?"start":"end"},"font-size":function(e){return i.fromPoint(a.settings.labels.fontSize)}}}},e.union_arrays=function(e,t){for(var i={},a=0;a<e.length;a++)i[e[a]]=e[a];for(var a=0;a<t.length;a++)i[t[a]]=t[a];var r=[];for(var s in i)i.hasOwnProperty(s)&&r.push(i[s]);return r},e.capabilities={dataRoles:[{name:D.Roles.Category,kind:c.Grouping,displayName:"From"},{name:D.Roles.Series,kind:c.Grouping,displayName:"To"},{name:D.Roles.Y,kind:c.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:0}},{Category:{max:1},Series:{min:1,max:1},Y:{max:1}},{Category:{max:1},Series:{max:0},Y:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{bind:{to:"Y"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2},supported:{min:1}}}}],objects:{dataPoint:{displayName:u("Visual_DataPoint"),properties:{defaultColor:{displayName:u("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:u("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:u("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},axis:{displayName:"Axis",properties:{show:{type:{bool:!0}}}},labels:{displayName:"Labels",properties:{show:{type:{bool:!0}},color:{displayName:u("Visual_Reference_Line_Data_Label_Color"),description:u("Visual_Reference_Line_Data_Label_Color_Description"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:u("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}}}},e.PolylineOpacity=.5,e.OuterArcRadiusRatio=.9,e.InnerArcRadiusRatio=.8,e.LabelMargin=10,e.DefaultMargin={left:10,right:10,top:10,bottom:10},e.VisualClassName="chordChart",e.TicksFontSize=12,e.sliceClass={"class":"slice",selector:".slice"},e.chordClass={"class":"chord",selector:".chord"},e.sliceTicksClass={"class":"slice-ticks",selector:".slice-ticks"},e.tickPairClass={"class":"tick-pair",selector:".tick-pair"},e.tickLineClass={"class":"tick-line",selector:".tick-line"},e.tickTextClass={"class":"tick-text",selector:".tick-text"},e.labelGraphicsContextClass={"class":"labels",selector:".labels"},e.labelsClass={"class":"data-labels",selector:".data-labels"},e.linesGraphicsContextClass={"class":"lines",selector:".lines"},e.lineClass={"class":"line-label",selector:".line-label"},e}();t.ChordChart=T}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.PixelConverter,r=a.CssConstants.createClassAndSelector,s=e.data.DataRoleHelper.getCategoryIndexOfRole,o=e.data.DataRoleHelper.getMeasureIndexOfRole,n=e.visuals.InteractivityUtils.registerStandardInteractivityHandlers,l=e.data.createDisplayNameGetter,c=a.Lazy,u=e.TextMeasurementService.measureSvgTextWidth,h=e.TextMeasurementService.measureSvgTextHeight,p=e.TextMeasurementService.estimateSvgTextHeight,d=e.TextMeasurementService.svgEllipsis,g=e.visuals.TooltipManager.addTooltip,m=a.PixelConverter.fromPoint,y=e.visuals.dataLabelUtils.LabelTextProperties,f=e.visuals.dataLabelUtils.getLabelFormattedText,v=e.Double.equalWithPrecision,x=e.visuals.AnimatorCommon.GetAnimationDuration,b=e.TextMeasurementService.getTailoredTextOrDefault,S=e.visuals.LegendData,w=e.visuals.SelectionId,C=e.DataViewObject,P=e.VisualDataRoleKind,A=e.visuals.legendPosition,D=e.visuals.BaseAnimator,T=e.visuals.yAxisPosition,V=e.visuals.appendClearCatcher,N=e.visuals.createInteractivityService,L=e.visuals.createLegend,M=e.visuals.AxisHelper,k=e.DataViewObjects,I=e.visuals.valueFormatter,O=e.visuals.dataLabelUtils,F=e.visuals.ColorHelper,z=e.visuals.LegendIcon,j=e.visuals.SelectionIdBuilder,G=e.visuals.TooltipBuilder,R=e.visuals.getInvalidValueWarnings,B=e.visuals.legendProps,H=e.visuals.LegendPosition,E=e.visuals.Legend,W=e.visuals.SVGUtil,U=e.visuals.ObjectEnumerationBuilder,Y=e.visuals.GradientUtils,X=e.visuals.axisType,q=e.visuals.axisScale,K=e.visuals.axisStyle,Z=function(){function e(){this.ScrollBarWidth=10}return Object.defineProperty(e.prototype,"margin",{get:function(){return this._margin||{left:0,right:0,top:0,bottom:0}},set:function(t){this._margin=$.extend({},t),this._viewportIn=e.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport||{width:0,height:0}},set:function(t){this._viewport=$.extend({},t),this._viewportIn=e.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this._viewportIn||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"legendViewport",{get:function(){return this.legend.getMargins()},enumerable:!0,configurable:!0}),e.getPropertiesByCapabilities=function(e){var t={};if(!e)return t;for(var i in e.objects){var a=e.objects[i];if(t[i]={},a)for(var r in a.properties)t[i][r]={objectName:i,propertyName:r}}return t},e.substractMargin=function(e,t){return{width:Math.max(e.width-(t.left+t.right),0),height:Math.max(e.height-(t.top+t.bottom),0)}},e.getCustomSymbolType=function(e){var t=d3.map({circle:function(e){var t=Math.sqrt(e/Math.PI);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"},cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Math.tan(Math.PI/6))),i=t*Math.tan(Math.PI/6);return"M0,"+-t+"L"+i+",0 0,"+t+" "+-i+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/Math.sqrt(3)),i=t*Math.sqrt(3)/2;return"M0,"+-i+"L"+t+","+i+" "+-t+","+i+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/Math.sqrt(3)),i=t*Math.sqrt(3)/2;return"M0,"+i+"L"+t+","+-i+" "+-t+","+-i+"Z"},star:function(e){for(var t=Math.sqrt(e/2),i=Math.sqrt(e/10),a="",r=Math.PI/5,s=0;10>s;s++){var o=0===(1&s)?t:i,n=Math.cos(s*r)*o,l=Math.sin(s*r)*o;0===s?a="M"+n+","+l+"L":a+=" "+n+","+l}return a+"Z"},hexagon:function(e){var t=Math.sqrt(e/(6*Math.sqrt(3))),i=Math.sqrt(e/(2*Math.sqrt(3)));return"M0,"+2*t+"L"+-i+","+t+" "+-i+","+-t+" 0,"+-2*t+" "+i+","+-t+" "+i+","+t+"Z"},x:function(e){var t=Math.sqrt(e/10);return"M0,"+t+"L"+-t+","+2*t+" "+-2*t+","+t+" "+-t+",0 "+-2*t+","+-t+" "+-t+","+-2*t+" 0,"+-t+" "+t+","+-2*t+" "+2*t+","+-t+" "+t+",0 "+2*t+","+t+" "+t+","+2*t+"Z"},uparrow:function(e){var t=Math.sqrt(e/12);return"M"+t+","+3*t+"L"+-t+","+3*t+" "+-t+","+-t+" "+-2*t+","+-t+" 0,"+-3*t+" "+2*t+","+-t+" "+t+","+-t+"Z"},downarrow:function(e){var t=Math.sqrt(e/12);return"M0,"+3*t+"L"+-2*t+","+t+" "+-t+","+t+" "+-t+","+-3*t+" "+t+","+-3*t+" "+t+","+t+" "+2*t+","+t+"Z"}}),i=t.entries()[0].value;if(e){if(isNaN(e))return t[e&&e.toString().toLowerCase()]||i;var a=t.entries()[Math.floor(e)];return a?a.value:i}return i},e.prototype.init=function(t){this.options=t,this.animator=new D,this.behavior=new J([new Q(e.DimmedBubbleOpacity,e.DefaultBubbleOpacity)]);var i=this.element=t.element;this.viewport=_.clone(t.viewport),this.style=t.style,this.hostServices=t.host,this.colors=this.style.colorPalette.dataColors,this.interactivity=t.interactivity,this.margin={top:1,right:1,bottom:1,left:1},this.yAxisOrientation=T.left,this.adjustMargins();var a=this.scrollY=!0,r=this.scrollX=!0,s=this.svg=d3.select(i.get(0)).append("svg").style("position","absolute").classed(e.ClassName,!0),o=this.axisGraphicsContext=s.append("g").classed(e.AxisGraphicsContextClassName,!0);this.svgScrollable=s.append("svg").classed("svgScrollable",!0).style("overflow","hidden");var n=this.axisGraphicsContextScrollable=this.svgScrollable.append("g").classed(e.AxisGraphicsContextClassName,!0);this.clearCatcher=V(this.axisGraphicsContextScrollable);var l=a?n:o;this.backgroundGraphicsContext=o.append("svg:image"),this.xAxisGraphicsContext=a?o.append("g").attr("class","x axis"):n.append("g").attr("class","x axis"),this.y1AxisGraphicsContext=l.append("g").attr("class","y axis"),this.xAxisGraphicsContext.classed("showLinesOnAxis",a),this.y1AxisGraphicsContext.classed("showLinesOnAxis",r),this.xAxisGraphicsContext.classed("hideLinesOnAxis",!a),this.y1AxisGraphicsContext.classed("hideLinesOnAxis",!r),this.interactivityService=N(this.hostServices),this.legend=L(i,this.interactivity&&this.interactivity.isInteractiveLegend,this.interactivityService,!0),this.mainGraphicsG=this.axisGraphicsContextScrollable.append("g").classed(e.MainGraphicsContextClassName,!0),this.mainGraphicsSVGSelection=this.mainGraphicsG.append("svg"),this.mainGraphicsContext=this.mainGraphicsSVGSelection.append("g"),this.svgDefaultImage="",this.keyArray=[]},e.prototype.adjustMargins=function(){var e=this.element.find(".x.axis");0===M.getRecommendedNumberOfTicksForXAxis(this.viewportIn.width)&&0===M.getRecommendedNumberOfTicksForYAxis(this.viewportIn.height)?(this.margin={top:0,right:0,bottom:0,left:0},e.hide()):e.show()},e.prototype.getValueAxisProperties=function(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.valueAxis;r&&(i={show:r.show,position:r.position,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,axisColor:r.axisColor,secShow:r.secShow,secPosition:r.secPosition,secAxisScale:r.secAxisScale,secStart:r.secStart,secEnd:r.secEnd,secShowAxisTitle:r.secShowAxisTitle,secAxisStyle:r.secAxisStyle,labelDisplayUnits:r.labelDisplayUnits})}return i},e.prototype.getCategoryAxisProperties=function(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.categoryAxis;r&&(i={show:r.show,axisType:r.axisType,axisScale:r.axisScale,axisColor:r.axisColor,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelDisplayUnits:r.labelDisplayUnits})}return i},e.converter=function(t,i,a,r,s){if(!t)return e.getDefaultData();var o,n,l,c,u,h=t.categorical,p=t.metadata,d=h.categories||[],g=h.values,m=!!g.source,y=g.grouped(),f=g.source,v=e.getMetadata(d,y,f),x=v.idx.category,b=v.idx.image>=0,S=v.idx.colorFill>=0;if(h.categories&&h.categories.length>0&&h.categories[x]){var w=h.categories[x];o=w.values,n=I.create({format:I.getFormatString(w.source,e.Properties.general.formatString),value:o[0],value2:o[o.length-1]}),c=w.identity,l=w.objects,u=w.source?w.source.queryName:null}else o=[null],n=I.createDefaultFormatter(null);var C=O.getDefaultPointLabelSettings(),P=!1,A={show:!1,url:""},D=!1,T=!1,V="",N=!0;if(p&&p.objects){var L=p.objects;V=k.getFillColor(L,e.Properties.dataPoint.defaultColor),N=k.getValue(L,e.Properties.dataPoint.showAllDataPoints);var M=L.categoryLabels;M&&(C.show=void 0!==M.show?M.show:C.show,C.fontSize=void 0!==M.fontSize?M.fontSize:C.fontSize,void 0!==M.color&&(C.labelColor=M.color.solid.color)),P=k.getValue(L,e.Properties.fillPoint.show,P);var F=L.backdrop;void 0!==F&&(A.show=F.show,A.show&&(A.url=F.url));var z=L.crosshair;void 0!==z&&(D=z.show);var j=L.outline;void 0!==j&&(T=j.show)}var G=e.createDataPoints(g,v,d,o,n,c,l,i,m,C,V,u);a&&a.applySelectionStateToData(G);var R=[];if(m){var B=I.getFormatString(f,e.Properties.general.formatString);R=e.createSeriesLegend(g,i,g,B,V)}var H=g&&f?f.displayName:"";H||(H=d&&d[x]&&d[x].source&&d[x].source.displayName?d[x].source.displayName:"");var E={title:H,dataPoints:R},_=e.getSizeRangeForGroups(y,v.idx.size);if(r&&null!==r.showAxisTitle&&r.showAxisTitle===!1&&(v.axesLabels.x=null),s&&null!==s.showAxisTitle&&s.showAxisTitle===!1&&(v.axesLabels.y=null),G&&G[0]){var W=G[0];null!=W.backdrop&&(A.show=!0,A.url=W.backdrop),null!=W.xStart&&(r.start=W.xStart),null!=W.xEnd&&(r.end=W.xEnd),null!=W.yStart&&(s.start=W.yStart),null!=W.yEnd&&(s.end=W.yEnd)}return{xCol:v.cols.x,yCol:v.cols.y,dataPoints:G,legendData:E,axesLabels:v.axesLabels,selectedIds:[],size:v.cols.size,sizeRange:_,dataLabelsSettings:C,defaultDataPointColor:V,hasDynamicSeries:m,showAllDataPoints:N,fillPoint:P,useShape:b,useCustomColor:S,backdrop:A,crosshair:D,outline:T}},e.createSeriesLegend=function(t,i,a,r,s){for(var o=[],n=t.grouped(),l=new F(i,e.Properties.dataPoint.fill,s),c=0,u=n.length;u>c;c++){var h,p,d=n[c];p=l.getColorForSeriesValue(d.objects,t.identityFields,d.name),h=d.identity?w.createWithId(d.identity):w.createNull(),o.push({color:p,icon:z.Circle,label:I.format(d.name,r),identity:h,selected:!1})}return o},e.getSizeRangeForGroups=function(t,i){var a={};return t&&t.forEach(function(t){var r=e.getMeasureValue(i,t.values),s=M.getRangeForColumn(r);(null==a.min||a.min>s.min)&&(a.min=s.min),(null==a.max||a.max<s.max)&&(a.max=s.max);
}),a},e.getMetadata=function(t,i,a){var r,n,l,c=s(t,e.ColumnCategory),u=s(t,e.ColumnColorFill),h=s(t,e.ColumnImage),p=s(t,e.ColumnBackdrop),d=o(i,e.ColumnX),g=o(i,e.ColumnY),m=o(i,e.ColumnSize),y=o(i,e.ColumnShape),f=o(i,e.ColumnRotation),v=o(i,e.ColumnXStart),x=o(i,e.ColumnXEnd),b=o(i,e.ColumnYStart),S=o(i,e.ColumnYEnd),w="",C="";if(i&&i.length){var P=i[0];d>=0&&(r=P.values[d].source,w=P.values[d].source.displayName),g>=0&&(n=P.values[g].source,C=P.values[g].source.displayName),m>=0&&(l=P.values[m].source)}return{idx:{category:c,x:d,y:g,size:m,colorFill:u,shape:y,image:h,rotation:f,backdrop:p,xStart:v,xEnd:x,yStart:b,yEnd:S},cols:{x:r,y:n,size:l},axesLabels:{x:w,y:C}}},e.createLazyFormattedCategory=function(e,t){return new c(function(){return e.format(t)})},e.createDataPoints=function(t,a,r,s,o,n,l,c,u,h,p,d){var g,m,y=[],f=a.idx,v=t.source,x=t.grouped(),b=i.fromPoint(h.fontSize);m=e.Properties.general.formatString,g=new F(c,e.Properties.dataPoint.fill,p);for(var S=0,w=s.length;w>S;S++)for(var C=s[S],P=0,A=x.length;A>P;P++){var D=r[f.colorFill],T=r[f.image],V=r[f.backdrop],N=x[P],L=N.values,M=e.getMeasureValue(f.x,L),k=e.getMeasureValue(f.y,L),I=e.getMeasureValue(f.size,L),O=e.getMeasureValue(f.shape,L),z=e.getMeasureValue(f.rotation,L),R=e.getMeasureValue(f.xStart,L),B=e.getMeasureValue(f.xEnd,L),H=e.getMeasureValue(f.yStart,L),E=e.getMeasureValue(f.yEnd,L),_=M&&M.values&&!isNaN(M.values[S])?M.values[S]:null,W=k&&k.values&&!isNaN(k.values[S])?k.values[S]:0,U=null==_||null==W;if(!U){var Y,X,q,K,Z,J,Q,$,ee,te,ie;if(Y=e.getValueFromDataViewValueColumnById(I,S),X=e.getValueFromDataViewValueColumnById(D,S),q=e.getCustomSymbolType(e.getValueFromDataViewValueColumnById(O,S)),K=e.getValueFromDataViewValueColumnById(T,S),Z=e.getNumberFromDataViewValueColumnById(z,S),J=e.getValueFromDataViewValueColumnById(V,S),Q=e.getValueFromDataViewValueColumnById(R,S),$=e.getValueFromDataViewValueColumnById(B,S),ee=e.getValueFromDataViewValueColumnById(H,S),te=e.getValueFromDataViewValueColumnById(E,S),u)ie=g.getColorForSeriesValue(N.objects,t.identityFields,N.name);else{var ae=null!=I?I.source.queryName:"";ie=g.getColorForMeasure(l&&l[S],ae)}var re=r&&r.length>0?r[f.category]:null,se=j.builder().withCategory(re,S).withSeries(t,N).createSelectionId(),oe=[];v&&oe.push({value:N.name,metadata:{source:v,values:[]}}),M&&oe.push({value:_,metadata:M}),k&&oe.push({value:W,metadata:k}),I&&I.values&&I.values.length>0&&oe.push({value:I.values[S],metadata:I}),D&&D.values&&D.values.length>0&&oe.push({value:D.values[S],metadata:D}),O&&O.values&&O.values.length>0&&oe.push({value:O.values[S],metadata:O}),T&&T.values&&T.values.length>0&&oe.push({value:T.values[S],metadata:T}),z&&z.values&&z.values.length>0&&oe.push({value:z.values[S],metadata:z}),V&&V.values&&V.values.length>0&&oe.push({value:V.values[S],metadata:V}),R&&R.values&&R.values.length>0&&oe.push({value:R.values[S],metadata:R}),B&&B.values&&B.values.length>0&&oe.push({value:B.values[S],metadata:B}),H&&H.values&&H.values.length>0&&oe.push({value:H.values[S],metadata:H}),E&&E.values&&E.values.length>0&&oe.push({value:E.values[S],metadata:E});var ne=G.createTooltipInfo(m,void 0,C,null,re?[re]:void 0,oe,void 0),le={x:_,y:W,size:Y,radius:{sizeMeasure:I,index:S},fill:ie,formattedCategory:this.createLazyFormattedCategory(o,C),selected:!1,identity:se,tooltipInfo:ne,labelFill:h.labelColor,labelFontSize:b,contentPosition:8,colorFill:X,shapeSymbolType:q,svgurl:K,rotation:Z,backdrop:J,xStart:Q,xEnd:$,yStart:ee,yEnd:te};y.push(le)}}return y},e.getMeasureValue=function(e,t){return t&&e>=0?t[e]:null},e.getNumberFromDataViewValueColumnById=function(t,i){var a=e.getValueFromDataViewValueColumnById(t,i);return a&&!isNaN(a)?a:0},e.getValueFromDataViewValueColumnById=function(e,t){return e&&e.values?e.values[t]:null},e.getDefaultData=function(){return{xCol:void 0,yCol:void 0,dataPoints:[],legendData:{dataPoints:[]},axesLabels:{x:"",y:""},selectedIds:[],sizeRange:[],dataLabelsSettings:O.getDefaultPointLabelSettings(),defaultDataPointColor:null,hasDynamicSeries:!1,useShape:!1,useCustomColor:!1}},e.prototype.setData=function(t){if(this.data=e.getDefaultData(),t&&t.length>0){var i=t[0];i&&(this.categoryAxisProperties=this.getCategoryAxisProperties(i.metadata,!0),this.valueAxisProperties=this.getValueAxisProperties(i.metadata,!0),this.dataView=i,i.categorical&&i.categorical.values&&(this.data=e.converter(i,this.colors,this.interactivityService,this.categoryAxisProperties,this.valueAxisProperties)))}},e.prototype.update=function(e){var t=this.dataViews=e.dataViews;if(this.viewport=_.clone(e.viewport),t){if(t&&t.length>0){var i=R(t,!1,!1,!1);i&&i.length>0&&this.hostServices.setWarnings(i),this.populateObjectProperties(t)}this.setData(t),this.options.interactivity&&this.options.interactivity.isInteractiveLegend||this.renderLegend(),this.render(e.suppressAnimations)}},e.prototype.populateObjectProperties=function(e){if(e&&e.length>0){var t=e[0].metadata;t?this.legendObjectProperties=k.getObject(t.objects,"legend",{}):this.legendObjectProperties={},this.categoryAxisProperties=this.getCategoryAxisProperties(t),this.valueAxisProperties=this.getValueAxisProperties(t);var i=this.valueAxisProperties.position;this.yAxisOrientation=i?i.toString():T.left}},e.prototype.renderLegend=function(){var t={title:"",dataPoints:[]},i=this.legend;this.layerLegendData=this.data.legendData,this.layerLegendData&&(t.title=this.layerLegendData.title||"",t.dataPoints=t.dataPoints.concat(this.layerLegendData.dataPoints||[]),t.fontSize=this.legendLabelFontSize?this.legendLabelFontSize:e.LegendLabelFontSizeDefault,this.layerLegendData.grouped&&(t.grouped=!0));var a=this.legendObjectProperties;if(a){S.update(t,a);var r=a[B.position];r&&i.changeOrientation(H[r])}else i.changeOrientation(H.Top);1!==t.dataPoints.length||t.grouped||(t.dataPoints=[]);var s=this.viewport;i.drawLegend(t,{height:s.height,width:s.width}),E.positionChartArea(this.svg,i)},e.prototype.shouldRenderAxis=function(e,t){return void 0===t&&(t="show"),e?(!e.isCategoryAxis||this.categoryAxisProperties&&null!=this.categoryAxisProperties[t]&&!this.categoryAxisProperties[t])&&(e.isCategoryAxis||this.valueAxisProperties&&null!=this.valueAxisProperties[t]&&!this.valueAxisProperties[t])?!1:e.values&&e.values.length>0:!1},e.prototype.getMaxMarginFactor=function(){return this.options.style.maxMarginFactor||.25},e.prototype.adjustViewportbyBackdrop=function(){var e=new Image,t=this;if(e.src=this.data.backdrop.url,e.onload=function(){t.oldBackdrop!==this.src&&(t.render(!0),t.oldBackdrop=this.src)},e.width>0&&e.height>0)if(e.width*this.viewportIn.height<this.viewportIn.width*e.height){var i=this.viewportIn.width-this.viewportIn.height*e.width/e.height;this.viewport={width:this.viewport.width-i,height:this.viewport.height}}else{var a=this.viewportIn.height-this.viewportIn.width*e.height/e.width;this.viewport={width:this.viewport.width,height:this.viewport.height-a}}},e.prototype.render=function(t){if(this.viewport.height-=this.legendViewport.height,this.viewport.width-=this.legendViewport.width,0!==this.viewportIn.width&&0!==this.viewportIn.height){var i=this.getMaxMarginFactor();this.leftRightMarginLimit=this.viewport.width*i;var a=this.bottomMarginLimit=Math.max(25,Math.ceil(this.viewport.height*i));this.margin.top=8,this.margin.bottom=a,this.margin.right=0,this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,e.TextProperties,!0),this.yAxisIsCategorical=this.yAxisProperties.isCategoryAxis,this.hasCategoryAxis=this.yAxisIsCategorical?this.yAxisProperties&&this.yAxisProperties.values.length>0:this.xAxisProperties&&this.xAxisProperties.values.length>0;var r,s=this.shouldRenderAxis(this.xAxisProperties),o=this.shouldRenderAxis(this.yAxisProperties);this.isXScrollBarVisible=!1,this.isYScrollBarVisible=!1;var n,l,c,p=this.yAxisOrientation,d=p===T.right;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,e.TextProperties,!0);for(var m=!1,y=2,f=0;!m&&y>f;){f++,n=M.getTickLabelMargins({width:this.viewportIn.width,height:this.viewport.height},this.leftRightMarginLimit,u,h,{x:this.xAxisProperties,y1:this.yAxisProperties},this.bottomMarginLimit,e.TextProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,d,s,o,!1);var v=d?n.yRight:n.yLeft,b=d?n.yLeft:n.yRight,S=n.xMax;v+=10,b+=10,S+=12,d&&o&&(b+=20),!d&&o&&(v+=20),this.addUnitTypeToAxisLabel(this.xAxisProperties,this.yAxisProperties),l={x:this.xAxisProperties.axisLabel,y:this.yAxisProperties.axisLabel,y2:null},c=null!=l.x||null!=l.y||null!=l.y2,null!=l.x&&(S+=18),null!=l.y&&(v+=20),null!=l.y2&&(b+=20),this.margin.left=d?b:v,this.margin.right=d?v:b,this.margin.bottom=S;var w=this.yAxisProperties.values.length;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,e.TextProperties,!0),this.yAxisProperties.values.length===w&&(m=!0)}if(this.data.backdrop&&this.data.backdrop.show&&void 0!==this.data.backdrop.url)for(this.adjustViewportbyBackdrop(),m=!1,y=2,f=0;!m&&y>f;){f++,n=M.getTickLabelMargins({width:this.viewportIn.width,height:this.viewport.height},this.leftRightMarginLimit,u,h,{x:this.xAxisProperties,y1:this.yAxisProperties},this.bottomMarginLimit,e.TextProperties,this.isXScrollBarVisible||this.isYScrollBarVisible,d,s,o,!1);var v=d?n.yRight:n.yLeft,b=d?n.yLeft:n.yRight,S=n.xMax;v+=10,d&&o&&(b+=15),S+=12,this.addUnitTypeToAxisLabel(this.xAxisProperties,this.yAxisProperties),l={x:this.xAxisProperties.axisLabel,y:this.yAxisProperties.axisLabel,y2:null},c=null!=l.x||null!=l.y||null!=l.y2,null!=l.x&&(S+=18),null!=l.y&&(v+=20),null!=l.y2&&(b+=20),this.margin.left=d?b:v,this.margin.right=d?v:b,this.margin.bottom=S;var w=this.yAxisProperties.values.length;this.calculateAxes(this.categoryAxisProperties,this.valueAxisProperties,e.TextProperties,!0),this.yAxisProperties.values.length===w&&(m=!0)}if(this.renderChart(r,this.xAxisProperties,this.yAxisProperties,n,c,l,t),this.updateAxis(),this.data){var C=this.data,P=this.data.dataPoints,A=this.interactivityService&&this.interactivityService.hasSelection();this.mainGraphicsSVGSelection.attr("width",this.viewportIn.width).attr("height",this.viewportIn.height);var D=P.sort(function(e,t){return t.radius.sizeMeasure?t.radius.sizeMeasure.values[t.radius.index]-e.radius.sizeMeasure.values[e.radius.index]:0}),V=x(this.animator,t),N=this.drawScatterMarkers(D,A,C.sizeRange,V),L=this.data.dataLabelsSettings;if(L.show){var k,I,F;k=this.getEnhanchedScatterChartLabelLayout(L,this.viewportIn,C.sizeRange),I=this.cloneDataPoints(P),F=O.drawDefaultLabelsForDataPointChart(I,this.mainGraphicsG,k,this.viewportIn),F&&F.attr("transform",function(t){var i,a,r=t.size;return i=r.width/e.DataLabelXOffset,a=r.height/e.DataLabelYOffset,W.translate(i,a)})}else O.cleanDataLabels(this.mainGraphicsG);this.renderCrosshair();var z;if(this.interactivityService&&(z={dataPointsSelection:N,data:this.data,plotContext:this.mainGraphicsSVGSelection}),g(N,function(e){return e.data.tooltipInfo}),W.flushAllD3TransitionsIfNeeded(this.options),this.behavior){var j=[z];if(this.interactivityService){var G={layerOptions:j,clearCatcher:this.clearCatcher};this.interactivityService.bind(P,this.behavior,G)}}}}},e.prototype.cloneDataPoints=function(e){return e.map(function(e){return _.clone(e)})},e.prototype.darkenZeroLine=function(e){var t=e.selectAll("g.tick").filter(function(e){return 0===e}).node();t&&d3.select(t).select("line").classed("zero-line",!0)},e.prototype.getCategoryAxisFill=function(){if(this.dataView&&this.dataView.metadata.objects){var e=this.dataView.metadata.objects.categoryAxis;if(e)return e.axisColor}return{solid:{color:"#333"}}},e.prototype.getEnhanchedScatterChartLabelLayout=function(t,i,a){var r=this.xAxisProperties.scale,s=this.yAxisProperties.scale,o=m(t.fontSize),n=y.fontFamily;return{labelText:function(e){return f({label:e.formattedCategory.getValue(),fontSize:t.fontSize,maxWidth:i.width})},labelLayout:{x:function(e){return r(e.x)},y:function(r){var o=e.getBubbleRadius(r.radius,a,i)+O.labelMargin;return 0===t.position?s(r.y)-o:s(r.y)+o}},filter:function(e){return null!=e&&null!=e.formattedCategory.getValue()},style:{fill:function(e){return e.labelFill},"font-size":o,"font-family":n}}},e.getBubbleRadius=function(t,i,a){var r=null,s=null,o=t.sizeMeasure;if(!o)return e.BubbleRadius;var n=i.min?i.min:0,l=i.max?i.max:0,c=Math.min(n,0),u=Math.max(l,0);if(r={minRange:c,maxRange:u,delta:u-c},s=e.getBubblePixelAreaSizeRange(a,e.MinSizeRange,e.MaxSizeRange),o.values){var h=o.values[t.index];if(null!=h)return e.projectSizeToPixels(h,r,s)/2}return e.BubbleRadius},e.getBubblePixelAreaSizeRange=function(t,i,a){var r=1;if(t.height>0&&t.width>0){var s=Math.min(t.height,t.width);r=s*s/e.AreaOf300By300Chart}var o=Math.round(i*r),n=Math.round(a*r);return{minRange:o,maxRange:n,delta:n-o}},e.projectSizeToPixels=function(t,i,a){var r=0;if(i){if(r=a.maxRange,0!==i.delta){var s=Math.min(Math.max(t,i.minRange),i.maxRange);r=e.project(s,i,a)}r=2*Math.sqrt(r/Math.PI)}return Math.round(r)},e.project=function(t,i,a){if(0===i.delta||0===a.delta)return e.rangeContains(i,t)?a.minRange:null;var r=(t-i.minRange)/i.delta;return a.minRange+r*a.delta},e.rangeContains=function(e,t){return e.minRange<=t&&t<=e.maxRange},e.prototype.getValueAxisFill=function(){if(this.dataView&&this.dataView.metadata.objects){var e=this.dataView.metadata.objects.valueAxis;if(e)return e.axisColor}return{solid:{color:"#333"}}},e.prototype.renderCrosshair=function(){return this.mainGraphicsSVGSelection?(this.crosshairCanvasSelection=this.addCrosshairCanvasToDOM(this.mainGraphicsSVGSelection),this.data&&this.data.crosshair&&(this.crosshairVerticalLineSelection=this.addCrosshairLineToDOM(this.crosshairCanvasSelection,e.CrosshairVerticalLineSelector),this.crosshairHorizontalLineSelection=this.addCrosshairLineToDOM(this.crosshairCanvasSelection,e.CrosshairHorizontalLineSelector),this.crosshairTextSelection=this.addCrosshairTextToDOM(this.crosshairCanvasSelection),this.bindCrosshairEvents()),this.crosshairCanvasSelection):void 0},e.prototype.addCrosshairCanvasToDOM=function(t){var i=e.CrosshairCanvasSelector;return this.addElementToDOM(t,{name:"g",selector:i.selector,className:i["class"],styles:{display:"none"}})},e.prototype.addCrosshairLineToDOM=function(t,i){var a=e.CrosshairLineSelector;return this.addElementToDOM(t,{name:"line",selector:i.selector,className:a["class"]+" "+i["class"],attributes:{x1:0,y1:0,x2:0,y2:0}})},e.prototype.addCrosshairTextToDOM=function(t){var i=e.CrosshairTextSelector;return this.addElementToDOM(t,{name:"text",selector:i.selector,className:i["class"]})},e.prototype.bindCrosshairEvents=function(){var e=this;this.axisGraphicsContextScrollable&&this.axisGraphicsContextScrollable.on("mousemove",function(){var t=d3.event.currentTarget,i=d3.mouse(t),a=t.viewportElement,r=a.getBoundingClientRect(),s=a.getBBox(),o=r.width/s.width,n=r.height/s.height,l=i[0],c=i[1];s.width>0&&!v(o,1,1e-5)&&(l/=o),s.height>0&&!v(n,1,1e-5)&&(c/=n),e.updateCrosshair(l,c)}).on("mouseover",function(){e.crosshairCanvasSelection.style("display","block")}).on("mouseout",function(){e.crosshairCanvasSelection.style("display","none")})},e.prototype.updateCrosshair=function(t,i){if(this.viewportIn&&this.crosshairHorizontalLineSelection&&this.crosshairVerticalLineSelection&&this.crosshairTextSelection&&this.xAxisProperties){var a,r,s=e.CrosshairTextMargin,o=this.xAxisProperties.scale,n=this.yAxisProperties.scale;this.crosshairHorizontalLineSelection.attr({x1:0,y1:i,x2:this.viewportIn.width,y2:i}),this.crosshairVerticalLineSelection.attr({x1:t,y1:0,x2:t,y2:this.viewportIn.height}),a=Math.round(100*o.invert(t))/100,r=Math.round(100*n.invert(i))/100,this.crosshairTextSelection.attr({x:t+s,y:i-s}).text("("+a+", "+r+")")}},e.prototype.addElementToDOM=function(e,t){if(!e||!t)return null;var i,a;return i=e.selectAll(t.selector),a=i.data(t.data||[[]]),a.enter().append(t.name).attr(t.attributes).style(t.styles).classed(t.className,!0),a.exit().remove(),a},e.prototype.renderBackground=function(){this.data.backdrop&&this.data.backdrop.show&&void 0!==this.data.backdrop.url?this.backgroundGraphicsContext.attr("xlink:href",this.data.backdrop.url).attr("x",0).attr("y",0).attr("width",this.viewportIn.width).attr("height",this.viewportIn.height):this.backgroundGraphicsContext.attr("width",0).attr("height",0)},e.prototype.renderChart=function(t,i,a,r,s,o,n,l,c){var u=this.bottomMarginLimit,h=this.leftRightMarginLimit,p=x(this.animator,n);if(this.renderBackground(),this.shouldRenderAxis(i)){i.axis.orient("bottom"),i.willLabelsFit||i.axis.tickPadding(5);var g=this.xAxisGraphicsContext;p?g.transition().duration(p).call(i.axis).call(this.darkenZeroLine):g.call(i.axis).call(this.darkenZeroLine);var m=g.selectAll("g.tick").filter(function(e){return 0===e});if(m){var y=this.getValueAxisFill();y&&m.selectAll("line").style({stroke:y.solid.color})}var f=g.selectAll("text");i.willLabelsWordBreak?f.call(M.LabelLayoutStrategy.wordBreak,i,u):f.call(M.LabelLayoutStrategy.rotate,u,b,e.TextProperties,!i.willLabelsFit,u===r.xMax,i,this.margin,this.isXScrollBarVisible||this.isYScrollBarVisible)}else this.xAxisGraphicsContext.selectAll("*").remove();if(this.shouldRenderAxis(a)){var v=this.yAxisOrientation;a.axis.tickSize(-this.viewportIn.width).tickPadding(10).orient(v.toLowerCase());var S=this.y1AxisGraphicsContext;p?S.transition().duration(p).call(a.axis).call(this.darkenZeroLine):S.call(a.axis).call(this.darkenZeroLine);var w=S.selectAll("g.tick").filter(function(e){return 0===e});if(w){var C=this.getCategoryAxisFill();C&&w.selectAll("line").style({stroke:C.solid.color})}r.yLeft>=h&&S.selectAll("text").call(M.LabelLayoutStrategy.clip,h-10,d)}else this.y1AxisGraphicsContext.selectAll("*").remove();if(s){var P=!this.shouldRenderAxis(i,"showAxisTitle"),A=!this.shouldRenderAxis(a,"showAxisTitle"),D=this.valueAxisProperties&&null!=this.valueAxisProperties.secShowAxisTitle&&this.valueAxisProperties.secShowAxisTitle===!1;this.renderAxesLabels(o,this.legendViewport.height,P,A,D)}else this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove()},e.prototype.renderAxesLabels=function(t,i,a,r,s){this.axisGraphicsContext.selectAll(".xAxisLabel").remove(),this.axisGraphicsContext.selectAll(".yAxisLabel").remove();var o=this.margin,n=this.viewportIn.width,l=this.viewport.height,c=e.AxisFontSize,u=this.yAxisOrientation,h=u===T.right;if(!a){var p=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.x).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"xAxisLabel",transform:W.translate(n/2,l-c-2)})})});p.call(M.LabelLayoutStrategy.clip,n,d)}if(!r){var g=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.y).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:h?n+o.right-c:-o.left,x:-((l-o.top-i)/2),dy:"1em"})})});g.call(M.LabelLayoutStrategy.clip,l-(o.bottom+o.top),d)}if(!s&&t.y2){var m=this.axisGraphicsContext.append("text").style("text-anchor","middle").text(t.y2).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":"yAxisLabel",transform:"rotate(-90)",y:h?-o.left:n+o.right-c,x:-((l-o.top-i)/2),dy:"1em"})})});m.call(M.LabelLayoutStrategy.clip,l-(o.bottom+o.top),d)}},e.prototype.updateAxis=function(){this.adjustMargins();var e=this.yAxisOrientation,t=e===T.right;this.xAxisGraphicsContext.attr("transform",W.translate(0,this.viewportIn.height)),this.y1AxisGraphicsContext.attr("transform",W.translate(t?this.viewportIn.width:0,0)),this.svg.attr({width:this.viewport.width,height:this.viewport.height}),this.svgScrollable.attr({width:this.viewport.width,height:this.viewport.height}),this.svgScrollable.attr({x:0});var i=this.margin.left,a=this.margin.top;this.axisGraphicsContext.attr("transform",W.translate(i,a)),this.axisGraphicsContextScrollable.attr("transform",W.translate(i,a)),this.clearCatcher.attr("transform",W.translate(-i,-a)),this.isXScrollBarVisible?(this.svgScrollable.attr({x:i}),this.axisGraphicsContextScrollable.attr("transform",W.translate(0,a)),this.svgScrollable.attr("width",this.viewportIn.width),this.svg.attr("width",this.viewport.width).attr("height",this.viewport.height+this.ScrollBarWidth)):this.isYScrollBarVisible&&(this.svgScrollable.attr("height",this.viewportIn.height+a),this.svg.attr("width",this.viewport.width+this.ScrollBarWidth).attr("height",this.viewport.height))},e.prototype.getUnitType=function(e){return e.formatter&&e.formatter.displayUnit&&e.formatter.displayUnit.value>1?e.formatter.displayUnit.title:null},e.prototype.addUnitTypeToAxisLabel=function(e,t){var i=this.getUnitType(e);e.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,e.axisLabel&&i&&(e.isCategoryAxis?e.axisLabel=M.createAxisLabel(this.categoryAxisProperties,e.axisLabel,i):e.axisLabel=M.createAxisLabel(this.valueAxisProperties,e.axisLabel,i)),i=this.getUnitType(t),t.isCategoryAxis?this.categoryAxisHasUnitType=null!==i:this.valueAxisHasUnitType=null!==i,t.axisLabel&&i&&(t.isCategoryAxis?t.axisLabel=M.createAxisLabel(this.categoryAxisProperties,t.axisLabel,i):t.axisLabel=M.createAxisLabel(this.valueAxisProperties,t.axisLabel,i))},e.prototype.drawScatterMarkers=function(t,i,a,r){var s,o=this,n=this.xAxisProperties.scale,l=this.yAxisProperties.scale,c=(!a||!a.min)&&this.data.fillPoint,u=this.data.useCustomColor;this.data.useShape?(this.mainGraphicsContext.selectAll(e.DotClasses.selector).remove(),s=this.mainGraphicsContext.classed("ScatterMarkers",!0).selectAll(e.ImageClasses.selector).data(t,function(e){return e.identity.getKey()}),s.enter().append("svg:image").classed(e.ImageClasses["class"],!0).attr("id","markerimage"),s.attr("xlink:href",function(e){return void 0!==e.svgurl&&null!=e.svgurl&&""!==e.svgurl?e.svgurl:o.svgDefaultImage}).attr("width",function(t){return 2*e.getBubbleRadius(t.radius,a,o.viewport)}).attr("height",function(t){return 2*e.getBubbleRadius(t.radius,a,o.viewport)}).transition().duration(function(e){return o.keyArray.indexOf(e.identity.getKey())>=0?r:0}).attr("transform",function(t){var i=e.getBubbleRadius(t.radius,a,o.viewport);return"translate("+(n(t.x)-i)+","+(l(t.y)-i)+") rotate("+t.rotation+","+i+","+i+")"})):(this.mainGraphicsContext.selectAll(e.ImageClasses.selector).remove(),s=this.mainGraphicsContext.classed("ScatterMarkers",!0).selectAll(e.DotClasses.selector).data(t,function(e){return e.identity.getKey()}),s.enter().append("path").classed(e.DotClasses["class"],!0).attr("id","markershape"),s.style({"stroke-opacity":function(t){return e.getBubbleOpacity(t,i)},"stroke-width":"1px",stroke:function(e){var t=u?e.colorFill:e.fill;return o.data.outline?d3.rgb(t).darker():d3.rgb(t)},fill:function(e){return d3.rgb(u?e.colorFill:e.fill)},"fill-opacity":function(t){return null!=t.size||c?e.getBubbleOpacity(t,i):0}}).attr("d",function(t){var i=e.getBubbleRadius(t.radius,a,o.viewport),r=4*i*i;return t.shapeSymbolType(r)}).transition().duration(function(e){return o.keyArray.indexOf(e.identity.getKey())>=0?r:0}).attr("transform",function(e){return"translate("+n(e.x)+","+l(e.y)+") rotate("+e.rotation+")"})),s.exit().remove(),this.keyArray=[];for(var h=0;h<t.length;h++)this.keyArray.push(t[h].identity.getKey());return s},e.getBubbleOpacity=function(t,i){return i&&!t.selected?e.DimmedBubbleOpacity:e.DefaultBubbleOpacity},e.prototype.calculateAxes=function(t,i,a,r){var s={viewport:this.viewport,margin:this.margin,forcedXDomain:[t?t.start:null,t?t.end:null],forceMerge:i&&i.secShow===!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:t&&null!=t.axisScale?t.axisScale:null,valueAxisScaleType:i&&null!=i.axisScale?i.axisScale:null,valueAxisDisplayUnits:i&&null!=i.labelDisplayUnits?i.labelDisplayUnits:e.LabelDisplayUnitsDefault,categoryAxisDisplayUnits:t&&null!=t.labelDisplayUnits?t.labelDisplayUnits:e.LabelDisplayUnitsDefault,trimOrdinalDataOnOverflow:!1};i&&(s.forcedYDomain=M.applyCustomizedDomain([i.start,i.end],s.forcedYDomain)),s.showCategoryAxisLabel=!!t&&!!t.showAxisTitle,s.showValueAxisLabel=!0;var o=this.viewport.width-(this.margin.left+this.margin.right),n=this.calculateAxesProperties(s);return n[0].willLabelsFit=M.LabelLayoutStrategy.willLabelsFit(n[0],o,u,a),n[0].willLabelsWordBreak=!n[0].willLabelsFit&&!r&&M.LabelLayoutStrategy.willLabelsWordBreak(n[0],this.margin,o,u,p,b,a),n},e.prototype.calculateAxesProperties=function(t){var i=this.data,a=i.dataPoints;this.margin=t.margin,this.viewport=t.viewport;var r=0,s=10,o=0,n=10;a.length>0&&(r=d3.min(a,function(e){return e.y}),s=d3.max(a,function(e){return e.y}),o=d3.min(a,function(e){return e.x}),n=d3.max(a,function(e){return e.x}));var l,c,u,h,p=[o,n];return l=M.combineDomain(this.optimizeTranslateValues(t.forcedXDomain),p),u=I.getFormatString(i.xCol,e.Properties.general.formatString),this.xAxisProperties=M.createAxis({pixelSpan:this.viewportIn.width,dataDomain:l,metaDataColumn:i.xCol,formatString:u,outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:t.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,scaleType:t.categoryAxisScaleType,axisDisplayUnits:t.categoryAxisDisplayUnits}),this.xAxisProperties.axis.tickSize(-this.viewportIn.height,0),this.xAxisProperties.axisLabel=this.data.axesLabels.x,c=M.combineDomain(this.optimizeTranslateValues(t.forcedYDomain),[r,s]),h=I.getFormatString(i.yCol,e.Properties.general.formatString),this.yAxisProperties=M.createAxis({pixelSpan:this.viewportIn.height,dataDomain:c,metaDataColumn:i.yCol,formatString:h,outerPadding:0,isScalar:!0,isVertical:!0,forcedTickCount:t.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,scaleType:t.valueAxisScaleType,axisDisplayUnits:t.valueAxisDisplayUnits}),this.yAxisProperties.axisLabel=this.data.axesLabels.y,[this.xAxisProperties,this.yAxisProperties]},e.prototype.optimizeTranslateValues=function(e){var t=this;return e&&e.map?e.map(function(e){return t.optimizeTranslateValue(e)}):e},e.prototype.optimizeTranslateValue=function(t){if(t){var i=t>=0?1:-1,a=Math.abs(t);if(a>e.MaxTranslateValue)return e.MaxTranslateValue*i;if(a<e.MinTranslateValue)return e.MinTranslateValue*i}return t},e.prototype.enumerateDataPoints=function(e){var t=this.data;if(t){var i=t.dataPoints.length;if(t.hasDynamicSeries)for(var a=t.legendData.dataPoints.length,r=0;a>r;r++){var s=t.legendData.dataPoints[r];e.pushInstance({objectName:"dataPoint",displayName:s.label,selector:F.normalizeSelector(s.identity.getSelector()),properties:{fill:{solid:{color:s.color}}}})}else{var o=t.showAllDataPoints;if(e.pushInstance({objectName:"dataPoint",selector:null,properties:{defaultColor:{solid:{color:t.defaultDataPointColor||this.colors.getColorByIndex(0).value}}}}).pushInstance({objectName:"dataPoint",selector:null,properties:{showAllDataPoints:o}}),o)for(var r=0;i>r;r++){var n=t.dataPoints[r];e.pushInstance({objectName:"dataPoint",displayName:n.formattedCategory.getValue(),selector:F.normalizeSelector(n.identity.getSelector(),!0),properties:{fill:{solid:{color:n.fill}}}})}}}},e.prototype.enumerateObjectInstances=function(e){var t=new U;switch(e.objectName){case"dataPoint":var i=this.dataView&&this.dataView.categorical?this.dataView.categorical:null;Y.hasGradientRole(i)||this.enumerateDataPoints(t);break;case"categoryAxis":this.getCategoryAxisValues(t);break;case"valueAxis":this.getValueAxisValues(t);break;case"categoryLabels":this.data?O.enumerateCategoryLabels(t,this.data.dataLabelsSettings,!0):O.enumerateCategoryLabels(t,null,!0);break;case"fillPoint":var a=this.data.sizeRange;if(a&&a.min)break;t.pushInstance({objectName:"fillPoint",selector:null,properties:{show:this.data.fillPoint}});break;case"backdrop":t.pushInstance({objectName:"backdrop",displayName:"Backdrop",selector:null,properties:{show:this.data.backdrop?this.data.backdrop.show:!1,url:this.data.backdrop?this.data.backdrop.url:null}});break;case"crosshair":t.pushInstance({objectName:"crosshair",selector:null,properties:{show:this.data.crosshair}});break;case"outline":t.pushInstance({objectName:"outline",selector:null,properties:{show:this.data.outline}});break;case"legend":this.getLegendValue(t)}return t.complete()},e.prototype.hasLegend=function(){return this.data&&this.data.hasDynamicSeries},e.prototype.getLegendValue=function(t){if(this.hasLegend()){var i=C.getValue(this.legendObjectProperties,B.show,this.legend.isVisible()),a=C.getValue(this.legendObjectProperties,B.showTitle,!0),r=C.getValue(this.legendObjectProperties,B.titleText,this.layerLegendData?this.layerLegendData.title:""),s=C.getValue(this.legendObjectProperties,B.labelColor,S.DefaultLegendLabelFillColor);this.legendLabelFontSize=C.getValue(this.legendObjectProperties,B.fontSize,e.LegendLabelFontSizeDefault),t.pushInstance({selector:null,properties:{show:i,position:H[this.legend.getOrientation()],showTitle:a,titleText:r,labelColor:s,fontSize:this.legendLabelFontSize},objectName:"legend"})}},e.prototype.getCategoryAxisValues=function(t){var i=X.both,a=!0,r=!1,s=[q.log,q.linear];a||this.categoryAxisProperties&&(this.categoryAxisProperties.start=null,this.categoryAxisProperties.end=null);var o={selector:null,properties:{},objectName:"categoryAxis",validValues:{axisScale:s}};o.properties.show=this.categoryAxisProperties&&null!=this.categoryAxisProperties.show?this.categoryAxisProperties.show:!0,this.yAxisIsCategorical&&(o.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:T.left),i===X.both&&(o.properties.axisType=a?X.scalar:X.categorical),a&&(o.properties.axisScale=this.categoryAxisProperties&&null!=this.categoryAxisProperties.axisScale&&r?this.categoryAxisProperties.axisScale:q.linear,o.properties.start=this.categoryAxisProperties?this.categoryAxisProperties.start:null,o.properties.end=this.categoryAxisProperties?this.categoryAxisProperties.end:null,o.properties.labelDisplayUnits=this.categoryAxisProperties&&null!=this.categoryAxisProperties.labelDisplayUnits?this.categoryAxisProperties.labelDisplayUnits:e.LabelDisplayUnitsDefault),o.properties.showAxisTitle=this.categoryAxisProperties&&null!=this.categoryAxisProperties.showAxisTitle?this.categoryAxisProperties.showAxisTitle:!0,t.pushInstance(o).pushInstance({selector:null,properties:{axisStyle:this.categoryAxisProperties&&this.categoryAxisProperties.axisStyle?this.categoryAxisProperties.axisStyle:K.showTitleOnly,labelColor:this.categoryAxisProperties?this.categoryAxisProperties.labelColor:null},objectName:"categoryAxis",validValues:{axisStyle:this.categoryAxisHasUnitType?[K.showTitleOnly,K.showUnitOnly,K.showBoth]:[K.showTitleOnly]}})},e.prototype.getValueAxisValues=function(t){var i=[q.log,q.linear],a=!1,r={selector:null,properties:{},objectName:"valueAxis",validValues:{axisScale:i,secAxisScale:i}};r.properties.show=this.valueAxisProperties&&null!=this.valueAxisProperties.show?this.valueAxisProperties.show:!0,this.yAxisIsCategorical||(r.properties.position=this.valueAxisProperties&&null!=this.valueAxisProperties.position?this.valueAxisProperties.position:T.left),r.properties.axisScale=this.valueAxisProperties&&null!=this.valueAxisProperties.axisScale&&a?this.valueAxisProperties.axisScale:q.linear,r.properties.start=this.valueAxisProperties?this.valueAxisProperties.start:null,r.properties.end=this.valueAxisProperties?this.valueAxisProperties.end:null,r.properties.showAxisTitle=this.valueAxisProperties&&null!=this.valueAxisProperties.showAxisTitle?this.valueAxisProperties.showAxisTitle:!0,r.properties.labelDisplayUnits=this.valueAxisProperties&&null!=this.valueAxisProperties.labelDisplayUnits?this.valueAxisProperties.labelDisplayUnits:e.LabelDisplayUnitsDefault,t.pushInstance(r).pushInstance({selector:null,properties:{axisStyle:this.valueAxisProperties&&null!=this.valueAxisProperties.axisStyle?this.valueAxisProperties.axisStyle:K.showTitleOnly,labelColor:this.valueAxisProperties?this.valueAxisProperties.labelColor:null},objectName:"valueAxis",validValues:{axisStyle:this.valueAxisHasUnitType?[K.showTitleOnly,K.showUnitOnly,K.showBoth]:[K.showTitleOnly]}})},
e.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},e.AxisGraphicsContextClassName="axisGraphicsContext",e.ClassName="enhancedScatterChart",e.MainGraphicsContextClassName="mainGraphicsContext",e.LegendLabelFontSizeDefault=9,e.LabelDisplayUnitsDefault=0,e.AxisFontSize=11,e.CrosshairTextMargin=5,e.BubbleRadius=6,e.MinSizeRange=200,e.MaxSizeRange=3e3,e.AreaOf300By300Chart=9e4,e.DataLabelXOffset=2,e.DataLabelYOffset=1.8,e.DotClasses=r("dot"),e.ImageClasses=r("img"),e.TextProperties={fontFamily:"'Segoe UI', wf_segoe-ui_normal, helvetica, arial, sans-serif",fontSize:i.toString(e.AxisFontSize)},e.CrosshairCanvasSelector=r("crosshairCanvas"),e.CrosshairLineSelector=r("crosshairLine"),e.CrosshairVerticalLineSelector=r("crosshairVerticalLine"),e.CrosshairHorizontalLineSelector=r("crosshairHorizontalLine"),e.CrosshairTextSelector=r("crosshairText"),e.MaxTranslateValue=1e25,e.MinTranslateValue=1e-25,e.DefaultBubbleOpacity=.85,e.DimmedBubbleOpacity=.4,e.ColumnCategory="Category",e.ColumnSeries="Series",e.ColumnX="X",e.ColumnY="Y",e.ColumnSize="Size",e.ColumnGradient="Gradient",e.ColumnColorFill="ColorFill",e.ColumnShape="Shape",e.ColumnImage="Image",e.ColumnRotation="Rotation",e.ColumnBackdrop="Backdrop",e.ColumnXStart="X Start",e.ColumnXEnd="X End",e.ColumnYStart="Y Start",e.ColumnYEnd="Y End",e.capabilities={dataRoles:[{name:e.ColumnCategory,kind:P.Grouping,displayName:l("Role_DisplayName_Details")},{name:e.ColumnSeries,kind:P.Grouping,displayName:l("Role_DisplayName_Legend")},{name:e.ColumnX,kind:P.Measure,displayName:l("Role_DisplayName_X")},{name:e.ColumnY,kind:P.Measure,displayName:l("Role_DisplayName_Y")},{name:e.ColumnSize,kind:P.Measure,displayName:l("Role_DisplayName_Size")},{name:e.ColumnGradient,kind:P.Measure,displayName:l("Role_DisplayName_Gradient")},{name:e.ColumnColorFill,kind:P.Grouping,displayName:"Customized Color"},{name:e.ColumnShape,kind:P.Measure,displayName:"Shape"},{name:e.ColumnImage,kind:P.Grouping,displayName:"Image"},{name:e.ColumnRotation,kind:P.Measure,displayName:"Rotation"},{name:e.ColumnBackdrop,kind:P.Grouping,displayName:"Backdrop"},{name:e.ColumnXStart,kind:P.Measure,displayName:"X Start"},{name:e.ColumnXEnd,kind:P.Measure,displayName:"X End"},{name:e.ColumnYStart,kind:P.Measure,displayName:"Y Start"},{name:e.ColumnYEnd,kind:P.Measure,displayName:"Y End"}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:1},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:0},ColorFill:{max:1},Shape:{max:1},Image:{max:0},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:0},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:1},ColorFill:{max:1},Shape:{max:1},Image:{max:0},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:1},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:0},ColorFill:{max:0},Shape:{max:0},Image:{max:1},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}},{Category:{max:1},Series:{max:0},X:{max:1},Y:{max:1},Size:{max:1},Gradient:{max:1},ColorFill:{max:0},Shape:{max:0},Image:{max:1},Rotation:{max:1},Backdrop:{max:1},"X Start":{max:1},"X End":{max:1},"Y Start":{max:1},"Y End":{max:1}}],categorical:{categories:{"for":{"in":e.ColumnCategory},dataReductionAlgorithm:{sample:{}}},values:{group:{by:e.ColumnSeries,select:[{bind:{to:e.ColumnX}},{bind:{to:e.ColumnY}},{bind:{to:e.ColumnSize}},{bind:{to:e.ColumnGradient}},{bind:{to:e.ColumnColorFill}},{bind:{to:e.ColumnShape}},{bind:{to:e.ColumnImage}},{bind:{to:e.ColumnRotation}},{bind:{to:e.ColumnBackdrop}},{bind:{to:e.ColumnXStart}},{bind:{to:e.ColumnXEnd}},{bind:{to:e.ColumnYStart}},{bind:{to:e.ColumnYEnd}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2}}}}],objects:{dataPoint:{displayName:l("Visual_DataPoint"),properties:{defaultColor:{displayName:l("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:l("Visual_DataPoint_Show_All"),type:{bool:!0}},useShape:{displayName:l("Visual_UseImage"),type:{bool:!0}},fill:{displayName:l("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:l("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:e.ColumnGradient,output:{property:"fill",selector:[e.ColumnCategory]}}}}},general:{displayName:l("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},categoryAxis:{displayName:l("Visual_XAxis"),properties:{show:{displayName:l("Visual_Show"),type:{bool:!0}},axisScale:{displayName:l("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},start:{displayName:l("Visual_Axis_Start"),type:{numeric:!0}},end:{displayName:l("Visual_Axis_End"),type:{numeric:!0}},showAxisTitle:{displayName:l("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:l("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}}}},valueAxis:{displayName:l("Visual_YAxis"),properties:{show:{displayName:l("Visual_Show"),type:{bool:!0}},position:{displayName:l("Visual_YAxis_Position"),type:{formatting:{yAxisPosition:!0}}},axisScale:{displayName:l("Visual_Axis_Scale"),type:{formatting:{axisScale:!0}}},start:{displayName:l("Visual_Axis_Start"),type:{numeric:!0}},end:{displayName:l("Visual_Axis_End"),type:{numeric:!0}},showAxisTitle:{displayName:l("Visual_Axis_Title"),type:{bool:!0}},axisStyle:{displayName:l("Visual_Axis_Style"),type:{formatting:{axisStyle:!0}}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}}}},legend:{displayName:l("Visual_Legend"),properties:{show:{displayName:l("Visual_Show"),type:{bool:!0}},position:{displayName:l("Visual_LegendPosition"),description:l("Visual_LegendPositionDescription"),type:{enumeration:A.type}},showTitle:{displayName:l("Visual_LegendShowTitle"),description:l("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:"Legend Name",description:l("Visual_LegendNameDescription"),type:{text:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},categoryLabels:{displayName:l("Visual_CategoryLabels"),properties:{show:{displayName:l("Visual_Show"),type:{bool:!0}},color:{displayName:l("Visual_LabelsFill"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},fillPoint:{displayName:l("Visual_FillPoint"),properties:{show:{displayName:l("Visual_Fill"),type:{bool:!0}}}},backdrop:{displayName:"Backdrop",properties:{show:{displayName:l("Visual_Show"),type:{bool:!0}},url:{displayName:"Image URL",type:{text:!0}}}},crosshair:{displayName:"Crosshair",properties:{show:{displayName:"Crosshair",type:{bool:!0}}}},outline:{displayName:"Outline",properties:{show:{displayName:l("Visual_Outline"),type:{bool:!0}}}}}},e.Properties=e.getPropertiesByCapabilities(e.capabilities),e}();t.EnhancedScatterChart=Z;var J=function(){function e(e){this.behaviors=e||[]}return e.prototype.bindEvents=function(e,t){for(var i=this.behaviors,a=0,r=i.length;r>a;a++)i[a].bindEvents(e.layerOptions[a],t);e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){for(var t=0,i=this.behaviors;t<i.length;t++){var a=i[t];a.renderSelection(e)}},e}();t.CustomVisualBehavior=J;var Q=function(){function e(e,t){this.dimmedBubbleOpacity=e,this.defaultBubbleOpacity=t}return e.prototype.bindEvents=function(e,t){var i=this.bubbles=e.dataPointsSelection,a=e.data;this.shouldEnableFill=(!a.sizeRange||!a.sizeRange.min)&&a.fillPoint,this.colorBorder=a.colorBorder,n(i,t)},e.prototype.renderSelection=function(e){var t=this,i=this.shouldEnableFill,a=this.colorBorder;this.bubbles.style("fill-opacity",function(a){return t.getMarkerFillOpacity(null!=a.size,i,e,a.selected)}),this.bubbles.style("stroke-opacity",function(i){return t.getMarkerStrokeOpacity(null!=i.size,a,e,i.selected)})},e.prototype.getMarkerFillOpacity=function(e,t,i,a){return e||t?i&&!a?this.dimmedBubbleOpacity:this.defaultBubbleOpacity:0},e.prototype.getMarkerStrokeOpacity=function(e,t,i,a){return e&&t?1:i&&!a?this.dimmedBubbleOpacity:this.defaultBubbleOpacity},e}();t.EnhancedScatterChartWebBehavior=Q}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){function i(){}var a,r,s,o,o=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var o;!function(o){var n=function(){function e(e,t){this.defaultViewport=e||{width:0,height:0},this.defaultMargin=t||{top:0,bottom:0,right:0,left:0}}return Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewportValue||(this.viewportValue=this.defaultViewport)},set:function(t){var i=this;this.previousOriginalViewportValue=_.clone(this.originalViewportValue),this.originalViewportValue=_.clone(t),this.setUpdateObject(t,function(e){return i.viewportValue=e},function(t){return e.restrictToMinMax(t,i.minViewport)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportCopy",{get:function(){return _.clone(this.viewport)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minViewport",{get:function(){return this.minViewportValue||{width:0,height:0}},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.minViewportValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this.marginValue||(this.marginValue=this.defaultMargin)},set:function(t){var i=this;this.setUpdateObject(t,function(e){return i.marginValue=e},e.restrictToMinMax)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportChanged",{get:function(){return!(!this.originalViewportValue||this.previousOriginalViewportValue&&this.previousOriginalViewportValue.height===this.originalViewportValue.height&&this.previousOriginalViewportValue.width===this.originalViewportValue.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewportInIsZero",{get:function(){return 0===this.viewportIn.width||0===this.viewportIn.height},enumerable:!0,configurable:!0}),e.prototype.resetMargin=function(){this.margin=this.defaultMargin},e.prototype.update=function(){this.viewportInValue=e.restrictToMinMax({width:this.viewport.width-(this.margin.left+this.margin.right),height:this.viewport.height-(this.margin.top+this.margin.bottom)},this.minViewportValue)},e.prototype.setUpdateObject=function(t,i,a){var r=this;t=_.clone(t),i(e.createNotifyChangedObject(t,function(e){a&&a(t),r.update()})),a&&a(t),this.update()},e.createNotifyChangedObject=function(e,t){var i={};return _.keys(e).forEach(function(a){return Object.defineProperty(i,a,{get:function(){return e[a]},set:function(i){e[a]=i,t(e,a)},enumerable:!0,configurable:!0})}),i},e.restrictToMinMax=function(e,t){return _.keys(e).forEach(function(i){return e[i]=Math.max(t&&t[i]||0,e[i])}),e},e}(),l=function(){function i(){this.dataPoint={}}return Object.defineProperty(i,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),i.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},i.getProperties=function(e){var t=_.merge({general:{properties:{formatString:{}}}},e.objects),i={};for(var a in t){i[a]={};for(var r in t[a].properties)i[a][r]={objectName:a,propertyName:r}}return i},i.createEnumTypeFromEnum=function(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i=!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))},i.getValueFnByType=function(t){switch(_.keys(t)[0]){case"fill":return e.DataViewObjects.getFillColor;default:return e.DataViewObjects.getValue}},i.enumerateObjectInstances=function(e,i,a){void 0===e&&(e=new this);var r=new t.ObjectEnumerationBuilder,s=e&&e[i.objectName];if(!s)return r;var o={objectName:i.objectName,selector:null,properties:{}};for(var n in s)_.has(s,n)&&(o.properties[n]=s[n]);return r.pushInstance(o),r},i.prototype.createOriginalSettings=function(){this.originalSettings=_.cloneDeep(this)},i}();o.GlobeMapSettings=l;var c=function(){function e(){this.Category=null,this.Series=null,this.X=null,this.Y=null,this.Height=null,this.Heat=null}return e.getColumnSources=function(e){return this.getColumnSourcesT(e)},e.getTableValues=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getColumnSourcesT(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.getCategoricalValues=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[],r=t&&a.source&&this.getSeriesValues(e);return t&&_.mapValues(new this,function(e,t){return _.toArray(i).concat(_.toArray(a)).filter(function(e){return e.source.roles&&e.source.roles[t]}).map(function(e){return e.values})[0]||a.source&&a.source.roles&&a.source.roles[t]&&r})},e.getSeriesValues=function(e){return e&&e.categorical&&e.categorical.values&&e.categorical.values.map(function(e){return t.converterHelper.getSeriesName(e.source)})},e.getCategoricalColumns=function(e){var t=e&&e.categorical,i=t&&t.categories||[],a=t&&t.values||[];return t&&_.mapValues(new this,function(e,t){return i.filter(function(e){return e.source.roles&&e.source.roles[t]})[0]||a.source&&a.source.roles&&a.source.roles[t]&&a||a.filter(function(e){return e.source.roles&&e.source.roles[t]})})},e.getGroupedValueColumns=function(e){var t=this,i=e&&e.categorical,a=i&&i.values,r=a&&a.grouped();return r&&r.map(function(e){return _.mapValues(new t,function(t,i){return e.values.filter(function(e){return e.source.roles[i]})[0]})})},e.getColumnSourcesT=function(e){var t=e&&e.metadata&&e.metadata.columns;return t&&_.mapValues(new this,function(e,i){return t.filter(function(e){return e.roles&&e.roles[i]})[0]})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();o.GlobeMapColumns=c;var u=function(){function o(){this.locationsToLoad=0,this.locationsLoaded=0,this.renderLoopEnabled=!0,this.needsRender=!1}return Object.defineProperty(o.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),o.converter=function(e,i,a){var r=c.getCategoricalColumns(e);if(!r||!r.Category||_.isEmpty(r.Category.values)||_.isEmpty(r.Height)&&_.isEmpty(r.Heat))return null;var s,n,u,h,p,d=l.getProperties(o.capabilities),g=o.parseSettings(e),m=c.getGroupedValueColumns(e),y=[],f=[],v=[],x=new t.ColorHelper(a,d.dataPoint.fill);if(r.Category&&r.Category.values){v=r.Category.values;var b=r.Category.source.type;s=b.category?b.category.toLowerCase():""}else v=[];if(_.isEmpty(r.Height))u=new Array(v.length),n=new Array(v.length);else if(m.length>1){n=new Array(v.length),u=new Array(v.length),h=new Array(v.length),f=new Array(m.length);for(var S=0;S<m.length;S++){var w=m[S].Height.values;f[S]=o.createDataPointForEnumeration(e,m[S].Height.source,S,null,x,a);for(var C=0;C<w.length;C++)n[C]||(n[C]=0),n[C]+=w[C]?w[C]:0,u[C]||(u[C]=[]),u[C][S]=w[C],h[C]||(h[C]=[]),h[C][S]={displayName:r.Series&&r.Series.source.displayName,value:e.categorical.values.grouped()[S].name,dataPointValue:w[C]}}for(var S=0;S<m.length;S++)for(var w=m[S].Height.values,C=0;C<w.length;C++)u[C][S]=w[C]/n[C]}else n=r.Height[0].values,u=new Array(m.length),f[0]=o.createDataPointForEnumeration(e,m[0].Height.source,0,e.metadata,x,a);if(_.isEmpty(r.Heat))p=new Array(v.length);else if(m.length>1){p=new Array(v.length);for(var S=0;S<m.length;S++)for(var w=m[S].Heat.values,C=0;C<w.length;C++)p[C]||(p[C]=0),p[C]+=w[C]?w[C]:0}else p=r.Heat[0].values;for(var P=Math.max.apply(null,n)||1,A=Math.max.apply(null,p)||1,D=t.valueFormatter.create({format:!_.isEmpty(r.Heat)&&r.Heat[0].source.format,value:p[0],value2:p[1]}),T=t.valueFormatter.create({format:!_.isEmpty(r.Height)&&r.Height[0].source.format,value:n[0],value2:n[1]}),S=0,V=v.length;V>S;++S)if("string"==typeof v[S]){var N=v[S].toLowerCase(),L=N+"/"+s,M=_.isEmpty(r.X)||_.isEmpty(r.Y)?i[L]:{longitude:r.X[0].values[S]||0,latitude:r.Y[0].values[S]||0},k=n[S]/P,I=p[S]/A,O={location:M,placeKey:L,place:N,locationType:s,height:k?k||.01:void 0,heightBySeries:u[S],seriesToolTipData:h?h[S]:void 0,heat:I||0,toolTipData:{location:{displayName:r.Category&&r.Category.source.displayName,value:v[S]},height:{displayName:!_.isEmpty(r.Height)&&r.Height[0].source.displayName,value:T.format(n[S])},heat:{displayName:!_.isEmpty(r.Heat)&&r.Heat[0].source.displayName,value:D.format(p[S])}}};y.push(O)}return{dataView:e,dataPoints:y,seriesDataPoints:f,settings:g}},o.parseSettings=function(e){var t=l.parse(e,o.capabilities);return t.createOriginalSettings(),t},o.createDataPointForEnumeration=function(e,i,a,r,s,o){var n=e.categorical.values.grouped()[a],l=t.converterHelper.getFormattedLegendLabel(i,n.values,null),c=t.SelectionId.createWithId(n.identity),u=t.converterHelper.getSeriesName(i),h=n.objects,p=h&&h.dataPoint?h.dataPoint.fill.solid.color:r&&r.objects?s.getColorForMeasure(r.objects,""):o.getColorByIndex(a).value;return{label:l,identity:c,category:u,color:p,selected:null}},o.prototype.enumerateObjectInstances=function(e){var i=l.enumerateObjectInstances(this.settings&&this.settings.originalSettings,e,o.capabilities);switch(e.objectName){case"dataPoint":if(this.data&&this.data.seriesDataPoints)for(var a=0;a<this.data.seriesDataPoints.length;a++){var r=this.data.seriesDataPoints[a];i.pushInstance({objectName:"dataPoint",displayName:r.label,selector:t.ColorHelper.normalizeSelector(r.identity.getSelector()),properties:{fill:{solid:{color:r.color}}}})}}return i.complete()},o.prototype.init=function(e){this.container=e.element,this.layout=new n(e.viewport),this.readyToRender=!1,this.globeMapLocationCache||(this.globeMapLocationCache={}),this.style=e.style,this.colors=this.style.colorPalette.dataColors,a||i(),a&&this.setup()},o.prototype.setup=function(){this.initTextures(),this.initMercartorSphere(),this.initZoomControl(),this.initScene(),this.initHeatmap(),this.readyToRender=!0,this.initRayCaster()},o.prototype.initScene=function(){var e=this,t=new a.Clock,i=this.renderer=new a.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});this.container.append(i.domElement),this.domElement=i.domElement,this.camera=new a.PerspectiveCamera(35,this.layout.viewportIn.width/this.layout.viewportIn.height,.1,1e4);var r=this.orbitControls=new a.OrbitControls(this.camera,this.domElement);this.scene=new a.Scene,i.setSize(this.layout.viewportIn.width,this.layout.viewportIn.height),i.setClearColor(12240082,1),this.camera.position.z=o.GlobeSettings.cameraRadius,r.maxDistance=o.GlobeSettings.cameraRadius,r.minDistance=o.GlobeSettings.earthRadius+1,r.rotateSpeed=o.GlobeSettings.rotateSpeed,r.zoomSpeed=o.GlobeSettings.zoomSpeed,r.autoRotate=o.GlobeSettings.autoRotate;var s=new a.AmbientLight(0),n=new a.DirectionalLight(16777215,.4),l=new a.DirectionalLight(16777215,.4),c=this.earth=this.createEarth();this.scene.add(s),this.scene.add(n),this.scene.add(l),this.scene.add(c),n.position.set(20,20,20),l.position.set(0,0,-20);var u=this,h=function(){try{if(u.renderLoopEnabled&&requestAnimationFrame(h),!u.shouldRender())return;r.update(t.getDelta()),u.setEarthTexture(),u.intersectBars(),u.heatmap&&u.heatmap.display&&u.heatmap.display(),i.render(e.scene,e.camera),u.needsRender=!1}catch(a){}};requestAnimationFrame(h)},o.prototype.shouldRender=function(){return this.readyToRender&&this.needsRender},o.prototype.createEarth=function(){var e=new o.MercartorSphere(o.GlobeSettings.earthRadius,o.GlobeSettings.earthSegments,o.GlobeSettings.earthSegments),t=new a.MeshPhongMaterial({map:this.mapTextures[0],side:a.DoubleSide,shininess:1,emissive:11184810});return new a.Mesh(e,t)},o.prototype.zoomClicked=function(e){this.orbitControls.enabled!==!1&&this.orbitControls.enableZoom!==!1&&(-1===e?this.orbitControls.constraint.dollyOut(Math.pow(.95,o.GlobeSettings.zoomSpeed)):1===e&&this.orbitControls.constraint.dollyIn(Math.pow(.95,o.GlobeSettings.zoomSpeed)),this.orbitControls.update(),this.animateCamera(this.camera.position))},o.prototype.rotateCam=function(e,t){this.orbitControls.enabled!==!1&&this.orbitControls.enableRotate!==!1&&(this.orbitControls.constraint.rotateLeft(2*Math.PI*e/this.domElement.offsetHeight*o.GlobeSettings.rotateSpeed),this.orbitControls.constraint.rotateUp(2*Math.PI*t/this.domElement.offsetHeight*o.GlobeSettings.rotateSpeed),this.orbitControls.update(),this.animateCamera(this.camera.position))},o.prototype.initTextures=function(){var e=this;if(!s){s=[];for(var t=2;5>=t;++t){var i=this.getBingMapCanvas(t);s.push(i)}}var r=function(t){var i=new a.Texture(t.get(0));return i.needsUpdate=!0,t.on("ready",function(t,a){i.needsUpdate=!0,e.needsRender=!0}),i};this.mapTextures=[];for(var o=0;o<s.length;++o)this.mapTextures.push(r(s[o]))},o.prototype.initHeatmap=function(){try{var e=this.heatmap=new r({width:o.GlobeSettings.heatmapSize,height:o.GlobeSettings.heatmapSize,intensityToAlpha:!0})}catch(t){}var i=this.heatTexture=new a.Texture(e.canvas);i.needsUpdate=!0;var s=new a.MeshBasicMaterial({map:i,transparent:!0}),n=new a.SphereGeometry(o.GlobeSettings.earthRadius+.01,o.GlobeSettings.earthSegments,o.GlobeSettings.earthSegments),l=new a.Mesh(n,s);window.heatmap=e,window.heatmapTexture=i,this.scene.add(l)},o.prototype.setEarthTexture=function(){if(this.camera){var e,t=o.GlobeSettings.cameraRadius-o.GlobeSettings.earthRadius,i=(this.camera.position.length()-o.GlobeSettings.earthRadius)/t;e=.2>=i?this.mapTextures[3]:.4>=i?this.mapTextures[2]:.6>=i?this.mapTextures[1]:this.mapTextures[0],this.earth.material.map!==e&&(this.earth.material.map=e),this.selectedBar?this.orbitControls.rotateSpeed=o.GlobeSettings.rotateSpeed:this.orbitControls.rotateSpeed=o.GlobeSettings.rotateSpeed*i}},o.prototype.update=function(t){if(this.needsRender=!0,this.layout.viewport=t.viewport,this.layout.viewportChanged&&this.camera&&this.renderer&&(this.camera.aspect=this.layout.viewportIn.width/this.layout.viewportIn.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.layout.viewportIn.width,this.layout.viewportIn.height)),t.type===e.VisualUpdateType.Data){this.cleanHeatAndBar();var i=o.converter(t.dataViews[0],this.globeMapLocationCache,this.colors);i&&(this.data=i,this.renderMagic())}},o.prototype.cleanHeatAndBar=function(){this.heatmap.clear(),this.heatTexture.needsUpdate=!0,this.barsGroup&&this.scene.remove(this.barsGroup)},o.prototype.renderMagic=function(){var e=this;if(this.data){if(this.data.dataPoints.forEach(function(t){return e.geocodeRenderDatum(t)}),!this.readyToRender)return void this.defferedRender();this.heatmap.clear(),this.barsGroup&&this.scene.remove(this.barsGroup),this.barsGroup=new a.Object3D,this.scene.add(this.barsGroup),this.averageBarVector=new a.Vector3;for(var t=0,i=this.data.dataPoints.length;i>t;++t){var r=this.data.dataPoints[t];if(r.location&&void 0!==r.location.longitude&&void 0!==r.location.latitude){if(r.heat>.001){r.heat<.1&&(r.heat=.1);var s=(180+r.location.longitude)/360*o.GlobeSettings.heatmapSize,n=(1-(90+r.location.latitude)/180)*o.GlobeSettings.heatmapSize;this.heatmap.addPoint(s,n,o.GlobeSettings.heatPointSize,r.heat*o.GlobeSettings.heatIntensity)}if(r.height>=0){r.height<.01&&(r.height=.01);var l=r.location.latitude/180*Math.PI,c=r.location.longitude/180*Math.PI,s=Math.cos(c)*Math.cos(l),u=-Math.sin(c)*Math.cos(l),n=Math.sin(l),h=new a.Vector3(s,n,u);this.averageBarVector.add(h);var p=o.GlobeSettings.barHeight*r.height,d=[],g=[];if(r.heightBySeries)for(var m=0;m<r.heightBySeries.length;m++)r.heightBySeries[m]&&d.push(r.heightBySeries[m]),g.push(r.seriesToolTipData[m]);else d.push(1);for(var y=0,f=0;f<d.length;f++){y+=d[f];var v=new a.CubeGeometry(o.GlobeSettings.barWidth,o.GlobeSettings.barWidth,p*d[f]),x=new a.Mesh(v,this.getBarMaterialByIndex(f));x.position=h.clone().multiplyScalar(o.GlobeSettings.earthRadius+p/2*y),x.lookAt(h),x.toolTipData=0===g.length?r.toolTipData:this.getToolTipDataForSeries(r.toolTipData,g[f]),this.barsGroup.add(x),y+=d[f]}}}}this.barsGroup.children.length>0&&this.camera&&(this.averageBarVector.multiplyScalar(1/this.barsGroup.children.length),this.locationsLoaded===this.locationsToLoad&&this.animateCamera(this.averageBarVector)),this.heatmap.update(),this.heatmap.blur(),this.heatTexture.needsUpdate=!0,this.needsRender=!0}},o.prototype.getBarMaterialByIndex=function(e){return new a.MeshPhongMaterial({color:this.data.seriesDataPoints[e].color})},o.prototype.getToolTipDataForSeries=function(e,t){var i=jQuery.extend(!0,{series:{displayName:t.displayName,value:t.value}},e);return i.height.value=t.dataPointValue,i},o.prototype.geocodeRenderDatum=function(i){var a=this;if(!i.location){this.globeMapLocationCache[i.placeKey]={},this.locationsToLoad++;try{var r=e.visuals.BI.Services.GeocodingManager.geocode}catch(s){r=t.services.geocode}r&&r(i.place,i.locationType).always(function(e){a.globeMapLocationCache[i.placeKey]=e,a.locationsLoaded++,i.location=e,a.defferedRender()})}},o.prototype.defferedRender=function(){var e=this;this.deferredRenderTimerId||(this.deferredRenderTimerId=setTimeout(function(){e.deferredRenderTimerId=null,e.renderMagic()},500))},o.prototype.initRayCaster=function(){var e=this;this.rayCaster=new a.Raycaster;var t,i=this.mousePosNormalized=new a.Vector2,r=this.mousePos=new a.Vector2,s=this.container.get(0);$(this.domElement).on("mousemove",function(t){var a=s.getBoundingClientRect();r.x=t.clientX,r.y=t.clientY,i.x=(t.clientX-a.left)/a.width*2-1,i.y=2*-((t.clientY-a.top)/a.height)+1,e.needsRender=!0}).on("mousedown",function(e){t=Date.now()}).on("mouseup",function(i){Date.now()-t>o.GlobeSettings.clickInterval||(e.hoveredBar&&i.shiftKey?(e.selectedBar=e.hoveredBar,e.animateCamera(e.selectedBar.position,function(){e.selectedBar&&(e.orbitControls.center.copy(e.selectedBar.position.clone().normalize().multiplyScalar(o.GlobeSettings.earthRadius)),e.orbitControls.minDistance=1)})):e.selectedBar&&(e.animateCamera(e.selectedBar.position,function(){e.orbitControls.center.set(0,0,0),e.orbitControls.minDistance=o.GlobeSettings.earthRadius+1}),e.selectedBar=null))}).on("mousewheel DOMMouseScroll",function(t){if(e.needsRender=!0,e.orbitControls.enabled&&e.orbitControls.enableZoom){e.heatTexture.needsUpdate=!0,t=t.originalEvent;var i=t.wheelDelta>0||t.detail<0?1:-1,a=i>0?o.GlobeSettings.heatmapScaleOnZoom:1/o.GlobeSettings.heatmapScaleOnZoom;e.heatmap.multiply(a),e.heatmap.update()}})},o.prototype.intersectBars=function(){if(this.rayCaster&&this.barsGroup){var e=this.rayCaster;e.setFromCamera(this.mousePosNormalized,this.camera);var i=e.intersectObjects(this.barsGroup.children);if(i&&i.length>0){var a=i[0].object;if(!a||!a.toolTipData)return;var r=a.toolTipData,s=[];r.location.displayName&&s.push(r.location),r.series&&s.push(r.series),r.height.displayName&&s.push(r.height),r.heat.displayName&&s.push(r.heat),this.hoveredBar=a,t.TooltipManager.ToolTipInstance.show(s,{x:this.mousePos.x,y:this.mousePos.y,width:0,height:0})}else this.hoveredBar=null,t.TooltipManager.ToolTipInstance.hide()}},o.prototype.animateCamera=function(e,t){var i=this;if(this.camera){var r=Date.now(),s=o.GlobeSettings.cameraAnimDuration,n=r+s,l=this.camera.position.clone().normalize(),c=e.clone().normalize(),u=this.camera.position.length(),h=function(e){return e*=2,1>e?e*e*e/2:(e-=2,(e*e*e+2)/2)},p=function(){var e=Date.now(),o=(e-r)/s;o>1&&(o=1),o=h(o);var d=(new a.Vector3).add(l.clone().multiplyScalar(1-o)).add(c.clone().multiplyScalar(o)).normalize().multiplyScalar(u);i.camera.position=d,n>e?requestAnimationFrame(p):t&&t(),i.needsRender=!0};requestAnimationFrame(p)}},o.prototype.destroy=function(){if(clearTimeout(this.deferredRenderTimerId),this.renderLoopEnabled=!1,this.scene=null,this.heatmap=null,this.heatTexture=null,this.camera=null,this.renderer){if(this.renderer.context){var e=this.renderer.context.getExtension("WEBGL_lose_context");e&&e.loseContext(),this.renderer.context=null}this.renderer.domElement=null}this.renderer=null,this.data=null,this.barsGroup=null,this.orbitControls&&this.orbitControls.dispose(),this.orbitControls=null,this.domElement&&$(this.domElement).off("mousemove mouseup mousedown mousewheel DOMMouseScroll"),this.domElement=null,this.container&&this.container.empty()},o.prototype.initZoomControl=function(){var e=this,t=17,i=8.5*t,a=8.5*t,r=3*t,s=t+3,o=2*t,n={position:"absolute",left:"calc(100% - "+i+"px)",top:"calc(100% - "+a+"px)",zIndex:"1000"},l=d3.select(this.container[0]).append("div").style(n);this.zoomControl=l.append("svg").attr({width:i,height:a});var c=this.zoomControl.append("g").on("click",function(){return e.rotateCam(0,-5)});c.append("circle").attr({cx:r+o,cy:s+2*o,r:t,fill:"white",opacity:.5,stroke:"gray"}),c.append("path").attr({d:"M"+(r+2*t)+" "+(s+4.7*t)+" l12 -20 a40,70 0 0,1 -24,0z",fill:"gray"});var u=this.zoomControl.append("g").on("click",function(){return e.rotateCam(5,0)});u.append("circle").attr({cx:r,cy:s+o,r:t,fill:"white",stroke:"gray",opacity:.5}),u.append("path").attr({d:"M"+(r-t/1.5)+" "+(s+2*t)+" l20 -12 a70,40 0 0,0 0,24z",fill:"gray"});var h=this.zoomControl.append("g").on("click",function(){return e.rotateCam(0,5)});h.append("circle").attr({cx:r+o,cy:s,r:t,fill:"white",stroke:"gray",opacity:.5}),h.append("path").attr({d:"M"+(r+2*t)+" "+(s-t/1.5)+" l12 20 a40,70 0 0,0 -24,0z",fill:"gray"});var p=this.zoomControl.append("g").on("click",function(){return e.rotateCam(-5,0)});p.append("circle").attr({cx:r+2*o,cy:s+o,r:t,fill:"white",stroke:"gray",opacity:.5}),p.append("path").attr({d:"M"+(r+4.7*t)+" "+(s+2*t)+" l-20 -12 a70,40 0 0,1 0,24z",fill:"gray"});var d=this.zoomControl.append("g").on("click",function(){return e.zoomClicked(-1)});d.append("circle").attr({cx:r+4*t,cy:s+6*t,r:t,fill:"white",stroke:"gray",opacity:.5}),d.append("rect").attr({x:r+3.5*t,y:s+5.9*t,width:t,height:t/3,fill:"gray"}),d.append("rect").attr({x:r+4*t-t/6,y:s+5.55*t,width:t/3,height:t,fill:"gray"});var g=this.zoomControl.append("g").on("click",function(){return e.zoomClicked(1)});g.append("circle").attr({cx:r,cy:s+6*t,r:t,fill:"white",stroke:"gray",opacity:"0.50"}),g.append("rect").attr({x:r-t/2,y:s+5.9*t,width:t,height:t/3,fill:"gray"})},o.prototype.initMercartorSphere=function(){if(!o.MercartorSphere){var e=function(e,t,i){function r(e,t,i){return(1-i)*e+i*t}function s(e,t,i){var s=2*Math.PI,o=Math.PI,n=this.radius,l=-n*Math.cos(e*s)*Math.sin(t*o),c=-n*Math.cos(t*o),u=n*Math.sin(e*s)*Math.sin(t*o),h=e*n*2-n,p=t*n*2-n,d=0,g=r(l,h,i),m=r(c,p,i),y=r(u,d,i);return new a.Vector3(g,m,y)}function o(e,t,i){var r=90*(t-.5)*2/180*Math.PI,s=Math.sin(r),o=.5+.25*Math.log((1+s)/(1-s))/Math.PI;return new a.Vector2(e,o)}a.Geometry.call(this),this.radius=e,this.widthSegments=t,this.heightSegments=i,this.t=0;var n,l,c=[],u=[];for(l=0;i>=l;l++){var h=[],p=[];for(n=0;t>=n;n++){var d=n/t,g=l/i;this.vertices.push(s.call(this,d,g,this.t)),p.push(o.call(this,d,g,this.t)),h.push(this.vertices.length-1)}c.push(h),u.push(p)}for(l=0;l<this.heightSegments;l++)for(n=0;n<this.widthSegments;n++){var m=c[l][n+1],y=c[l][n],f=c[l+1][n],v=c[l+1][n+1],x=this.vertices[m].clone().normalize(),b=this.vertices[y].clone().normalize(),S=this.vertices[f].clone().normalize(),w=this.vertices[v].clone().normalize(),C=u[l][n+1].clone(),P=u[l][n].clone(),A=u[l+1][n].clone(),D=u[l+1][n+1].clone(),T=[x,b,S,w];
this.faces.push(new a.Face4(m,y,f,v,T)),this.faceVertexUvs[0].push([C,P,A,D])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new a.Sphere(new a.Vector3,e)};e.prototype=Object.create(a.Geometry.prototype),o.MercartorSphere=e}},o.prototype.getBingMapCanvas=function(e){function t(a,r){e>=a&&(a===e&&i(r),t(a+1,r+"0"),t(a+1,r+"1"),t(a+1,r+"2"),t(a+1,r+"3"))}function i(t){var i="https://t{server}.tiles.virtualearth.net/tiles/r{quad}.jpeg?g=0&mkt={language}",s=7,l=Math.round(Math.random()*s),u=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language,p=i.replace("{server}",l).replace("{quad}",t).replace("{language}",u),d=a(t),g=new Image;g.onload=function(){n++,h.drawImage(g,d.x*r,d.y*r,r,r),n===o&&c.trigger("ready",e)},g.crossOrigin="",g.src=p}function a(e){for(var t=0,i=0,a=e.length-1,r=a;r>=0;r--){var s=e.charAt(r),o=Math.pow(2,a-r);"1"===s?t+=o:"2"===s?i+=o:"3"===s&&(t+=o,i+=o)}return{x:t,y:i}}var r=256,s=Math.pow(2,e),o=s*s,n=0,l=r*s,c=$("<canvas/>").attr({width:l,height:l}),u=c.get(0),h=u.getContext("2d");return t(0,""),c},o.GlobeSettings={autoRotate:!1,earthRadius:30,cameraRadius:100,earthSegments:100,heatmapSize:1e3,heatPointSize:7,heatIntensity:10,heatmapScaleOnZoom:.95,barWidth:.3,barHeight:5,rotateSpeed:.5,zoomSpeed:.8,cameraAnimDuration:1e3,clickInterval:200},o.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:e.data.createDisplayNameGetter("Role_DisplayName_Location"),preferredTypes:[{geography:{address:!0}},{geography:{city:!0}},{geography:{continent:!0}},{geography:{country:!0}},{geography:{county:!0}},{geography:{place:!0}},{geography:{postalCode:!0}},{geography:{region:!0}},{geography:{stateOrProvince:!0}}]},{name:"Series",kind:e.VisualDataRoleKind.Grouping,displayName:"Legend"},{name:"X",kind:e.VisualDataRoleKind.Measure,displayName:"Longitude",description:"Use to override the longitude of locations",preferredTypes:[{geography:{longitude:!0}}]},{name:"Y",kind:e.VisualDataRoleKind.Measure,displayName:"Latitude",description:"Use to override the latitude of locations",preferredTypes:[{geography:{latitude:!0}}]},{name:"Height",kind:e.VisualDataRoleKind.Measure,displayName:"Bar Height"},{name:"Heat",kind:e.VisualDataRoleKind.Measure,displayName:"Heat Intensity"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),properties:{defaultColor:{displayName:e.data.createDisplayNameGetter("Visual_DefaultColor"),type:{fill:{solid:{color:!0}}}},showAllDataPoints:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint_Show_All"),type:{bool:!0}},fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fillRule:{displayName:e.data.createDisplayNameGetter("Visual_Gradient"),type:{fillRule:{}},rule:{inputRole:"Gradient",output:{property:"fill",selector:["Category"]}}}}}},dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:1},Height:{max:1},Heat:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{bind:{to:"Height"}},{bind:{to:"Heat"}},{bind:{to:"X"}},{bind:{to:"Y"}}],dataReductionAlgorithm:{top:{}}}},rowCount:{preferred:{min:2}}}}],sorting:{custom:{}}},o}();o.GlobeMap=u}(o=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(o||(o={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.CssConstants.createClassAndSelector,s=a.PixelConverter,o=function(){function e(){}return e.prototype.bindEvents=function(e,t){var i=this.selection=e.selection,a=e.clearCatcher;i.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey),d3.event.stopPropagation()}),a.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){this.selection.style("opacity",function(t){return e&&!t.selected?n.DimmedAreaFillOpacity:n.NodeFillOpacity})},e}();i.RadarChartWebBehavior=o;var n=function(){function i(e){e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),e.margin&&(this.margin=e.margin))}return i.converter=function(e,r){if(!(e&&e.categorical&&e.categorical.categories&&e.categorical.categories.length>0&&e.categorical.categories[0]&&e.categorical.values&&e.categorical.values.length>0&&r))return{legendData:{dataPoints:[]},settings:{showLegend:!0},series:[],dataLabelsSettings:t.dataLabelUtils.getDefaultPointLabelSettings()};for(var s=e.categorical,o=s.values,n=s&&s.values?s.values.grouped():null,l=[],c=new t.ColorHelper(r,i.Properties.dataPoint.fill),u={fontSize:8.25,dataPoints:[],title:""},h=i.parseSettings(e),p=i.parseLabelSettings(e),d=0,g=o.length;g>d;d++){var m,y,f,v=r.getColorByIndex(d).value,x=[],b=n&&n.length>d&&n[d].values?n[d]:null;if(o[d].source){var S=o[d].source;if(S.queryName&&(y=S.queryName,m=t.SelectionId.createWithMeasure(y)),S.displayName&&(f=S.displayName),S.objects){var w=S.objects;v=c.getColorForMeasure(w,y)}}u.dataPoints.push({label:f,color:v,icon:t.LegendIcon.Box,selected:!1,identity:m});for(var C=0,P=o[d].values.length;P>C;C++){var A=t.SelectionIdBuilder.builder().withMeasure(y).withCategory(s.categories[0],C).withSeries(e.categorical.values,b).createSelectionId(),D=t.TooltipBuilder.createTooltipInfo(i.formatStringProp,s,s.categories[0].values[C],o[d].values[C],null,null,d),T=t.valueFormatter.getFormatString(s.values[d].source,i.formatStringProp),V=a.PixelConverter.fromPoint(p.fontSize);x.push({x:C,y:o[d].values[C],color:v,identity:A,selected:!1,tooltipInfo:D,value:o[d].values[C],labelFormatString:T,labelFontSize:V})}x.length>0&&l.push({fill:v,name:f,data:x,identity:m})}return{legendData:u,settings:h,series:l,dataLabelsSettings:p}},i.prototype.init=function(e){var a=e.element;this.svg||(this.svg=d3.select(a.get(0)).append("svg"),this.svg.style("position","absolute")),this.margin||(this.margin=i.DefaultMargin),this.svg.classed(i.VisualClassName,!0),this.interactivityService=t.createInteractivityService(e.host),this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.legend=t.createLegend(a,this.isInteractiveChart,this.interactivityService,!0,t.LegendPosition.Top),this.colors=e.style.colorPalette.dataColors,this.mainGroupElement=this.svg.append("g"),this.segments=this.mainGroupElement.append("g").classed(i.Segments["class"],!0),this.zeroSegment=this.mainGroupElement.append("g").classed(i.ZeroSegment["class"],!0),this.axis=this.mainGroupElement.append("g").classed(i.Axis["class"],!0),this.chart=this.mainGroupElement.append("g").classed(i.Chart["class"],!0)},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var a=e.dataViews[0];this.radarChartData=i.converter(a,this.colors);var r,s=[],o=this.radarChartData.series,n=t.AnimatorCommon.GetAnimationDuration(this.animator,e.suppressAnimations);a.categorical&&a.categorical.categories&&a.categorical.categories[0]&&a.categorical.categories[0].values&&(s=a.categorical.categories[0].values),a.metadata&&a.metadata.columns&&a.metadata.columns.length>0&&(r=a.metadata.columns[0]),this.viewport={height:e.viewport.height>0?e.viewport.height:0,width:e.viewport.width>0?e.viewport.width:0},this.parseLegendProperties(a),this.renderLegend(this.radarChartData),this.updateViewport(),this.svg.attr({height:this.viewport.height,width:this.viewport.width});var l=this.mainGroupElement;l.attr("transform",t.SVGUtil.translate(this.viewport.width/2,this.viewport.height/2));var c=this.viewport.width-this.margin.left-this.margin.right,u=this.viewport.height-this.margin.top-this.margin.bottom;this.angle=i.Radians/s.length,this.radius=i.SegmentFactor*i.Scale*Math.min(c,u)/2,this.drawCircularSegments(s),this.drawAxes(s),this.drawAxesLabels(s,r),this.drawChart(o,n),this.drawDataLabels(o),this.drawZeroCircularSegment(s),0!==this.zeroPointRadius?this.drawZeroLabel():this.mainGroupElement.selectAll(i.ZeroLabel.selector).remove()}},i.prototype.getRadarChartLabelLayout=function(e,i){var a=t.dataLabelUtils.createColumnFormatterCacheManager(),r=this.angle,o=this.viewport,n=this.viewport.height/2,l=this.viewport.width/2,c=this.calculateChartDomain(this.radarChartData.series);return{labelText:function(r){var s=a.getOrCreate(r.labelFormatString,e);if(0===e.displayUnits){var n=_.max(i,function(e){return e.value}),l=n.value>0?n.value:0;s=a.getOrCreate(r.labelFormatString,e,l)}return t.dataLabelUtils.getLabelFormattedText({label:s.format(r.value),maxWidth:o.width,fontSize:e.fontSize})},labelLayout:{x:function(e){return-1*c(e.y)*Math.sin(e.x*r)+l},y:function(e){return-1*c(e.y)*Math.cos(e.x*r)+n-7}},filter:function(e){return null!=e&&null!=e.value},style:{fill:e.labelColor,"font-size":function(t){return s.fromPoint(e.fontSize)}}}},i.prototype.drawCircularSegments=function(e){for(var a=[],r=this.angle,s=i.SegmentFactor,o=i.SegmentLevels,n=this.radius,l=0;o-1>l;l++)for(var c=n*((l+1)/o),u=-1*c,h=0;h<e.length;h++)a.push({x1:c*(1-s*Math.sin(h*r)),y1:c*(1-s*Math.cos(h*r)),x2:c*(1-s*Math.sin((h+1)*r)),y2:c*(1-s*Math.cos((h+1)*r)),translate:t.SVGUtil.translate(u,u)});var p=this.mainGroupElement.select(i.Segments.selector).selectAll(i.SegmentNode.selector).data(a);p.enter().append("svg:line").classed(i.SegmentNode["class"],!0),p.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},transform:function(e){return e.translate}}),p.exit().remove()},i.prototype.drawDataLabels=function(e){var i=this.getAllDataPointsList(e);if(this.radarChartData.dataLabelsSettings.show){var a=this.getRadarChartLabelLayout(this.radarChartData.dataLabelsSettings,i),r=this.viewport,s=t.dataLabelUtils.drawDefaultLabelsForDataPointChart(i,this.mainGroupElement,a,r);s.attr("transform",t.SVGUtil.translate(-(r.width/2),-(r.height/2)))}else t.dataLabelUtils.cleanDataLabels(this.mainGroupElement)},i.prototype.drawAxes=function(e){var t=this.angle,a=-1*this.radius,r=this.mainGroupElement.select(i.Axis.selector).selectAll(i.AxisNode.selector),s=r.data(e);s.enter().append("svg:line"),s.attr({x1:0,y1:0,x2:function(e,i){return a*Math.sin(i*t)},y2:function(e,i){return a*Math.cos(i*t)}}).classed(i.AxisNode["class"],!0),s.exit().remove()},i.prototype.drawAxesLabels=function(a,r){var s=this,o=this.angle,n=-1*this.radius,l=a.length,c=t.valueFormatter.create({format:t.valueFormatter.getFormatString(r,i.formatStringProp,!0),value:a[0],value2:a[l-1]}),u=this.mainGroupElement.select(i.Axis.selector).selectAll(i.AxisLabel.selector),h=u.data(a);h.enter().append("svg:text"),h.attr({"text-anchor":"middle",dy:"1.5em",transform:t.SVGUtil.translate(0,-10),x:function(e,t){return(n-30)*Math.sin(t*o)},y:function(e,t){return(n-20)*Math.cos(t*o)}}).text(function(t){var a={fontFamily:i.AxesLabelsFontFamily,fontSize:i.AxesLabelsfontSize,text:c.format(t)};return e.TextMeasurementService.getTailoredTextOrDefault(a,Math.min(i.AxesLabelsMaxWidth,s.viewport.width))}).classed(i.AxisLabel["class"],!0),h.exit().remove()},i.prototype.drawChart=function(e,a){var r=this.angle,s=5,n=this.getDataPoints(e),l=d3.layout.stack(),c=l(n),u=this.calculateChartDomain(e),h=function(e){return e.map(function(e){var t=-1*u(e.y)*Math.sin(e.x*r),i=-1*u(e.y)*Math.cos(e.x*r);return t+","+i}).join(" ")},p=this.chart.selectAll(i.ChartArea.selector).data(c);p.enter().append("g").classed(i.ChartArea["class"],!0);var d=p.selectAll(i.ChartPolygon.selector).data(function(e){return e&&e.length>0?[e]:[]});d.enter().append("polygon").classed(i.ChartPolygon["class"],!0),d.style("fill",function(e){return e[0].color}).style("opacity",i.DimmedAreaFillOpacity).on("mouseover",function(e){d3.select(this).transition().duration(a).style("opacity",i.AreaFillOpacity)}).on("mouseout",function(e){d3.select(this).transition().duration(a).style("opacity",i.DimmedAreaFillOpacity)}).attr("points",h),d.exit().remove(),p.exit().remove();var g=this.chart.selectAll(i.ChartNode.selector).data(c);g.enter().append("g").classed(i.ChartNode["class"],!0);var m=g.selectAll(i.ChartDot.selector).data(function(e){return e.filter(function(e){return null!=e.y})});m.enter().append("svg:circle").classed(i.ChartDot["class"],!0),m.attr("r",s).attr({cx:function(e){return-1*u(e.y)*Math.sin(e.x*r)},cy:function(e){return-1*u(e.y)*Math.cos(e.x*r)}}).style("fill",function(e){return e.color}),m.exit().remove(),t.TooltipManager.addTooltip(m,function(e){return e.data.tooltipInfo},!0),g.exit().remove();var y=void 0;if(this.interactivityService){var f=this.getAllDataPointsList(e);y={selection:m,clearCatcher:this.svg},this.interactivityService.bind(f,new o,y)}},i.prototype.calculateChartDomain=function(e){var t=this.radius,i=this.getAllDataPointsList(e),a=d3.min(i,function(e){return e.y}),r=d3.max(i,function(e){return e.y});this.isPercentChart(i)&&(a=a>=0?0:-1,r=0>=r?0:1);var s=d3.scale.linear().domain([a,r]).range([0,t]);return this.zeroPointRadius=0>a&&r>0?s(0):0,s},i.prototype.renderLegend=function(e){if(e.legendData){var i=e.legendData;if(this.legendObjectProperties){t.LegendData.update(i,this.legendObjectProperties);var a=this.legendObjectProperties[t.legendProps.position];a&&this.legend.changeOrientation(t.LegendPosition[a])}else this.legend.changeOrientation(t.LegendPosition.Top);var r=this.viewport;this.legend.drawLegend(i,{height:r.height,width:r.width}),t.Legend.positionChartArea(this.svg,this.legend)}},i.prototype.drawZeroCircularSegment=function(e){for(var a=[],r=this.angle,s=i.SegmentFactor,o=this.zeroPointRadius,n=-1*o,l=0;l<e.length;l++)a.push({x1:o*(1-s*Math.sin(l*r)),y1:o*(1-s*Math.cos(l*r)),x2:o*(1-s*Math.sin((l+1)*r)),y2:o*(1-s*Math.cos((l+1)*r)),translate:t.SVGUtil.translate(n,n)});var c=this.mainGroupElement.select(i.ZeroSegment.selector).selectAll(i.ZeroSegmentNode.selector).data(a);c.enter().append("svg:line").classed(i.ZeroSegmentNode["class"],!0),c.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},transform:function(e){return e.translate}}),c.exit().remove()},i.prototype.drawZeroLabel=function(){var e=[];e.push({x:this.zeroPointRadius*(1-i.SegmentFactor)+5,y:-1*this.zeroPointRadius});var t=this.mainGroupElement.select(i.ZeroSegment.selector).selectAll(i.ZeroLabel.selector).data(e);t.enter().append("text").classed(i.ZeroLabel["class"],!0).text("0"),t.attr({x:function(e){return e.x},y:function(e){return e.y}})},i.prototype.getDataPoints=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].data);return t},i.prototype.getAllDataPointsList=function(e){for(var t=[],i=0;i<e.length;i++)t=t.concat(e[i].data);return t},i.prototype.isPercentChart=function(e){for(var t=0;t<e.length;t++)if(-1===e[t].labelFormatString.indexOf("%"))return!1;return!0},i.prototype.parseLegendProperties=function(t){return t&&t.metadata?void(this.legendObjectProperties=e.DataViewObjects.getObject(t.metadata.objects,"legend",{})):void(this.legendObjectProperties={})},i.parseSettings=function(t){var a;return a=t&&t.metadata&&t.metadata.columns&&t.metadata.objects?t.metadata.objects:null,{showLegend:e.DataViewObjects.getValue(a,i.Properties.legend.show,!0)}},i.getPrecision=function(e){return Math.max(i.MinPrecision,Math.min(i.MaxPrecision,e))},i.parseLabelSettings=function(a){var r;r=a&&a.metadata&&a.metadata.objects?a.metadata.objects:null;var s=t.dataLabelUtils.getDefaultPointLabelSettings(),o={show:e.DataViewObjects.getValue(r,i.Properties.labels.show,s.show),labelColor:e.DataViewObjects.getFillColor(r,i.Properties.labels.color,s.labelColor),displayUnits:e.DataViewObjects.getValue(r,i.Properties.labels.displayUnits,s.displayUnits),precision:i.getPrecision(e.DataViewObjects.getValue(r,i.Properties.labels.precision,s.precision)),fontSize:e.DataViewObjects.getValue(r,i.Properties.labels.fontSize,s.fontSize),position:s.position};return o},i.prototype.enumerateObjectInstances=function(e){var i,a=new t.ObjectEnumerationBuilder;if(!this.radarChartData||!this.radarChartData.settings)return[];switch(i=this.radarChartData.settings,e.objectName){case"legend":a.pushInstance(this.enumerateLegend(i));break;case"dataPoint":this.enumerateDataPoint(a);break;case"labels":this.enumerateDataLabels(a)}return a.complete()},i.prototype.getLabelSettingsOptions=function(e,t){return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:!0,precision:!0,fontSize:!0}},i.prototype.enumerateDataLabels=function(e){var i=this.radarChartData.dataLabelsSettings;t.dataLabelUtils.enumerateDataLabels(this.getLabelSettingsOptions(e,i))},i.prototype.enumerateLegend=function(i){var a,r,s=!0,o="",n=8;return s=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.showTitle,s),o=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.titleText,o),r=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.labelColor,r),n=e.DataViewObject.getValue(this.legendObjectProperties,t.legendProps.fontSize,n),a={objectName:"legend",displayName:"legend",selector:null,properties:{show:i.showLegend,position:t.LegendPosition[this.legend.getOrientation()],showTitle:s,titleText:o,labelColor:r,fontSize:n}}},i.prototype.enumerateDataPoint=function(e){if(this.radarChartData&&this.radarChartData.series)for(var i=this.radarChartData.series,a=0;a<i.length;a++){var r=i[a];e.pushInstance({objectName:"dataPoint",displayName:r.name,selector:t.ColorHelper.normalizeSelector(r.identity.getSelector(),!1),properties:{fill:{solid:{color:r.fill}}}})}},i.prototype.updateViewport=function(){var e,i=this.legend.getMargins();switch(e=t.LegendPosition[this.legendObjectProperties[t.legendProps.position]]){case t.LegendPosition.Top:case t.LegendPosition.TopCenter:case t.LegendPosition.Bottom:case t.LegendPosition.BottomCenter:this.viewport.height-=i.height;break;case t.LegendPosition.Left:case t.LegendPosition.LeftCenter:case t.LegendPosition.Right:case t.LegendPosition.RightCenter:this.viewport.width-=i.width}},i.capabilities={dataRoles:[{displayName:"Category",name:"Category",kind:e.VisualDataRoleKind.Grouping},{displayName:"Y Axis",name:"Y",kind:e.VisualDataRoleKind.Measure}],dataViewMappings:[{conditions:[{Category:{min:1,max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Y"}}]}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},legend:{displayName:e.data.createDisplayNameGetter("Visual_Legend"),description:e.data.createDisplayNameGetter("Visual_LegendDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:e.data.createDisplayNameGetter("Visual_LegendPosition"),description:e.data.createDisplayNameGetter("Visual_LegendPositionDescription"),type:{enumeration:t.legendPosition.type}},showTitle:{displayName:e.data.createDisplayNameGetter("Visual_LegendShowTitle"),description:e.data.createDisplayNameGetter("Visual_LegendShowTitleDescription"),type:{bool:!0}},titleText:{displayName:e.data.createDisplayNameGetter("Visual_LegendName"),description:e.data.createDisplayNameGetter("Visual_LegendNameDescription"),type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:e.data.createDisplayNameGetter("Visual_LegendTitleColor"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}},dataPoint:{displayName:e.data.createDisplayNameGetter("Visual_DataPoint"),description:e.data.createDisplayNameGetter("Visual_DataPointDescription"),properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},labels:{displayName:e.data.createDisplayNameGetter("Visual_DataPointsLabels"),description:e.data.createDisplayNameGetter("Visual_DataPointsLabelsDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_LabelsFill"),description:e.data.createDisplayNameGetter("Visual_LabelsFillDescription"),type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:e.data.createDisplayNameGetter("Visual_DisplayUnits"),description:e.data.createDisplayNameGetter("Visual_DisplayUnitsDescription"),type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:e.data.createDisplayNameGetter("Visual_Precision"),description:e.data.createDisplayNameGetter("Visual_PrecisionDescription"),placeHolderText:e.data.createDisplayNameGetter("Visual_Precision_Auto"),type:{numeric:!0},suppressFormatPainterCopy:!0},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),type:{formatting:{fontSize:!0}}}}}}},i.formatStringProp={objectName:"general",propertyName:"formatString"},i.Properties={legend:{show:{objectName:"legend",propertyName:"show"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},displayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},precision:{objectName:"labels",propertyName:"labelPrecision"},fontSize:{objectName:"labels",propertyName:"fontSize"}}},i.VisualClassName="radarChart",i.Segments=r("segments"),i.SegmentNode=r("segmentNode"),i.ZeroSegment=r("zeroSegment"),i.ZeroSegmentNode=r("zeroSegmentNode"),i.ZeroLabel=r("zeroLabel"),i.Axis=r("axis"),i.AxisNode=r("axisNode"),i.AxisLabel=r("axisLabel"),i.Chart=r("chart"),i.ChartNode=r("chartNode"),i.ChartArea=r("chartArea"),i.ChartPolygon=r("chartPolygon"),i.ChartDot=r("chartDot"),i.MaxPrecision=17,i.MinPrecision=0,i.DefaultMargin={top:50,bottom:50,right:100,left:100},i.SegmentLevels=6,i.SegmentFactor=1,i.Radians=2*Math.PI,i.Scale=1,i.NodeFillOpacity=1,i.AreaFillOpacity=.6,i.DimmedAreaFillOpacity=.4,i.AxesLabelsFontFamily="sans-serif",i.AxesLabelsfontSize="11px",i.AxesLabelsMaxWidth=200,i}();i.RadarChart=n}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.PixelConverter,r=a.CssConstants.createClassAndSelector,s=e.visuals.utility.SelectionManager,o=e.visuals.valueFormatter,n=e.visuals.AnimatorCommon.GetAnimationDuration,l=e.visuals.SelectionId,c=e.visuals.axisStyle,u=e.visuals.yAxisPosition,h=e.VisualDataRoleKind,p=e.data.createDisplayNameGetter,d=e.ValueType,g=e.visuals.DataColorPalette,m=e.DataViewObjects,y=e.visuals.ColorHelper,f=e.visuals.SVGUtil,v=e.visuals.TooltipManager,x=e.visuals.dataLabelUtils,b=e.DateTimeSequence,S=e.visuals.AxisHelper.applyCustomizedDomain,w=e.visuals.AxisHelper.combineDomain,C=e.visuals.AxisHelper.LabelLayoutStrategy.willLabelsFit,P=e.visuals.AxisHelper.LabelLayoutStrategy.willLabelsWordBreak,A=e.visuals.axisScale,D=e.TextMeasurementService,T=e.visuals.valueFormatter,V=function(){function e(e){this.message=e}return Object.defineProperty(e.prototype,"code",{get:function(){return"BulletChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){return{message:this.message,title:e.get(""),detail:e.get("")}},e.ErrorInvalidDataValues="Some data values are invalid or too big",e}();t.HistogramChartWarning=V;var N=function(){function e(e){this.ColumnPadding=1,this.MinColumnHeight=1,this.MinOpacity=.3,this.MaxOpacity=1,this.TooltipDisplayName="Range",this.SeparatorNumbers=", ",this.LegendSize=50,this.YLegendSize=50,this.XLegendSize=50,this.AxisSize=30,this.DataLabelMargin=0,this.widthOfColumn=0,this.yTitleMargin=0,this.outerPadding=5,this.ExcludeBrackets={left:"(",right:")"},this.IncludeBrackets={left:"[",right:"]"},this.margin={top:10,right:10,bottom:10,left:10},this.durationAnimations=200,this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:i.toString(9)},e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),this.margin=e.margin||this.margin)}return Object.defineProperty(e.prototype,"columnsSelection",{get:function(){return this.main.select(e.Columns.selector).selectAll(e.Column.selector)},enumerable:!0,configurable:!0}),e.prototype.init=function(t){this.hostService=t.host,this.svg?this.root=this.svg:this.root=d3.select(t.element.get(0)).append("svg");var i=t.style;this.colors=i&&i.colorPalette?i.colorPalette.dataColors:new g,this.root.classed(e.ClassName,!0),this.main=this.root.append("g"),this.axes=this.main.append("g").classed(e.Axes["class"],!0),this.axisX=this.axes.append("g").classed(e.Axis["class"],!0),this.axisY=this.axes.append("g").classed(e.Axis["class"],!0),this.legend=this.main.append("g").classed(e.Legends["class"],!0),this.columns=this.main.append("g").classed(e.Columns["class"],!0),this.labels=this.main.append("g").classed(e.Labels["class"],!0),this.selectionManager=new s({hostServices:t.host})},e.prototype.converter=function(t){if(!(t&&t.categorical&&t.categorical.categories&&t.categorical.categories[0]&&t.categorical.categories[0].values&&t.categorical.categories[0].values.length>0))return null;var i,a,r,s,n,l,c,u,h,p=[],d=[],g=[],m=0,y=0;if(t.categorical.values&&t.categorical.values[0]&&t.categorical.values[0].values&&(d=t.categorical.values[0].values),t.categorical.categories[0].identity&&t.categorical.categories[0].identity.length>0&&(g=t.categorical.categories[0].identity),i=this.parseSettings(t),!i)return null;r=e.getValuesByFrequencies(t.categorical.categories[0].values,d,g),r.forEach(function(e){p.push(e.value),y+=e.frequency}),a=d3.layout.histogram(),i.bins&&i.bins>e.MinNumberOfBins&&(a=a.bins(i.bins)),s=a.frequency(i.frequency)(p),s.forEach(function(t,a){var s,o;s=r.filter(function(i){return e.isValueContainedInRange(i,t,a)}),o=s.reduce(function(e,t){return e+t.frequency},0),t.y=i.frequency?o:o/y,m+=t.length});var f=i.yAxisSettings,v=null!==f.end&&f.end>f.start?f.end:d3.max(s,function(e){return e.y}),x=f.start<v?f.start:0;return i.yAxisSettings.end=v,i.yAxisSettings.start=x,i.maxX=d3.max(s,function(e){return d3.max(e)}),n=d3.scale.linear().domain([d3.min(s,function(e){return d3.min(e)}),d3.max(s,function(e){return d3.max(e)})]).range([0,this.viewport.width-this.YLegendSize-this.AxisSize]),l=d3.scale.linear().domain([x,v]).range([this.viewport.height-this.LegendSize,this.outerPadding]),c=o.create({format:o.getFormatString(t.categorical.categories[0].source,e.Properties.general.formatString),value:r[0].value,value2:r[r.length-1].value,precision:i.precision}),u=o.create({value:0===i.xAxisSettings.displayUnits?r[r.length-1].value:i.xAxisSettings.displayUnits,precision:i.xAxisSettings.precision}),h=o.create({value:i.yAxisSettings.displayUnits,precision:i.yAxisSettings.precision}),{xScale:n,yScale:l,settings:i,data:this.getData(r,p,s,i,h,u),formatter:c,xLabelFormatter:u,yLabelFormatter:h}},e.getValuesByFrequencies=function(e,t,i){var a=[];return e.forEach(function(e,r){var s=1,o=Number(e);o=isNaN(o)?0:o,t&&t[r]&&!isNaN(t[r])&&t[r]>1&&(s=t[r]),a.push({value:o,frequency:s,selectionId:l.createWithId(i[r])})}),a},e.prototype.getData=function(t,a,r,s,o,n){var l=this,c=d3.min(a),u=d3.max(a),h=i.fromPoint(s.labelSettings.fontSize);return r.map(function(i,a){return i.range=e.getRange(c,u,i.dx,a),i.tooltipInfo=l.getTooltipData(i.y,i.range,s,0===a,o,n),i.selectionIds=e.getSelectionIds(t,i,a),i.labelFontSize=h,i})},e.getRange=function(e,t,i,a){var r=e+a*i,s=r+i;return[r,s]},e.prototype.getTooltipData=function(t,i,a,r,s,o){return[{displayName:e.getLegendText(a),value:s.format(t)},{displayName:this.TooltipDisplayName,value:this.rangeToString(i,r,o)}]},e.getSelectionIds=function(t,i,a){var r=[];return t.forEach(function(t){e.isValueContainedInRange(t,i,a)&&r.push(t.selectionId)}),r},e.isValueContainedInRange=function(e,t,i){return(0===i&&e.value>=t.x||e.value>t.x)&&e.value<=t.x+t.dx},e.prototype.parseSettings=function(t){if(!(t&&t.metadata&&t.metadata.columns&&t.metadata.columns[0]))return null;var i,a,r={};a=new y(this.colors,e.Properties.dataPoint.fill,e.DefaultHistogramSettings.fillColor),r.displayName=t.metadata.columns[0].displayName||e.DefaultHistogramSettings.displayName,i=e.getObjectsFromDataView(t);var s={axisColor:e.getXAxisColor(i).solid.color,title:e.getXTitle(i),precision:e.getXPrecision(i),style:e.getXStyle(i),displayUnits:e.getXDisplayUnit(i),show:e.getXAxisShow(i)},o={axisColor:e.getYAxisColor(i).solid.color,title:e.getYTitle(i),precision:e.getYPrecision(i),style:e.getYStyle(i),displayUnits:e.getYDisplayUnit(i),show:e.getYAxisShow(i),start:e.getYStart(i),end:e.getYEnd(i),position:e.getYPosition(i)},n={show:e.getLabelShow(i),color:e.getLabelColor(i).solid.color,displayUnits:e.getLabelDisplayUnits(i),precision:e.getLabelPrecision(i),fontSize:e.getLabelFontSize(i)};return r.fillColor=a.getColorForMeasure(i,""),r.bins=e.getBins(i),r.frequency=e.getFrequency(i),r.precision=e.getPrecision(i),r.displayName=e.getLegend(r.displayName,s.style,s.displayUnits),r.xAxisSettings=s,r.yAxisSettings=o,r.labelSettings=n,r},e.getLegend=function(e,t,i){var a,r=o.create({value:i});switch(t){case c.showTitleOnly:a=e;break;case c.showUnitOnly:a=0===i||1===i?e:r.displayUnit.title;break;case c.showBoth:a=0===i||1===i?e:e+" ("+r.displayUnit.title+")"}return a},e.getLabelFontSize=function(t){return m.getValue(t,e.Properties.labels.fontSize,e.DefaultHistogramSettings.labelSettings.fontSize)},e.getLabelShow=function(t){return m.getValue(t,e.Properties.labels.show,e.DefaultHistogramSettings.labelSettings.show)},e.getLabelColor=function(t){return m.getValue(t,e.Properties.labels.color,{solid:{color:e.DefaultHistogramSettings.labelSettings.color}})},e.getLabelDisplayUnits=function(t){return m.getValue(t,e.Properties.labels.displayUnits,e.DefaultHistogramSettings.labelSettings.displayUnits)},e.getLabelPrecision=function(t){var i=m.getValue(t,e.Properties.labels.precision,e.DefaultHistogramSettings.labelSettings.precision);return i<=e.MinPrecision?e.MinPrecision:i>=e.MaxPrecision?e.MaxPrecision:i},e.getXStyle=function(t){return m.getValue(t,e.Properties.xAxis.style,e.DefaultHistogramSettings.xAxisSettings.style)},e.getXDisplayUnit=function(t){return m.getValue(t,e.Properties.xAxis.displayUnits,e.DefaultHistogramSettings.xAxisSettings.displayUnits)},e.getXPrecision=function(t){var i=m.getValue(t,e.Properties.xAxis.precision,e.DefaultHistogramSettings.xAxisSettings.precision);return i<=e.MinPrecision?e.MinPrecision:i>=e.MaxPrecision?e.MaxPrecision:i},e.getXAxisShow=function(t){return m.getValue(t,e.Properties.xAxis.show,e.DefaultHistogramSettings.xAxisSettings.show)},e.getXAxisColor=function(t){return m.getValue(t,e.Properties.xAxis.axisColor,{solid:{color:e.DefaultHistogramSettings.xAxisSettings.axisColor}})},e.getXTitle=function(t){return m.getValue(t,e.Properties.xAxis.title,e.DefaultHistogramSettings.xAxisSettings.title)},e.getYStyle=function(t){return m.getValue(t,e.Properties.yAxis.style,e.DefaultHistogramSettings.yAxisSettings.style)},e.getYPosition=function(t){return m.getValue(t,e.Properties.yAxis.position,e.DefaultHistogramSettings.yAxisSettings.position)},e.getYAxisShow=function(t){return m.getValue(t,e.Properties.yAxis.show,e.DefaultHistogramSettings.yAxisSettings.show)},e.getYAxisColor=function(t){return m.getValue(t,e.Properties.yAxis.axisColor,{solid:{color:e.DefaultHistogramSettings.yAxisSettings.axisColor}})},e.getYStart=function(t){return m.getValue(t,e.Properties.yAxis.start,e.DefaultHistogramSettings.yAxisSettings.start)},e.getYEnd=function(t){return m.getValue(t,e.Properties.yAxis.end,e.DefaultHistogramSettings.yAxisSettings.end)},e.getYDisplayUnit=function(t){return m.getValue(t,e.Properties.yAxis.displayUnits,e.DefaultHistogramSettings.yAxisSettings.displayUnits)},e.getYPrecision=function(t){var i=m.getValue(t,e.Properties.yAxis.precision,e.DefaultHistogramSettings.yAxisSettings.precision);return i<=e.MinPrecision?e.MinPrecision:i>=e.MaxPrecision?e.MaxPrecision:i},e.getYTitle=function(t){return m.getValue(t,e.Properties.yAxis.title,e.DefaultHistogramSettings.yAxisSettings.title);
},e.getBins=function(t){var i=Number(m.getValue(t,e.Properties.general.bins,e.DefaultHistogramSettings.bins));return!i||isNaN(i)||i<=e.MinNumberOfBins?e.DefaultHistogramSettings.bins:i>e.MaxNumberOfBins?e.MaxNumberOfBins:i},e.getFrequency=function(t){return m.getValue(t,e.Properties.general.frequency,e.DefaultHistogramSettings.frequency)},e.getPrecision=function(t){var i=m.getValue(t,e.Properties.labels.precision,e.DefaultHistogramSettings.precision);return i<=e.MinPrecision?e.MinPrecision:i>=e.MaxPrecision?e.MaxPrecision:i},e.prototype.validateData=function(e){return e&&e.data.some(function(e){return e.range.some(function(e){return isNaN(e)||e===1/0||e===-(1/0)})})?(this.hostService.setWarnings([new V(V.ErrorInvalidDataValues)]),!1):!0},e.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){var t,i=e.dataViews[0];if(this.durationAnimations=n(this.animator,e.suppressAnimations),this.setSize(e.viewport),this.histogramDataView=this.converter(i),this.validateData(this.histogramDataView)||(this.histogramDataView.data=[]),this.histogramDataView){this.YLegendSize=this.getLegendSize(this.histogramDataView.settings.yAxisSettings),this.XLegendSize=this.getLegendSize(this.histogramDataView.settings.xAxisSettings),t=this.getWidthOfLabel(),this.xAxisProperties=this.calculateXAxes(i.categorical.categories[0].source,this.textProperties,t,!1);var a=i.categorical.values&&i.categorical.values[0]&&i.categorical.values[0].values?i.categorical.values[0].source:i.categorical.categories[0].source;this.yAxisProperties=this.calculateYAxes(a,this.textProperties,t,!1),this.render()}}},e.prototype.getLegendSize=function(t){return t.title?e.LegendSizeWhenTitleIsActive:e.LegendSizeWhenTitleIsNotActive},e.prototype.getWidthOfLabel=function(){if(this.histogramDataView&&this.histogramDataView.settings){var t=this.histogramDataView.xLabelFormatter.format(this.histogramDataView.settings.maxX),i={text:t,fontFamily:this.textProperties.fontFamily,fontSize:this.textProperties.fontSize};return D.measureSvgTextWidth(i)+e.AdditionalWidthOfLabel}},e.prototype.setSize=function(e){var t,i;t=e.height-this.margin.top-this.margin.bottom,i=e.width-this.margin.left-this.margin.right,this.viewport={height:t,width:i},this.updateElements(e.height,e.width)},e.prototype.updateElements=function(e,t){this.root.attr({height:e,width:t}),this.main.attr("transform",f.translate(this.margin.left,this.margin.top)),this.legend.attr("transform",f.translate(this.margin.left,this.margin.top)),this.axisX.attr("transform",f.translate(0,this.viewport.height-this.XLegendSize))},e.prototype.shouldShowYOnRight=function(){return this.histogramDataView.settings.yAxisSettings.position===u.right},e.prototype.columsAndAxesTransform=function(e){var t=20,i=this.shouldShowYOnRight()?10:this.histogramDataView.settings.yAxisSettings.title?this.margin.left+e+t:this.margin.left+e;this.DataLabelMargin=i,this.columns.attr("transform",f.translate(i,0)),this.axes.attr("transform",f.translate(i,0)),this.axisY.attr("transform",f.translate(this.shouldShowYOnRight()?this.viewport.width-this.AxisSize-this.YLegendSize+.01:0,0)),this.axisX.attr("transform",f.translate(0,this.viewport.height-this.XLegendSize))},e.prototype.render=function(){if(this.histogramDataView&&this.histogramDataView.settings){this.renderAxes();var e=this.renderColumns();this.adjustTransformToAxisLabels(),this.renderLegend(),this.histogramDataView.settings.labelSettings.show?this.renderLabels():this.main.selectAll(".labels").selectAll("*").remove(),this.bindSelectionHandler(e)}},e.prototype.adjustTransformToAxisLabels=function(){var e=0;this.main.selectAll("g.axis").filter(function(e,t){return 1===t}).selectAll("g.tick text").each(function(t,i){var a=D.getSvgMeasurementProperties(this),r={text:a.text,fontFamily:a.fontFamily,fontSize:a.fontSize},s=D.measureSvgTextWidth(r);s>e&&(e=s)});var t=70;this.yTitleMargin=this.shouldShowYOnRight()?this.viewport.width-this.AxisSize-t+this.YLegendSize+e:0,this.columsAndAxesTransform(e)},e.prototype.renderColumns=function(){var t,i,a=this,r=this.histogramDataView.data,s=this.histogramDataView.yScale,o=r.length;return t=o&&(this.viewport.width-this.AxisSize-this.YLegendSize)/o-this.ColumnPadding,0>t&&(t=0),this.widthOfColumn=t,i=this.columnsSelection.data(r),i.enter().append("svg:rect"),i.attr("x",this.ColumnPadding/2).attr("width",t).attr("height",function(e){return a.getColumnHeight(e,s)}).style("fill",this.histogramDataView.settings.fillColor).attr("class",e.Column["class"]).attr("transform",function(e,i){return f.translate(t*i+a.ColumnPadding*i,s(e.y)-a.ColumnPadding/2.5)}),o&&i.classed(e.Column["class"]),i.exit().remove(),e.renderTooltip(i),i},e.renderTooltip=function(e){v.addTooltip(e,function(e){return e.data.tooltipInfo})},e.prototype.getColumnHeight=function(e,t){var i=this.viewport.height-this.XLegendSize-t(e.y);return i>0?i:this.MinColumnHeight},e.prototype.renderAxes=function(){var e,t,i=this;e=this.xAxisProperties.axis.tickFormat(function(e){return i.histogramDataView.xLabelFormatter.format(e)}).orient("bottom"),t=this.yAxisProperties.axis.orient(this.histogramDataView.settings.yAxisSettings.position.toLowerCase()).tickFormat(function(e){return i.histogramDataView.yLabelFormatter.format(e)});var a=this.histogramDataView.settings.xAxisSettings.show,r=this.histogramDataView.settings.yAxisSettings.show;a?this.axisX.transition().duration(1).call(e):this.axisX.selectAll("*").remove(),r?this.axisY.call(t):this.axisY.selectAll("*").remove(),this.main.selectAll("g.axis").filter(function(e,t){return 0===t}).selectAll("g.tick text").style({fill:this.histogramDataView.settings.xAxisSettings.axisColor}),this.main.selectAll("g.axis").filter(function(e,t){return 1===t}).selectAll("g.tick text").style({fill:this.histogramDataView.settings.yAxisSettings.axisColor})},e.prototype.getLabaelLayout=function(){var e=this,t=this.histogramDataView.settings.labelSettings,a=i.fromPoint(t.fontSize),r=o.create({value:t.displayUnits,precision:t.precision});return{labelText:function(e){return r.format(e.y).toString()},labelLayout:{x:function(t){return e.DataLabelMargin+e.histogramDataView.xScale(t.x)+e.widthOfColumn/2},y:function(t){return e.histogramDataView.yScale(t.y)-5}},filter:function(e){return null!=e},style:{fill:t.color,"font-size":a}}},e.prototype.renderLabels=function(){var e=this.getLabaelLayout(),t=this.histogramDataView.data;x.drawDefaultLabelsForDataPointChart(t,this.main,e,this.viewport)},e.rangesToArray=function(e){return e.reduce(function(e,t,i){var a;return a=0===i?t.range:t.range.slice(1),e.concat(a)},[])},e.prototype.rangeToString=function(e,t,i){var a,r=this.IncludeBrackets.right,s=i.format(e[0]),o=i.format(e[1]);return a=t?this.IncludeBrackets.left:this.ExcludeBrackets.left,""+a+s+this.SeparatorNumbers+o+r},e.prototype.renderLegend=function(){var t,i,a=this.getDataLegends(this.histogramDataView.settings);t=this.main.select(e.Legends.selector).selectAll(e.Legend.selector),i=t.data(a),i.enter().append("svg:text"),i.attr("x",0).attr("y",0).attr("dx",function(e){return e.dx}).attr("dy",function(e){return e.dy}).attr("transform",function(e){return e.transform}).attr("class",e.Legend["class"]).text(function(e){return e.text}).classed(e.Legend["class"],!0),i.exit().remove(),this.legend.select("text").style({display:this.histogramDataView.settings.xAxisSettings.title===!0?"block":"none"}),this.legend.selectAll("text").filter(function(e,t){return 1===t}).style({display:this.histogramDataView.settings.yAxisSettings.title===!0?"block":"none"})},e.prototype.getDataLegends=function(t){var i=e.getLegendText(t);return i=e.getLegend(i,t.yAxisSettings.style,t.yAxisSettings.displayUnits),[{transform:f.translate(this.viewport.width/2,this.viewport.height),text:t.displayName,dx:"1em",dy:"-1em"},{transform:f.translateAndRotate(this.shouldShowYOnRight()?this.yTitleMargin:0,this.viewport.height/2,0,0,270),text:i,dx:"3em"}]},e.getLegendText=function(t){return t.frequency?e.FrequencyText:e.DensityText},e.prototype.bindSelectionHandler=function(e){var t=this;this.setSelection(e),e.on("click",function(i){t.selectionManager.clear(),i.selectionIds.forEach(function(a){t.selectionManager.select(a,!0).then(function(a){a.length>0?t.setSelection(e,i):t.setSelection(e)})}),d3.event.stopPropagation()}),this.root.on("click",function(){t.selectionManager.clear(),t.setSelection(e)})},e.prototype.setSelection=function(e,t){e.transition().duration(this.durationAnimations).style("fill-opacity",this.MaxOpacity),t&&e.filter(function(e){return e!==t}).transition().duration(this.durationAnimations).style("fill-opacity",this.MinOpacity)},e.prototype.enumerateObjectInstances=function(e){var t,i=[];if(!this.histogramDataView||!this.histogramDataView.settings)return i;switch(t=this.histogramDataView.settings,e.objectName){case"general":var a={objectName:"general",displayName:"general",selector:null,properties:{bins:t.bins,frequency:t.frequency}};i.push(a);break;case"dataPoint":var r={objectName:"dataPoint",displayName:"dataPoint",selector:null,properties:{fill:t.fillColor}};i.push(r);break;case"labels":var s=t.labelSettings,o={objectName:"labels",displayName:"labels",selector:null,properties:{show:s.show,color:s.color,displayUnits:s.displayUnits,precision:s.precision,fontSize:s.fontSize}};i.push(o);break;case"xAxis":var n=t.xAxisSettings,l={objectName:"xAxis",displayName:"X-Axis",selector:null,properties:{show:n.show,title:n.title,style:n.style,axisColor:n.axisColor,displayUnits:n.displayUnits,precision:n.precision}};i.push(l);break;case"yAxis":var c=t.yAxisSettings,u={objectName:"yAxis",displayName:"Y-Axis",selector:null,properties:{show:c.show,position:c.position,start:c.start,end:c.end,title:c.title,style:c.style,axisColor:c.axisColor,displayUnits:c.displayUnits,precision:c.precision}};i.push(u)}return i},e.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},e.prototype.destroy=function(){this.root=null},e.prototype.calculateXAxes=function(t,i,a,r){var s,o,n=this.viewport.width;return o={viewport:this.viewport,margin:this.margin,forcedXDomain:e.rangesToArray(this.histogramDataView.data),forceMerge:!0,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:A.linear,valueAxisScaleType:null,trimOrdinalDataOnOverflow:!1},s=this.calculateXAxesProperties(o,t,e.InnerPaddingRatio,a),s.willLabelsFit=C(s,n,D.measureSvgTextWidth,i),s.willLabelsWordBreak=!s.willLabelsFit&&!r&&P(s,this.margin,n,D.measureSvgTextWidth,D.estimateSvgTextHeight,D.getTailoredTextOrDefault,i),s},e.prototype.calculateXAxesProperties=function(t,i,a,r){var s=L.createAxis({pixelSpan:this.viewport.width-this.YLegendSize-this.AxisSize,dataDomain:t.forcedXDomain,metaDataColumn:i,formatString:T.getFormatString(i,e.Properties.general.formatString),outerPadding:0,isScalar:!1,isVertical:!1,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(e,t){return e},scaleType:t.categoryAxisScaleType,innerPaddingRatio:a,minOrdinalRectThickness:r,tickLabelPadding:void 0});return s.axisLabel=this.histogramDataView.settings.displayName,s},e.prototype.calculateYAxes=function(t,i,a,r){var s,o;return o={viewport:this.viewport,margin:this.margin,forceMerge:!0,showCategoryAxisLabel:!0,showValueAxisLabel:!1,categoryAxisScaleType:A.linear,valueAxisScaleType:null,trimOrdinalDataOnOverflow:!1},s=this.histogramDataView.settings.yAxisSettings,o.forcedYDomain=S([s.start,s.end],o.forcedYDomain),this.calculateYAxesProperties(o,t,e.InnerPaddingRatio,a)},e.prototype.calculateYAxesProperties=function(t,i,a,r){var s=this.histogramDataView.settings.yAxisSettings;return L.createAxis({pixelSpan:this.viewport.height-this.XLegendSize+5,dataDomain:w(t.forcedYDomain,[s.start,s.end]),metaDataColumn:i,formatString:T.getFormatString(i,e.Properties.general.formatString),outerPadding:this.outerPadding,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!1,getValueFn:function(e,t){return e},scaleType:t.categoryAxisScaleType,innerPaddingRatio:a,minOrdinalRectThickness:r,tickLabelPadding:void 0})},e.ClassName="histogram",e.FrequencyText="Frequency",e.DensityText="Density",e.Properties={general:{bins:{objectName:"general",propertyName:"bins"},frequency:{objectName:"general",propertyName:"frequency"},formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},displayUnits:{objectName:"labels",propertyName:"displayUnits"},precision:{objectName:"labels",propertyName:"precision"},fontSize:{objectName:"labels",propertyName:"fontSize"}},xAxis:{show:{objectName:"xAxis",propertyName:"show"},axisColor:{objectName:"xAxis",propertyName:"axisColor"},title:{objectName:"xAxis",propertyName:"title"},displayUnits:{objectName:"xAxis",propertyName:"displayUnits"},precision:{objectName:"xAxis",propertyName:"precision"},style:{objectName:"xAxis",propertyName:"style"}},yAxis:{show:{objectName:"yAxis",propertyName:"show"},axisColor:{objectName:"yAxis",propertyName:"axisColor"},title:{objectName:"yAxis",propertyName:"title"},displayUnits:{objectName:"yAxis",propertyName:"displayUnits"},precision:{objectName:"yAxis",propertyName:"precision"},style:{objectName:"yAxis",propertyName:"style"},start:{objectName:"yAxis",propertyName:"start"},end:{objectName:"yAxis",propertyName:"end"},position:{objectName:"yAxis",propertyName:"position"}}},e.DefaultHistogramSettings={frequency:!0,displayName:"Histogram",bins:null,fillColor:"#5f9ea0",precision:2,xAxisSettings:{show:!0,axisColor:"#5f9ea0",title:!0,displayUnits:0,precision:2,style:c.showTitleOnly},yAxisSettings:{show:!0,axisColor:"#5f9ea0",title:!0,displayUnits:0,precision:2,style:c.showTitleOnly,start:0,position:u.left},labelSettings:{show:!1,color:"#5f9ea0",displayUnits:0,precision:2,fontSize:9}},e.Axes=r("axes"),e.Axis=r("axis"),e.Labels=r("labels"),e.Columns=r("columns"),e.Column=r("column"),e.Legends=r("legends"),e.Legend=r("legend"),e.MinNumberOfBins=0,e.MaxNumberOfBins=100,e.MinPrecision=0,e.MaxPrecision=17,e.AdditionalWidthOfLabel=3,e.LegendSizeWhenTitleIsActive=50,e.LegendSizeWhenTitleIsNotActive=25,e.InnerPaddingRatio=1,e.capabilities={dataRoles:[{name:"Values",kind:h.Grouping,displayName:p("Role_DisplayName_Values")},{name:"Frequency",kind:h.Measure,displayName:"Frequency"}],dataViewMappings:[{conditions:[{Values:{min:1,max:1},Frequency:{min:0,max:1}}],categorical:{categories:{bind:{to:"Values"},dataReductionAlgorithm:{top:{}}},values:{"for":{"in":"Frequency"}}}}],sorting:{implicit:{clauses:[{role:"Values",direction:1}]}},objects:{general:{displayName:p("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}},bins:{displayName:"Bins",type:{numeric:!0}},frequency:{displayName:"Frequency",type:{bool:!0}}}},dataPoint:{displayName:p("Visual_DataPoint"),properties:{fill:{displayName:p("Visual_Fill"),type:{fill:{solid:{color:!0}}}}}},xAxis:{displayName:"X-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},axis:{displayName:"Axis",type:{bool:!0}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},title:{displayName:"Title",type:{bool:!0}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},precision:{displayName:"Decimal Places",type:{numeric:!0}},style:{displayName:"Style",type:{enumeration:c.type}}}},yAxis:{displayName:"Y-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},axis:{displayName:"yAxis",type:{bool:!0}},axisColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},title:{displayName:"Title",type:{bool:!0}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},precision:{displayName:"Decimal Places",type:{numeric:!0}},style:{displayName:"Style",type:{enumeration:c.type}},start:{displayName:"Start",type:{numeric:!0},placeHolderText:"Start",suppressFormatPainterCopy:!0},end:{displayName:"End",type:{numeric:!0},placeHolderText:"End",suppressFormatPainterCopy:!0},position:{displayName:"Position",type:{enumeration:u.type}}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},precision:{displayName:"Decimal Places",type:{numeric:!0},suppressFormatPainterCopy:!0},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}}},e}();t.Histogram=N;var L;!function(t){function i(e){var t=e.pixelSpan,i=e.dataDomain,c=e.metaDataColumn,h=e.formatString,p=e.outerPadding||0,d=!!e.isCategoryAxis,g=!!e.isScalar,m=!!e.isVertical,f=!!e.useTickIntervalForDisplayUnits,x=e.getValueFn,b=e.categoryThickness,S=e.axisDisplayUnits,w=e.axisPrecision,C=!!e.is100Pct,P=e.tickLabelPadding||j,D=y(c,g),T=v(e),V=T.scale,N=T.bestTickCount,L=V.domain(),M=l(i,D);if(b&&g&&i&&2===i.length){var k=i[1]-i[0],I=L[1]-L[0];k>0&&I>0&&(b=b*k/I)}var O;if(g&&1===N)O=[i[0]];else{var F=g?o(h,D,C):void 0;O=u(N,V,D,g,F)}e.scaleType&&e.scaleType===A.log&&M&&(O=O.filter(function(e){return a(e)}));var z=s(L,i,D,g,h,N,O,x,f,S,w),G=d3.svg.axis().scale(V).tickSize(6,0).orient(m?"left":"bottom").ticks(N).tickValues(O),B=[];c&&(B=n(G,O,z,D,x));var H;return!g&&b?H=Math.max(1,b-2*P):(H=O.length>1?r(V,O):t,H-=2*R),{scale:V,axis:G,formatter:z,values:B,axisType:D,axisLabel:null,isCategoryAxis:d,xLabelMaxWidth:H,categoryThickness:b,outerPadding:p,usingDefaultDomain:T.usingDefaultDomain,isLogScaleAllowed:M,dataDomain:i}}function a(e){var t=Math.abs(e),i=Math.log(t)/Math.LN10;return i=Math.ceil(i-1e-12),t/Math.pow(10,i)===1}function r(e,t){return e&&!_.isEmpty(t)?Math.abs(e(t[1])-e(t[0])):1}function s(e,t,i,a,r,s,o,n,l,c,u){void 0===l&&(l=!1);var h;if(i.dateTime)if(a){var p=new Date(e[0]),d=new Date(e[1]);1===s&&(p=d=new Date(t[0])),h=T.create({format:r,value:p,value2:d,tickCount:s})}else h=T.createDefaultFormatter(r,!0);else if(l&&a&&o.length>1){var g=c?c:o[1]-o[0],m={format:r,value:g,value2:0,allowFormatBeautification:!0};u?m.precision=u:m.detectAxisPrecision=!0,h=T.create(m)}else h=T.createDefaultFormatter(r,!0);return h}function o(e,t,i){var a=e&&!F.isStandardFormat(e);if(a){var r=F.getCustomFormatMetadata(e,!0).precision;return e.indexOf("%")>-1&&(r+=2),Math.pow(10,-r)}return i?.01:t.integer?1:0}function n(e,t,i,a,r){var s=[];return r||(r=function(e){return e}),i?(e.tickFormat(function(e){return i.format(r(e,a))}),s=t.map(function(e){return i.format(r(e,a))})):s=t.map(function(e){return r(e,a)}),s}function l(e,t){return null==e?!1:c(t)?!1:e[0]>0&&e[1]>0||e[0]<0&&e[1]<0}function c(e){return!(!e||!e.dateTime)}function u(e,t,i,a,r){return!a||m(t)?h(e,t.domain()):c(i)?g(e,t.domain()):p(e,t,r)}function h(e,t){var i=[];if(0>=e)return i;var a=t.length;if(e>a)return t;for(var r=0,s=Math.ceil(a/e);a>r;r+=s)i.push(t[r]);return i}function p(e,t,i){var a=[];if(0===e)return a;var r=t;if(r.ticks){if(a=r.ticks(e),a.length>e&&e>1&&(a=r.ticks(e-1)),a.length<B&&(a=r.ticks(e+1)),a=O(a),i&&a.length>1){for(var s=a[1]-a[0];s>0&&i>s;){for(var o=1;o<a.length;o++)a.splice(o,1);s=2*s}1===a.length&&a.push(a[0]+i)}return a}return a}function g(e,t){var i=[];if(0===t[0]&&0===t[1])return[];var a=b.calculate(new Date(t[0]),new Date(t[1]),e).sequence;return i=a.map(function(e){return e.getTime()}),i=k(i,t[0],t[1])}function m(e){return"undefined"==typeof e.invert}function y(e,t){return e&&f(e.type)?e.type:t?d.fromDescriptor({numeric:!0}):d.fromDescriptor({text:!0})}function f(e){return e&&(e.bool||e.numeric||e.text||e.dateTime)}function v(e){var i=e.pixelSpan,a=e.dataDomain,r=e.metaDataColumn,s=e.outerPadding||0,o=!!e.isScalar,n=!!e.isVertical,l=e.forcedTickCount,c=e.categoryThickness,u=!!e.shouldClamp,h=e.maxTickCount,p=e.innerPaddingRatio||z,d=e.minOrdinalRectThickness||G,g=y(r,o),m=n?N(i):V(i);h&&m>h&&(m=h);var f,v=a?a.slice():null,b=m,P=!1;if(null==a||2===a.length&&null==a[0]&&null==a[1]||2!==a.length&&o)P=!0,a=g.dateTime||!L(g)?t.emptyDomain:[],f=L(g)?S(i,a,p,c?s/c:0):C(e.scaleType,i,a,g,s,b);else{if(o&&a.length>0){b=void 0!==l?0!==m?l:0:M(a[0],a[a.length-1],[r],m,g.dateTime);var A=w({min:a[0],max:a[a.length-1]});v=[A.min,A.max]}o&&g.numeric&&!g.dateTime?f=C(e.scaleType,i,v,g,s,b,u):o&&g.dateTime?f=D(i,v,s,null,u):(g.text||g.dateTime||g.numeric||g.bool)&&(f=S(i,v,p,c?s/c:0),b=0===m?0:Math.min(v.length,(i-2*s)/d))}return n&&o&&f.range(f.range().reverse()),x(f),{scale:f,bestTickCount:b,usingDefaultDomain:P}}function x(e){for(var t=e.domain(),i=0,a=t.length;a>i;++i)t[i]===Number.POSITIVE_INFINITY?t[i]=Number.MAX_VALUE:t[i]===Number.NEGATIVE_INFINITY&&(t[i]=-Number.MAX_VALUE);e.domain(t)}function S(e,t,i,a){var r=d3.scale.ordinal().rangeBands([0,e],i,a).domain(t);return r}function w(e){return isNaN(e.min)||isNaN(e.max)?(e.min=t.emptyDomain[0],e.max=t.emptyDomain[1]):e.min===e.max?(e.min=e.min<0?1.2*e.min:.8*e.min,e.max=e.max<0?.8*e.max:1.2*e.max):Math.abs(e.min)<1e-4&&e.min/(e.max-e.min)<1e-4&&(e.min=0),e}function C(e,t,i,a,r,s,o){return void 0===r&&(r=0),e===A.log&&l(i,a)?P(t,i,r,s):D(t,i,r,s,o)}function P(e,t,i,a){void 0===i&&(i=0);var r=d3.scale.log().range([i,e-i]).domain([t[0],t[1]]).clamp(!0);return a&&r.nice(a),r}function D(e,t,i,a,r){void 0===i&&(i=0);var s=d3.scale.linear().range([i,e-i]).domain([t[0],t[1]]).clamp(r);return a&&s.nice(a),s}function V(e){return 300>e?3:500>e?5:8}function N(e){return 150>e?3:300>e?5:8}function L(e){return!(!e||!(e.text||e.bool||e.misc&&e.misc.barcode||e.geography&&e.geography.postalCode))}function M(e,t,i,a,r){return isNaN(e)||isNaN(t)?H:1>=a||1>=t&&e>=-1?a:e===t?r?1:H:I(i)?a:Math.min(t-e+1,a)}function k(e,t,i){var a=e.filter(function(e){return e>=t&&i>=e});return a.length<2&&(a=[t,i]),a}function I(e){for(var t=0,i=e.length;i>t;t++){var a=e[t];if(a&&a.type&&!a.type.integer)return!0}return!1}function O(e,t){if(void 0===t&&(t=1e-5),!e||e.length<2)return e;var i=t*Math.abs(e[1]-e[0]);return e.map(function(e){return Math.abs(e)<=i?0:e})}var F=e.NumberFormat;t.emptyDomain=[0,0];var z=.2,j=2,G=20,R=3,B=2,H=3;t.createAxis=i,t.powerOfTen=a,t.createFormatter=s,t.getMinTickValueInterval=o,t.isLogScalePossible=l,t.isDateTime=c,t.getRecommendedTickValues=u,t.getRecommendedTickValuesForAnOrdinalRange=h,t.getRecommendedTickValuesForAQuantitativeRange=p,t.isOrdinalScale=m,t.getCategoryValueType=y,t.columnDataTypeHasValue=f,t.createScale=v,t.normalizeInfinityInScale=x,t.createOrdinalScale=S,t.createNumericalScale=C,t.createLinearScale=D,t.getRecommendedNumberOfTicksForXAxis=V,t.getRecommendedNumberOfTicksForYAxis=N,t.isOrdinal=L,t.getBestNumberOfTicks=M,t.ensureValuesInRange=k,t.hasNonIntegerData=I}(L=t.HistogramAxisHelper||(t.HistogramAxisHelper={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r,s=e.visuals.AnimatorCommon.GetAnimationDuration,o=a.CssConstants.createClassAndSelector,n=e.visuals.axisScale,l=a.PixelConverter,c=e.createEnumType,u=e.visuals.SelectionId,h=e.VisualDataRoleKind,p=e.visuals.dataLabelUtils,d=e.visuals.LegendData,g=e.DataViewObjects,m=e.visuals.SelectionIdBuilder,y=e.visuals.createInteractivityService,f=e.visuals.appendClearCatcher,v=e.visuals.SVGUtil,x=e.visuals.ObjectEnumerationBuilder,b=e.DataViewObject,S=e.visuals.valueFormatter,w=e.visuals.TooltipManager,C=e.visuals.AxisHelper,P=e.TextMeasurementService,A=40,D=15,T=5,V=1,N="#00B8AA",L=0,M=17;!function(e){!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(e.Orientation||(e.Orientation={}));var t=e.Orientation;e.type=c([{value:t[0],displayName:"Horizontal"},{value:t[1],displayName:"Vertical"}])}(r=i.DotPlotLabelsOrientation||(i.DotPlotLabelsOrientation={})),i.DotPlotProperties={general:{formatString:{objectName:"general",propertyName:"formatString"}},labels:{show:{objectName:"labels",propertyName:"show"},fontSize:{objectName:"labels",propertyName:"fontSize"},labelPrecision:{objectName:"labels",propertyName:"labelPrecision"},labelDisplayUnits:{objectName:"labels",propertyName:"labelDisplayUnits"},labelColor:{objectName:"labels",propertyName:"color"},orientation:{objectName:"labels",propertyName:"orientation"}},dataPoint:{fill:{objectName:"dataPoint",propertyName:"fill"}},categories:{show:{objectName:"categories",propertyName:"show"},fontColor:{objectName:"categories",propertyName:"fontColor"},fontSize:{objectName:"categories",propertyName:"fontSize"}},categoryAxis:{show:{objectName:"categoryAxis",propertyName:"show"},showAxisTitle:{objectName:"categoryAxis",propertyName:"showAxisTitle"},labelColor:{objectName:"categoryAxis",propertyName:"labelColor"}}};var k=function(){function c(e){this.DefaultMargin={top:10,bottom:10,right:20,left:20},this.durationAnimations=200,this.scaleType=n.linear,this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:a.PixelConverter.toString(9)},this.dotPlotSelectors={svgPlotSelector:o("dotplot"),plotSelector:o("dotplotSelector"),plotGroupSelector:o("dotplotGroup"),axisSelector:o("axisGraphicsContext"),xAxisSelector:o("x axis"),circleSeletor:o("circleSelector")},this.DefaultDotPlotSettings={labelSettings:{show:!0,precision:2,fontSize:p.DefaultFontSizeInPt,displayUnits:0,labelColor:p.defaultLabelColor},categorySettings:{show:!0,fontColor:d.DefaultLegendLabelFillColor},defaultDataPointColor:N,categoryAxisSettings:{show:!0,showAxisTitle:!0,labelColor:{solid:{color:p.defaultLabelColor}}},labelOrientation:r.Orientation.Horizontal,labelTextMaxSize:0,xAxisLabelTexMaxSize:0},e&&(e.svg&&(this.svg=e.svg),e.animator&&(this.animator=e.animator),this.radius=e.radius||T,this.strokeWidth=e.strokeWidth||V)}return c.getTooltipData=function(e){return[{displayName:"Value",value:e.toString()}]},c.converter=function(t,a,s,o,n,h,p,d){var y,f=t.categorical.values,v=[],x=t.categorical.categories[0].source.displayName,b=g.getFillColor(a,i.DotPlotProperties.dataPoint.fill,h.getColorByIndex(0).value),S=t.categorical.categories[0].values.map(function(e,i){return{value:e,selectionId:u.createWithId(t.categorical.categories[0].identity[i])}});y={categorySettings:this.getCategorySettings(a,n),defaultDataPointColor:b,labelSettings:this.parseSettings(a,n),categoryAxisSettings:this.parseCategoryAxisSettings(a,n),labelOrientation:g.getValue(a,i.DotPlotProperties.labels.orientation,r.Orientation.Horizontal)+""=="Vertical"?r.Orientation.Vertical:r.Orientation.Horizontal,labelTextMaxSize:0,xAxisLabelTexMaxSize:0};var w={text:"W",fontFamily:"Segoe UI",fontSize:y.labelSettings.fontSize+"px"},C=0;for(var P in f){var D=f[P],T=_.max(D.values);C=T>C?T:C}var V=0;if(y.labelOrientation===r.Orientation.Vertical)for(var N in S){var L=S[N];L.textWidth=e.TextMeasurementService.measureSvgTextWidth(w)*L.value.length,V=L.value.length>V?L.value.length:V}y.labelTextMaxSize=e.TextMeasurementService.measureSvgTextWidth(w)*(C+" ").length,y.xAxisLabelTexMaxSize=e.TextMeasurementService.measureSvgTextWidth(w)*V,y.labelOrientation===r.Orientation.Vertical&&(A=y.xAxisLabelTexMaxSize);var M=t.categorical.categories[0],k=2*d+1,I=p.height-d-A-(y.labelOrientation===r.Orientation.Vertical?y.labelTextMaxSize:0),O=Math.floor((I-o.top)/k)-1,F=l.fromPoint(y.labelSettings.fontSize),z=d3.scale.linear().domain([0,O]).range([I-o.bottom,o.top+o.bottom]);for(var P in f)for(var D=f[P],j=_.min(D.values),T=_.max(D.values),G=g.getFillColor(a,i.DotPlotProperties.dataPoint.fill,h.getColorByIndex(0).value),R=D&&D.values?D.values.length:0,B=j/(T/O),H=d3.scale.log().domain([0>j?1:j,T]).range([0>=B?1:B,O]).clamp(!0),E=0;R>E;E++){for(var W=H(D.values[E]),U=[],Y=0;W>Y;Y++)U.push({x:s(S[E].value)+s.rangeBand()/2,y:z(Y)+(y.labelOrientation===r.Orientation.Vertical?y.labelTextMaxSize:0),tooltipInfo:c.getTooltipData(D.values[E].toFixed(y.labelSettings.precision))});var X=m.builder().withCategory(M,E).createSelectionId(),q=c.getTooltipData(D.values[E].toFixed(y.labelSettings.precision));v.push({selected:!1,value:D.values[E],label:D.values[E],color:G,identity:X,tooltipInfo:q,dataPoints:U,labelFontSize:F})}return{dataPoints:v,values:t.categorical.categories[0].values,displayName:x,categories:S,settings:y}},c.prototype.init=function(e){var t=e.element;this.behavior=new I,this.interactivityService=y(e.host),this.radius=T,this.strokeWidth=V,this.colors=e.style.colorPalette.dataColors,this.svg=d3.select(t.get(0)).append("svg").classed(this.dotPlotSelectors.svgPlotSelector["class"],!0).style("position","absolute").style("left","5px"),this.clearCatcher=f(this.svg);var i=this.svg.append("g").classed(this.dotPlotSelectors.axisSelector["class"],!0);this.dotPlot=this.svg.append("g").classed(this.dotPlotSelectors.plotSelector["class"],!0),this.xAxis=i.append("g").classed(this.dotPlotSelectors.xAxisSelector["class"],!0)},c.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){this.durationAnimations=s(this.animator,e.suppressAnimations);var t=this.dataView=e.dataViews[0],i=e.viewport;if(!t||!t.categorical||!t.categorical.values||t.categorical.values.length<1||!t.categorical||!t.categorical.categories||!t.categorical.categories[0])return void this.clearData();var a={height:i.height-this.DefaultMargin.top,width:i.width-this.DefaultMargin.left};this.viewportIn=a,this.svg.style({height:l.toString(i.height),width:l.toString(i.width)});var o=c.getObjectsFromDataView(t),n=c.parseCategoryAxisSettings(o,this.DefaultDotPlotSettings),u=this.calculateAxes(a,n,this.textProperties,o,!1),h=c.converter(t,o,u.scale,this.DefaultMargin,this.DefaultDotPlotSettings,this.colors,i,this.radius);this.dotPlotDataView=h;var d=h.dataPoints;this.interactivityService&&this.interactivityService.applySelectionStateToData(d),this.renderAxis(a.height-A,a,u,n,h,this.durationAnimations),this.drawDotPlot(d,h.settings);var g=h.settings.labelSettings;if(g.show){var m=this.getEnhanchedDotplotLayout(g,a),y=p.drawDefaultLabelsForDataPointChart(d,this.svg,m,a,!e.suppressAnimations,this.durationAnimations);y&&y.attr("transform",function(e){return h.settings.labelOrientation===r.Orientation.Vertical?v.translateAndRotate(e.size.height/2,0-e.size.width/2,e.anchorPoint.x,e.anchorPoint.y,-90):v.translate(0,0)})}else p.cleanDataLabels(this.svg)}},c.prototype.enumerateObjectInstances=function(e){var t=new x;switch(e.objectName){case"dataPoint":this.enumerateDataPoints(t,this.dataView);break;case"labels":this.enumerateDataLabels(t,this.dataView);break;case"categories":this.enumerateCategories(t,this.dataView);break;case"categoryAxis":this.enumerateCategoryAxisValues(t,this.dataView)}return t.complete()},c.prototype.enumerateCategoryAxisValues=function(e,t){var a=t&&t.metadata?t.metadata.objects:void 0;e.pushInstance({objectName:"categoryAxis",displayName:"Category Axis",selector:null,properties:{show:g.getValue(a,i.DotPlotProperties.categoryAxis.show,this.DefaultDotPlotSettings.categoryAxisSettings.show),showAxisTitle:g.getValue(a,i.DotPlotProperties.categoryAxis.showAxisTitle,this.DefaultDotPlotSettings.categoryAxisSettings.showAxisTitle),labelColor:a&&a.categoryAxis&&a.categoryAxis.labelColor?a.categoryAxis.labelColor:this.DefaultDotPlotSettings.categoryAxisSettings.labelColor}})},c.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},c.parseSettings=function(e,t){var a=this.getPrecision(e,t);return{show:g.getValue(e,i.DotPlotProperties.labels.show,t.labelSettings.show),precision:a,fontSize:g.getValue(e,i.DotPlotProperties.labels.fontSize,t.labelSettings.fontSize),displayUnits:g.getValue(e,i.DotPlotProperties.labels.labelDisplayUnits,t.labelSettings.displayUnits),labelColor:g.getFillColor(e,i.DotPlotProperties.labels.labelColor,t.labelSettings.labelColor)}},c.parseCategoryAxisSettings=function(e,t){return{show:g.getValue(e,i.DotPlotProperties.categoryAxis.show,t.categoryAxisSettings.show),showAxisTitle:g.getValue(e,i.DotPlotProperties.categoryAxis.showAxisTitle,t.categoryAxisSettings.showAxisTitle),labelColor:e&&e.categoryAxis&&e.categoryAxis.labelColor?e.categoryAxis.labelColor:t.categoryAxisSettings.labelColor
}},c.getCategorySettings=function(e,t){return{show:b.getValue(e,i.DotPlotProperties.categories.show,t.categorySettings.show),fontColor:g.getFillColor(e,i.DotPlotProperties.categories.fontColor,t.categorySettings.fontColor)}},c.getPrecision=function(e,t){var a=g.getValue(e,i.DotPlotProperties.labels.labelPrecision,t.labelSettings.precision);return L>=a?L:a>=M?M:a},c.prototype.drawDotPlot=function(e,i){var a=this.dotPlot.selectAll(this.dotPlotSelectors.plotGroupSelector.selector).data(e),r=this.interactivityService&&this.interactivityService.hasSelection();a.enter().append("g").attr({stroke:"black","stroke-width":this.strokeWidth}).style("fill-opacity",function(e){return t.ColumnUtil.getFillOpacity(e.selected,e.highlight,r,!1)}).classed(this.dotPlotSelectors.plotGroupSelector["class"],!0);var s=a.selectAll(this.dotPlotSelectors.circleSeletor.selector).data(function(e){return e.dataPoints});s.enter().append("circle").classed(this.dotPlotSelectors.circleSeletor["class"],!0),s.attr({cx:function(e){return e.x},cy:function(e){return e.y},r:this.radius,fill:i.defaultDataPointColor}),this.renderTooltip(a),s.exit().remove(),a.exit().remove();var o=this.interactivityService;if(o){o.applySelectionStateToData(e);var n={columns:a,clearCatcher:this.clearCatcher,interactivityService:this.interactivityService};o.bind(e,this.behavior,n)}},c.prototype.getEnhanchedDotplotLayout=function(e,t){var r=a.PixelConverter.fromPoint(e.fontSize),s=S.create({format:S.getFormatString(this.dataView.categorical.categories[0].source,i.DotPlotProperties.general.formatString),precision:e.precision,value:e.displayUnits});return{labelText:function(i){return p.getLabelFormattedText({label:s.format(i.label),fontSize:e.fontSize,maxWidth:t.width})},labelLayout:{x:function(e){return e.dataPoints[e.dataPoints.length-1].x-5},y:function(e){return e.dataPoints[e.dataPoints.length-1].y-D-5}},filter:function(e){return e&&e.dataPoints&&e.dataPoints[e.dataPoints.length-1]},style:{fill:e.labelColor,"font-size":r}}},c.prototype.enumerateDataLabels=function(e,t){var a=t&&t.metadata?t.metadata.objects:void 0;e.pushInstance({objectName:"labels",displayName:"Labels",selector:null,properties:{show:g.getValue(a,i.DotPlotProperties.labels.show,this.DefaultDotPlotSettings.labelSettings.show),fontSize:g.getValue(a,i.DotPlotProperties.labels.fontSize,this.DefaultDotPlotSettings.labelSettings.fontSize),labelPrecision:g.getValue(a,i.DotPlotProperties.labels.labelPrecision,this.DefaultDotPlotSettings.labelSettings.precision),labelDisplayUnits:g.getValue(a,i.DotPlotProperties.labels.labelDisplayUnits,this.DefaultDotPlotSettings.labelSettings.displayUnits),color:g.getFillColor(a,i.DotPlotProperties.labels.labelColor,this.DefaultDotPlotSettings.labelSettings.labelColor),orientation:g.getValue(a,i.DotPlotProperties.labels.orientation,r.Orientation.Horizontal)}})},c.prototype.enumerateDataPoints=function(e,t){var a=t&&t.metadata?t.metadata.objects:void 0,r=g.getFillColor(a,i.DotPlotProperties.dataPoint.fill,this.DefaultDotPlotSettings.defaultDataPointColor);e.pushInstance({objectName:"dataPoint",displayName:"Data Points",selector:null,properties:{fill:{solid:{color:r}}}})},c.prototype.enumerateCategories=function(e,t){var i=t&&t.metadata?t.metadata.objects:void 0,a=c.getCategorySettings(i,this.DefaultDotPlotSettings);e.pushInstance({objectName:"categories",displayName:"Categories",selector:null,properties:{show:a.show,fontSize:a.fontSize,fontColor:a.fontColor}})},c.prototype.clearData=function(){this.dotPlot.selectAll("*").remove(),this.xAxis.selectAll("*").remove(),p.cleanDataLabels(this.svg)},c.prototype.renderTooltip=function(e){w.addTooltip(e,function(e){return e.data.tooltipInfo})},c.prototype.calculateAxes=function(e,t,a,s,o){var n=this.dataView.categorical.categories&&this.dataView.categorical.categories.length>0?this.dataView.categorical.categories[0]:{source:void 0,values:[S.format(null)],identity:void 0},l={viewport:e,margin:this.DefaultMargin,forcedXDomain:this.dataView.categorical.categories[0].values,forceMerge:!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:this.scaleType,valueAxisScaleType:null,valueAxisDisplayUnits:0,categoryAxisDisplayUnits:0,trimOrdinalDataOnOverflow:!1},c=e.width,u=this.calculateAxesProperties(e,t,l,n.source,s);u.willLabelsFit=C.LabelLayoutStrategy.willLabelsFit(u,c,P.measureSvgTextWidth,a);var h=g.getValue(s,i.DotPlotProperties.labels.orientation,r.Orientation.Horizontal)+""=="Vertical"?r.Orientation.Vertical:r.Orientation.Horizontal;return h!==r.Orientation.Vertical?u.willLabelsWordBreak=!u.willLabelsFit&&!o&&C.LabelLayoutStrategy.willLabelsWordBreak(u,this.DefaultMargin,c,P.measureSvgTextWidth,P.estimateSvgTextHeight,P.getTailoredTextOrDefault,a):u.willLabelsWordBreak=!1,u},c.prototype.calculateAxesProperties=function(e,t,a,r,s){var o=C.createAxis({pixelSpan:e.width,dataDomain:a.forcedXDomain,metaDataColumn:r,formatString:S.getFormatString(r,i.DotPlotProperties.general.formatString),outerPadding:0,isScalar:!1,isVertical:!1,forcedTickCount:a.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(e,i){return t.show?e:""},scaleType:a.categoryAxisScaleType,axisDisplayUnits:a.categoryAxisDisplayUnits});return t.show&&(o.axisLabel=C.createAxisLabel(s,"","")),o},c.prototype.renderAxis=function(t,i,a,s,o,n){this.xAxis.attr({transform:v.translate(0,t)});var l=a.axis;l.orient("bottom"),this.xAxis.transition().duration(n).call(l).call(c.setAxisLabelColor,s.labelColor);var u=this.xAxis.selectAll(".tick text");u.data(a.values),o.settings.labelOrientation!==r.Orientation.Vertical&&u.call(C.LabelLayoutStrategy.clip,a.xLabelMaxWidth,P.svgEllipsis),o.settings.labelOrientation===r.Orientation.Vertical&&u.attr("transform",function(t){var i=12,a=e.TextMeasurementService.measureSvgTextWidth(t);return v.translateAndRotate(i/2-2*i,a+20,0,0,-90)}),u.append("title").text(function(e){return e}),this.xAxis.selectAll("line").style("opacity",o.settings.categoryAxisSettings.show?1:0),this.xAxis.selectAll(".xAxisLabel").remove(),o.settings.categoryAxisSettings.showAxisTitle&&this.xAxis.append("text").text(this.dataView.categorical.categories[0].source.displayName).style("text-anchor","middle").attr("class","xAxisLabel").style("fill",s.labelColor.solid.color).attr("transform","translate("+i.width/2+","+(o.settings.xAxisLabelTexMaxSize>0?o.settings.xAxisLabelTexMaxSize:40)+")")},c.setAxisLabelColor=function(e,t){e.selectAll("g.tick text").style("fill",t&&t.solid?t.solid.color:null)},c.capabilities={dataRoles:[{name:"Category",kind:e.VisualDataRoleKind.Grouping,displayName:"Category"},{name:"Values",kind:h.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Category:{max:1},Values:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{top:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Values"}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}}}},categoryAxis:{displayName:"X-Axis",properties:{show:{displayName:"Show",type:{bool:!0}},showAxisTitle:{displayName:"Title",description:"Title options",type:{bool:!0}},labelColor:{displayName:"Label color",type:{fill:{solid:{color:!0}}}}}},dataPoint:{displayName:"Data colors",properties:{fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Data labels",description:"Display data label options",properties:{show:{displayName:"Show",type:{bool:!0}},showSeries:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",description:"Select color for data labels",type:{fill:{solid:{color:!0}}}},labelDisplayUnits:{displayName:"Display units",description:"Select the units (millions, billions, etc.)",type:{formatting:{labelDisplayUnits:!0}},suppressFormatPainterCopy:!0},labelPrecision:{displayName:"Decimal places",description:"Select the number of decimal places to display",placeHolderText:"Auto",type:{numeric:!0},suppressFormatPainterCopy:!0},showAll:{displayName:"Customize series",type:{bool:!0}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}},orientation:{displayName:"Orientation",type:{enumeration:r.type}}}}}},c}();i.DotPlot=k;var I=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.columns=e.columns,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.columns.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),e.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var t=this.interactivityService.hasSelection();this.columns.style("fill-opacity",function(i){return O.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&t)})},e}();i.DotplotBehavior=I;var O;!function(e){function t(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getFillOpacity=t}(O=i.dotPlotUtils||(i.dotPlotUtils={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var r=a.PixelConverter;!function(e){e[e.ByWeight="By Weight"]="ByWeight",e[e.ByLinkType="By Link Type"]="ByLinkType",e[e.Interactive="Interactive"]="Interactive"}(i.LinkColorType||(i.LinkColorType={}));var s=i.LinkColorType,o=function(){function i(){this.labels={show:!0,color:t.dataLabelUtils.defaultLabelColor,fontSize:t.dataLabelUtils.DefaultFontSizeInPt},this.links={showArrow:!1,showLabel:!1,colorLink:s.Interactive,thickenLink:!0,displayUnits:0,decimalPlaces:null},this.nodes={displayImage:!1,defaultImage:"Home",imageUrl:"",imageExt:".png",nameMaxLength:10,highlightReachableLinks:!1},this.size={charge:-15}}return Object.defineProperty(i,"Default",{get:function(){return new this},enumerable:!0,configurable:!0}),i.parse=function(e,t){var i=new this;if(!e||!e.metadata||!e.metadata.objects)return i;var a=this.getProperties(t);for(var r in t.objects)for(var s in t.objects[r].properties)if(i[r]&&_.has(i[r],s)){var o=t.objects[r].properties[s].type,n=this.getValueFnByType(o);i[r][s]=n(e.metadata.objects,a[r][s],i[r][s])}return i},i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},i.createEnumTypeFromEnum=function(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i=!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))},i.getValueFnByType=function(t){switch(_.keys(t)[0]){case"fill":return e.DataViewObjects.getFillColor;default:return e.DataViewObjects.getValue}},i.enumerateObjectInstances=function(e,i,a){var r=new t.ObjectEnumerationBuilder,s=e&&e[i.objectName];if(!s)return r.complete();var o={objectName:i.objectName,selector:null,properties:{}};for(var n in s)_.has(s,n)&&(o.properties[n]=s[n]);return r.pushInstance(o),r.complete()},i}();i.ForceGraphSettings=o;var n=function(){function e(){this.Source=null,this.Target=null,this.Weight=null,this.LinkType=null,this.SourceType=null,this.TargetType=null}return e.getMetadataColumns=function(t){var i=t&&t.metadata&&t.metadata.columns;return i&&_.mapValues(new e,function(e,t){return i.filter(function(e){return e.roles&&e.roles[t]})[0]})},e.getTableValues=function(e){var t=e&&e.table,i=this.getMetadataColumns(e);return i&&t&&_.mapValues(i,function(e,i){return e&&t.rows.map(function(t){return t[e.index]})})},e.getTableRows=function(e){var t=e&&e.table,i=this.getMetadataColumns(e);return i&&t&&t.rows.map(function(e){return _.mapValues(i,function(t,i){return t&&e[t.index]})})},e.Roles=Object.freeze(_.mapValues(new e,function(e,t){return t})),e}();i.ForceGraphColumns=n;var l=function(){function i(){this.uniqieId="_"+i.Count++ +"_"}return Object.defineProperty(i,"Href",{get:function(){return window.location.href.replace(window.location.hash,"")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"settings",{get:function(){return this.data&&this.data.settings},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"margin",{get:function(){return this.marginValue||{left:0,right:0,top:0,bottom:0}},set:function(e){this.marginValue=$.extend({},e),this.viewportInValue=i.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewport",{get:function(){return this.viewportValue||{width:0,height:0}},set:function(e){this.viewportValue=$.extend({},e),this.viewportInValue=i.substractMargin(this.viewport,this.margin)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewportIn",{get:function(){return this.viewportInValue||this.viewport},enumerable:!0,configurable:!0}),i.substractMargin=function(e,t){return{width:Math.max(e.width-(t.left+t.right),0),height:Math.max(e.height-(t.top+t.bottom),0)}},i.prototype.scale1to10=function(e){var t=d3.scale.linear().domain([this.data.minFiles,this.data.maxFiles]).rangeRound([1,10]).clamp(!0);return t(e)},i.prototype.getLinkColor=function(e){switch(this.settings.links.colorLink){case s.ByWeight:return this.colors.getColorByIndex(this.scale1to10(e.weight)).value;case s.ByLinkType:return e.type&&this.data.linkTypes[e.type]?this.data.linkTypes[e.type].color:i.DefaultValues.defaultLinkColor}return i.DefaultValues.defaultLinkColor},i.prototype.enumerateObjectInstances=function(e){return o.enumerateObjectInstances(this.settings,e,i.capabilities)},i.converter=function(e,a){var r=e.categorical,s=i.parseSettings(e),l={},c=Number.MAX_VALUE,u=0,h={},p=[],d={},g=0,m=[],y=n.getMetadataColumns(e);if(!y||!y.Source||!y.Target)return null;var f=n.getTableRows(e),v=o.getProperties(i.capabilities).general.formatString,x=t.valueFormatter.getFormatString(r.categories[0].source,v),b=t.valueFormatter.getFormatString(r.categories[1].source,v),S=y.Weight&&t.valueFormatter.create({format:t.valueFormatter.getFormatString(y.Weight,v,!0),precision:s.links.decimalPlaces,value:s.links.displayUnits||_.max(f,function(e){return e.Weight}).Weight});return f.forEach(function(i){h[i.Source+","+i.Target]=1;var r=l[i.Source]||(l[i.Source]={name:i.Source,image:i.SourceType||"",adj:{}}),s=l[i.Target]||(l[i.Target]={name:i.Target,image:i.TargetType||"",adj:{}});r.adj[s.name]=1,s.adj[r.name]=1,m=[{displayName:e.metadata.columns[0].displayName,value:t.valueFormatter.format(r.name,x)},{displayName:e.metadata.columns[1].displayName,value:t.valueFormatter.format(s.name,b)}],y.Weight&&m.push({displayName:e.metadata.columns[2].displayName,value:i.Weight});var o={source:r,target:s,weight:Math.max(i.Weight,0),formattedWeight:i.Weight&&S.format(i.Weight),type:i.LinkType||"",tooltipInfo:m};y.LinkType&&(d[i.LinkType]||(d[i.LinkType]={label:i.LinkType,color:a.getColorByIndex(g++).value})),o.weight<c&&(c=o.weight),o.weight>u&&(u=o.weight),p.push(o)}),{nodes:l,links:p,minFiles:c,maxFiles:u,linkedByName:h,linkTypes:d,settings:s}},i.parseSettings=function(e){var t=o.parse(e,i.capabilities);return t.size.charge=Math.min(Math.max(t.size.charge,-100),-.1),t.links.decimalPlaces=t.links.decimalPlaces&&Math.min(Math.max(t.links.decimalPlaces,0),5),t},i.prototype.init=function(e){var t=this;this.root=d3.select(e.element.get(0)),this.forceLayout=d3.layout.force(),this.forceLayout.drag().on("dragstart",function(e){e.isDrag=!0,t.fadeNode(e)}).on("dragend",function(e){e.isDrag=!1,t.fadeNode(e)}).on("drag",function(e){return t.fadeNode(e)}),this.colors=e.style.colorPalette.dataColors},i.prototype.update=function(e){var a=this;if(e.dataViews&&!(e.dataViews.length<1)&&(this.data=i.converter(this.dataView=e.dataViews[0],this.colors),this.data)){this.viewport=e.viewport;var o=Math.sqrt(Object.keys(this.data.nodes).length/(this.viewport.width*this.viewport.height));this.root.selectAll("svg").remove();var n=this.root.append("svg").attr("width",this.viewport.width).attr("height",this.viewport.height).classed(i.VisualClassName,!0);if(this.forceLayout.gravity(100*o).links(this.data.links).size([this.viewport.width,this.viewport.height]).linkDistance(100).charge(this.settings.size.charge/o).on("tick",this.tick()),this.updateNodes(),this.forceLayout.start(),this.paths=n.selectAll(".link").data(this.forceLayout.links()).enter().append("path").attr("class","link").attr("id",function(e,t){return"linkid_"+a.uniqieId+t}).attr("stroke-width",function(e){return a.settings.links.thickenLink?a.scale1to10(e.weight):i.DefaultValues.defaultLinkThickness}).style("stroke",function(e){return a.getLinkColor(e)}).style("fill",function(e){return a.settings.links.showArrow?a.getLinkColor(e):void 0}).on("mouseover",this.fadePath(.3,i.DefaultValues.defaultLinkHighlightColor)).on("mouseout",this.fadePath(1,i.DefaultValues.defaultLinkColor)),t.TooltipManager.addTooltip(this.paths,function(e){return e.data.tooltipInfo}),this.settings.links.showLabel){var l=n.selectAll(".linklabelholder").data(this.forceLayout.links());l.enter().append("g").attr("class","linklabelholder").append("text").attr("class","linklabel").attr("y","-12").attr("text-anchor","middle").style("fill","#000").append("textPath").attr("xlink:href",function(e,t){return i.Href+"#linkid_"+a.uniqieId+t}).attr("startOffset","25%").text(function(e){return a.settings.links.colorLink===s.ByLinkType?e.type:e.formattedWeight}),l.exit().remove()}this.nodes=n.selectAll(".node").data(this.forceLayout.nodes()).enter().append("g").attr("class","node").call(this.forceLayout.drag).on("mouseover",function(e){e.isOver=!0,a.fadeNode(e)}).on("mouseout",function(e){e.isOver=!1,a.fadeNode(e)}).on("mousedown",function(){return d3.event.stopPropagation()}).attr("drag-resize-disabled",!0),this.settings.nodes.displayImage?this.nodes.append("image").attr("xlink:href",function(e){return e.image&&""!==e.image?a.settings.nodes.imageUrl+e.image+a.settings.nodes.imageExt:a.settings.nodes.defaultImage&&""!==a.settings.nodes.defaultImage?a.settings.nodes.imageUrl+a.settings.nodes.defaultImage+a.settings.nodes.imageExt:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAMAAAHNDTTxAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACuUExURQAAAMbGxvLy8sfHx/Hx8fLy8vHx8cnJycrKyvHx8fHx8cvLy/Ly8szMzM3NzfHx8dDQ0PHx8fLy8vHx8e/v79LS0tPT0/Ly8tTU1NXV1dbW1vHx8fHx8fDw8NjY2PT09PLy8vLy8vHx8fLy8vHx8fHx8enp6fDw8PLy8uPj4+Tk5OXl5fHx8b+/v/Pz8+bm5vHx8ejo6PLy8vHx8fLy8sTExPLy8vLy8sXFxfHx8YCtMbUAAAA6dFJOUwD/k/+b7/f///+r/////0z/w1RcEP//ZP///4fj/v8Yj3yXn/unDEhQ////YP9Y/8//aIMU/9+L/+fzC4s1AAAACXBIWXMAABcRAAAXEQHKJvM/AAABQElEQVQoU5WS61LCMBCFFymlwSPKVdACIgWkuNyL+P4v5ibZ0jKjP/xm0uw5ySa7mRItAhnMoIC5TwQZdCZiZjcoC8WU6EVsmZgzoqGdxafgvJAvjUXCb2M+0cXNsd/GDarZqSf7av3M2P1E3xhfLkPUvLD5joEYwVVJQXM6+9McWUwLf4nDTCQZAy96UoDjNI/jhl3xPLbQamu8xD7iaIsPKw7GJ7KZEnWLY3Gi8EFj5nqibXnwD5VEGjJXk5sbpLppfvvo1RazQVrhSopPK4TODrtnjS3dY4ic8KurruWQYF+UG60BacexTMyT2jlNg41dOmKvTpkUd/Jevy7ZxQ61ULRUpoododx8GeDPvIrktbFVdUsK6f8Na5VlVpjZJtowTXVy7kfXF5wCaV1tqXAFuIdWJu+JviaQzNzfQvQDGKRXXEmy83cAAAAASUVORK5CYII="}).attr("x","-12px").attr("y","-12px").attr("width","24px").attr("height","24px"):this.nodes.append("circle").attr("r",function(e){return e.weight<5?5:e.weight}),this.settings.labels.show&&this.nodes.append("text").attr({x:12,dy:".35em"}).style({fill:this.settings.labels.color,"font-size":r.fromPoint(this.settings.labels.fontSize)}).text(function(e){return e.name?e.name.length>a.settings.nodes.nameMaxLength?e.name.substr(0,a.settings.nodes.nameMaxLength):e.name:""})}},i.prototype.updateNodes=function(){var e=this.forceLayout.nodes();this.forceLayout.nodes(d3.values(this.data.nodes)),this.forceLayout.nodes().forEach(function(t,i){e[i]&&(t.x=e[i].x,t.y=e[i].y,t.px=e[i].px,t.py=e[i].py,t.weight=e[i].weight)})},i.prototype.tick=function(){var e=this,t=this.viewportIn,i=20*t.width,a=20*t.height,r=function(e){return Math.max((t.width-i)/2,Math.min((t.width+i)/2,e))},s=function(e){return Math.max((t.height-a)/2,Math.min((t.height+a)/2,e))},o=this.settings.links.showArrow?function(e){e.source.x=r(e.source.x),e.source.y=s(e.source.y),e.target.x=r(e.target.x),e.target.y=s(e.target.y);var t=e.target.x-e.source.x,i=e.target.y-e.source.y,a=Math.sqrt(t*t+i*i),o=Math.atan2(i,t)+Math.PI/7.85,n=Math.PI/2,l=e.target.x-6*Math.cos(o),c=e.target.y-6*Math.sin(o);return"M"+e.source.x+","+e.source.y+"A"+a+","+a+" 0 0 1,"+e.target.x+","+e.target.y+"A"+a+","+a+" 0 0 0,"+e.source.x+","+e.source.y+"M"+l+","+c+"l"+(3.5*Math.cos(n-o)-10*Math.cos(o))+","+(-3.5*Math.sin(n-o)-10*Math.sin(o))+"L"+(l-3.5*Math.cos(n-o)-10*Math.cos(o))+","+(c+3.5*Math.sin(n-o)-10*Math.sin(o))+"z"}:function(e){e.source.x=r(e.source.x),e.source.y=s(e.source.y),e.target.x=r(e.target.x),e.target.y=s(e.target.y);var t=e.target.x-e.source.x,i=e.target.y-e.source.y,a=Math.sqrt(t*t+i*i);return"M"+e.source.x+","+e.source.y+"A"+a+","+a+" 0 0,1 "+e.target.x+","+e.target.y};return function(){e.paths.each(function(){this.parentNode.insertBefore(this,this)}),e.paths.attr("d",o),e.nodes.attr("transform",function(e){return"translate("+r(e.x)+","+s(e.y)+")"})}},i.prototype.fadePath=function(e,t){var a=this;if(this.settings.links.colorLink===s.Interactive)return function(r){a.paths.style("stroke-opacity",function(t){return t.source===r.source&&t.target===r.target?1:e}),a.paths.style("stroke",function(e){return e.source===r.source&&e.target===r.target?t:i.DefaultValues.defaultLinkColor})}},i.prototype.isReachable=function(e,t){if(e.name===t.name)return!0;if(this.data.linkedByName[e.name+","+t.name])return!0;var i={};for(var a in this.data.nodes)i[a]=!1;i[e.name]=!0;var r=[];for(r.push(e.name);r.length>0;){var s=r.pop(),o=this.data.nodes[s];for(var n in o.adj){if(n===t.name)return!0;i[n]||(i[n]=!0,r.push(n))}}return!1},i.prototype.fadeNode=function(e){var t=this;if(this.settings.links.colorLink===s.Interactive){var a=function(e,i){return t.data.linkedByName[e.name+","+i.name]||t.data.linkedByName[i.name+","+e.name]||e.name===i.name},r=e.isOver||e.isDrag,o=r?.3:1,n=r?i.DefaultValues.defaultLinkHighlightColor:i.DefaultValues.defaultLinkColor,l=this;this.nodes.style("stroke-opacity",function(t){var i=(l.settings.nodes.highlightReachableLinks?l.isReachable(e,t):a(e,t))?1:o;return this.setAttribute("fill-opacity",i),i}),this.paths.style("stroke-opacity",function(i){return(t.settings.nodes.highlightReachableLinks?t.isReachable(e,i.source):i.source===e||i.target===e)?1:o}),this.paths.style("stroke",function(a){return(t.settings.nodes.highlightReachableLinks?t.isReachable(e,a.source):a.source===e||a.target===e)?n:i.DefaultValues.defaultLinkColor})}},i.prototype.destroy=function(){this.root=null},i.VisualClassName="forceGraph",i.Count=0,i.DefaultValues={defaultLinkColor:"#bbb",defaultLinkHighlightColor:"#f00",defaultLinkThickness:"1.5px"},i.capabilities={dataRoles:[{name:n.Roles.Source,kind:e.VisualDataRoleKind.Grouping,displayName:"Source"},{name:n.Roles.Target,kind:e.VisualDataRoleKind.Grouping,displayName:"Target"},{name:n.Roles.Weight,kind:e.VisualDataRoleKind.Measure,displayName:"Weight"},{name:n.Roles.LinkType,kind:e.VisualDataRoleKind.Grouping,displayName:"Link Type",description:"Links can be colored by link types"},{name:n.Roles.SourceType,kind:e.VisualDataRoleKind.Grouping,displayName:"Source Type",description:"Source type represents the image name for source entities"},{name:n.Roles.TargetType,kind:e.VisualDataRoleKind.Grouping,displayName:"Target Type",description:"Target type represents the image name for target entities"}],objects:{general:{properties:{formatString:{type:{formatting:{formatString:!0}}}}},labels:{displayName:"Data labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},links:{displayName:"Links",properties:{showArrow:{type:{bool:!0},displayName:"Arrow"},showLabel:{type:{bool:!0},displayName:"Label",description:"Displays weight on links"},colorLink:{type:{enumeration:o.createEnumTypeFromEnum(s)},displayName:"Color"},thickenLink:{type:{bool:!0},displayName:"Thickness",description:"Thickenss of links represents weight"},displayUnits:{displayName:"Display Units",type:{formatting:{labelDisplayUnits:!0}}},decimalPlaces:{displayName:"Decimal Places",placeHolderText:"Auto",type:{numeric:!0}}}},nodes:{displayName:"Nodes",properties:{displayImage:{type:{bool:!0},displayName:"Image",description:"Images are loaded from image url + source or target type + image extension"},defaultImage:{type:{text:!0},displayName:"Default image"},imageUrl:{type:{text:!0},displayName:"Image url"},imageExt:{type:{text:!0},displayName:"Image extension"},nameMaxLength:{type:{numeric:!0},displayName:"Max name length",description:"Max length of the name of entities displayed"},highlightReachableLinks:{type:{bool:!0},displayName:"Highlight all reachable links",description:"In interactive mode, whether a node's all reachable links will be highlighted"}}},size:{displayName:"Size",properties:{charge:{type:{numeric:!0},displayName:"Charge",description:"The larger the negative charge the more apart the entities, must be negative but greater than -100"}}}},dataViewMappings:[{conditions:[{Source:{max:1},Target:{max:1},Weight:{max:1},LinkType:{max:1},SourceType:{max:1},TargetType:{max:1}}],categorical:{categories:{"for":{"in":"Source"},dataReductionAlgorithm:{top:{}}},values:{select:[{bind:{to:"Target"}},{bind:{to:"Weight"}},{bind:{to:"LinkType"}},{bind:{to:"SourceType"}},{bind:{to:"TargetType"}}]},rowCount:{preferred:{min:1}}}}],suppressDefaultTitle:!0},i}();i.ForceGraph=l}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){function i(e){var t=!1;return n(Object.keys(e).filter(function(i,a){return!!(a%2)===t&&e[i]===i&&!void(t===!t)||!!(a%2)!==t}).map(function(e){return{value:e,displayName:e}}))}var r=a.PixelConverter,s=a.CssConstants.createClassAndSelector,o=e.visuals.utility.SelectionManager,n=e.createEnumType,l=e.visuals.LegendData,c=e.visuals.legendPosition,u=e.VisualDataRoleKind,h=e.data.createDisplayNameGetter,p=e.visuals.createInteractivityService,d=e.visuals.appendClearCatcher,g=e.visuals.createLegend,m=e.visuals.LegendPosition,y=e.visuals.valueFormatter,f=e.visuals.ColorHelper,v=e.visuals.SelectionId,x=e.DataViewObjects,b=e.visuals.LegendIcon,S=e.visuals.Legend,w=e.ValueType,C=e.PrimitiveType,P=e.visuals.AxisHelper,A=e.TextMeasurementService,D=e.visuals.TooltipManager,T=e.visuals.SVGUtil,V=e.visuals.ObjectEnumerationBuilder,N=e.visuals.axisScale,L="0.00 %;-0.00 %;0.00 %",M=864e5,k=6048e5,I=2629746e3,O=31556952e3,F=40,z=5;!function(e){e[e.Day="Day"]="Day",e[e.Week="Week"]="Week",e[e.Month="Month"]="Month",e[e.Year="Year"]="Year"}(t.GanttDateType||(t.GanttDateType={}));var j,G=t.GanttDateType;!function(e){e.ClassName=s("gantt"),e.Chart=s("chart"),e.ChartLine=s("chart-line"),e.Body=s("gantt-body"),e.AxisGroup=s("axis"),e.Domain=s("domain"),e.AxisTick=s("tick"),e.Tasks=s("tasks"),e.TaskGroup=s("task-group"),e.SingleTask=s("task"),e.TaskRect=s("task-rect"),e.TaskProgress=s("task-progress"),e.TaskResource=s("task-resource"),e.SingleMilestone=s("milestone"),e.TaskLabels=s("task-labels"),e.TaskLines=s("task-lines"),e.SingleTaskLine=s("task-line"),e.Label=s("label"),e.LegendItems=s("legendItem"),e.LegendTitle=s("legendTitle")}(j||(j={}));var R=function(){function e(){this.textProperties={fontFamily:"wf_segoe-ui_normal",fontSize:r.toString(9)},this.margin=e.DefaultMargin}return e.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},Object.defineProperty(e,"DefaultMargin",{get:function(){return{top:50,right:40,bottom:40,left:10}},enumerable:!0,configurable:!0}),e.prototype.init=function(e){this.viewport=_.clone(e.viewport),this.style=e.style,this.body=d3.select(e.element.get(0)),this.hostServices=e.host,this.selectionManager=new o({hostServices:e.host}),this.isInteractiveChart=e.interactivity&&e.interactivity.isInteractiveLegend,this.interactivityService=p(this.hostServices),this.createViewport(e.element),this.updateChartSize(),this.behavior=new B,this.colors=e.style.colorPalette.dataColors},e.prototype.createViewport=function(e){this.ganttDiv=this.body.append("div").classed(j.Body["class"],!0),this.ganttSvg=this.ganttDiv.append("svg").classed(j.ClassName["class"],!0),this.clearCatcher=d(this.ganttSvg),this.axisGroup=this.ganttSvg.append("g").classed(j.AxisGroup["class"],!0),this.lineGroup=this.ganttSvg.append("g").classed(j.TaskLines["class"],!0),this.chartGroup=this.ganttSvg.append("g").classed(j.Chart["class"],!0),this.taskGroup=this.chartGroup.append("g").classed(j.Tasks["class"],!0),this.legend=g(e,this.isInteractiveChart,this.interactivityService,!0,m.Top)},e.prototype.clearViewport=function(){this.body.selectAll(j.LegendItems.selector).remove(),this.body.selectAll(j.LegendTitle.selector).remove(),this.axisGroup.selectAll(j.AxisTick.selector).remove(),this.axisGroup.selectAll(j.Domain.selector).remove(),this.lineGroup.selectAll("*").remove(),this.chartGroup.selectAll(j.ChartLine.selector).remove(),this.chartGroup.selectAll(j.TaskGroup.selector).remove(),this.chartGroup.selectAll(j.SingleTask.selector).remove()},e.prototype.updateChartSize=function(){this.ganttDiv.style({height:r.toString(this.viewport.height),width:r.toString(this.viewport.width)})},e.getTaskProperty=function(e,t,i){if(!(t&&e&&e.length>0&&e[0].roles))return null;var a=e.indexOf(e.filter(function(e){return e.roles[i]})[0]);return-1!==a?t[a]:null},e.hasRole=function(e,t){var i=e.roles;return i&&i[t]},e.getTooltipInfo=function(t,i,a){void 0===a&&(a="Days");var r=[];return t.taskType&&r.push({displayName:e.capabilities.dataRoles[0].name,value:t.taskType}),r.push({displayName:e.capabilities.dataRoles[1].name,value:t.name}),isNaN(t.start.getDate())||r.push({displayName:e.capabilities.dataRoles[2].name,value:i.startDateFormatter.format(t.start.toLocaleDateString())}),r.push({displayName:e.capabilities.dataRoles[3].name,value:i.durationFormatter.format(t.duration)+" "+a}),r.push({displayName:e.capabilities.dataRoles[4].name,value:i.completionFormatter.format(t.completion)}),t.resource&&r.push({displayName:e.capabilities.dataRoles[5].name,value:t.resource}),r},e.isChartHasTask=function(t){if(t.table&&t.table.columns)for(var i=0,a=t.table.columns;i<a.length;i++){var r=a[i];if(e.hasRole(r,"Task"))return!0}return!1},e.getFormatters=function(t){if(!t||!t.metadata||!t.metadata.columns)return null;for(var i="d",a="#",r=0,s=t.metadata.columns;r<s.length;r++){var o=s[r];if(t.categorical.categories)for(var n=0,l=t.categorical.categories;n<l.length;n++){var c=l[n];e.hasRole(c.source,"StartDate")&&(i=o.format)}}return{startDateFormatter:y.create({format:i}),durationFormatter:y.create({format:a}),completionFormatter:y.create({format:L,value:1,allowFormatBeautification:!0})}},e.createTasks=function(t,i,a){var r=t.table.columns,s=t.table.rows,o=t.categorical.categories[0],n=new f(a,void 0);return s.map(function(a,s){var l=e.getTaskProperty(r,a,"StartDate");l=e.isValidDate(l)?l:new Date(Date.now());var c=e.getTaskProperty(r,a,"Duration"),u=e.getTaskProperty(r,a,"Completion"),h=e.convertToDecimal(u);h=1>=h?h:1;var p=e.getTaskProperty(r,a,"Legend"),d=n.getColorForMeasure(t.metadata.objects,p),g={id:s,name:e.getTaskProperty(r,a,"Task"),start:l?l:new Date(Date.now()),duration:c>0?c:1,end:null,completion:h>0?h:0,resource:e.getTaskProperty(r,a,"Resource"),taskType:p,color:d?d:e.DefaultValues.TaskColor,tooltipInfo:null,description:"",identity:v.createWithIdAndMeasure(o.identity[s],p),selected:!1};return g.end=d3.time.day.offset(g.start,g.duration),g.tooltipInfo=e.getTooltipInfo(g,i),g})},e.createSeries=function(t,i,a,r){var s=new f(r,void 0),o=_.groupBy(i,function(e){return e.taskType}),n=e.getAllTasksTypes(a),l=_.map(n.types,function(e){return{tasks:o[e],fill:s.getColorForMeasure(t,e),name:e,identity:v.createWithMeasure(e),
selected:!1}});return l},e.converter=function(t,i){if(!t||!t.categorical||!e.isChartHasTask(t)||0===t.table.rows.length)return null;var a=e.parseSettings(t,i),r=e.getAllTasksTypes(t),s={fontSize:a.legend.fontSize,dataPoints:[],title:r.typeName},o=new f(i,void 0);s.dataPoints=_.map(r.types,function(e){return{label:e,color:o.getColorForMeasure(t.metadata.objects,e),icon:b.Circle,selected:!1,identity:v.createWithMeasure(e)}});var n=this.getFormatters(t),l=e.createTasks(t,n,i),c=e.createSeries(t.metadata.objects,l,t,i),u={dataView:t,settings:a,tasks:l,series:c,legendData:s,taskTypes:r};return u},e.parseSettings=function(t,i){var a=_.cloneDeep(e.DefaultSettings);if(!t||!t.metadata||!t.metadata.objects)return a;var r=t.metadata.objects;return a.general.groupTasks=x.getValue(r,e.Properties.general.groupTasks,e.DefaultSettings.general.groupTasks),a.taskLabels.show=x.getValue(r,e.Properties.taskLabels.show,e.DefaultSettings.taskLabels.show),a.taskLabels.fill=x.getFillColor(r,e.Properties.taskLabels.fill,e.DefaultSettings.taskLabels.fill),a.taskLabels.fontSize=x.getValue(r,e.Properties.taskLabels.fontSize,e.DefaultSettings.taskLabels.fontSize),a.taskLabels.width=x.getValue(r,e.Properties.taskLabels.width,a.taskLabels.show?e.DefaultSettings.taskLabels.width:0),a.taskCompletion.show=x.getValue(r,e.Properties.taskCompletion.show,e.DefaultSettings.taskCompletion.show),delete a.taskCompletion.show,a.taskCompletion.fill=x.getFillColor(r,e.Properties.taskCompletion.fill,e.DefaultSettings.taskCompletion.fill),a.taskResource.show=x.getValue(r,e.Properties.taskResource.show,e.DefaultSettings.taskResource.show),a.taskResource.fontSize=x.getValue(r,e.Properties.taskResource.fontSize,e.DefaultSettings.taskResource.fontSize),a.taskResource.fill=x.getFillColor(r,e.Properties.taskResource.fill,e.DefaultSettings.taskResource.fill),a.dateType.type=x.getValue(r,e.Properties.dateType.type,e.DefaultSettings.dateType.type),a.legend.show=x.getValue(r,e.Properties.legend.show,e.DefaultSettings.legend.show),a.legend.fontSize=x.getValue(r,e.Properties.legend.fontSize,e.DefaultSettings.legend.fontSize),a.legend.labelColor=x.getFillColor(r,e.Properties.legend.labelColor,e.DefaultSettings.legend.labelColor),a.legend.position=x.getValue(r,e.Properties.legend.position,e.DefaultSettings.legend.position),a.legend.showTitle=x.getValue(r,e.Properties.legend.showTitle,e.DefaultSettings.legend.showTitle),a.legend.titleText=x.getValue(r,e.Properties.legend.titleText,e.DefaultSettings.legend.titleText),a},e.isValidDate=function(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:!isNaN(e.getTime())},e.convertToDecimal=function(e){return e>=0&&1>=e?e:e/100},e.getAllTasksTypes=function(e){var t,i=[],a="",r=e.table.rows,s=_.findIndex(e.table.columns,function(e){return e.roles.hasOwnProperty("Legend")});return-1!==s&&(a=e.table.columns[s].displayName,i=_.unique(r,function(e){return e[s]}).map(function(e){return e[s]})),t={typeName:a,types:i}},e.prototype.renderLegend=function(){if(this.viewModel.legendData){l.update(this.viewModel.legendData,x.getObject(this.viewModel.dataView.metadata.objects,"legend",{}));var e=this.viewModel.settings.legend.show?m[this.viewModel.settings.legend.position]:m.None;switch(this.legend.changeOrientation(e),this.legend.drawLegend(this.viewModel.legendData,_.clone(this.viewport)),S.positionChartArea(this.ganttDiv,this.legend),this.legend.getOrientation()){case m.Left:case m.LeftCenter:case m.Right:case m.RightCenter:this.viewport.width-=this.legend.getMargins().width;break;case m.Top:case m.TopCenter:case m.Bottom:case m.BottomCenter:this.viewport.height-=this.legend.getMargins().height}}},e.prototype.update=function(t){if(t.dataViews&&t.dataViews[0]){if(this.viewModel=e.converter(t.dataViews[0],this.colors),!this.viewModel)return void this.clearViewport();this.viewport=_.clone(t.viewport),this.margin=e.DefaultMargin,this.renderLegend(),this.updateChartSize();var i=this.viewModel.tasks;if(this.interactivityService&&(this.interactivityService.applySelectionStateToData(i),this.interactivityService.applySelectionStateToData(this.viewModel.series)),i.length>0){var a=_.sortBy(i,function(e){return e.start}),s=_.sortBy(i,function(e){return e.end}),o=this.getDateType(),n=a[0].start,l=s[i.length-1].end,c=Math.ceil(Math.round(l.valueOf()-n.valueOf())/o),u=this.groupTasks(i);c=0===c||1===c?2:c;var h=50*c;this.ganttSvg.attr({height:r.toString(u.length*F+this.margin.top),width:r.toString(this.margin.left+this.viewModel.settings.taskLabels.width+h+e.DefaultValues.ResourceWidth)});var p={height:this.viewport.height,width:h},d=this.calculateAxes(p,this.textProperties,n,l,h,c,!1);if(this.timeScale=d.scale,this.renderAxis(d,200),this.renderTasks(u),this.createMilestoneLine(u),this.updateTaskLabels(u,this.viewModel.settings.taskLabels.width),this.updateElementsPositions(this.viewport,this.margin),this.interactivityService){var g={clearCatcher:this.clearCatcher,taskSelection:this.taskGroup.selectAll(j.SingleTask.selector),legendSelection:this.body.selectAll(j.LegendItems.selector),interactivityService:this.interactivityService};this.interactivityService.bind(i,this.behavior,g)}}}},e.prototype.getDateType=function(){var e=k;switch(this.viewModel.settings.dateType.type){case"Day":e=M;break;case"Week":e=k;break;case"Month":e=I;break;case"Year":e=O}return e},e.prototype.calculateAxes=function(e,t,i,a,r,s,o){var n=w.fromPrimitiveTypeAndCategory(C.Date),l={displayName:"StartDate",queryName:"StartDate",type:n,index:0},c={viewport:e,margin:this.margin,forcedXDomain:[i,a],forceMerge:!1,showCategoryAxisLabel:!1,showValueAxisLabel:!1,categoryAxisScaleType:N.linear,valueAxisScaleType:null,valueAxisDisplayUnits:0,categoryAxisDisplayUnits:0,trimOrdinalDataOnOverflow:!1,forcedTickCount:s},u=e.width,h=this.calculateAxesProperties(e,c,r,l);return h.willLabelsFit=P.LabelLayoutStrategy.willLabelsFit(h,u,A.measureSvgTextWidth,t),h.willLabelsWordBreak=!h.willLabelsFit&&!o&&P.LabelLayoutStrategy.willLabelsWordBreak(h,this.margin,u,A.measureSvgTextWidth,A.estimateSvgTextHeight,A.getTailoredTextOrDefault,t),h},e.prototype.calculateAxesProperties=function(t,i,a,r){var s=this,o=P.createAxis({pixelSpan:t.width,dataDomain:i.forcedXDomain,metaDataColumn:r,formatString:e.DefaultValues.DateFormatStrings[this.viewModel.settings.dateType.type],outerPadding:0,isScalar:!0,isVertical:!1,forcedTickCount:i.forcedTickCount,useTickIntervalForDisplayUnits:!0,isCategoryAxis:!0,getValueFn:function(t,i){return y.format(new Date(t),e.DefaultValues.DateFormatStrings[s.viewModel.settings.dateType.type])},scaleType:i.categoryAxisScaleType,axisDisplayUnits:i.categoryAxisDisplayUnits});return o.axisLabel=r.displayName,o},e.prototype.groupTasks=function(e){if(this.viewModel.settings.general.groupTasks){var t=_.groupBy(e,function(e){return e.name}),i=_.map(t,function(e,i){return{name:i,tasks:t[i]}});return i.forEach(function(e,t){e.tasks.forEach(function(e){return e.id=t}),e.id=t}),i}return e.map(function(e){return{name:e.name,id:e.id,tasks:[e]}})},e.prototype.renderAxis=function(e,t){var i=e.axis;i.orient("bottom"),this.axisGroup.transition().duration(t).call(i)},e.prototype.updateTaskLabels=function(t,i){var a,s=this,o=15,n=this.viewModel?this.viewModel.settings.taskLabels.show:!0,l=this.viewModel?this.viewModel.settings.taskLabels.fill:e.DefaultSettings.taskLabels.fill,c=this.viewModel?this.viewModel.settings.taskLabels.fontSize:e.DefaultSettings.taskLabels.fontSize;n?(a=this.lineGroup.selectAll(j.Label.selector).data(t),a.enter().append("text").classed(j.Label["class"],!0),a.attr({x:o,y:function(e,t){return s.getTaskLabelCoordinateY(e.id)},fill:l,"stroke-width":1}).style("font-size",r.fromPoint(c)).text(function(e){return e.name}),a.call(P.LabelLayoutStrategy.clip,i-20,A.svgEllipsis),a.append("title").text(function(e){return e.name}),a.exit().remove()):this.lineGroup.selectAll(j.Label.selector).remove()},e.prototype.renderTasks=function(t){var i=this,a=this.taskGroup.selectAll(j.TaskGroup.selector).data(t),s=this.viewModel?this.viewModel.settings.taskCompletion.fill:e.DefaultSettings.taskCompletion.fill,o=this.viewModel?this.viewModel.settings.taskResource.show:!0,n=4,l=this.viewModel?this.viewModel.settings.taskResource.fill:e.DefaultSettings.taskResource.fill,c=this.viewModel?this.viewModel.settings.taskResource.fontSize:e.DefaultSettings.taskResource.fontSize;a.enter().append("g").classed(j.TaskGroup["class"],!0);var u=a.selectAll(j.SingleTask.selector).data(function(e){return e.tasks});u.enter().append("g").classed(j.SingleTask["class"],!0);var h=u.selectAll(j.TaskRect.selector).data(function(e){return[e]});h.enter().append("rect").classed(j.TaskRect["class"],!0),h.classed(j.TaskRect["class"],!0).attr({x:function(e){return i.timeScale(e.start)},y:function(e){return i.getBarYCoordinate(e.id)},width:function(e){return i.taskDurationToWidth(e)},height:function(){return i.getBarHeight()}}).style("fill",function(e){return e.color}),h.exit().remove();var p=u.selectAll(j.TaskProgress.selector).data(function(e){return[e]});if(p.enter().append("rect").classed(j.TaskProgress["class"],!0),p.attr({x:function(e){return i.timeScale(e.start)},y:function(t){return i.getBarYCoordinate(t.id)+i.getBarHeight()/2-e.DefaultValues.ProgressBarHeight/2},width:function(e){return i.setTaskProgress(e)},height:e.DefaultValues.ProgressBarHeight}).style("fill",s),p.exit().remove(),o){var d=u.selectAll(j.TaskResource.selector).data(function(e){return[e]});d.enter().append("text").classed(j.TaskResource["class"],!0),d.attr({x:function(e){return i.timeScale(e.end)+n},y:function(e){return i.getBarYCoordinate(e.id)+i.getBarHeight()/2+n}}).text(function(e){return e.resource}).style({fill:l,"font-size":r.fromPoint(c)}).call(P.LabelLayoutStrategy.clip,e.DefaultValues.ResourceWidth-10,A.svgEllipsis),d.exit().remove()}else u.selectAll(j.TaskResource.selector).remove();D.addTooltip(u,function(e){return e.data.tooltipInfo}),u.exit().remove(),a.exit().remove()},e.prototype.onClearSelection=function(){this.selectionManager.clear()},e.prototype.getTaskLabelCoordinateY=function(e){var t=+this.viewModel.settings.taskLabels.fontSize;return F*e+(this.getBarHeight()+5-(40-t)/4)},e.prototype.setTaskProgress=function(e){var t=e.completion/1,i=this.timeScale,a=(i(e.end)-i(e.start))*t;return a},e.prototype.getBarYCoordinate=function(e){return F*e+z},e.prototype.getBarHeight=function(){return F/1.5},e.prototype.taskDurationToWidth=function(e){return this.timeScale(e.end)-this.timeScale(e.start)},e.prototype.getTooltipForMilstoneLine=function(e,t){var i=new Date(e).toDateString(),a=[{displayName:t,value:i}];return a},e.prototype.createMilestoneLine=function(e,t,i){void 0===t&&(t="Today"),void 0===i&&(i=Date.now());var a=[{x1:this.timeScale(i),y1:0,x2:this.timeScale(i),y2:this.getMilestoneLineLength(e.length),tooltipInfo:this.getTooltipForMilstoneLine(i,t)}],r=this.chartGroup.selectAll(j.ChartLine.selector).data(a);r.enter().append("line").classed(j.ChartLine["class"],!0),r.attr({x1:function(e){return e.x1},y1:function(e){return e.y1},x2:function(e){return e.x2},y2:function(e){return e.y2},tooltipInfo:function(e){return e.tooltipInfo}}),D.addTooltip(r,function(e){return e.data.tooltipInfo}),r.exit().remove()},e.prototype.updateElementsPositions=function(e,t){this.axisGroup.attr("transform",T.translate(this.viewModel.settings.taskLabels.width+t.left,15)),this.chartGroup.attr("transform",T.translate(this.viewModel.settings.taskLabels.width+t.left,t.top)),this.lineGroup.attr("transform",T.translate(0,t.top))},e.prototype.getMilestoneLineLength=function(e){return e*F},e.prototype.enumerateGeneral=function(e){return[]},e.prototype.enumerateLegend=function(t){return[{displayName:e.Properties.legend.show.objectName,selector:null,properties:t.legend,objectName:e.Properties.legend.show.objectName}]},e.prototype.enumerateDataPoints=function(e){return this.viewModel.series.map(function(e){return{objectName:"dataPoint",displayName:e.name,selector:f.normalizeSelector(e.identity.getSelector(),!1),properties:{fill:{solid:{color:e.fill}}}}})},e.prototype.enumerateTaskCompletion=function(t){return[{selector:null,properties:t.taskCompletion,objectName:e.Properties.taskCompletion.show.objectName}]},e.prototype.enumerateTaskLabels=function(t){return[{selector:null,properties:t.taskLabels,objectName:e.Properties.taskLabels.show.objectName}]},e.prototype.enumerateTaskResources=function(t){return[{selector:null,properties:t.taskResource,objectName:e.Properties.taskResource.show.objectName}]},e.prototype.enumerateDateType=function(t){return[{selector:null,properties:t.dateType,objectName:e.Properties.dateType.type.objectName}]},e.prototype.enumerateObjectInstances=function(t){var i=this.viewModel&&this.viewModel.settings||e.DefaultSettings,a=new V,r=function(e){return e.forEach(function(e){return a.pushInstance(e)})};switch(t.objectName){case"general":r(this.enumerateGeneral(i));break;case"legend":r(this.enumerateLegend(i));break;case"dataPoint":r(this.enumerateDataPoints(i));break;case"taskLabels":r(this.enumerateTaskLabels(i));break;case"taskCompletion":r(this.enumerateTaskCompletion(i));break;case"taskResource":r(this.enumerateTaskResources(i));break;case"dateType":r(this.enumerateDateType(i))}return a.complete()},e.DefaultSettings={general:{groupTasks:!1},legend:{show:!0,position:c.right,showTitle:!0,titleText:"",labelColor:"#000000",fontSize:8},taskLabels:{show:!0,fill:"#000000",fontSize:9,width:110},taskCompletion:{show:!0,fill:"#000000"},taskResource:{show:!0,fill:"#000000",fontSize:9},dateType:{type:G.Week}},e.DefaultValues={AxisTickSize:6,MaxTaskOpacity:1,MinTaskOpacity:.4,ProgressBarHeight:4,ResourceWidth:100,TaskColor:"#00B099",TaskLineWidth:15,DefaultDateType:G.Week,DateFormatStrings:{Day:"MMM dd",Week:"MMM dd",Month:"MMM yyyy",Year:"yyyy"}},e.capabilities={dataRoles:[{name:"Legend",kind:u.Grouping,displayName:"Legend"},{name:"Task",kind:u.Grouping,displayName:"Task"},{name:"StartDate",kind:u.Grouping,displayName:"Start Date"},{name:"Duration",kind:u.Measure,displayName:"Duration",requiredTypes:[{numeric:!0},{integer:!0}]},{name:"Completion",kind:u.Measure,displayName:"% Completion",requiredTypes:[{numeric:!0},{integer:!0}]},{name:"Resource",kind:u.Grouping,displayName:"Resource"}],dataViewMappings:[{conditions:[{Legend:{min:0,max:1},Task:{min:1,max:1},StartDate:{min:0,max:0},Duration:{min:0,max:0},Completion:{min:0,max:0},Resource:{min:0,max:0}},{Legend:{min:0,max:1},Task:{min:1,max:1},StartDate:{min:0,max:1},Duration:{min:0,max:0},Completion:{min:0,max:0},Resource:{min:0,max:0}},{Legend:{min:0,max:1},Task:{min:0,max:1},StartDate:{min:0,max:1},Duration:{min:0,max:1},Completion:{min:0,max:1},Resource:{min:0,max:1}}],table:{rows:{select:[{"for":{"in":"Legend"}},{"for":{"in":"Task"}},{"for":{"in":"StartDate"}},{"for":{"in":"Duration"}},{"for":{"in":"Completion"}},{"for":{"in":"Resource"}}]}}}],objects:{general:{displayName:h("Visual_General"),properties:{groupTasks:{displayName:"Group Tasks",type:{bool:!0}}}},legend:{displayName:"Legend",description:"Display legend options",properties:{show:{displayName:"Show",type:{bool:!0}},position:{displayName:"Position",description:"Select the location for the legend",type:{enumeration:c.type}},showTitle:{displayName:"Title",description:"Display a title for legend symbols",type:{bool:!0}},titleText:{displayName:"Legend Name",description:"Title text",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},taskLabels:{displayName:"Category Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Fill",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Font Size",type:{formatting:{fontSize:!0}}},width:{displayName:"Width",type:{numeric:!0}}}},taskCompletion:{displayName:"Task Completion",properties:{show:{type:{bool:!0}},fill:{displayName:"Completion Color",type:{fill:{solid:{color:!0}}}}}},taskResource:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fill:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Font Size",type:{formatting:{fontSize:!0}}}}},dateType:{displayName:"Gantt Date Type",properties:{type:{displayName:"Type",type:{enumeration:i(G)}}}}},sorting:{"default":{}}},e.Properties=e.getProperties(e.capabilities),e}();t.Gantt=R;var B=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.options=e;var i=e.clearCatcher;e.taskSelection.on("click",function(e){t.handleSelection(e,d3.event.ctrlKey),d3.event.stopPropagation()}),i.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){this.options.taskSelection.style("opacity",function(t){return e&&!t.selected?R.DefaultValues.MinTaskOpacity:R.DefaultValues.MaxTaskOpacity})},e}();t.GanttChartBehavior=B;var H=function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"GanttChartWarning"},enumerable:!0,configurable:!0}),e.prototype.getMessages=function(e){var t,i="This visual requires task value",a="",r="";return t={message:i,title:e.get(a),detail:e.get(r)}},e}();t.GanttChartWarning=H}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi,r=(window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft,this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});!function(e){var t;!function(t){var i;!function(i){var s=a.CssConstants.createClassAndSelector,o=t.utility.SelectionManager,n=a.PixelConverter.toString,l=a.PixelConverter.fromPoint,c=a.PixelConverter.fromPointToPixel;i.Months=e.createEnumType([{value:1,displayName:"January"},{value:2,displayName:"February"},{value:3,displayName:"March"},{value:4,displayName:"April"},{value:5,displayName:"May"},{value:6,displayName:"June"},{value:7,displayName:"July"},{value:8,displayName:"August"},{value:9,displayName:"September"},{value:10,displayName:"October"},{value:11,displayName:"November"},{value:12,displayName:"December"}]),i.WeekDays=e.createEnumType([{value:0,displayName:"Sunday"},{value:1,displayName:"Monday"},{value:2,displayName:"Tuesday"},{value:3,displayName:"Wednesday"},{value:4,displayName:"Thursday"},{value:5,displayName:"Friday"},{value:6,displayName:"Saturday"}]),function(e){e[e.year=0]="year",e[e.quarter=1]="quarter",e[e.month=2]="month",e[e.week=3]="week",e[e.day=4]="day"}(i.GranularityType||(i.GranularityType={}));var u=i.GranularityType,h={objectName:"cells",propertyName:"fillSelected"},p={objectName:"cells",propertyName:"fillUnselected"},d={objectName:"granularity",propertyName:"scaleColor"},g={objectName:"granularity",propertyName:"sliderColor"},m={objectName:"rangeHeader",propertyName:"fontColor"},y={objectName:"rangeHeader",propertyName:"textSize"},f={objectName:"rangeHeader",propertyName:"show"},v={objectName:"labels",propertyName:"fontColor"},x={objectName:"labels",propertyName:"textSize"},b={objectName:"labels",propertyName:"show"},S={objectName:"calendar",propertyName:"month"},w={objectName:"calendar",propertyName:"day"},C={objectName:"weekDay",propertyName:"day"},P=[{granularityType:u.year,name:"year"},{granularityType:u.quarter,name:"quarter"},{granularityType:u.month,name:"month"},{granularityType:u.week,name:"week"},{granularityType:u.day,name:"day"}],A=function(){function e(){this.datePeriods=[]}return e.prototype.shortMonthName=function(e){return e.toString().split(" ")[1]},e.prototype.resetDatePeriods=function(){this.datePeriods=[]},e.prototype.getDatePeriods=function(){return this.datePeriods},e.prototype.getExtendedLabel=function(){return this.extendedLabel},e.prototype.setExtendedLabel=function(e){this.extendedLabel=e},e.prototype.createLabels=function(e){var t,i=[];return _.map(this.datePeriods,function(a){!_.isEmpty(i)&&e.sameLabel(a,t)||(t=a,i.push(e.generateLabel(a)))}),i},e.prototype.addDate=function(e,t){var i=this.getDatePeriods(),a=i[i.length-1];0!==i.length&&_.isEqual(a.identifierArray,t)?a.endDate=e:(i.length>0&&(a.endDate=e),i.push({identifierArray:t,startDate:e,endDate:e,week:this.determineWeek(e),year:this.determineYear(e),fraction:1,index:i.length}))},e.prototype.setNewEndDate=function(e){_.last(this.datePeriods).endDate=e},e.prototype.splitPeriod=function(e,t,i){var a=this.datePeriods[e];a.fraction-=t;var r={identifierArray:a.identifierArray,startDate:i,endDate:a.endDate,week:this.determineWeek(i),year:this.determineYear(i),fraction:t,index:a.index+a.fraction};a.endDate=i,this.datePeriods.splice(e+1,0,r)},e.prototype.previousMonth=function(e){return e>0?e-1:11},e.prototype.nextMonth=function(e){return 11>e?e+1:0},e.prototype.countWeeks=function(e,t){var i;if(t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()>=e.getDate())i=t.getDate()-e.getDate();else{i=t.getDate()-1;for(var a=this.nextMonth(e.getMonth()),r=t.getMonth();r!==a;)i+=new Date(t.getFullYear(),r,0).getDate(),r=this.previousMonth(r);i+=new Date(t.getFullYear(),a,0).getDate()-e.getDate()}return 1+Math.floor(i/7)},e.prototype.determineWeek=function(e){var t=e.getFullYear();this.inPreviousYear(e)&&t--;var i=O.calendar.getDateOfFirstWeek(t),a=this.countWeeks(i,e);return[a,t]},e.prototype.inPreviousYear=function(e){var t=O.calendar.getDateOfFirstWeek(e.getFullYear());return t>e},e.prototype.determineYear=function(e){var t=new Date(e.getFullYear(),O.calendar.getFirstMonthOfYear(),O.calendar.getFirstDayOfYear());return e.getFullYear()-(e>=t?0:1)},e}();i.TimelineGranularity=A;var D=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return u.day},t.prototype.splitDate=function(e){return[this.shortMonthName(e),e.getDate(),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return e.startDate.getTime()===t.startDate.getTime()},t.prototype.generateLabel=function(e){return{title:this.shortMonthName(e.startDate)+" "+e.startDate.getDate()+" - "+e.year,text:e.startDate.getDate().toString(),id:e.index}},t}(A);i.DayGranularity=D;var T=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return u.month},t.prototype.splitDate=function(e){return[this.shortMonthName(e),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return this.shortMonthName(e.startDate)===this.shortMonthName(t.startDate)},t.prototype.generateLabel=function(e){var t=this.shortMonthName(e.startDate);return{title:t,text:t,id:e.index}},t}(A);i.MonthGranularity=T;var V=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return u.week},t.prototype.splitDate=function(e){return this.determineWeek(e)},t.prototype.sameLabel=function(e,t){return _.isEqual(e.week,t.week)},t.prototype.generateLabel=function(e){return{title:"Week "+e.week[0]+" - "+e.week[1],text:"W"+e.week[0],id:e.index}},t}(A);i.WeekGranularity=V;var N=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.quarterText=function(e){for(var t=3,i=e.getFullYear();e<O.calendar.getQuarterStartDate(i,t);)t>0?t--:(t=3,i--);return t++,"Q"+t},t.prototype.getType=function(){return u.quarter},t.prototype.splitDate=function(e){return[this.quarterText(e),e.getFullYear()]},t.prototype.sameLabel=function(e,t){return this.quarterText(e.startDate)===this.quarterText(t.startDate)&&e.year===t.year},t.prototype.generateLabel=function(e){var t=this.quarterText(e.startDate);return{title:t+" "+e.year,text:t,id:e.index}},t}(A);i.QuarterGranularity=N;var L=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.getType=function(){return u.year},t.prototype.splitDate=function(e){return[e.getFullYear()]},t.prototype.sameLabel=function(e,t){return e.year===t.year},t.prototype.generateLabel=function(e){return{title:"Year "+e.year,text:e.year.toString(),id:e.index}},t}(A);i.YearGranularity=L;var M=function(){function e(t,i){this.granularities=[],this.setDatesRange(t,i);var a=this.dates[this.dates.length-1];this.endingDate=e.nextDay(a)}return e.previousDay=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()-1),t},e.nextDay=function(e){var t=new Date(e.getTime());return t.setDate(t.getDate()+1),t},e.prototype.setDatesRange=function(t,i){this.dates=[];for(var a=t;i>=a;)this.dates.push(a),a=e.nextDay(a)},e.prototype.addGranularity=function(e){e.resetDatePeriods();for(var t=0,i=this.dates;t<i.length;t++){var a=i[t],r=e.splitDate(a);e.addDate(a,r)}e.setNewEndDate(this.endingDate),this.granularities.push(e)},e.prototype.getGranularity=function(e){return this.granularities[e]},e.prototype.createGranularities=function(){this.granularities=[],this.addGranularity(new L),this.addGranularity(new N),this.addGranularity(new T),this.addGranularity(new V),this.addGranularity(new D)},e.prototype.createLabels=function(){var e=this;this.granularities.forEach(function(t){t.setExtendedLabel({dayLabels:t.getType()>=u.day?t.createLabels(e.granularities[u.day]):[],weekLabels:t.getType()>=u.week?t.createLabels(e.granularities[u.week]):[],monthLabels:t.getType()>=u.month?t.createLabels(e.granularities[u.month]):[],quarterLabels:t.getType()>=u.quarter?t.createLabels(e.granularities[u.quarter]):[],yearLabels:t.getType()>=u.year?t.createLabels(e.granularities[u.year]):[]})})},e}();i.TimelineGranularityData=M;var k=function(){function e(){}return e.getStartSelectionDate=function(e){return e.currentGranularity.getDatePeriods()[e.selectionStartIndex].startDate},e.getEndSelectionDate=function(e){return e.currentGranularity.getDatePeriods()[e.selectionEndIndex].endDate},e.getEndSelectionPeriod=function(e){return e.currentGranularity.getDatePeriods()[e.selectionEndIndex]},e.getCellColor=function(t,i,a){var r=t.datePeriod.startDate>=e.getStartSelectionDate(i)&&t.datePeriod.endDate<=e.getEndSelectionDate(i);return r?a.colorInProperty:a.colorOutProperty||"transparent"},e.getGranularityType=function(e){var t=_.findIndex(P,function(t){return t.name===e});return P[t].granularityType},e.getGranularityName=function(e){var t=_.findIndex(P,function(t){return t.granularityType===e});return P[t].name},e.separateSelection=function(t,i,a){var r=t.currentGranularity.getDatePeriods(),s=_.findIndex(r,function(e){return i<e.endDate}),o=_.findIndex(r,function(e){return a<=e.endDate});t.selectionStartIndex=s,t.selectionEndIndex=o;var n=e.getDateRatio(r[s],i,!0),l=e.getDateRatio(r[o],a,!1);if(l>0&&t.currentGranularity.splitPeriod(o,l,a),n>0){var c=r[s].fraction-n;t.currentGranularity.splitPeriod(s,c,i),t.selectionStartIndex++,t.selectionEndIndex++}},e.getDateRatio=function(e,t,i){var a=i?t.getTime()-e.startDate.getTime():e.endDate.getTime()-t.getTime(),r=e.endDate.getTime()-e.startDate.getTime();return 0===r?0:a/r},e.timeRangeText=function(t){var i=t.currentGranularity.splitDate(e.getStartSelectionDate(t)),a=t.currentGranularity.splitDate(e.getEndSelectionPeriod(t).startDate);return i.join(" ")+" - "+a.join(" ")},e.dateRangeText=function(e){return e.startDate.toDateString()+" - "+M.previousDay(e.endDate).toDateString()},e.unseparateSelection=function(e){var t=_.findIndex(e,function(e){return e.fraction<1});return t>=0?(e[t].endDate=e[t+1].endDate,e[t].fraction+=e[t+1].fraction,e.splice(t+1,1),!0):!1},e}();i.Utils=k;var I=function(){function e(e){var t=this;this.firstDayOfWeek=e.weekDayProperty,this.firstMonthOfYear=e.firstMonthProperty-1,this.firstDayOfYear=e.firstDayProperty,this.dateOfFirstWeek={},this.quarterFirstMonths=[0,3,6,9].map(function(e){return e+t.firstMonthOfYear})}return e.prototype.getFirstDayOfWeek=function(){return this.firstDayOfWeek},e.prototype.getFirstMonthOfYear=function(){return this.firstMonthOfYear},e.prototype.getFirstDayOfYear=function(){return this.firstDayOfYear},e.prototype.getQuarterStartDate=function(e,t){return new Date(e,this.quarterFirstMonths[t],this.firstDayOfYear)},e.prototype.isChanged=function(e){return this.firstMonthOfYear!==e.firstMonthProperty-1||this.firstDayOfYear!==e.firstDayProperty||this.firstDayOfWeek!==e.weekDayProperty},e.prototype.calculateDateOfFirstWeek=function(e){for(var t=new Date(e,this.firstMonthOfYear,this.firstDayOfYear);t.getDay()!==this.firstDayOfWeek;)t=M.nextDay(t);return t},e.prototype.getDateOfFirstWeek=function(e){return this.dateOfFirstWeek[e]||(this.dateOfFirstWeek[e]=this.calculateDateOfFirstWeek(e)),this.dateOfFirstWeek[e]},e}();i.Calendar=I;var O=function(){function a(){var e=this;this.requiresNoUpdate=!1,this.datasetsChangedState=!1,this.selector=["Y","Q","M","W","D"],this.timelineMargins={LeftMargin:15,RightMargin:15,TopMargin:15,BottomMargin:10,CellWidth:40,CellHeight:25,StartXpoint:10,StartYpoint:20,ElementWidth:30,MinCellWidth:30,MaxCellHeight:60,PeriodSlicerRectWidth:15,PeriodSlicerRectHeight:23},this.defaultTimelineProperties={DefaultLabelsShow:!0,TimelineDefaultTextSize:9,TimelineDefaultCellColor:"#ADD8E6",TimelineDefaultCellColorOut:"",TimelineDefaultTimeRangeShow:!0,DefaultTimeRangeColor:"#777777",DefaultLabelColor:"#777777",DefaultScaleColor:"#000000",DefaultSliderColor:"#AAAAAA",DefaultGranularity:u.month,DefaultFirstMonth:1,DefaultFirstDay:1,DefaultFirstWeekDay:0},this.timelineSelectors={TimelineVisual:s("Timeline"),SelectionRangeContainer:s("selectionRangeContainer"),textLabel:s("label"),LowerTextCell:s("lowerTextCell"),UpperTextCell:s("upperTextCell"),UpperTextArea:s("upperTextArea"),LowerTextArea:s("lowerTextArea"),RangeTextArea:s("rangeTextArea"),CellsArea:s("cellsArea"),CursorsArea:s("cursorsArea"),MainArea:s("mainArea"),SelectionCursor:s("selectionCursor"),Cell:s("cell"),CellRect:s("cellRect"),VertLine:s("timelineVertLine"),TimelineSlicer:s("timelineSlicer"),PeriodSlicerGranularities:s("periodSlicerGranularities"),PeriodSlicerSelection:s("periodSlicerSelection"),PeriodSlicerSelectionRect:s("periodSlicerSelectionRect"),PeriodSlicerRect:s("periodSlicerRect")},this.drag=d3.behavior.drag().origin(function(t){return t.x=t.selectionIndex*e.timelineProperties.cellWidth,t}).on("dragstart",function(){e.dragstarted()}).on("drag",function(t){e.dragged(t)}).on("dragend",function(){e.dragended()})}return a.prototype.changeGranularity=function(e,t,i){k.unseparateSelection(this.timelineData.currentGranularity.getDatePeriods())&&k.unseparateSelection(this.timelineData.currentGranularity.getDatePeriods()),this.timelineData.currentGranularity=this.timelineGranularityData.getGranularity(e),k.separateSelection(this.timelineData,t,i)},a.prototype.init=function(e){this.hostServices=e.host,this.initialized=!1;var t=e.element;this.selectionManager=new o({hostServices:e.host}),this.timelineProperties={element:t,textYPosition:50,cellsYPosition:3*this.timelineMargins.TopMargin+65,topMargin:this.timelineMargins.TopMargin,bottomMargin:this.timelineMargins.BottomMargin,leftMargin:this.timelineMargins.LeftMargin,startXpoint:this.timelineMargins.StartXpoint,startYpoint:this.timelineMargins.StartYpoint,cellWidth:this.timelineMargins.CellWidth,cellHeight:this.timelineMargins.CellHeight,elementWidth:this.timelineMargins.ElementWidth,rightMargin:this.timelineMargins.RightMargin},this.body=d3.select(t.get(0)),this.timelineDiv=this.body.append("div"),this.svg=this.timelineDiv.append("svg").attr("width",n(e.viewport.width)).classed(this.timelineSelectors.TimelineVisual["class"],!0),this.addWrappElements()},a.prototype.addWrappElements=function(){this.clearCatcher=t.appendClearCatcher(this.svg),this.clearCatcher.data([this]).on("click",function(e){return e.clear()}).on("touchstart",function(e){return e.clear()}),this.rangeText=this.svg.append("g").classed(this.timelineSelectors.RangeTextArea["class"],!0).append("text"),this.mainGroupElement=this.svg.append("g").classed(this.timelineSelectors.MainArea["class"],!0),this.yearLabelsElement=this.mainGroupElement.append("g"),this.quarterLabelsElement=this.mainGroupElement.append("g"),this.monthLabelsElement=this.mainGroupElement.append("g"),this.weekLabelsElement=this.mainGroupElement.append("g"),this.dayLabelsElement=this.mainGroupElement.append("g"),this.cellsElement=this.mainGroupElement.append("g").classed(this.timelineSelectors.CellsArea["class"],!0),
this.cursorGroupElement=this.svg.append("g").classed(this.timelineSelectors.CursorsArea["class"],!0)},a.prototype.clear=function(){this.initialized&&(this.selectionManager.clear(),this.timelineData&&(this.timelineData.selectionStartIndex=0,this.timelineData.selectionEndIndex=this.timelineData.currentGranularity.getDatePeriods().length-1,_.any(this.timelineData.timelineDatapoints,function(e){return e.index%1!==0})?this.selectPeriod(this.timelineData.currentGranularity.getType()):(a.updateCursors(this.timelineData,this.timelineProperties.cellWidth),this.fillCells(this.timelineFormat.cellFormat),this.renderCursors(this.timelineData,this.timelineFormat,this.timelineProperties.cellHeight,this.timelineProperties.cellsYPosition),this.renderTimeRangeText(this.timelineData,this.timelineFormat.rangeTextFormat),this.fillColorGranularity(this.timelineFormat.granularityFormat)),this.setSelection(this.timelineData)))},a.prototype.drawGranular=function(e){var t=this,i=!1,a=e.startXpoint,r=e.startYpoint,s=e.elementWidth;this.selectorContainer=this.svg.append("g").classed(this.timelineSelectors.TimelineSlicer["class"],!0),this.selectorContainer.on("mouseleave",function(e){return i=!1}),this.horizLine=this.selectorContainer.append("rect");var o=this.selector;this.horizLine.attr({height:n(1),x:n(a),y:n(r+2),width:n((o.length-1)*s)}),this.vertLine=this.selectorContainer.selectAll("vertLines").data(o).enter().append("rect"),this.vertLine.classed(this.timelineSelectors.VertLine["class"],!0).attr({x:function(e,t){return n(a+t*s)},y:n(r),width:n(2),height:n(3)}).style({cursor:"pointer"});var l=this.selectorContainer.selectAll(this.timelineSelectors.PeriodSlicerGranularities.selector).data(o).enter().append("text").classed(this.timelineSelectors.PeriodSlicerGranularities["class"],!0);this.textLabels=l.text(function(e){return e}).attr({x:function(e,t){return n(a-3+t*s)},y:n(r-3)}),this.selectedText=this.selectorContainer.append("text").classed(this.timelineSelectors.PeriodSlicerSelection["class"],!0),this.selectedText.text(k.getGranularityName(this.defaultTimelineProperties.DefaultGranularity)).attr({x:n(a+2*s),y:n(r+17)});var c=this.selectorContainer.selectAll(this.timelineSelectors.PeriodSlicerSelectionRect.selector).data(o).enter().append("rect").classed(this.timelineSelectors.PeriodSlicerSelectionRect["class"],!0),u=function(e,a){t.selectPeriod(a),i=!0};c.attr({x:function(e,t){return n(a-s/2+t*s)},y:n(3),width:n(s),height:n(23)}).style({cursor:"pointer"}).on("mousedown",u).on("touchstart",u).on("mouseup",function(){return i=!1}).on("touchend",function(){return i=!1}).on("mouseover",function(e,a){i&&t.selectPeriod(a)});var h=d3.behavior.drag().on("dragstart",function(e,t){i=!0}).on("dragend",function(e,t){i=!1});this.periodSlicerRect=this.selectorContainer.append("rect").classed(this.timelineSelectors.PeriodSlicerRect["class"],!0).attr({x:n(a-6+this.defaultTimelineProperties.DefaultGranularity*s),y:n(r-16),rx:n(4),width:n(15),height:n(23)}).on("mouseup",function(e){return i=!1}),this.periodSlicerRect.call(h)},a.prototype.fillColorGranularity=function(e){this.periodSlicerRect.style("stroke",e.sliderColorProperty),this.selectedText.attr("fill",e.scaleColorProperty),this.textLabels.attr("fill",e.scaleColorProperty),this.vertLine.attr("fill",e.scaleColorProperty),this.horizLine.attr("fill",e.scaleColorProperty)},a.prototype.redrawPeriod=function(e){var t=this.timelineMargins.StartXpoint+e*this.timelineMargins.ElementWidth;this.periodSlicerRect.transition().attr("x",n(t-7)),this.selectedText.text(k.getGranularityName(e));var i=k.getStartSelectionDate(this.timelineData),a=k.getEndSelectionDate(this.timelineData);this.changeGranularity(e,i,a)},a.setMeasures=function(e,t,i,a,r,s){r.cellsYPosition=r.textYPosition;var o=c(e.sizeProperty);e.showProperty&&(r.cellsYPosition+=1.5*o*(t+1));var n=Math.max(0,a.height-s.TopMargin),l=a.width-s.RightMargin-s.MinCellWidth*i,u=Math.max(s.MinCellWidth,Math.min(s.MaxCellHeight,l,n-r.cellsYPosition-20)),h=Math.max(s.MinCellWidth,(a.width-u-s.RightMargin)/i);r.cellHeight=u,r.cellWidth=h},a.prototype.visualChangeOnly=function(e){if(e&&e.dataViews&&e.dataViews[0]&&e.dataViews[0].metadata&&this.options&&this.options.dataViews&&this.options.dataViews[0]&&this.options.dataViews[0].metadata){var t=e.dataViews[0].metadata.objects,i=this.options.dataViews[0].metadata.objects,a=["rangeHeader","cells","labels","granularity"],r=!a.every(function(e){return _.isEqual(t?t[e]:void 0,i?i[e]:void 0)});return e.suppressAnimations||r}return!1},a.prototype.datasetsChanged=function(e){if(e&&e.dataViews&&e.dataViews[0]&&e.dataViews[0].categorical&&e.dataViews[0].categorical.categories&&e.dataViews[0].categorical.categories[0]&&e.dataViews[0].categorical.categories[0].source&&this.options&&this.options.dataViews&&this.options.dataViews[0]&&this.options.dataViews[0].categorical&&this.options.dataViews[0].categorical.categories&&this.options.dataViews[0].categorical.categories[0]&&this.options.dataViews[0].categorical.categories[0].source){var t=e.dataViews[0].categorical.categories[0].source.displayName,i=this.options.dataViews[0].categorical.categories[0].source.displayName;if(!_.isEqual(t,i))return!0}return!1},a.prototype.unavailableType=function(e){return!(e.categories&&1===e.categories.length&&e.categories[0].values&&0!==e.categories[0].values.length&&e.categories[0].source&&e.categories[0].source.type)},a.prototype.unavailableChildIdentityField=function(e){return!e.root||!e.root.childIdentityFields||0===e.root.childIdentityFields.length},a.prototype.createTimelineOptions=function(e){if(this.dataView=e,!e.categorical||!e.metadata||this.unavailableType(e.categorical)||!e.tree||this.unavailableChildIdentityField(e.tree))return!1;var t=e.tree.root.childIdentityFields[0];return this.valueType=t?t.ref:null,e.categorical.categories[0].source.type.dateTime||e.categorical.categories[0].source.type.numeric&&("Year"===this.valueType||"Date"===this.valueType)?(this.values=this.prepareValues(this.dataView.categorical.categories[0].values),!0):!1},a.prototype.prepareValues=function(e){e=e.filter(Boolean);for(var t in e){var i=e[t];if("String"==typeof i&&"Invalid Date"!==String(new Date(i)))return e[t]=new Date(i)}return e},a.prototype.createTimelineData=function(){var e,t;if("Year"===this.valueType){var i=this.values;e=new Date(_.min(i),0),t=new Date(_.max(i),11)}else{var r=this.values;e=_.min(r),t=_.max(r)}if(this.timelineFormat=a.fillTimelineFormat(this.options.dataViews[0].metadata.objects,this.defaultTimelineProperties),this.initialized||(this.drawGranular(this.timelineProperties),this.fillColorGranularity(this.timelineFormat.granularityFormat)),this.initialized){var s=M.nextDay(t),o=this.timelineGranularityData.getGranularity(u.day).getDatePeriods(),n=o[0].startDate,l=o[o.length-1].endDate,c=e.getTime()>=n.getTime()&&s.getTime()<=l.getTime();this.newGranularity=this.timelineData.currentGranularity.getType(),c?this.changeGranularity(this.newGranularity,e,s):(l>s&&(t=o[o.length-1].startDate),e>n&&(e=n),this.initialized=!1)}this.initialized||(this.timelineGranularityData=new M(e,t),this.timelineData={elementsCount:0,timelineDatapoints:[],cursorDataPoints:new Array})},a.prototype.update=function(e){var t=this.visualChangeOnly(e);if(this.datasetsChangedState=this.datasetsChanged(e),this.requiresNoUpdate=this.requiresNoUpdate&&!this.datasetsChangedState&&!t,this.requiresNoUpdate)return void(this.requiresNoUpdate=!1);if(this.options=e,e.dataViews&&e.dataViews[0]){var i=this.createTimelineOptions(e.dataViews[0]);if(!i)return void this.clearData();this.newGranularity=this.defaultTimelineProperties.DefaultGranularity,t||this.createTimelineData(),this.timelineFormat=a.converter(this.timelineData,this.timelineProperties,this.defaultTimelineProperties,this.timelineGranularityData,e.dataViews[0],this.initialized,this.newGranularity,e.viewport,this.timelineMargins),this.render(this.timelineData,this.timelineFormat,this.timelineProperties,e),this.initialized=!0}},a.prototype.selectPeriod=function(e){this.redrawPeriod(e),this.timelineFormat=a.converter(this.timelineData,this.timelineProperties,this.defaultTimelineProperties,this.timelineGranularityData,this.options.dataViews[0],this.initialized,this.timelineData.currentGranularity.getType(),this.options.viewport,this.timelineMargins),this.render(this.timelineData,this.timelineFormat,this.timelineProperties,this.options)},a.isDataNotMatch=function(e){return e.categorical.categories.length<=0||void 0===e.categorical.categories[0]||void 0===e.categorical.categories[0].identityFields||e.categorical.categories[0].identityFields.length<=0},a.converter=function(e,t,i,r,s,o,n,l,c){var u=a.fillTimelineFormat(s.metadata.objects,i);if(o||(e.cursorDataPoints.push({x:0,selectionIndex:0,cursorIndex:0}),e.cursorDataPoints.push({x:0,selectionIndex:0,cursorIndex:1})),o&&!a.calendar.isChanged(u.calendarFormat)||(a.calendar=new I(u.calendarFormat),r.createGranularities(),r.createLabels(),e.currentGranularity=r.getGranularity(n),e.selectionStartIndex=0,e.selectionEndIndex=e.currentGranularity.getDatePeriods().length-1),e.categorySourceName=s.categorical.categories[0].source.displayName,e.columnIdentity=s.categorical.categories[0].identityFields[0],s.categorical.categories[0].source.type.numeric&&(e.columnIdentity.ref="Date"),!this.isDataNotMatch(s)){var h=e.currentGranularity.getDatePeriods();e.elementsCount=h.length,e.timelineDatapoints=[];for(var p=0,d=h;p<d.length;p++){var g=d[p],m={index:g.index,datePeriod:g};e.timelineDatapoints.push(m)}var y=e.currentGranularity.getDatePeriods().filter(function(e){return e.index%1===0}).length;return a.setMeasures(u.labelFormat,e.currentGranularity.getType(),y,l,t,c),a.updateCursors(e,t.cellWidth),u}},a.prototype.render=function(e,i,a,r){var s=this.timelineData.timelineDatapoints.filter(function(e){return e.index%1===0}).length;this.svgWidth=1+this.timelineProperties.cellHeight+a.cellWidth*s,this.renderTimeRangeText(e,i.rangeTextFormat),this.fillColorGranularity(this.timelineFormat.granularityFormat),this.timelineDiv.attr({height:n(r.viewport.height),width:n(r.viewport.width),"drag-resize-disabled":!0}).style({"overflow-x":"auto","overflow-y":"auto"}),this.svg.attr({height:n(Math.max(0,r.viewport.height-this.timelineMargins.TopMargin)),width:n(Math.max(0,this.svgWidth))});var o=t.SVGUtil.translate(a.leftMargin,a.topMargin),l=t.SVGUtil.translate(a.cellHeight/2,a.topMargin);this.mainGroupElement.attr("transform",l),this.selectorContainer.attr("transform",o),this.cursorGroupElement.attr("transform",l);var c=this.timelineData.currentGranularity.getExtendedLabel(),u=this.timelineData.currentGranularity.getType(),h=0,p=1.5;this.renderLabels(c.yearLabels,this.yearLabelsElement,h,0===u),h+=p,this.renderLabels(c.quarterLabels,this.quarterLabelsElement,h,1===u),h+=p,this.renderLabels(c.monthLabels,this.monthLabelsElement,h,2===u),h+=p,this.renderLabels(c.weekLabels,this.weekLabelsElement,h,3===u),h+=p,this.renderLabels(c.dayLabels,this.dayLabelsElement,h,4===u),this.renderCells(e,i,a,r.suppressAnimations),this.renderCursors(e,i,a.cellHeight,a.cellsYPosition)},a.prototype.renderLabels=function(i,a,r,s){var o=this,n=a.selectAll(this.timelineSelectors.textLabel.selector);if(!this.timelineFormat.labelFormat.showProperty)return void n.remove();var u=n.data(i);u.enter().append("text").classed(this.timelineSelectors.textLabel["class"],!0),u.text(function(a,r){if(!s&&0===r&&i.length>1){var n=l(o.timelineFormat.labelFormat.sizeProperty),c={text:i[0].text,fontFamily:"arial",fontSize:n},u=e.TextMeasurementService.measureSvgTextWidth(c)/2;c={text:i[1].text,fontFamily:"arial",fontSize:n};var h=e.TextMeasurementService.measureSvgTextWidth(c)/2,p=o.timelineProperties.cellWidth*(i[1].id-i[0].id);if(u+h>p)return""}var d={label:a.text,maxWidth:o.timelineProperties.cellWidth*(s?.9:3),fontSize:o.timelineFormat.labelFormat.sizeProperty};return t.dataLabelUtils.getLabelFormattedText(d)}).style("font-size",l(this.timelineFormat.labelFormat.sizeProperty)).attr({x:function(e){return(e.id+.5)*o.timelineProperties.cellWidth},y:this.timelineProperties.textYPosition+(1+r)*c(this.timelineFormat.labelFormat.sizeProperty),fill:this.timelineFormat.labelFormat.colorProperty}).append("title").text(function(e){return e.title}),u.exit().remove()},a.prototype.clearData=function(){this.initialized=!1,this.mainGroupElement.selectAll(this.timelineSelectors.CellRect.selector).remove(),this.mainGroupElement.selectAll(this.timelineSelectors.textLabel.selector).remove(),this.rangeText.text(""),this.cursorGroupElement.selectAll(this.timelineSelectors.SelectionCursor.selector).remove(),this.svg.select(this.timelineSelectors.TimelineSlicer.selector).remove(),this.mainGroupElement.selectAll(this.timelineSelectors.textLabel.selector)},a.updateCursors=function(e,t){var i=e.timelineDatapoints[e.selectionStartIndex].datePeriod;e.cursorDataPoints[0].selectionIndex=i.index;var a=e.timelineDatapoints[e.selectionEndIndex].datePeriod;e.cursorDataPoints[1].selectionIndex=a.index+a.fraction},a.fillTimelineFormat=function(t,i){var a={rangeTextFormat:{showProperty:e.DataViewObjects.getValue(t,f,i.TimelineDefaultTimeRangeShow),colorProperty:e.DataViewObjects.getFillColor(t,m,i.DefaultTimeRangeColor),sizeProperty:e.DataViewObjects.getValue(t,y,i.TimelineDefaultTextSize)},cellFormat:{colorInProperty:e.DataViewObjects.getFillColor(t,h,i.TimelineDefaultCellColor),colorOutProperty:e.DataViewObjects.getFillColor(t,p,i.TimelineDefaultCellColorOut)},granularityFormat:{scaleColorProperty:e.DataViewObjects.getFillColor(t,d,i.DefaultScaleColor),sliderColorProperty:e.DataViewObjects.getFillColor(t,g,i.DefaultSliderColor)},labelFormat:{showProperty:e.DataViewObjects.getValue(t,b,i.DefaultLabelsShow),colorProperty:e.DataViewObjects.getFillColor(t,v,i.DefaultLabelColor),sizeProperty:e.DataViewObjects.getValue(t,x,i.TimelineDefaultTextSize)},calendarFormat:{firstMonthProperty:e.DataViewObjects.getValue(t,S,1),firstDayProperty:Math.max(1,Math.min(31,e.DataViewObjects.getValue(t,w,i.DefaultFirstDay))),weekDayProperty:Math.max(0,Math.min(6,e.DataViewObjects.getValue(t,C,i.DefaultFirstWeekDay)))}};return a},a.prototype.fillCells=function(e){var t=this,i=this.timelineData.timelineDatapoints,a=this.mainGroupElement.selectAll(this.timelineSelectors.CellRect.selector).data(i);a.attr("fill",function(i){return k.getCellColor(i,t.timelineData,e)})},a.prototype.renderCells=function(e,t,i,a){var r=this,s=e.timelineDatapoints,o=0,l=this.cellsElement.selectAll(this.timelineSelectors.CellRect.selector).data(s);l.enter().append("rect").classed(this.timelineSelectors.CellRect["class"],!0),l.attr({height:n(i.cellHeight),width:function(e){return n(e.datePeriod.fraction*i.cellWidth)},x:function(e){var t=o;return o+=e.datePeriod.fraction*i.cellWidth,n(t)},y:n(i.cellsYPosition),id:function(e){return e.index}});var c=function(a,s){d3.event.preventDefault();var o=r.timelineData.cursorDataPoints,n=d3.event;n.altKey||n.shiftKey?r.timelineData.selectionEndIndex<s?(o[1].selectionIndex=a.datePeriod.index+a.datePeriod.fraction,e.selectionEndIndex=s):(o[0].selectionIndex=a.datePeriod.index,e.selectionStartIndex=s):(e.selectionStartIndex=s,e.selectionEndIndex=s,o[0].selectionIndex=a.datePeriod.index,o[1].selectionIndex=a.datePeriod.index+a.datePeriod.fraction),r.fillCells(t.cellFormat),r.renderCursors(e,t,i.cellHeight,i.cellsYPosition),r.renderTimeRangeText(e,t.rangeTextFormat),r.fillColorGranularity(r.timelineFormat.granularityFormat),r.setSelection(e)};l.on("click",c).on("touchstart",c),this.fillCells(t.cellFormat),l.exit().remove()},a.prototype.dragstarted=function(){this.timelineData.dragging=!0},a.prototype.dragged=function(e){if(this.timelineData.dragging===!0){var t=1,i=d3.select(this.timelineSelectors.TimelineVisual.selector);if(i){var a=i.style("transform");if(void 0!==a&&"none"!==a){var r=a.split("(")[1];t=Number(r.split(", ")[0])}}var s=this.findCursorOverElement(d3.event.x);if(!s)return;var o=s.datapoint,n=s.index;0===e.cursorIndex&&n<=this.timelineData.selectionEndIndex&&(this.timelineData.selectionStartIndex=n,this.timelineData.cursorDataPoints[0].selectionIndex=o.datePeriod.index),1===e.cursorIndex&&n>=this.timelineData.selectionStartIndex&&(this.timelineData.selectionEndIndex=n,this.timelineData.cursorDataPoints[1].selectionIndex=o.datePeriod.index+o.datePeriod.fraction),this.fillCells(this.timelineFormat.cellFormat),this.renderCursors(this.timelineData,this.timelineFormat,this.timelineProperties.cellHeight,this.timelineProperties.cellsYPosition),this.renderTimeRangeText(this.timelineData,this.timelineFormat.rangeTextFormat),this.fillColorGranularity(this.timelineFormat.granularityFormat)}},a.prototype.findCursorOverElement=function(e){var t=this.timelineData.timelineDatapoints||[],i=t.length,a=this.timelineProperties.cellWidth;if(t[0]&&t[1]&&e<=t[1].index*a)return{index:0,datapoint:t[0]};if(t[i-1]&&e>=t[i-1].index*a)return{index:i-1,datapoint:t[i-1]};for(var r=1;i>r;r++){var s=t[r].index*a,o=t[r+1].index*a;if(e>=s&&o>=e)return{index:r,datapoint:t[r]}}return null},a.prototype.dragended=function(){this.setSelection(this.timelineData)},a.prototype.renderCursors=function(e,i,a,r){var s=this,o=this.cursorGroupElement.selectAll(this.timelineSelectors.SelectionCursor.selector).data(e.cursorDataPoints);return o.enter().append("path").classed(this.timelineSelectors.SelectionCursor["class"],!0),o.attr("transform",function(e){return t.SVGUtil.translate(e.selectionIndex*s.timelineProperties.cellWidth,a/2+r)}).attr({d:d3.svg.arc().innerRadius(0).outerRadius(a/2).startAngle(function(e){return e.cursorIndex*Math.PI+Math.PI}).endAngle(function(e){return e.cursorIndex*Math.PI+2*Math.PI})}).call(this.drag),o.exit().remove(),o},a.prototype.renderTimeRangeText=function(e,i){var a=(P.length+2)*this.timelineProperties.elementWidth,r=this.svgWidth-a-this.timelineProperties.leftMargin-i.sizeProperty;if(i.showProperty&&r>0){var s=k.timeRangeText(e),o={label:s,maxWidth:r,fontSize:i.sizeProperty},n=t.dataLabelUtils.getLabelFormattedText(o);this.rangeText.classed(this.timelineSelectors.SelectionRangeContainer["class"],!0),this.rangeText.attr({x:P.length*(this.timelineProperties.elementWidth+this.timelineProperties.leftMargin),y:40,fill:i.colorProperty}).style({"font-size":l(i.sizeProperty)}).text(n).append("title").text(s)}else this.rangeText.text("")},a.prototype.setSelection=function(t){this.requiresNoUpdate=!0;var i=e.data.SQExprBuilder.dateTime(k.getStartSelectionDate(t)),a=e.data.SQExprBuilder.dateTime(new Date(k.getEndSelectionDate(t).getTime()-1)),r=e.data.SQExprBuilder.between(t.columnIdentity,i,a),s=e.data.SemanticFilter.fromSQExpr(r),o={merge:[{objectName:"general",selector:void 0,properties:{filter:s}}]};this.hostServices.persistProperties(o),this.hostServices.onSelect({visualObjects:[]})},a.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"rangeHeader":this.enumerateRangeHeader(i,this.dataView);break;case"cells":this.enumerateCells(i,this.dataView);break;case"granularity":this.enumerateGranularity(i,this.dataView);break;case"labels":this.enumerateLabels(i,this.dataView);break;case"calendar":this.enumerateCalendar(i,this.dataView);break;case"weekDay":this.enumerateWeekDay(i,this.dataView)}return i.complete()},a.prototype.enumerateRangeHeader=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"rangeHeader",displayName:"Selection Color",selector:null,properties:{show:e.DataViewObjects.getValue(a,f,this.defaultTimelineProperties.TimelineDefaultTimeRangeShow),fontColor:e.DataViewObjects.getFillColor(a,m,this.defaultTimelineProperties.DefaultTimeRangeColor),textSize:e.DataViewObjects.getValue(a,y,this.defaultTimelineProperties.TimelineDefaultTextSize)}})},a.prototype.enumerateCells=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"cells",selector:null,properties:{fillSelected:e.DataViewObjects.getFillColor(a,h,this.defaultTimelineProperties.TimelineDefaultCellColor),fillUnselected:e.DataViewObjects.getFillColor(a,p,this.defaultTimelineProperties.TimelineDefaultCellColorOut)}})},a.prototype.enumerateGranularity=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"granularity",selector:null,properties:{scaleColor:e.DataViewObjects.getFillColor(a,d,this.defaultTimelineProperties.DefaultScaleColor),sliderColor:e.DataViewObjects.getFillColor(a,g,this.defaultTimelineProperties.DefaultSliderColor)}})},a.prototype.enumerateLabels=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"labels",selector:null,properties:{show:e.DataViewObjects.getValue(a,b,this.defaultTimelineProperties.DefaultLabelsShow),fontColor:e.DataViewObjects.getFillColor(a,v,this.defaultTimelineProperties.DefaultLabelColor),textSize:e.DataViewObjects.getValue(a,x,this.defaultTimelineProperties.TimelineDefaultTextSize)}})},a.prototype.enumerateCalendar=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"calendar",selector:null,properties:{month:Math.max(1,Math.min(12,e.DataViewObjects.getValue(a,S,1))),day:Math.max(1,Math.min(31,e.DataViewObjects.getValue(a,w,1)))}})},a.prototype.enumerateWeekDay=function(t,i){var a=i&&i.metadata?i.metadata.objects:void 0;t.pushInstance({objectName:"weekDay",selector:null,properties:{day:Math.max(0,Math.min(6,e.DataViewObjects.getValue(a,C,0)))}})},a.capabilities={dataRoles:[{name:"Time",kind:e.VisualDataRoleKind.Grouping,displayName:"Time"}],dataViewMappings:[{conditions:[{Time:{max:1}}],categorical:{categories:{"for":{"in":"Time"},dataReductionAlgorithm:{sample:{}}},values:{select:[{bind:{to:"Time"}}]}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},selected:{type:{bool:!0}},filter:{type:{filter:{}},rule:{output:{property:"selected",selector:["Time"]}}}}},calendar:{displayName:"Fiscal Year Start",properties:{month:{displayName:"Month",type:{enumeration:i.Months}},day:{displayName:"Day",type:{numeric:!0}}}},weekDay:{displayName:"First Day of Week",properties:{day:{displayName:"Day",type:{enumeration:i.WeekDays}}}},rangeHeader:{displayName:"Range Header",properties:{show:{displayName:"Show",type:{bool:!0}},fontColor:{displayName:"Font color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:"Text Size",type:{numeric:!0}}}},cells:{displayName:"Cells",properties:{fillSelected:{displayName:"Selected cell color",type:{fill:{solid:{color:!0}}}},fillUnselected:{displayName:"Unselected cell color",type:{fill:{solid:{color:{nullable:!0}}}}}}},granularity:{displayName:"Granularity",properties:{scaleColor:{displayName:"Scale color",type:{fill:{solid:{color:!0}}}},sliderColor:{displayName:"Slider color",type:{fill:{solid:{color:!0}}}}}},labels:{displayName:"Labels",properties:{show:{displayName:"Show",type:{bool:!0}},fontColor:{displayName:"Font color",type:{fill:{solid:{color:!0}}}},textSize:{displayName:"Text Size",type:{numeric:!0}}}}}},a}();i.Timeline=O}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(t){var i=a.PixelConverter,r=e.visuals.valueFormatter,s=e.visuals.LegendData,o=e.VisualDataRoleKind,n=e.data.createDisplayNameGetter,l=e.visuals.legendPosition,c=e.visuals.SelectionId,u=e.visuals.LegendIcon,h=e.visuals.TooltipBuilder,p=e.TextMeasurementService,d=e.DataViewObjects,g=e.visuals.appendClearCatcher,m=e.visuals.createInteractivityService,y=e.visuals.createLegend,f=e.visuals.TooltipManager,v=e.visuals.dataLabelUtils,x=e.visuals.SVGUtil,b=e.visuals.AxisHelper,S=e.visuals.valueFormatter,w=e.visuals.legendProps,C=e.visuals.LegendPosition,P=e.visuals.Legend,A=e.visuals.ObjectEnumerationBuilder,D="axisGraphicsContext",T="dataPointsContainer",V="x axis",N="y axis",L="#777",M=8,k=4,I=10,O="#666666",F="wf_segoe-ui_normal",z="normal",j=20,G=10,R=20,B=45,H=10,E=20,W={legendSettings:{show:!0,showTitle:!0,labelColor:O,titleText:"",fontSize:M},categoryAxisSettings:{show:!0,labelColor:L,showAxisTitle:!1},valueAxisSettings:{show:!0,labelColor:L,showAxisTitle:!1},dataLabelsSettings:v.getDefaultPointLabelSettings()},U=function(){function e(){}return e.prototype.bindEvents=function(e,t){this.selection=e.selection,this.clearCatcher=e.clearCatcher,this.interactivityService=e.interactivityService,this.selection.on("click",function(e,i){t.handleSelection(e,d3.event.ctrlKey)}),this.clearCatcher.on("click",function(){t.handleClearSelection()})},e.prototype.renderSelection=function(e){var t=this.interactivityService.hasSelection();this.selection.style("fill-opacity",function(i){return X.getFillOpacity(i.selected,i.highlight,!i.highlight&&e,!i.selected&&t)})},e}(),Y=function(){function e(){this.margin={left:B,right:15,bottom:j,top:10}}return e.prototype.converter=function(t,a,s){if(!(t&&t.categorical&&t.categorical.values&&t.categorical.categories&&a))return null;for(var o,n,l=t.categorical,d=l.categories,g=l.values,m=[],y={dataPoints:[],title:g.source?g.source.displayName:"",fontSize:M},f=0,v=d&&d.length>0?d[0]:null,x=e.Properties.general.formatString,b=!!(g.length>0&&g[0].highlights),S=this.parseSettings(t),w=i.fromPoint(S.dataLabelsSettings.fontSize),C=0;C<g.length;C++){var P=g[C].source.groupName,A=g[C].identity?c.createWithId(g[C].identity):c.createWithMeasure(g[C].source.queryName);P?y.dataPoints.push({label:P,color:a.getColorByIndex(C).value,icon:u.Box,selected:!1,identity:A}):P=g[C].source.displayName;var D=h.createTooltipInfo(x,{categories:null,values:g},null,null,null,null,C);m[C]={dataPoints:[],tooltipInfo:D,highlight:b,identity:A,selected:!1};var T=g[C].values;if(0!==T.length)for(var V=0;V<T.length;V++){var N=b?g[C].highlights[V]:T[V];N>f&&(f=N),m[C].dataPoints.push({x:V,y:isNaN(N)?0:N,text:P,labelFontSize:w})}}s&&s.applySelectionStateToData(m),o=r.create({format:"g",value:f}),n=r.create({format:r.getFormatString(v.source,e.Properties.general.formatString),value:v.values});for(var L=[],k=this.getTextPropertiesFunction,I=0;I<v.values.length;I++){var O=void 0;if(null!=v.values[I]){O=n.format(v.values[I]);var F=p.measureSvgTextWidth(k(O));F>e.MaxNumberOfAxisXValues&&(e.MaxNumberOfAxisXValues=F)}L.push(O)}return{series:m,legendData:y,valueFormatter:o,categoryFormatter:n,streamGraphSettings:S,categoriesText:L}},e.prototype.parseSettings=function(t){if(!t||!t.metadata)return W;var i=t.metadata.objects,a=_.cloneDeep(W),r=a.categoryAxisSettings;r.show=d.getValue(i,e.Properties.categoryAxis.show,r.show),r.labelColor=d.getFillColor(i,e.Properties.categoryAxis.labelColor,r.labelColor),r.showAxisTitle=d.getValue(i,e.Properties.categoryAxis.showAxisTitle,r.showAxisTitle);var s=a.valueAxisSettings;s.show=d.getValue(i,e.Properties.valueAxis.show,s.show),s.labelColor=d.getFillColor(i,e.Properties.valueAxis.labelColor,s.labelColor),s.showAxisTitle=d.getValue(i,e.Properties.valueAxis.showAxisTitle,s.showAxisTitle);var o=a.dataLabelsSettings;o.show=d.getValue(i,e.Properties.labels.show,o.show),o.labelColor=d.getFillColor(i,e.Properties.labels.color,o.labelColor),o.fontSize=d.getValue(i,e.Properties.labels.fontSize,o.fontSize);var n=a.legendSettings,l=t.categorical.values.source,c=l&&_.isEmpty(n.titleText)?l.displayName:n.titleText;return n.show=d.getValue(i,e.Properties.legend.show,n.show),n.showTitle=d.getValue(i,e.Properties.legend.showTitle,n.showTitle),n.titleText=d.getValue(i,e.Properties.legend.titleText,c),n.labelColor=d.getValue(i,e.Properties.legend.labelColor,n.labelColor),n.fontSize=d.getValue(i,e.Properties.legend.fontSize,n.fontSize),_.isEmpty(n.titleText)&&(n.titleText=c),a},e.prototype.init=function(t){var i=t.element,a=this.svg=d3.select(i.get(0)).append("svg").classed(e.VisualClassName,!0).style("position","absolute");this.clearCatcher=g(a),this.axisGraphicsContext=a.append("g").classed(D,!0),this.xAxis=this.axisGraphicsContext.append("g").classed(V,!0),this.yAxis=this.axisGraphicsContext.append("g").classed(N,!0),this.dataPointsContainer=a.append("g").classed(T,!0),this.viewport=t.viewport,this.colors=t.style.colorPalette.dataColors,this.behavior=new U;var r=t.interactivity;this.interactivityService=m(t.host),this.legend=y(i,r&&r.isInteractiveLegend,this.interactivityService,!0)},e.prototype.update=function(e){if(!e.dataViews||!e.dataViews[0]||!e.dataViews[0].categorical)return void this.clearData();this.viewport={width:Math.max(0,e.viewport.width),height:Math.max(0,e.viewport.height)};var t=e.suppressAnimations?0:250,i=this.dataView=e.dataViews[0],a=this.data=this.converter(i,this.colors,this.interactivityService);if(!a||!a.series||!a.series.length)return void this.clearData();this.renderLegend(a),this.renderXAxisLabels(),this.renderYAxisLabels(),this.svg.attr({width:this.viewport.width+"px",height:this.viewport.height+"px"});var r=this.renderChart(a.series,t);f.addTooltip(r,function(e){return e.data.tooltipInfo});var s=this.interactivityService;if(s){var o={selection:r,clearCatcher:this.clearCatcher,interactivityService:s};s.bind(a.series,this.behavior,o)}},e.prototype.getStreamGraphLabelLayout=function(e,t){var a=this.data.streamGraphSettings.dataLabelsSettings,r=i.fromPoint(a.fontSize);return{labelText:function(e){return e.text},labelLayout:{x:function(t){return e(t.x)},y:function(e){return t(e.y0)}},filter:function(e){return null!=e&&null!=e.text},style:{fill:a.labelColor,"font-size":r}}},e.prototype.renderChart=function(t,i){var a=this,r=d3.layout.stack().values(function(e){return e.dataPoints}),s=this.viewport.width,o=this.viewport.height;this.getWiggle(this.dataView)&&r.offset("wiggle");var n=r(t),l=this.margin,c=d3.scale.linear().domain([0,t[0].dataPoints.length-1]).range([l.left,s-l.right]),u=d3.max(n,function(e){return d3.max(e.dataPoints,function(e){return e.y0+e.y})}),h=d3.min(n,function(e){return d3.min(e.dataPoints,function(e){return e.y0+e.y})}),p=d3.scale.linear().domain([Math.min(h,0),u]).range([o-l.bottom,l.top]).nice(),d=d3.svg.area().interpolate("monotone").x(function(e){return c(e.x)}).y0(function(e){return p(e.y0)}).y1(function(e){return p(e.y0+e.y)}).defined(function(e){return!isNaN(e.y0)&&!isNaN(e.y)}),g=this.dataPointsContainer.selectAll(e.Layer.selector).data(n);if(g.enter().append("path").classed(e.Layer["class"],!0),g.style("fill",function(e,t){return a.colors.getColorByIndex(t).value}).style("fill-opacity",X.DefaultOpacity).transition().duration(i).attr("d",function(e){return d(e.dataPoints)}),g.selectAll("path").append("g").classed(T,!0),g.exit().remove(),this.data.streamGraphSettings.dataLabelsSettings.show){var m=d3.scale.linear().domain([0,t[0].dataPoints.length-1]).range([0,s-l.left-l.right]),y=this.getStreamGraphLabelLayout(m,p),f=[];t.forEach(function(e){var t;t=e.dataPoints.filter(function(e){return e&&null!==e.y&&void 0!==e.y}),t.length>0&&(f=f.concat(t))});var b={height:o-l.top-l.bottom,width:s-l.right-l.left},S=v.drawDefaultLabelsForDataPointChart(f,this.svg,y,b);if(S){var w=k+l.left;S.attr("transform",function(e){return x.translate(w+e.size.width/2,e.size.height/2)})}}else v.cleanDataLabels(this.svg);return this.drawAxis(this.data,c,p),g},e.prototype.drawAxis=function(t,i,a){for(var r=this.margin,s=this.viewport.height-r.bottom,o=this.viewport.width-r.left-r.right,n=this.data.categoriesText,l=d3.svg.axis(),c=e.MaxNumberOfAxisXValues,u=this.getTextPropertiesFunction,h=0;h<n.length;h++)if(null!=n[h]){var d=n[h].toString(),g=p.measureSvgTextWidth(u(d));g>c&&(c=g)}l.scale(i).orient("bottom").ticks(n.length).tickFormat(function(e){var i=n[e];return t.categoryFormatter&&(i=t.categoryFormatter.format(i)),null===e||void 0===e||0!==e&&e!==n.length-1||(i=p.getTailoredTextOrDefault(u(i),2*(e?r.right:r.left))),i});var m=d3.svg.axis().scale(a).orient("left").tickFormat(function(e){var i=e;return t.valueFormatter&&(i=t.valueFormatter.format(i)),i=p.getTailoredTextOrDefault(u(i.toString()),B-I)});this.setMaxTicks(l,o,Math.max(2,Math.round(o/c))),this.setMaxTicks(m,s);var y=this.data.streamGraphSettings.valueAxisSettings;
if(y.show){var f=y.labelColor;this.yAxis.attr("transform",x.translate(r.left,0)).call(m),this.yAxis.selectAll("text").style("fill",f)}else this.yAxis.selectAll("*").remove();var v=this.data.streamGraphSettings.categoryAxisSettings;if(v.show){var f=v.labelColor;this.xAxis.attr("transform",x.translate(0,s)).call(l),this.xAxis.selectAll("text").style("fill",f)}else this.xAxis.selectAll("*").remove()},e.prototype.renderYAxisLabels=function(){this.axisGraphicsContext.selectAll(e.YAxisLabel.selector).remove();var t=this.data.streamGraphSettings.valueAxisSettings;if(this.margin.left=t.show?B:H,t.showAxisTitle){this.margin.left+=E;var i=this.data.streamGraphSettings.categoryAxisSettings,a=i.show===!0,r=i.showAxisTitle===!0,s=this.margin.top,o=this.viewport.height-s-(a?j:G)-(r?R:0),n=this.dataView.categorical.values,l=n.source?n.source.displayName:this.getYAxisTitleFromValues(n),c=this.getTextPropertiesFunction(l);l=p.getTailoredTextOrDefault(c,o);var u=e.YAxisLabel["class"],h=this.axisGraphicsContext.append("text").style("text-anchor","middle").style("font-family",c.fontFamily).style("font-size",c.fontSize).style("font-style",c.fontStyle).style("font-weight",c.fontWeight).text(l).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":u,transform:"rotate(-90)",fill:t.labelColor,x:-(s+o/2),dy:"1em"})})});h.call(b.LabelLayoutStrategy.clip,o,p.svgEllipsis)}},e.prototype.getYAxisTitleFromValues=function(e){for(var t=[],i=0;i<e.length;i++)e[i]&&e[i].source&&e[i].source.displayName&&t.push({displayName:e[i].source.displayName});var a=t.map(function(e){return e?e.displayName:""}).filter(function(e,t,i){return""!==e&&i.indexOf(e)===t});return S.formatListAnd(a)},e.prototype.renderXAxisLabels=function(){this.axisGraphicsContext.selectAll(e.XAxisLabel.selector).remove();var t=this.data.streamGraphSettings.categoryAxisSettings;if(this.margin.bottom=t.show?j:G,t.showAxisTitle&&this.dataView.categorical.categories[0].source){this.margin.bottom+=R;var i=this.data.streamGraphSettings.valueAxisSettings,a=i.show===!0,r=i.showAxisTitle===!0,s=(a?B:H)+(r?E:0),o=this.viewport.width-this.margin.right-s,n=this.viewport.height,l=this.dataView.categorical.categories[0].source.displayName,c=this.getTextPropertiesFunction(l);l=p.getTailoredTextOrDefault(c,o);var u=e.XAxisLabel["class"],h=this.axisGraphicsContext.append("text").style("text-anchor","middle").style("font-family",c.fontFamily).style("font-size",c.fontSize).style("font-weight",c.fontWeight).text(l).call(function(e){e.each(function(){var e=d3.select(this);e.attr({"class":u,transform:x.translate(s+o/2,n),fill:t.labelColor,dy:"-0.5em"})})});h.call(b.LabelLayoutStrategy.clip,o,p.svgEllipsis)}},e.prototype.renderLegend=function(e){var t=e.streamGraphSettings.legendSettings,i=e.legendData;if(this.dataView&&this.dataView.metadata){var a=d.getObject(this.dataView.metadata.objects,"legend",{});a.titleText=t.titleText,s.update(i,a);var r=a[w.position];r&&this.legend.changeOrientation(C[r]),this.legend.drawLegend(i,_.clone(this.viewport)),P.positionChartArea(this.svg,this.legend),this.updateViewPort()}},e.prototype.updateViewPort=function(){var e=this.legend.getMargins(),t=this.legend.getOrientation();switch(t){case C.Top:case C.TopCenter:case C.Bottom:case C.BottomCenter:this.viewport.height=Math.max(0,this.viewport.height-e.height);break;case C.Left:case C.LeftCenter:case C.Right:case C.RightCenter:this.viewport.width=Math.max(0,this.viewport.width-e.width)}},e.prototype.setMaxTicks=function(e,t,i){var a=void 0===i?this.getTicksByAxis(e).length:Math.min(i,this.getTicksByAxis(e).length);e.scale().domain.toString()===d3.scale.linear().domain.toString()?e.ticks(this.getFittedTickLength(e,t,a)):e.tickValues(this.getFittedTickValues(e,t,a))},e.prototype.getFittedTickLength=function(e,t,i){for(var a=this.getTicksByAxis(e),r=this.getMeasureTickFunction(e,a);i>0&&t>0&&(this.measureTicks(a,r)>t||e.scale().ticks([i]).length>i);i--,a=this.getTicksByAxis(e))e.ticks(i);return i},e.prototype.getFittedTickValues=function(e,t,i){for(var a,r=this.getTicksByAxis(e),s=[],o=this.getMeasureTickFunction(e,r),n=i,l=[];i>0&&t>0;n--,l=[]){switch(n){case 0:return[];case 1:l=[0];break;case 2:l=[0,r.length-1];break;default:for(var c=r.length/(n-1),u=0;n-1>u;u++)l.push(Math.round(c*u));l.push(r.length-1)}var h=l.map(function(e){return[r[e],e]});if(a=t/r.length*2,h.reduce(function(e,t){return s.push([o(e[0])+o(t[0]),(t[1]-e[1])*a]),t}),!s.some(function(e){return e[0]>e[1]}))return h.map(function(e){return e[0]})}return[]},e.prototype.measureTicks=function(e,t){return e.map(function(e){return t(e)}).reduce(function(e,t){return e+t})},e.prototype.getTicksByAxis=function(e){var t=e.scale(),i=null===e.tickValues()?t.ticks?t.ticks.apply(t,e.ticks()):t.domain():e.tickValues();return void 0===i.length?[i]:i},e.prototype.getMeasureTickFunction=function(e,t){var i="top"===e.orient()||"bottom"===e.orient()?p.measureSvgTextWidth:p.measureSvgTextHeight,a=this.getTextPropertiesFunction,r={};return function(t){return r[t]?r[t]:r[t]=i(a(e.tickFormat()(t)))+e.tickPadding()}},e.prototype.getTextPropertiesFunction=function(e){var t=F,a=i.fromPoint(M),r=z;return{text:e,fontFamily:t,fontSize:a,fontWeight:r}},e.prototype.getWiggle=function(e){if(e&&e.metadata){var t=e.metadata.objects;if(t){var i=d.getObject(t,"general",void 0);if(i)return i.wiggle}}return!0},e.prototype.enumerateValueAxisValues=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.valueAxisSettings:W.valueAxisSettings;e.pushInstance({selector:null,objectName:"valueAxis",displayName:"Y-Axis",properties:{show:t.show,showAxisTitle:t.showAxisTitle,labelColor:t.labelColor}})},e.prototype.enumerateCategoryAxisValues=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.categoryAxisSettings:W.categoryAxisSettings;e.pushInstance({selector:null,objectName:"categoryAxis",displayName:"X-Axis",properties:{show:t.show,showAxisTitle:t.showAxisTitle,labelColor:t.labelColor}})},e.prototype.enumerateLegend=function(e){var t=this.data&&this.data.streamGraphSettings?this.data.streamGraphSettings.legendSettings:W.legendSettings;e.pushInstance({selector:null,objectName:"legend",displayName:"Legend",properties:{show:t.show,position:C[this.legend.getOrientation()],showTitle:t.showTitle,titleText:t.titleText,labelColor:t.labelColor,fontSize:t.fontSize}})},e.prototype.clearData=function(){this.svg.selectAll(e.Layer.selector).remove(),this.legend.drawLegend({dataPoints:[]},this.viewport),this.yAxis.selectAll("*").remove(),this.axisGraphicsContext.selectAll(e.YAxisLabel.selector).remove(),this.xAxis.selectAll("*").remove(),this.axisGraphicsContext.selectAll(e.XAxisLabel.selector).remove(),this.svg.select(".labels").remove()},e.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},e.prototype.enumerateObjectInstances=function(e){var t,i=new A,a=this.dataView;switch(this.data&&(t=this.data.streamGraphSettings.dataLabelsSettings?this.data.streamGraphSettings.dataLabelsSettings:W.dataLabelsSettings),e.objectName){case"legend":a&&a.categorical&&a.categorical.values&&a.categorical.values.source&&this.enumerateLegend(i);break;case"categoryAxis":this.enumerateCategoryAxisValues(i);break;case"valueAxis":this.enumerateValueAxisValues(i);break;case"labels":var r={enumeration:i,dataLabelsSettings:t,show:!0,fontSize:!0};v.enumerateDataLabels(r);break;case"general":var s={objectName:"general",displayName:"General",selector:null,properties:{wiggle:this.getWiggle(a)}};i.pushInstance(s)}return i.complete()},e.VisualClassName="streamGraph",e.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},legend:{show:{objectName:"legend",propertyName:"show"},showTitle:{objectName:"legend",propertyName:"showTitle"},titleText:{objectName:"legend",propertyName:"titleText"},labelColor:{objectName:"legend",propertyName:"labelColor"},fontSize:{objectName:"legend",propertyName:"fontSize"}},categoryAxis:{show:{objectName:"categoryAxis",propertyName:"show"},labelColor:{objectName:"categoryAxis",propertyName:"labelColor"},showAxisTitle:{objectName:"categoryAxis",propertyName:"showAxisTitle"}},valueAxis:{show:{objectName:"valueAxis",propertyName:"show"},labelColor:{objectName:"valueAxis",propertyName:"labelColor"},showAxisTitle:{objectName:"valueAxis",propertyName:"showAxisTitle"}},labels:{show:{objectName:"labels",propertyName:"show"},color:{objectName:"labels",propertyName:"color"},fontSize:{objectName:"labels",propertyName:"fontSize"}}},e.Layer={"class":"layer",selector:".layer"},e.XAxisLabel={"class":"xAxisLabel",selector:".xAxisLabel"},e.YAxisLabel={"class":"yAxisLabel",selector:".yAxisLabel"},e.MaxNumberOfAxisXValues=5,e.capabilities={dataRoles:[{name:"Category",kind:o.Grouping,displayName:"Category"},{name:"Series",kind:o.Grouping,displayName:"Series"},{name:"Y",kind:o.Measure,displayName:n("Role_DisplayName_Values")}],dataViewMappings:[{conditions:[{Category:{max:1},Series:{max:0}},{Category:{max:1},Series:{min:1,max:1},Y:{max:1}}],categorical:{categories:{"for":{"in":"Category"},dataReductionAlgorithm:{bottom:{}}},values:{group:{by:"Series",select:[{"for":{"in":"Y"}}],dataReductionAlgorithm:{bottom:{}}}}}}],objects:{general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},wiggle:{type:{bool:!0},displayName:"Wiggle"}}},categoryAxis:{displayName:"X-Axis",properties:{show:{displayName:"show",type:{bool:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}},valueAxis:{displayName:"Y-Axis",properties:{show:{displayName:"show",type:{bool:!0}},showAxisTitle:{displayName:"Title",type:{bool:!0}},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}}}},legend:{displayName:"Legend",properties:{show:{displayName:"show",type:{bool:!0}},position:{displayName:"Position",type:{enumeration:l.type}},showTitle:{displayName:"Title",type:{bool:!0}},titleText:{displayName:"Legend Name",type:{text:!0},suppressFormatPainterCopy:!0},labelColor:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}},labels:{displayName:"Data Labels",properties:{show:{displayName:"Show",type:{bool:!0}},color:{displayName:"Color",type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}}}}},supportsHighlight:!0},e}();t.StreamGraph=Y;var X;!function(e){function t(t,i,a,r){return r&&!i||a&&!t?e.DimmedOpacity:e.DefaultOpacity}e.DimmedOpacity=.4,e.DefaultOpacity=1,e.getFillOpacity=t}(X=t.streamGraphUtils||(t.streamGraphUtils={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,a=window.jsCommon,i=window.powerbi;window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){function r(t){var i=!1;return e.createEnumType(Object.keys(t).filter(function(e,a){return!!(a%2)===i&&t[e]===e&&!void(i===!i)||!!(a%2)!==i}).map(function(e){return{value:e,displayName:e}}))}var s=t.utility.SelectionManager,o=e.visuals.valueFormatter,n=a.CssConstants.createClassAndSelector,l=e.TextMeasurementService,c=t.dataLabelUtils.defaultLabelPrecision,u=t.dataLabelUtils.defaultLabelColor,h=t.dataLabelUtils.DefaultFontSizeInPt,p=t.dataLabelUtils.defaultLabelDensity;i.createEnumTypeFromEnum=r,function(e){e[e.DateOnly="Date only"]="DateOnly",e[e.TimeOnly="Time only"]="TimeOnly"}(i.PulseChartXAxisDateFormat||(i.PulseChartXAxisDateFormat={}));var d=i.PulseChartXAxisDateFormat;!function(e){e[e.Center="Center"]="Center",e[e.Bottom="Bottom"]="Bottom"}(i.XAxisPosition||(i.XAxisPosition={}));var g=i.XAxisPosition;!function(e){e[e.TopLeft="Top Left"]="TopLeft",e[e.TopRight="Top Right"]="TopRight"}(i.RunnerCounterPosition||(i.RunnerCounterPosition={}));var m=i.RunnerCounterPosition,y=function(){function i(e){e&&e.svg&&(this.svg=e.svg),this.margin=i.DefaultMargin}return i.getProperties=function(e){var t={};for(var i in e.objects){t[i]={};for(var a in e.objects[i].properties)t[i][a]={objectName:i,propertyName:a}}return t},i.GetPopupValueTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontSize:t+"px"}},i.GetPopupTitleTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontWeight:"bold",fontSize:t+"px"}},i.GetPopupDescriptionTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontSize:t+"px"}},i.GetRunnerCounterTextProperties=function(e,t){return void 0===t&&(t=12),{text:e||"",fontFamily:"sans-serif",fontSize:t+"px"}},i.ConvertTextPropertiesToStyle=function(e){return{"font-family":e.fontFamily,"font-weight":e.fontWeight,"font-size":e.fontSize}},i.GetDateTimeFormatString=function(e,t){switch(e){case d.DateOnly:return t;case d.TimeOnly:return"H:mm";default:return""}},i.GetFullWidthOfDateFormat=function(e,i){return i.text=t.valueFormatter.create({format:e}).format(new Date(2e3,10,20,20,20,20)),l.measureSvgTextWidth(i)},i.AddOnTouchClick=function(e,t){var i=function(e,i){d3.event.preventDefault(),t(e,i)};return e.on("click",i).on("touchstart",i)},i.getCategoricalColumnOfRole=function(e,t){var i=function(e){return e.filter(function(e){return e.source&&e.source.roles&&e.source.roles[t]})[0]};return i(e.categorical.categories)||i(e.categorical.values)},i.converter=function(e,a,r){if(!(e&&e.categorical&&e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].values&&e.categorical.categories))return null;var s=_.mapValues(i.RoleNames,function(t,a){return i.getCategoricalColumnOfRole(e,a)}),n=s.Timestamp;if(!n)return null;var c=!(n.source&&n.source.type&&n.source.type.dateTime),u=i.parseSettings(e,a,s),h=n.values;if(!h||_.isEmpty(e.categorical.values)||!s.Value||_.isEmpty(s.Value.values))return null;var p=Math.min.apply(null,s.Value.values),g=Math.max.apply(null,s.Value.values),m=Math.min.apply(null,h),y=Math.max.apply(null,h);u.xAxis.dateFormat=864e5>y-m&&new Date(y).getDate()===new Date(m).getDate()?d.TimeOnly:d.DateOnly,u.xAxis.formatterOptions={value:c?m:new Date(m),value2:c?y:new Date(y)},u.yAxis.formatterOptions={value:p,value2:g,format:o.getFormatString(s.Value.source,i.DefaultSettings.formatStringProperty)},c?u.xAxis.formatterOptions.format=o.getFormatString(n.source,i.DefaultSettings.formatStringProperty):u.xAxis.formatterOptions.format=i.GetDateTimeFormatString(u.xAxis.dateFormat,n.source.format);var f=70,v=c?60:i.GetFullWidthOfDateFormat(n.source.format,i.GetPopupValueTextProperties())+5,S=l.measureSvgTextHeight(i.GetPopupDescriptionTextProperties("lj",u.popup.fontSize)),w=s.RunnerCounter&&t.valueFormatter.getFormatString(s.RunnerCounter.source,u.formatStringProperty);u.popup.width=Math.max(v+20,u.popup.width);var C=i.DefaultSettings.dots.minSize,P=i.DefaultSettings.dots.maxSize;u.dots&&(C=u.dots.minSize,P=u.dots.maxSize);for(var A=i.createScale(!0,s.EventSize?[d3.min(s.EventSize.values),d3.max(s.EventSize.values)]:[0,0],C,P),D=b.getCategoryAxisProperties(e.metadata),T=!(!n.values||!n.source),V=x.getDefaultPulseChartLabelSettings(),N=i.getGapWidths(h),L=Math.max.apply(null,N),M=0,k=0,I=1,O=e.categorical.values&&e.categorical.values.grouped(),F=O[k]&&O[k].values[M]&&O[k].values[M].values,z=O[I]&&O[I].values[M]&&O[I].values[M].values,j=[],G=[],R=0,B=0,H=n.values.length;H>R;R++,B++){var E=h[R],W=t.AxisHelper.normalizeNonFiniteNumber(n.values[R]),U=s.RunnerCounter&&s.RunnerCounter.values&&s.RunnerCounter.values[R],Y=t.SelectionIdBuilder.builder().withCategory(n,R).createSelectionId(),X=Math.max((y-m)/i.MaxGapCount,i.MinGapWidth[u.xAxis.dateFormat]),q=N[R],K=u.gaps.show&&q>0&&q>X+(100-u.gaps.visibleGapsPercentage)*(L-X)/100;if(K&&G.length>0&&(j.push({displayName:O[k].name,key:Y.getKey(),lineIndex:j.length,color:u.series.fill,xCol:n.source,yCol:n.source,data:G,identity:Y,selected:!1,labelSettings:V,width:u.series.width,widthOfGap:q}),B=0,G=[]),!c||null!==E&&null!==W){var Z=null,J=s.EventSize&&s.EventSize.values&&s.EventSize.values[R]||0;if(s.EventTitle&&s.EventTitle.values&&s.EventTitle.values[R]||s.EventDescription&&s.EventDescription.values&&s.EventDescription.values[R]){var Q=E;!c&&E&&(Q=t.valueFormatter.create({format:n.source.format}).format(E)),Z={value:Q,title:s.EventTitle&&s.EventTitle.values&&s.EventTitle.values[R],description:s.EventDescription&&s.EventDescription.values&&s.EventDescription.values[R]}}var $={categoryValue:E,value:W,categoryIndex:R,seriesIndex:j.length,tooltipInfo:null,popupInfo:Z,selected:!1,identity:Y,key:JSON.stringify({ser:Y.getKey(),catIdx:R}),labelFill:V.labelColor,labelSettings:V,x:E,y:F&&F[R]||z&&z[R]||0,pointColor:u.series.fill,groupIndex:i.getGroupIndex(R,O),eventSize:s.EventSize?A(J):0,runnerCounterValue:U,runnerCounterFormatString:w,specificIdentity:void 0};G.push($)}}r&&r.applySelectionStateToData(G),G.length>0&&j.push({displayName:O[k].name,key:Y.getKey(),lineIndex:j.length,color:u.series.fill,xCol:n.source,yCol:n.source,data:G,identity:Y,selected:!1,labelSettings:V,width:u.series.width,widthOfGap:0}),D=b.getCategoryAxisProperties(e.metadata);var ee=b.getValueAxisProperties(e.metadata),te=e.categorical.categories,ie=[];if(te)for(var ae=0;ae<te.length;ae++)te[ae]&&te[ae].source&&te[ae].source.displayName&&ie.push({displayName:te[ae].source.displayName});var re=t.converterHelper.createAxesLabels(D,ee,n.source,ie);return r&&r.applySelectionStateToData(j),{columns:s,series:j,isScalar:c,dataLabelsSettings:V,axesLabels:{x:re.xAxisLabel,y:re.yAxisLabel},hasDynamicSeries:T,categoryMetadata:n.source,categories:h,settings:u,grouped:O,hasHighlights:!!s.Value.highlights,widthOfXAxisLabel:f,widthOfTooltipValueLabel:v,heightOfTooltipDescriptionTextLine:S,runnerCounterHeight:l.measureSvgTextHeight(i.GetRunnerCounterTextProperties("lj",u.runnerCounter.fontSize))}},i.createAxisY=function(e,i,a,r){void 0===r&&(r=!0);var s=t.valueFormatter.create(a),o=Math.max(2,Math.round(i/40)),n=d3.svg.axis().scale(e).ticks(o).outerTickSize(0).tickFormat(s.format);return n},i.createAxisX=function(e,a,r,s,o,n,l){for(var c=i.getXAxisScales(a,e,r),u=new Array(c.length),h=0,p=!1;h<u.length;h++){var d=i.getXAxisValuesToDisplay(c[h],p,e,o,l);if(!p&&n===g.Bottom&&d.length<i.MinimumTicksToRotate){var m=i.getXAxisValuesToDisplay(c[h],!0,e,o,l);if(m.length>d.length){p=!0,h=-1;continue}}u[h]={values:d,scale:c[h],rotate:p}}return s.tickCount=u.length&&5*u.map(function(e){return e.values.length}).reduce(function(e,t){return e+t}),s.value=r.domain()[0],s.value2=r.domain()[1],u.forEach(function(e){var i=e.values.filter(function(e){return null!==e}),a=t.valueFormatter.create(s);e.axis=d3.svg.axis().scale(e.scale).tickValues(i).tickFormat(a.format).outerTickSize(0)}),u},i.getXAxisScales=function(e,t,a){return e.map(function(e){var r=e.data,s=r[0].categoryValue,o=r[r.length-1].categoryValue,n=a(r[0].categoryValue),l=a(r[r.length-1].categoryValue);return i.createScale(t,[s,o],n,l)})},i.getXAxisValuesToDisplay=function(e,t,a,r,s){var o=e,n=t?i.XAxisTickHeight*(t?Math.abs(Math.sin(i.AxisTickRotateAngle*Math.PI/180)):0):s,l=i.XAxisTickSpace;if(e.range()[1]<n)return[];var c=e.invert(e.range()[0]+n/2),u=e.invert(e.range()[1]-n/2),h=e.range()[1]-e.range()[0],p=Math.floor((h+l)/(n+l));t&&(p=Math.min(i.MinimumTicksToRotate,p));var g=[];if(g=a?d3.range(c,u,(u-c)/(100*p)):(r===d.TimeOnly?d3.time.minute:d3.time.day).range(c,u),(!g.length||_.last(g)<u)&&g.push(u),!p)return[];p=Math.min(g.length,p);var m=d3.scale.ordinal().domain(d3.range(p)).rangePoints([0,g.length-1]).range();g=m.map(function(e){return g[Math.round(e)]});for(var y=1;y<g.length;y++){var f=o(g[y-1]),v=o(g[y]);n+l/3>v-f&&g.splice(y--,1)}return g},i.getGroupIndex=function(e,t){for(var i=0;i<t.length;i++)if(t[i].values&&t[i].values[0]&&void 0!==t[i].values[0].values[e]&&null!==t[i].values[0].values[e])return i;return 0},i.getGapWidths=function(e){for(var t=[],i=0,a=0,r=e.length;r>i;i++)a&&e[i]?t.push(e[i]-a):t.push(0),a=e[i];return t},i.createScale=function(e,t,i,a){var r;return r=e?d3.scale.linear():d3.time.scale(),r.domain(t).range([i,a])},Object.defineProperty(i.prototype,"runnerCounterPlaybackButtonsHeight",{get:function(){return Math.max(i.PlaybackButtonsHeight,this.data&&this.data.runnerCounterHeight/2+17)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"popupHeight",{get:function(){return this.data&&this.data.settings&&this.data.settings.popup&&this.data.settings.popup.show&&this.data.settings.popup.height||0},enumerable:!0,configurable:!0}),i.prototype.init=function(a){e.formattingService.initialize(),this.host=a.host,this.selectionManager=new s({hostServices:this.host});var r=this.svg=d3.select(a.element.get(0)).append("svg").classed("pulseChart",!0);this.gaps=r.append("g").classed(i.Gaps["class"],!0),this.yAxis=r.append("g").attr("class","y axis"),this.chart=r.append("g").attr("class",i.Chart["class"]),this.dots=r.append("g").attr("class","dots"),this.animationDot=this.dots.append("circle").classed(i.AnimationDot["class"],!0).attr("display","none"),this.animationHandler=new v(this,r);var o=a.style;this.colors=o&&o.colorPalette?o.colorPalette.dataColors:new t.DataColorPalette},i.prototype.update=function(e){if(e&&e.dataViews&&e.dataViews[0]){this.viewport=$.extend({},e.viewport);var t=e.dataViews[0];if(this.updateData(i.converter(t,this.colors)),!this.validateData(this.data))return void this.clearAll(!0);var a=this.getChartWidth();if(this.calculateXAxisProperties(a),this.data.xScale.ticks(void 0).length<2)return void this.clearAll(!0);var r=this.getChartHeight(this.data.settings.xAxis.show&&this.data.series.some(function(e){return e.xAxisProperties.rotate}));this.calculateYAxisProperties(r),this.size={width:a,height:r},this.updateElements(),this.render(!0)}},i.prototype.updateData=function(e){if(!this.data)return void(this.data=e);var t=this.getDataArrayToCompare(this.data),i=this.getDataArrayToCompare(e);_.isEqual(t,i)||this.clearAll(!1),this.data=e},i.prototype.getDataArrayToCompare=function(e){if(!e||!e.series)return null;var t=_.flatten(e.series.map(function(e){return e.data}));return _.flatten(t.map(function(e){return e&&_.flatten([[e.categoryValue,e.eventSize,e.groupIndex,e.runnerCounterValue,e.y,e.seriesIndex],e.popupInfo&&[e.popupInfo.description,e.popupInfo.title,e.popupInfo.value]])}))},i.prototype.validateData=function(e){return e?!e.categories.some(function(e){return!(e instanceof Date||$.isNumeric(e))}):!1},i.prototype.getChartWidth=function(){var e=this.margin.right;this.data.settings.yAxis&&this.data.settings.yAxis.show&&(e+=i.MaxWidthOfYAxis);var t=this.viewport.width-this.margin.left-e;return Math.max(t,i.DefaultViewport.width)},i.prototype.getChartHeight=function(e){var t=10+(e?this.data.widthOfXAxisLabel*Math.abs(Math.sin(i.AxisTickRotateAngle*Math.PI/180)):3);!this.data.settings.popup.alwaysOnTop&&this.popupHeight&&(t=Math.max(this.margin.bottom+this.popupHeight,t));var a=this.viewport.height-this.margin.top-this.runnerCounterPlaybackButtonsHeight-t-this.popupHeight;return Math.max(a,i.DefaultViewport.height)},i.prototype.updateElements=function(){var e=this.margin.top+this.runnerCounterPlaybackButtonsHeight+this.popupHeight;this.svg.attr(this.viewport),this.svg.style("display",void 0),this.gaps.attr("transform",t.SVGUtil.translate(this.margin.left,e+this.size.height/2)),this.chart.attr("transform",t.SVGUtil.translate(this.margin.left,e)),this.yAxis.attr("transform",t.SVGUtil.translate(this.size.width+this.margin.left,e)),this.dots.attr("transform",t.SVGUtil.translate(this.margin.left,e))},i.prototype.calculateXAxisProperties=function(e){this.data.xScale=i.createScale(this.data.isScalar,[this.data.categories[0],this.data.categories[this.data.categories.length-1]],0,e);var t=i.createAxisX(this.data.isScalar,this.data.series,this.data.xScale,$.extend({},this.data.settings.xAxis.formatterOptions),this.data.settings.xAxis.dateFormat,this.data.settings.xAxis.position,this.data.widthOfXAxisLabel);this.data.series.forEach(function(e,i){e.xAxisProperties=t[i]})},i.prototype.calculateYAxisProperties=function(e){this.data.yScales=this.getYAxisScales(e);var t=[];this.data.yScales.forEach(function(e){return t=t.concat(e.domain())}),this.data.commonYScale=i.createScale(!0,[d3.max(t),d3.min(t)],0,e),this.data.yAxis=i.createAxisY(this.data.commonYScale,e,this.data.settings.yAxis.formatterOptions)},i.prototype.getYAxisScales=function(e){var t=this.data,a=e/t.grouped.length;return t.grouped.map(function(e,t){var r=e.values[0].values.map(function(e){return e||0}),s=Number.MAX_VALUE,o=-Number.MAX_VALUE;if(r.forEach(function(e){s>e&&(s=e),e>o&&(o=e)}),o===s){var n=0===o?1:Math.abs(o/2);o+=n,s-=n}return i.createScale(!0,[o,s],a*t,a*(t+1))})},Object.defineProperty(i.prototype,"autoplayPauseDuration",{get:function(){return 1e3*(this.data&&this.data.settings&&this.data.settings.playback?this.data.settings.playback.autoplayPauseDuration:i.DefaultSettings.playback.autoplayPauseDuration)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isAutoPlay",{get:function(){return this.data&&this.data.settings&&this.data.settings.playback&&this.data.settings.playback.autoplay},enumerable:!0,configurable:!0}),i.prototype.render=function(e){var i=t.AnimatorCommon.GetAnimationDuration(this.animator,e),a=this.data;this.lastSelectedPoint=null;var r=a.xScale,s=a.yScales;this.lineX=d3.svg.line().x(function(e){return r(e.categoryValue)}).y(function(e){return s[e.groupIndex](e.y)}),this.data&&this.data.settings&&this.data.settings.playback&&this.data.settings.playback.color&&this.animationHandler.setControlsColor(this.data.settings.playback.color),this.animationHandler.render(),this.animationHandler.setRunnerCounterValue(),this.renderAxes(a,i),this.renderGaps(a,i)},i.prototype.renderAxes=function(e,t){this.renderXAxis(e,t),this.renderYAxis(e,t)},i.prototype.renderXAxis=function(e,a){var r,s,o,n=i.DefaultSettings.xAxis.color,l=i.DefaultSettings.xAxis.fontColor;this.data&&this.data.settings&&this.data.settings.xAxis&&(n=this.data.settings.xAxis.color,l=this.data.settings.xAxis.fontColor),r=this.rootSelection.selectAll(i.XAxisNode.selector),s=r.data(e.series),s.enter().insert("g","g."+i.LineContainer["class"]).classed(i.XAxisNode["class"],!0),s.call(function(t){t.forEach(function(t,i){d3.select(t[0]).call(e.series[i].xAxisProperties.axis.orient("bottom"))})}),s.exit().remove(),o=s.selectAll(".tick").selectAll(".axisBox").data([[]]),o.enter().insert("rect","text").classed("axisBox",!0),o.style("display",this.data.settings.xAxis.position===g.Center?"inherit":"none").style("fill",this.data.settings.xAxis.backgroundColor);var c=this.data.settings.xAxis.position===g.Center?-11:0;o.attr({x:-(this.data.widthOfXAxisLabel/2),y:c+"px",width:this.data.widthOfXAxisLabel,height:i.XAxisTickHeight+"px"}),o.exit().remove(),s.style("stroke",this.data.settings.xAxis.position===g.Center?n:"none").style("display",this.data.settings.xAxis.show?"inherit":"none"),s.call(function(e){var t=e.datum().xAxisProperties.rotate,a=t?Math.abs(Math.sin(i.AxisTickRotateAngle*Math.PI/180)):0,r=c+3;e.selectAll("text").attr("transform",function(){return"translate(0, "+(r+9+$(this).width()/2*a)+") rotate("+(t?i.AxisTickRotateAngle:0)+")"}).style("fill",l).style("stroke","none").attr("dy",-9)}),s.selectAll(".domain").style("stroke",n),s.selectAll(".domain").forEach(function(e){$(e).insertBefore($(e).parent().children().first())});var u=this.size.height;switch(this.data.settings.xAxis.position){case g.Center:u/=2;break;case g.Bottom:}s.attr("transform",t.SVGUtil.translate(0,u))},i.prototype.renderYAxis=function(e,t){var a=e.yAxis,r=!1,s=i.DefaultSettings.yAxis.color,o=i.DefaultSettings.yAxis.fontColor;a.orient("right"),this.data&&this.data.settings&&this.data.settings.yAxis&&this.data.settings.yAxis.show&&(r=!0),this.data&&this.data.settings&&this.data.settings.yAxis&&this.data.settings.yAxis&&(s=this.data.settings.yAxis.color,o=this.data.settings.yAxis.fontColor),this.yAxis.call(a).attr("display",r?"inline":"none"),this.yAxis.selectAll(".domain, path, line").style("stroke",s),this.yAxis.selectAll("text").style("fill",o),this.yAxis.selectAll("g.tick line").attr("x1",-this.size.width)},i.prototype.renderChart=function(){var e=this.data,t=this.data.series,a=this.rootSelection=this.chart.selectAll(i.LineNode.selector).data(t),r=a.enter().append("g").classed(i.LineNode["class"],!0);r.append("g").classed(i.LineContainer["class"],!0),r.append("g").classed(i.TooltipContainer["class"],!0),r.append("g").classed(i.DotsContainer["class"],!0),this.animationHandler.isAnimated?this.showAnimationDot():this.hideAnimationDot(),this.drawTooltips(e,this.selectionManager.getSelectionIds()),this.drawDots(e),this.drawLines(e),a.exit().remove()},i.prototype.drawLinesStatic=function(e,t){var a=this,r=i.Line,s=i.LineContainer,o=this.rootSelection,n=o.filter(function(i,a){return!t||e>a}).select(s.selector).selectAll(r.selector).data(function(e){return[e]});n.enter().append("path").classed(r["class"],!0),n.style({fill:"none",stroke:function(e){return e.color},"stroke-width":function(e){return e.width+"px"}}),n.attr("d",function(e){return a.lineX(e.data)}),n.exit().remove()},i.prototype.drawLinesStaticBeforeAnimation=function(e){var t=this,a=i.Line,r=i.LineContainer,s=this.rootSelection;this.animationSelection=s.filter(function(t,i){return i===e}).select(r.selector).selectAll(a.selector).data(function(e){return[e]}),this.animationSelection.enter().append("path").classed(a["class"],!0),this.animationSelection.style({fill:"none",stroke:function(e){return e.color},"stroke-width":function(e){return e.width+"px"}}),this.animationSelection.attr("d",function(e){var i=t.animationHandler.flooredPosition.index;if(0===i)return t.moveAnimationDot(e.data[0]),t.lineX([]);var a=e.data.slice(0,i+1);return t.moveAnimationDot(a[a.length-1]),t.lineX(a)}),this.animationSelection.exit().remove()},i.prototype.moveAnimationDot=function(e){var t=this.data.xScale,i=this.data.yScales;this.animationDot.attr("cx",t(e.x)).attr("cy",i[e.groupIndex](e.y))},i.prototype.playAnimation=function(e){var t=this;void 0===e&&(e=0);var i=this.animationHandler.flooredPosition.index;this.showAnimationDot(),this.animationSelection.transition().delay(e).duration(this.animationDuration).ease("linear").attrTween("d",function(e,a){return t.getInterpolation(e.data,i)}).each("end",function(e){return t.handleSelection(t.animationHandler.flooredPosition)})},i.prototype.pauseAnimation=function(){this.animationSelection&&(this.hideAnimationDot(),this.animationSelection.selectAll("path").transition(),this.animationSelection.transition().duration(0).delay(0))},i.prototype.stopAnimation=function(){this.pauseAnimation(),d3.timer.flush()},i.prototype.findNextPoint=function(e){for(var t=e.series;t<this.data.series.length;t++)for(var i=this.data.series[t],a=t===e.series?Math.floor(e.index+1):0;a<i.data.length;a++)if(i.data[a]&&i.data[a].popupInfo)return{series:t,index:a};return null},i.prototype.findPrevPoint=function(e){for(var t=e.series;t>=0;t--)for(var i=this.data.series[t],a=t===e.series?Math.ceil(e.index-1):i.data.length;a>=0;a--)if(i.data[a]&&i.data[a].popupInfo)return{series:t,index:a};return null},i.prototype.isAnimationSeriesAndIndexLast=function(e){return this.isAnimationSeriesLast(e)&&this.isAnimationIndexLast(e)},i.prototype.isAnimationSeriesLast=function(e){return e.series>=this.data.series.length-1},i.prototype.isAnimationIndexLast=function(e){var t=this.data.series[e.series];return e.index>=t.data.length-1},i.prototype.drawLines=function(e){var t=this.animationHandler.position.series,i=this.animationHandler.isAnimated;this.drawLinesStatic(t,i),i&&this.drawLinesStaticBeforeAnimation(t)},i.prototype.showAnimationDot=function(){if(this.animationHandler.isPlaying){var e=i.DefaultSettings.dots.size;this.data&&this.data.settings&&this.data.settings.dots&&this.data.settings.dots.size&&(e=this.data.settings.dots.size),this.animationDot.attr("display","inline").attr("fill",this.data.settings.dots.color).style("opacity",this.dotOpacity).attr("r",e);
}},i.prototype.hideAnimationDot=function(){this.animationDot.attr("display","none")},i.prototype.getInterpolation=function(e,t){var i=this;if(this.data){var a=this.data.xScale,r=this.data.yScales,s=t+1;this.showAnimationDot();var o=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear"),n=e.slice(0,t+1).map(function(e){return{x:a(e.x),y:r[e.groupIndex](e.y)}}),l=a(e[t].x),c=a(e[s].x),u=r[e[t].groupIndex](e[t].y),h=r[e[s].groupIndex](e[s].y),p=d3.scale.linear().domain([0,1]).range([t,s]),d=d3.scale.linear().domain([0,1]).range([l,c]),g=d3.scale.linear().domain([0,1]).range([u,h]);return this.animationHandler.setRunnerCounterValue(t),function(e){if(!i.animationHandler.isPlaying)return o(n);var t=d(e),a=g(e);return i.animationDot.attr("cx",t).attr("cy",a),n.push({x:t,y:a}),i.animationHandler.position.index=p(e),o(n)}}},i.prototype.clearSelection=function(){this.data&&this.data.hasHighlights||!this.selectionManager.hasSelection()?this.selectionManager.selectedIds=[]:this.selectionManager.clear(),this.chart.selectAll(i.Tooltip.selector).remove()},i.prototype.handleSelection=function(e){var t=this;if(this.data){var i=this.animationHandler.animationPlayingIndex,a=this.data.series[e.series].data[e.index],r=this.animationHandler.isPlaying&&this.isAnimationSeriesAndIndexLast(e);if((!a||!a.popupInfo)&&this.animationHandler.isPlaying)return void(r?setTimeout(function(){return t.animationHandler.toEnd()},0):this.animationHandler.play(0,!0));r?setTimeout(function(){return t.animationHandler.toEnd()},0):this.animationHandler.pause(),this.selectionManager.select(a.identity).then(function(e){t.setSelection(e),clearTimeout(t.handleSelectionTimeout),t.handleSelectionTimeout=setTimeout(function(){t.animationHandler.animationPlayingIndex===i&&((r||t.animationHandler.isPaused)&&t.clearSelection(),!r&&t.animationHandler.isPaused&&t.animationHandler.play())},t.pauseDuration)})}},Object.defineProperty(i.prototype,"animationDuration",{get:function(){return 1e3/(this.data&&this.data.settings&&this.data.settings.playback?this.data.settings.playback.playSpeed:i.DefaultSettings.playback.playSpeed)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pauseDuration",{get:function(){return 1e3*(this.data&&this.data.settings&&this.data.settings.playback?this.data.settings.playback.pauseDuration:i.DefaultSettings.playback.pauseDuration)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dotOpacity",{get:function(){return 1-(this.data&&this.data.settings&&this.data.settings.dots?this.data.settings.dots.transparency:i.DefaultSettings.dots.transparency)/100},enumerable:!0,configurable:!0}),i.prototype.drawDots=function(e){var t=this;if(e&&e.xScale){var a=e.xScale,r=e.yScales,s=i.Dot,o=i.DotsContainer,n=this.rootSelection,l=this.data.settings.dots.color,c=this.data.settings.dots.size,u=this.animationHandler.isAnimated,h=this.animationHandler.position,p=n.filter(function(e,t){return!u||t<=h.series}).select(o.selector).selectAll(s.selector).data(function(e,t){return _.filter(e.data,function(e,i){return u&&t===h.series&&i>h.index?!1:!!e.popupInfo})});p.enter().append("circle").classed(s["class"],!0),p.attr("cx",function(e){return a(e.categoryValue)}).attr("cy",function(e){return r[e.groupIndex](e.y)}).attr("r",function(e){return e.eventSize||c}).style("fill",l).style("opacity",this.dotOpacity).style("cursor","pointer").call(i.AddOnTouchClick,function(e){d3.event.stopPropagation(),t.selectionManager.select(e.identity,d3.event.ctrlKey).then(function(e){return t.setSelection(e)})}),p.exit().remove()}},i.prototype.renderGaps=function(e,a){var r,s,o,n,l=e.series,c=e.isScalar,u=e.xScale;r=[{left:-4.5,top:-5,height:10,width:3},{left:1.5,top:-5,height:10,width:3}],s=this.gaps.selectAll(i.Gap.selector).data(l.slice(0,l.length-1)),o=s.enter().append("g"),s.attr("transform",function(e,i){var a,r=e.widthOfGap/2,s=e.data[e.data.length-1].categoryValue;return a=u(c?r+s:new Date(r+s.getTime())),t.SVGUtil.translate(a,0)}),n=s.selectAll(i.GapNode.selector).data(r),n.enter().append("rect").attr({x:function(e){return e.left},y:function(e){return e.top},height:function(e){return e.height},width:function(e){return e.width}}).classed(i.GapNode["class"],!0),o.classed(i.Gap["class"],!0),s.exit().remove(),n.exit().remove()},i.prototype.setSelection=function(e){this.data&&(this.drawDots(this.data),this.drawTooltips(this.data,e))},i.prototype.isPopupShow=function(e,t){return this.popupHeight&&e.popupInfo&&t?s.containsSelection(t,e.identity):!1},i.prototype.drawTooltips=function(e,a){var r=this,s=e.xScale,o=e.yScales,n=i.Tooltip,c=i.TooltipContainer,u=this.rootSelection,h=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),p=i.DefaultTooltipSettings.marginTop,d=this.data.settings.popup.width,g=this.data.settings.popup.height,m=20,y=function(e,t){return r.isHigherMiddle(e,t)?-1*p+m:r.size.height+p},f=u.select(c.selector).selectAll(n.selector).data(function(e){return _.filter(e.data,function(e){return r.isPopupShow(e,a)})});f.enter().append("g").classed(n["class"],!0),f.attr("transform",function(e){var i=s(e.x)-d/2,a=y(e.y,e.groupIndex);return e.popupInfo.offsetX=Math.min(r.viewport.width-r.margin.right-d,Math.max(-r.margin.left,i))-i,t.SVGUtil.translate(i+e.popupInfo.offsetX,a)});var v=f.selectAll(i.TooltipRect.selector).data(function(e){return[e]});v.enter().append("path").classed(i.TooltipRect["class"],!0),v.attr("display",function(e){return e.popupInfo?"inherit":"none"}).style("fill",this.data.settings.popup.color).attr("d",function(e){var t=[{x:-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0},{x:-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g):g},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g):g},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0}];return h(t)});var x=f.selectAll(i.TooltipTriangle.selector).data(function(e){return[e]});x.enter().append("path").classed(i.TooltipTriangle["class"],!0),x.style("fill",this.data.settings.popup.color).attr("d",function(e){var t=[{x:d/2-5-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0},{x:d/2-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p-5):-5},{x:d/2+5-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0}];return h(t)}).style("stroke-width","1px");var b=f.selectAll(i.TooltipLine.selector).data(function(e){return[e]});b.enter().append("path").classed(i.TooltipLine["class"],!0),b.style("fill",this.data.settings.popup.color).style("stroke",this.data.settings.popup.color).style("stroke-width","1px").attr("d",function(e){var t=[{x:d/2-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?o[e.groupIndex](e.y)+y(e.y,e.groupIndex)-e.eventSize:o[e.groupIndex](e.y)-y(e.y,e.groupIndex)+e.eventSize},{x:d/2-e.popupInfo.offsetX,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*p:0}];return h(t)});var S=this.data.settings.popup.showTime,w=this.data.settings.popup.showTitle,C=f.selectAll(i.TooltipTimeRect.selector).data(function(e){return[e]}),P={display:S?void 0:"none"};C.enter().append("path").classed(i.TooltipTimeRect["class"],!0),C.style("fill",this.data.settings.popup.timeFill).style(P).attr("d",function(e){var t=[{x:d-r.data.widthOfTooltipValueLabel-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g):0},{x:d-r.data.widthOfTooltipValueLabel-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g-i.DefaultTooltipSettings.timeHeight):i.DefaultTooltipSettings.timeHeight},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g-i.DefaultTooltipSettings.timeHeight):i.DefaultTooltipSettings.timeHeight},{x:d-2,y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g):0}];return h(t)});var A=f.selectAll(i.TooltipTime.selector).data(function(e){return[e]});A.enter().append("text").classed(i.TooltipTime["class"],!0),A.style(i.ConvertTextPropertiesToStyle(i.GetPopupValueTextProperties())).style(P).style("fill",this.data.settings.popup.timeColor).attr("x",function(e){return d-r.data.widthOfTooltipValueLabel}).attr("y",function(e){return r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g-i.DefaultTooltipSettings.timeHeight+3):i.DefaultTooltipSettings.timeHeight-3}).text(function(e){return e.popupInfo.value});var D={display:w?void 0:"none"},T=f.selectAll(i.TooltipTitle.selector).data(function(e){return[e]});T.enter().append("text").classed(i.TooltipTitle["class"],!0),T.style(D).style(i.ConvertTextPropertiesToStyle(i.GetPopupTitleTextProperties())).style("fill",this.data.settings.popup.fontColor).attr("x",function(e){return i.PopupTextPadding}).attr("y",function(e){return(r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g-12):12)+i.PopupTextPadding}).text(function(e){if(!e.popupInfo)return"";var t=d-2*i.PopupTextPadding-(S?r.data.widthOfTooltipValueLabel-i.PopupTextPadding:0)-10;return l.getTailoredTextOrDefault(i.GetPopupTitleTextProperties(e.popupInfo.title),t)});var V=function(e){var t=i.PopupTextPadding+r.data.settings.popup.fontSize,a=t+i.DefaultTooltipSettings.timeHeight;return e.popupInfo&&(t=w&&e.popupInfo.title||S&&e.popupInfo.value?a:t),{y:r.isHigherMiddle(e.y,e.groupIndex)?-1*(p+g-t):t,x:i.PopupTextPadding,width:d-2*i.PopupTextPadding,height:g-t}},N=f.selectAll(i.TooltipDescription.selector).data(function(e){return[e]});N.enter().append("text").classed(i.TooltipDescription["class"],!0),N.style(i.ConvertTextPropertiesToStyle(i.GetPopupDescriptionTextProperties(null,this.data.settings.popup.fontSize))).style("fill",this.data.settings.popup.fontColor).text(function(e){return e.popupInfo&&e.popupInfo.description}).attr("y",function(e){var t=V(e),i=d3.select(this)[0][0];return l.wordBreak(i,t.width,t.height),0}).attr("transform",function(e){var i=V(e);return t.SVGUtil.translate(0,i.y)}),N.selectAll("tspan").attr("x",i.PopupTextPadding),f.exit().remove()},i.prototype.isHigherMiddle=function(e,t){if(this.data.settings.popup.alwaysOnTop)return!0;if(this.data.yScales.length>1)return 0===t;var i=this.data.commonYScale.domain(),a=d3.min(i),r=Math.abs((d3.max(i)-a)/2);return r=0===r?r:a+r,e>=r},i.getObjectsFromDataView=function(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.objects?e.metadata.objects:null},i.parseSettings=function(e,t,a){var r={},s=i.getObjectsFromDataView(e);return r.xAxis=this.getAxisXSettings(s,t),r.yAxis=this.getAxisYSettings(s,t),r.popup=this.getPopupSettings(s,t),r.dots=this.getDotsSettings(s,t),r.series=this.getSeriesSettings(s,t),r.gaps=this.getGapsSettings(s),r.playback=this.getPlaybackSettings(s,t),r.runnerCounter=this.getRunnerCounterSettings(s,t,a),r},i.getPopupSettings=function(a,r){var s=e.DataViewObjects.getValue(a,i.Properties.popup.show,i.DefaultSettings.popup.show),o=e.DataViewObjects.getValue(a,i.Properties.popup.alwaysOnTop,i.DefaultSettings.popup.alwaysOnTop),n=Math.max(i.PopupMinWidth,Math.min(i.PopupMaxWidth,e.DataViewObjects.getValue(a,i.Properties.popup.width,i.DefaultSettings.popup.width))),l=Math.max(i.PopupMinHeight,Math.min(i.PopupMaxHeight,e.DataViewObjects.getValue(a,i.Properties.popup.height,i.DefaultSettings.popup.height))),c=new t.ColorHelper(r,i.Properties.popup.color,i.DefaultSettings.popup.color),u=c.getColorForMeasure(a,""),h=parseInt(e.DataViewObjects.getValue(a,i.Properties.popup.fontSize,i.DefaultSettings.popup.fontSize),10),p=new t.ColorHelper(r,i.Properties.popup.fontColor,i.DefaultSettings.popup.fontColor),d=p.getColorForMeasure(a,""),g=e.DataViewObjects.getValue(a,i.Properties.popup.showTime,i.DefaultSettings.popup.showTime),m=e.DataViewObjects.getValue(a,i.Properties.popup.showTitle,i.DefaultSettings.popup.showTitle),y=new t.ColorHelper(r,i.Properties.popup.timeColor,i.DefaultSettings.popup.timeColor),f=y.getColorForMeasure(a,""),v=new t.ColorHelper(r,i.Properties.popup.timeFill,i.DefaultSettings.popup.timeFill),x=v.getColorForMeasure(a,"");return{show:s,alwaysOnTop:o,width:n,height:l,color:u,fontSize:h,fontColor:d,showTime:g,showTitle:m,timeColor:f,timeFill:x}},i.getDotsSettings=function(a,r){var s=i.Properties.dots,o=i.DefaultSettings.dots,n=new t.ColorHelper(r,s.color,o.color),l=n.getColorForMeasure(a,""),c=Math.max(0,Math.min(9999,e.DataViewObjects.getValue(a,s.minSize,o.minSize))),u=Math.max(c,Math.min(9999,e.DataViewObjects.getValue(a,s.maxSize,o.maxSize))),h=Math.max(c,Math.min(u,e.DataViewObjects.getValue(a,s.size,o.size))),p=Math.max(0,Math.min(100,e.DataViewObjects.getValue(a,s.transparency,o.transparency)));return{color:l,size:h,minSize:c,maxSize:u,transparency:p}},i.getSeriesSettings=function(a,r){var s=Math.max(1,Math.min(100,e.DataViewObjects.getValue(a,i.Properties.series.width,i.DefaultSettings.series.width))),o=new t.ColorHelper(r,i.Properties.series.fill,i.DefaultSettings.series.fill),n=o.getColorForMeasure(a,"");return{width:s,fill:n}},i.getGapsSettings=function(t){var a=e.DataViewObjects.getValue(t,i.Properties.gaps.show,i.DefaultSettings.gaps.show),r=Math.max(1,Math.min(100,e.DataViewObjects.getValue(t,i.Properties.gaps.transparency,i.DefaultSettings.gaps.visibleGapsPercentage)));return{show:a,visibleGapsPercentage:r}},i.getAxisXSettings=function(a,r){var s=i.Properties.xAxis,o=i.DefaultSettings.xAxis,n=new t.ColorHelper(r,s.color,o.color).getColorForMeasure(a,""),l=new t.ColorHelper(r,s.fontColor,o.fontColor).getColorForMeasure(a,""),c=e.DataViewObjects.getValue(a,s.show,o.show),u=e.DataViewObjects.getValue(a,s.position,o.position),h=new t.ColorHelper(r,s.backgroundColor,o.backgroundColor).getColorForMeasure(a,"");return{show:c,position:u,color:n,fontColor:l,backgroundColor:h}},i.getAxisYSettings=function(a,r){var s=i.Properties.yAxis,o=i.DefaultSettings.yAxis,n=new t.ColorHelper(r,s.color,o.color),l=n.getColorForMeasure(a,""),c=new t.ColorHelper(r,s.fontColor,o.fontColor),u=c.getColorForMeasure(a,""),h=e.DataViewObjects.getValue(a,s.show,o.show);return{color:l,fontColor:u,show:h}},i.getPlaybackSettings=function(a,r){var s={},o=i.Properties.playback,n=i.DefaultSettings.playback;s.autoplay=e.DataViewObjects.getValue(a,o.autoplay,n.autoplay),s.playSpeed=Math.max(1,Math.min(99999,e.DataViewObjects.getValue(a,o.playSpeed,n.playSpeed))),s.pauseDuration=Math.max(0,Math.min(9999,e.DataViewObjects.getValue(a,o.pauseDuration,n.pauseDuration))),s.autoplayPauseDuration=Math.max(1,Math.min(9999,e.DataViewObjects.getValue(a,o.autoplayPauseDuration,n.autoplayPauseDuration)));var l=new t.ColorHelper(r,o.color,n.color);s.color=l.getColorForMeasure(a,"");var c=e.DataViewObjects.getValue(a,o.position,"");if(c.length>3)try{s.position=JSON.parse(c)}catch(u){}return s.position=s.position||n.position,s},i.getRunnerCounterSettings=function(a,r,s){var o=e.DataViewObjects.getValue(a,i.Properties.runnerCounter.show,i.DefaultSettings.runnerCounter.show),n=e.DataViewObjects.getValue(a,i.Properties.runnerCounter.label,s.RunnerCounter&&s.RunnerCounter.source&&s.RunnerCounter.source.displayName||i.DefaultSettings.runnerCounter.label),l=e.DataViewObjects.getValue(a,i.Properties.runnerCounter.position,i.DefaultSettings.runnerCounter.position),c=parseInt(e.DataViewObjects.getValue(a,i.Properties.runnerCounter.fontSize,i.DefaultSettings.runnerCounter.fontSize),10),u=new t.ColorHelper(r,i.Properties.runnerCounter.fontColor,i.DefaultSettings.runnerCounter.fontColor).getColorForMeasure(a,"");return{show:o,label:n,position:l,fontSize:c,fontColor:u}},i.prototype.clearAll=function(e){this.gaps.selectAll(i.Gap.selector).remove(),this.animationHandler&&(this.animationHandler.reset(),this.animationHandler.clear()),e&&this.svg.style("display","none"),this.clearChart()},i.prototype.clearChart=function(){this.clearSelection(),this.hideAnimationDot(),this.chart.selectAll(i.Line.selector).remove(),this.chart.selectAll(i.Dot.selector).remove()},i.prototype.clearRedundant=function(e){var t=this;if(this.data){var a=this.chart.selectAll(i.Tooltip.selector).filter(function(i){return i.seriesIndex<e.series||i.seriesIndex===e.series&&t.data.series[i.seriesIndex].data[e.index].value>=i.value}),r=a.data().map(function(e){return e.identity});if(this.clearSelection(),r.length){var s=r.map(function(e){return t.selectionManager.select(e,!0)});$.when.apply(null,s).then(function(e){return t.setSelection(e)})}this.chart.selectAll(i.Line.selector).remove(),this.chart.selectAll(i.Dot.selector).remove()}},i.prototype.enumerateObjectInstances=function(e){var i=new t.ObjectEnumerationBuilder;switch(e.objectName){case"general":this.readGeneralInstance(i);break;case"popup":this.readPopupInstance(i);break;case"dots":this.readDotsInstance(i);break;case"xAxis":this.xAxisInstance(i);break;case"yAxis":this.yAxisInstance(i);break;case"series":this.readSeriesInstance(i);break;case"gaps":this.readGapsInstance(i);break;case"playback":this.readPlaybackInstance(i);break;case"runnerCounter":this.readRunnerCounterInstance(i)}return i.complete()},i.prototype.getSettings=function(e){return this.data&&this.data.settings&&this.data.settings[e]?this.data.settings[e]:i.DefaultSettings[e]},i.prototype.readGeneralInstance=function(e){var t={objectName:"general",displayName:"general",selector:null,properties:{}};e.pushInstance(t)},i.prototype.readPopupInstance=function(e){var t=this.getSettings("popup"),i={objectName:"popup",displayName:"popup",selector:null,properties:{show:t.show,alwaysOnTop:t.alwaysOnTop,width:t.width,height:t.height,color:t.color,fontColor:t.fontColor,fontSize:t.fontSize,showTime:t.showTime,showTitle:t.showTitle,timeColor:t.timeColor,timeFill:t.timeFill}};e.pushInstance(i)},i.prototype.readDotsInstance=function(e){var t=this.getSettings("dots"),i={objectName:"dots",displayName:"Dots",selector:null,properties:{color:t.color,size:t.size,minSize:t.minSize,maxSize:t.maxSize,transparency:t.transparency}};e.pushInstance(i)},i.prototype.xAxisInstance=function(e){var t=this.getSettings("xAxis");e.pushInstance({objectName:"xAxis",displayName:"xAxis",selector:null,properties:{show:t.show,position:t.position,color:t.color,fontColor:t.fontColor,backgroundColor:t.backgroundColor}})},i.prototype.yAxisInstance=function(e){var t=this.getSettings("yAxis");e.pushInstance({objectName:"yAxis",displayName:"yAxis",selector:null,properties:{color:t.color,fontColor:t.fontColor,show:t.show}})},i.prototype.readSeriesInstance=function(e){var t=this.getSettings("series"),i={objectName:"series",displayName:"series",selector:null,properties:{fill:t.fill,width:t.width}};e.pushInstance(i)},i.prototype.readGapsInstance=function(e){var t=this.getSettings("gaps"),i={objectName:"gaps",selector:null,properties:{show:t.show,transparency:t.visibleGapsPercentage}};e.pushInstance(i)},i.prototype.readPlaybackInstance=function(e){var t=this.getSettings("playback");e.pushInstance({objectName:"playback",displayName:"playback",selector:null,properties:{autoplay:t.autoplay,playSpeed:t.playSpeed,pauseDuration:t.pauseDuration,autoplayPauseDuration:t.autoplayPauseDuration,color:t.color}})},i.prototype.readRunnerCounterInstance=function(e){var t=this.getSettings("runnerCounter"),i={objectName:"runnerCounter",selector:null,properties:{}};this.data&&this.data.columns&&this.data.columns.RunnerCounter&&(i.properties={show:t.show,label:t.label,position:t.position,fontSize:t.fontSize,fontColor:t.fontColor}),e.pushInstance(i)},i.prototype.destroy=function(){this.data=null,this.clearAll(!0)},i.RoleDisplayNames={Timestamp:"Timestamp",Category:"Category",Value:"Value",EventTitle:"Event Title",EventDescription:"Event Description",EventSize:"Event Size",RunnerCounter:"Runner Counter"},i.RoleNames=_.mapValues(i.RoleDisplayNames,function(e,t){return t}),i.capabilities={dataRoles:[{displayName:i.RoleDisplayNames.Timestamp,name:i.RoleNames.Timestamp,kind:e.VisualDataRoleKind.Grouping},{displayName:i.RoleDisplayNames.Value,name:i.RoleNames.Value,kind:e.VisualDataRoleKind.Measure},{displayName:i.RoleDisplayNames.EventTitle,name:i.RoleNames.EventTitle,kind:e.VisualDataRoleKind.GroupingOrMeasure},{displayName:i.RoleDisplayNames.EventDescription,name:i.RoleNames.EventDescription,kind:e.VisualDataRoleKind.GroupingOrMeasure},{displayName:i.RoleDisplayNames.EventSize,name:i.RoleNames.EventSize,kind:e.VisualDataRoleKind.GroupingOrMeasure},{displayName:i.RoleDisplayNames.RunnerCounter,name:i.RoleNames.RunnerCounter,kind:e.VisualDataRoleKind.GroupingOrMeasure}],dataViewMappings:[{conditions:[{Timestamp:{max:1},Value:{max:1},Category:{max:1},EventTitle:{max:1},EventDescription:{max:1},EventSize:{max:1},RunnerCounter:{max:1}}],categorical:{categories:{"for":{"in":i.RoleNames.Timestamp},dataReductionAlgorithm:{top:{count:1e4}}},values:{group:{by:i.RoleNames.Category,select:[{bind:{to:i.RoleNames.Value}},{bind:{to:i.RoleNames.EventTitle}},{bind:{to:i.RoleNames.EventDescription}},{bind:{to:i.RoleNames.EventSize}},{bind:{to:i.RoleNames.RunnerCounter}}],dataReductionAlgorithm:{top:{}}}}}}],objects:{series:{displayName:"Series",description:"Series",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},width:{displayName:"Width",type:{numeric:!0}}}},gaps:{displayName:"Gaps",description:"Gaps",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},transparency:{displayName:"Visible gaps",type:{numeric:!0}}}},general:{displayName:"General",properties:{formatString:{type:{formatting:{formatString:!0}}},fill:{displayName:"Background color",type:{fill:{solid:{color:!0}}}}}},popup:{displayName:"Popup",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},alwaysOnTop:{displayName:"Always on top",type:{bool:!0}},width:{displayName:"Width",type:{numeric:!0}},height:{displayName:"Height",type:{numeric:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},fontSize:{displayName:"Text size",type:{formatting:{fontSize:!0}}},fontColor:{displayName:"Text color",type:{fill:{solid:{color:!0}}}},showTime:{displayName:"Show time",type:{bool:!0}},showTitle:{displayName:"Show title",type:{bool:!0}},timeColor:{displayName:"Time color",type:{fill:{solid:{color:!0}}}},timeFill:{displayName:"Time fill",type:{fill:{solid:{color:!0}}}}}},dots:{displayName:"Dots",properties:{color:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},minSize:{displayName:"Min Size",type:{numeric:!0}},maxSize:{displayName:"Max Size",type:{numeric:!0}},size:{displayName:"Default Size",type:{numeric:!0}},transparency:{displayName:"Transparency",type:{numeric:!0}}}},xAxis:{displayName:e.data.createDisplayNameGetter("Visual_XAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},position:{displayName:"Position",type:{enumeration:r(g)}},fontColor:{displayName:"Font Color",type:{fill:{solid:{color:!0}}}},color:{displayName:"Axis Color",type:{fill:{solid:{color:!0}}}},backgroundColor:{displayName:"Background Color",type:{fill:{solid:{color:!0}}}}}},yAxis:{displayName:e.data.createDisplayNameGetter("Visual_YAxis"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},fontColor:{displayName:"Font Color",type:{fill:{solid:{color:!0}}}},color:{displayName:"Axis Color",type:{fill:{solid:{color:!0}}}}}},playback:{displayName:"Playback",properties:{autoplay:{displayName:"Autoplay",type:{bool:!0}},playSpeed:{displayName:"Speed (dots/sec)",type:{numeric:!0}},pauseDuration:{displayName:"Pause Duration",type:{numeric:!0}},autoplayPauseDuration:{displayName:"Start Delay",type:{numeric:!0}},color:{displayName:"Buttons Color",type:{fill:{solid:{color:!0}}}},position:{displayName:"Position",type:{text:!0}}}},runnerCounter:{displayName:"Runner Counter",properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},label:{displayName:"Label",type:{text:!0}},position:{displayName:"Position",type:{enumeration:r(m)}},fontSize:{displayName:"Text Size",type:{formatting:{fontSize:!0}}},fontColor:{displayName:"Font Color",type:{fill:{solid:{color:!0}}}}}}},sorting:{implicit:{clauses:[{role:i.RoleNames.Timestamp,direction:1}]}},supportsHighlight:!0},i.Properties=i.getProperties(i.capabilities),i.DefaultMargin={top:20,bottom:20,right:25,left:25},i.DefaultViewport={width:50,height:50},i.PlaybackButtonsHeight=26,i.PopupMinHeight=20,i.PopupMinWidth=20,i.PopupMaxHeight=200,i.PopupMaxWidth=2e3,i.MaxWidthOfYAxis=50,i.PopupTextPadding=3,i.XAxisTickSpace=15,i.XAxisTickHeight=16,i.MinimumTicksToRotate=3,i.AxisTickRotateAngle=-35,i.DefaultSettings={precision:0,popup:{show:!0,alwaysOnTop:!1,width:100,height:80,color:"#808181",fontSize:10,fontColor:"white",showTime:!0,showTitle:!0,timeColor:"white",timeFill:"#010101"},dots:{color:"#808181",size:5,minSize:5,maxSize:20,transparency:25},gaps:{show:!1,visibleGapsPercentage:1},series:{fill:"#3779B7",width:2},xAxis:{color:"#777777",fontColor:"#777777",position:g.Center,show:!0,dateFormat:d.TimeOnly,backgroundColor:"#E1F2F7"},yAxis:{color:"#777777",fontColor:"#777777",show:!0},playback:{autoplay:!1,playSpeed:5,pauseDuration:10,autoplayPauseDuration:0,color:"#777",position:null},runnerCounter:{show:!0,label:"",position:m.TopRight,fontSize:13,fontColor:"#777777"},formatStringProperty:i.Properties.general.formatString},i.DefaultTooltipSettings={dataPointColor:"#808181",marginTop:20,timeHeight:15},i.MaxGapCount=100,i.MinGapWidth=_.object([[d.DateOnly,144e4],[d.TimeOnly,6e4]],void 0),i.Chart=n("chart"),i.Line=n("line"),i.LineContainer=n("lineContainer"),i.LineNode=n("lineNode"),i.XAxisNode=n("xAxisNode"),i.Dot=n("dot"),i.DotsContainer=n("dotsContainer"),i.Tooltip=n("Tooltip"),i.TooltipRect=n("tooltipRect"),i.TooltipTriangle=n("tooltipTriangle"),i.Gaps=n("gaps"),i.Gap=n("gap"),i.GapNode=n("gapNode"),i.TooltipLine=n("tooltipLine"),i.TooltipTime=n("tooltipTime"),i.TooltipTimeRect=n("tooltipTimeRect"),i.TooltipTitle=n("tooltipTitle"),i.TooltipDescription=n("tooltipDescription"),i.TooltipContainer=n("tooltipContainer"),i.AnimationDot=n("animationDot"),i}();i.PulseChart=y;var f;!function(e){e[e.Ready=0]="Ready",e[e.Play=1]="Play",e[e.Paused=2]="Paused",e[e.Stopped=3]="Stopped"}(f||(f={}));var v=function(){function e(t,i){var a=this;this.animationPlayingIndex=0,this.runnerCounterTopLeftPosition=180,this.isAutoPlayed=!1,this.isPositionWasSaved=!1,this.chart=t,this.svg=i,this.setDefaultValues();var r=this.container=this.svg.append("g");this.animationPlay=r.append("g").classed(e.AnimationPlay["class"],!0),this.animationPlay.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationPlay.call(y.AddOnTouchClick,function(){return a.play()}),this.animationPlay.append("path").attr("d","M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3 17v-10l9 5.146-9 4.854z"),this.animationPause=r.append("g").classed(e.AnimationPause["class"],!0),this.animationPause.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationPause.call(y.AddOnTouchClick,function(){return a.stop()}),this.animationPause.append("path").attr("d","M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-1 17h-3v-10h3v10zm5-10h-3v10h3v-10z"),this.animationReset=r.append("g").classed(e.AnimationReset["class"],!0),this.animationReset.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationReset.call(y.AddOnTouchClick,function(){return a.reset()}),this.animationReset.append("path").attr("d","M22 12c0 5.514-4.486 10-10 10s-10-4.486-10-10 4.486-10 10-10 10 4.486 10 10zm-22 0c0 6.627 5.373 12 12 12s12-5.373 12-12-5.373-12-12-12-12 5.373-12 12zm13 0l5-4v8l-5-4zm-5 0l5-4v8l-5-4zm-2 4h2v-8h-2v8z"),this.animationPrev=r.append("g").classed(e.AnimationPrev["class"],!0),this.animationPrev.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationPrev.call(y.AddOnTouchClick,function(){return a.prev()}),this.animationPrev.append("path").attr("d","M9.5 12l7.5-4.5v9l-7.5-4.5zm-4.5 0l6.5 4v-1.634l-3.943-2.366 3.943-2.366v-1.634l-6.5 4zm17 0c0 5.514-4.486 10-10 10s-10-4.486-10-10 4.486-10 10-10 10 4.486 10 10zm-22 0c0 6.627 5.373 12 12 12s12-5.373 12-12-5.373-12-12-12-12 5.373-12 12z"),this.animationNext=r.append("g").classed(e.AnimationNext["class"],!0),this.animationNext.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationNext.call(y.AddOnTouchClick,function(){return a.next()}),this.animationNext.append("path").attr("d","M7 16.5v-9l7.5 4.5-7.5 4.5zm5.5-8.5v1.634l3.943 2.366-3.943 2.366v1.634l6.5-4-6.5-4zm-.5-6c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12z").attr("rotate",180),this.animationToEnd=r.append("g").classed(e.AnimationToEnd["class"],!0),this.animationToEnd.append("circle").attr("cx",12).attr("cy",12).attr("r",10).attr("fill","transparent"),this.animationToEnd.call(y.AddOnTouchClick,function(){return a.toEnd()}),this.animationToEnd.append("path").attr("d","M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-6 16v-8l5 4-5 4zm5 0v-8l5 4-5 4zm7-8h-2v8h2v-8z"),this.runnerCounter=r.append("g").classed(e.RunnerCounter["class"],!0),this.runnerCounterText=this.runnerCounter.append("text"),this.setControlsColor(e.DefaultControlsColor)}return Object.defineProperty(e,"AnimationMinPosition",{get:function(){return{series:0,index:0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"runnerCounterPosition",{get:function(){return this.chart.data.settings.runnerCounter.position},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxTextWidthOfRunnerCounterValue",{get:function(){var e=this.runnerCounterPosition===m.TopLeft||this.runnerCounterPosition===m.TopRight;return this.chart.viewport.width-(e?this.runnerCounterTopLeftPosition:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAnimated",{get:function(){return this.animatorState===f.Paused||this.animatorState===f.Play||this.animatorState===f.Stopped},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this.animatorState===f.Play},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPaused",{get:function(){return this.animatorState===f.Paused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStopped",{get:function(){return this.animatorState===f.Stopped},enumerable:!0,configurable:!0}),e.prototype.setDefaultValues=function(){this.position=e.AnimationMinPosition,this.animatorState=f.Ready,this.runnerCounterValue=null},e.prototype.render=function(){this.renderControls(),this.disableControls(),this.chart.isAutoPlay||(this.isAutoPlayed=!0,this.savedPosition&&(this.savedPosition=null)),this.chart.isAutoPlay&&this.isAutoPlayed&&this.animatorState===f.Play&&!this.isPositionWasSaved&&!_.isEqual(this.autoPlayPosition,this.savedPosition)&&(this.chart.stopAnimation(),this.isAutoPlayed=!1,this.isPositionWasSaved=!0,this.animatorState=f.Ready),this.animatorState===f.Play?this.play():this.chart.isAutoPlay&&!this.isAutoPlayed&&this.animatorState===f.Ready?(this.autoPlayPosition=this.savedPosition,this.isAutoPlayed=!0,this.savedPosition&&this.savedPosition.series<this.chart.data.series.length&&this.savedPosition.index<this.chart.data.series[this.savedPosition.series].data.length&&(this.position=this.savedPosition),this.play(this.chart.autoplayPauseDuration)):this.chart.renderChart()},e.prototype.setControlsColor=function(e){this.color=e},e.prototype.renderControls=function(){this.show(),this.animationPlay.attr("transform",t.SVGUtil.translate(0,0)).attr("fill",this.color),this.animationPause.attr("transform",t.SVGUtil.translate(30,0)).attr("fill",this.color),this.animationReset.attr("transform",t.SVGUtil.translate(60,0)).attr("fill",this.color),this.animationPrev.attr("transform",t.SVGUtil.translate(90,0)).attr("fill",this.color),this.animationNext.attr("transform",t.SVGUtil.translate(120,0)).attr("fill",this.color),this.animationToEnd.attr("transform",t.SVGUtil.translate(150,0)).attr("fill",this.color),
this.runnerCounter.attr("fill",this.color).attr("transform",t.SVGUtil.translate(this.runnerCounterPosition===m.TopLeft?this.runnerCounterTopLeftPosition:this.chart.viewport.width-2,this.chart.data.runnerCounterHeight/2+7)),this.runnerCounterText.style("text-anchor",this.runnerCounterPosition===m.TopLeft?"start":"end"),this.chart.data&&this.chart.data.settings&&(this.runnerCounterText.style(y.ConvertTextPropertiesToStyle(y.GetRunnerCounterTextProperties(null,this.chart.data.settings.runnerCounter.fontSize))),this.runnerCounterText.style("fill",this.chart.data.settings.runnerCounter.fontColor)),this.drawCounterValue()},e.setControlVisiblity=function(t,i,a){void 0===a&&(a=!1),t.style("opacity",i?e.DefaultOpacity:e.DimmedOpacity),i?t.attr("display","inline"):a&&t.attr("display","none")},e.prototype.disableControls=function(){var t=this.chart.data&&this.chart.data.settings&&this.chart.data.settings.runnerCounter.show;switch(e.setControlVisiblity(this.animationReset,!0),e.setControlVisiblity(this.animationToEnd,!0),this.animatorState){case f.Play:e.setControlVisiblity(this.animationPlay,!1),e.setControlVisiblity(this.animationPrev,!0),e.setControlVisiblity(this.animationNext,!0),e.setControlVisiblity(this.animationPause,!0),e.setControlVisiblity(this.runnerCounter,t,!0);break;case f.Paused:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPause,!0),e.setControlVisiblity(this.animationPrev,!0),e.setControlVisiblity(this.animationNext,!0),e.setControlVisiblity(this.runnerCounter,t,!0);break;case f.Stopped:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPrev,!0),e.setControlVisiblity(this.animationNext,!0),e.setControlVisiblity(this.runnerCounter,t,!0),e.setControlVisiblity(this.animationPause,!1);break;case f.Ready:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPrev,!1),e.setControlVisiblity(this.animationNext,!1),e.setControlVisiblity(this.animationPause,!1),e.setControlVisiblity(this.runnerCounter,!1,!0);break;default:e.setControlVisiblity(this.animationPlay,!0),e.setControlVisiblity(this.animationPrev,!1),e.setControlVisiblity(this.animationNext,!1),e.setControlVisiblity(this.animationPause,!1),e.setControlVisiblity(this.runnerCounter,!1,!0)}},e.prototype.show=function(){this.container.style("display","inline")},e.prototype.setRunnerCounterValue=function(e){var i=this.chart.data&&this.chart.data.series&&this.chart.data.series[this.position.series]&&this.chart.data.series[this.position.series].data&&this.chart.data.series[this.position.series].data[$.isNumeric(e)?e:this.flooredPosition.index],a=i&&null!=i.runnerCounterValue?i.runnerCounterValue:"";if(i&&i.runnerCounterFormatString){var r=t.valueFormatter.create({format:i.runnerCounterFormatString});a=r.format(a)}this.runnerCounterValue=this.chart.data.settings.runnerCounter.label+" "+a,this.drawCounterValue()},e.prototype.drawCounterValue=function(){var e=""+this.runnerCounterValue;this.runnerCounterText.text(e),l.svgEllipsis(this.runnerCounterText.node(),this.maxTextWidthOfRunnerCounterValue)},e.prototype.play=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=!1),this.animatorState!==f.Play||t){if(this.animatorState===f.Ready&&(this.animationPlayingIndex++,this.chart.clearChart()),this.chart.isAnimationIndexLast(this.position))return void this.playNext();this.animatorState===f.Paused&&this.chart.clearSelection(),this.animatorState=f.Play,this.chart.renderChart(),this.chart.playAnimation(e),this.disableControls()}},e.prototype.playNext=function(){this.pause(),this.chart.isAnimationSeriesLast(this.position)?(this.setDefaultValues(),this.chart.clearSelection()):(this.position={series:this.position.series+1,index:e.AnimationMinPosition.index},this.play())},e.prototype.pause=function(){this.animatorState===f.Play&&(this.animatorState=f.Paused,this.chart.pauseAnimation()),this.disableControls()},e.prototype.reset=function(){this.clearTimeouts(),this.chart.stopAnimation(),this.chart.clearSelection(),this.chart.clearChart(),this.setDefaultValues(),this.animatorState=f.Stopped,this.disableControls(),this.savedPosition=null},e.prototype.next=function(){if(this.isAnimated){this.stop();var e=this.chart.findNextPoint(this.position);e?(this.position=e,this.chart.renderChart()):this.toEnd()}},e.prototype.prev=function(){if(this.isAnimated){this.stop();var e=this.chart.findPrevPoint(this.position);e?(this.chart.clearRedundant(e),this.position=e,this.chart.renderChart()):this.reset()}},e.prototype.toEnd=function(){this.savedPosition=null,this.chart.stopAnimation(),this.chart.clearSelection(),this.chart.clearChart(),this.setDefaultValues(),this.disableControls(),this.chart.renderChart()},e.prototype.stop=function(){this.isAnimated&&(this.drawCounterValue(),this.savedPosition=this.position,this.chart.stopAnimation(),this.animatorState=f.Stopped,this.disableControls())},Object.defineProperty(e.prototype,"position",{get:function(){return this.positionValue},set:function(e){this.positionValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flooredPosition",{get:function(){return this.position&&{series:this.position.series,index:Math.floor(this.position.index)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"savedPosition",{get:function(){return this.chart.data&&this.chart.data.settings&&this.chart.data.settings.playback&&this.chart.data.settings.playback.position},set:function(e){this.chart.isAutoPlay||(e=null),this.chart.data&&this.chart.data.settings&&this.chart.data.settings.playback&&(this.isPositionWasSaved=!0,this.chart.data&&this.chart.data.settings&&this.chart.data.settings.playback&&(this.chart.data.settings.playback.position=e),this.chart.host.persistProperties({merge:[{objectName:"playback",selector:null,properties:{position:e&&JSON.stringify(e)||""}}]}))},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.isAnimated&&this.chart.stopAnimation(),this.setDefaultValues(),this.container.style("display","none")},e.prototype.clearTimeouts=function(){clearTimeout(this.chart.handleSelectionTimeout)},e.AnimationPlay=n("animationPlay"),e.AnimationPause=n("animationPause"),e.AnimationReset=n("animationReset"),e.AnimationToEnd=n("animationToEnd"),e.AnimationPrev=n("animationPrev"),e.AnimationNext=n("animationNext"),e.RunnerCounter=n("runnerCounter"),e.DimmedOpacity=.25,e.DefaultOpacity=1,e.DefaultControlsColor="#777",e}();i.PulseAnimator=v;var x;!function(e){function t(){return{show:!1,position:0,displayUnits:0,precision:c,labelColor:u,fontSize:h,labelDensity:p}}e.getDefaultPulseChartLabelSettings=t}(x=i.PulseChartDataLabelUtils||(i.PulseChartDataLabelUtils={}));var b;!function(e){function t(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.categoryAxis;r&&(i={show:r.show,axisType:r.axisType,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelColor:r.labelColor,labelDisplayUnits:r.labelDisplayUnits,labelPrecision:r.labelPrecision,duration:r.duration})}return i}function i(e,t){var i={};if(!e)return i;var a=e.objects;if(a){var r=a.valueAxis;r&&(i={show:r.show,position:r.position,axisScale:r.axisScale,start:r.start,end:r.end,showAxisTitle:null==r.showAxisTitle?t:r.showAxisTitle,axisStyle:r.axisStyle,labelColor:r.labelColor,labelDisplayUnits:r.labelDisplayUnits,labelPrecision:r.labelPrecision,secShow:r.secShow,secPosition:r.secPosition,secAxisScale:r.secAxisScale,secStart:r.secStart,secEnd:r.secEnd,secShowAxisTitle:r.secShowAxisTitle,secAxisStyle:r.secAxisStyle,secLabelColor:r.secLabelColor,secLabelDisplayUnits:r.secLabelDisplayUnits,secLabelPrecision:r.secLabelPrecision})}return i}e.getCategoryAxisProperties=t,e.getValueAxisProperties=i}(b=i.PulseChartAxisPropertiesHelper||(i.PulseChartAxisPropertiesHelper={}))}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var a=t.utility.SelectionManager,r=function(){function i(){this.margin={top:10,right:30,bottom:10,left:10},this.LegendSize=50,this.AxisSize=30}return i.prototype.init=function(e){var r=this;this.hostServices=e.host,this.selectionManager=new a({hostServices:this.hostServices}),this.root=d3.select(e.element.get(0)).append("svg").classed(i.Identity["class"],!0),this.root.on("click",function(e){r.clearSelection()}),this.main=this.root.append("g"),this.axes=this.main.append("g").classed(i.Axes["class"],!0),this.axisX=this.axes.append("g").classed(i.Axis["class"],!0),this.axisY=this.axes.append("g").classed(i.Axis["class"],!0),this.axisY2=this.axes.append("g").classed(i.Axis["class"],!0),this.legends=this.main.append("g").classed(i.Legends["class"],!0),this.line=this.main.append("g").classed(i.Values["class"],!0),this.colors=e.style&&e.style.colorPalette?e.style.colorPalette.dataColors:new t.DataColorPalette},i.prototype.update=function(e){if(e.dataViews&&e.dataViews[0]){var t=e.viewport,i=this.model=this.converter(e.dataViews[0],t);this.clearSelection(),this.resize(t),this.draw(i)}},i.prototype.destroy=function(){this.root=null},i.prototype.setIsStopped=function(e){var t={merge:[{objectName:"misc",selector:void 0,properties:{isstopped:e}}]};this.hostServices.persistProperties(t),this.hostServices.onSelect({visualObjects:[]})},i.prototype.enumerateObjectInstances=function(e){var t=[];if(!this.model||!this.model.settings)return t;var i=this.model.settings;switch(e.objectName){case"lineoptions":var a={objectName:"lineoptions",displayName:"lineoptions",selector:null,properties:{fill:i.lineFill,lineThickness:i.lineThickness}};t.push(a);break;case"dotoptions":var r={objectName:"dotoptions",displayName:"dotoptions",selector:null,properties:{color:i.dotFill,dotSizeMin:i.dotSizeMin,dotSizeMax:i.dotSizeMax}};t.push(r);break;case"counteroptions":var s={objectName:"counteroptions",displayName:"counteroptions",selector:null,properties:{counterTitle:i.counterTitle}};t.push(s);break;case"misc":var o={objectName:"misc",displayName:"misc",selector:null,properties:{isanimated:i.isanimated,isstopped:i.isstopped,duration:i.duration}};t.push(o)}return t},i.prototype.selectDot=function(e,t){var i=d3.select(e);i.classed("point_selected")?this.clearSelection():(t&&this.selectionManager.select(t),this.root.classed("filtered",!0),this.line.selectAll("circle.point").classed("point_selected",!1),d3.select(e).classed("point_selected",!0)),d3.event.stopPropagation()},i.prototype.clearSelection=function(){this.root.classed("filtered",!1),this.root.selectAll("circle.point").classed("point_selected",!1),this.selectionManager.clear()},i.prototype.converter=function(e,i){if(!(e.categorical&&e.categorical.categories&&e.categorical.categories[0]&&e.categorical.categories[0].values&&e.categorical.categories[0].values.length>0&&e.categorical&&e.categorical.values&&e.categorical.values[0]&&e.categorical.values[0].values&&e.categorical.values[0].values.length>0))return null;var a,r,s,o,n=[],l=this,c=t.AxisHelper.getCategoryValueType(e.categorical.categories[0].source,!0);this.isDateTime=t.AxisHelper.isDateTime(c);var u,h=!0,p=this.parseSettings(e),d=Math.max(0,i.width-this.margin.left-this.margin.right-this.LegendSize-this.AxisSize),g=Math.max(0,i.height-this.margin.top-this.margin.bottom-this.LegendSize),m="";n=e.categorical.categories[0].values,a=e.categorical.categories[0].source,r=d3.extent(n),this.isDateTime?(s=r[0].getTime(),o=r[1].getTime(),s=new Date(s),o=new Date(o+.05*(o-s)),m="MMM dd yyyy",u=t.valueFormatter.create({format:m})):(s=r[0],o=r[1],o+=.05*(o-s),u=t.valueFormatter.create({value:0}));var y=t.AxisHelper.createAxis({pixelSpan:d,dataDomain:[s,o],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!0,isScalar:h,isVertical:!1,forcedTickCount:void 0,useTickIntervalForDisplayUnits:!0,getValueFn:function(e,t){return l.isDateTime?u.format(new Date(e)):e}});y.formatter=u,a=e.categorical.values[0].source,n=e.categorical.values[0].values,r=d3.extent(n),s=r[0],o=r[1];for(var f,v=[],x=0,b=0,S=0,w=0;w<e.categorical.categories[0].values.length;w++)b=e.categorical.values[0].values[w],S=e.categorical.categories[0].values[w],x+=b,f=t.SelectionId.createWithId(e.categorical.categories[0].identity[w]),v.push({dot:(b-s)/(o-s),value:b,sum:x,time:S,selector:f});x+=.1*(x-s);var C=t.AxisHelper.createAxis({pixelSpan:g,dataDomain:[s,x],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!1,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0}),P=t.AxisHelper.createAxis({pixelSpan:g,dataDomain:[s,x],metaDataColumn:a,formatString:null,outerPadding:0,isCategoryAxis:!1,isScalar:!0,isVertical:!0,useTickIntervalForDisplayUnits:!0});return P.axis.orient("right"),{points:v,settings:p,xAxis:y,yAxis:C,yAxis2:P,legends:this.generateAxisLabels(i,p)}},i.prototype.parseSettings=function(a){if(!(a&&a.metadata&&a.metadata.columns&&a.metadata.columns[0]))return null;var r=a.metadata.objects,s=new t.ColorHelper(this.colors,i.Properties.lineoptions.fill,i.DefaultSettings.lineFill),o=new t.ColorHelper(this.colors,i.Properties.dotoptions.color,i.DefaultSettings.dotFill),n=i.DefaultSettings.xAxisTitle,l=i.DefaultSettings.yAxisTitle;a.categorical.categories[0]&&a.categorical.categories[0].source&&a.categorical.categories[0].source.displayName&&a.categorical.values[0]&&a.categorical.values[0].source&&a.categorical.values[0].source.displayName&&(n=a.categorical.categories[0].source.displayName,l=a.categorical.values[0].source.displayName);var c=i.DefaultSettings.lineThickness,u=i.DefaultSettings.dotSizeMin,h=i.DefaultSettings.dotSizeMax,p=i.DefaultSettings.counterTitle,d=i.DefaultSettings.isanimated,g=i.DefaultSettings.isstopped,m=i.DefaultSettings.duration;return r&&(c=e.DataViewObjects.getValue(r,i.Properties.lineoptions.lineThickness,i.DefaultSettings.lineThickness),u=e.DataViewObjects.getValue(r,i.Properties.dotoptions.dotSizeMin,i.DefaultSettings.dotSizeMin),h=e.DataViewObjects.getValue(r,i.Properties.dotoptions.dotSizeMax,i.DefaultSettings.dotSizeMax),p=e.DataViewObjects.getValue(r,i.Properties.counteroptions.counterTitle,i.DefaultSettings.counterTitle),d=e.DataViewObjects.getValue(r,i.Properties.misc.isanimated,i.DefaultSettings.isanimated),g=e.DataViewObjects.getValue(r,i.Properties.misc.isstopped,i.DefaultSettings.isstopped),m=e.DataViewObjects.getValue(r,i.Properties.misc.duration,i.DefaultSettings.duration)),{xAxisTitle:n,yAxisTitle:l,lineFill:s.getColorForMeasure(r,""),lineThickness:c,dotFill:o.getColorForMeasure(r,""),dotSizeMin:u,dotSizeMax:h,counterTitle:p,isstopped:g,isanimated:d,duration:m}},i.prototype.generateAxisLabels=function(e,i){return[{transform:t.SVGUtil.translate((e.width-this.margin.left-this.margin.right)/2,e.height-this.margin.top-this.margin.bottom),text:i.xAxisTitle,dx:"1em",dy:"-1em"},{transform:t.SVGUtil.translateAndRotate(0,(e.height-this.margin.top-this.margin.bottom)/2,0,0,270),text:i.yAxisTitle,dx:"3em"}]},i.prototype.resize=function(e){this.root.attr({height:Math.max(0,e.height),width:Math.max(0,e.width)}),this.main.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.legends.attr("transform",t.SVGUtil.translate(this.margin.left,this.margin.top)),this.line.attr("transform",t.SVGUtil.translate(this.margin.left+this.LegendSize,0)),this.axes.attr("transform",t.SVGUtil.translate(this.margin.left+this.LegendSize,0)),this.axisX.attr("transform",t.SVGUtil.translate(0,e.height-this.margin.top-this.margin.bottom-this.LegendSize)),this.axisY2.attr("transform",t.SVGUtil.translate(e.width-this.margin.left-this.margin.right-this.LegendSize-this.AxisSize,0))},i.prototype.draw=function(e){var t=this,i=this;if(this.line.selectAll("*").remove(),this.legends.selectAll("*").remove(),this.axisX.selectAll("*").remove(),this.axisY.selectAll("*").remove(),this.axisY2.selectAll("*").remove(),e&&(this.renderLegends(e),e&&e.points&&e.points.length)){if(this.axisX.call(e.xAxis.axis),this.axisY.call(e.yAxis.axis),this.axisY2.call(e.yAxis2.axis),e.settings.isanimated){var a=this.line.append("g").classed("lineDotChart__playBtn",!0).attr("transform","translate(40, 20)");if(a.append("circle").attr("r",17),e.settings.isstopped)return a.append("path").attr("d","M0 2l10 6-10 6z").attr("transform","translate(-4,-8)"),void a.on("click.lineDotChart__playBt",function(){i.setIsStopped(!1)});a.append("path").attr("d","M0 2l10 6-10 6z").attr("transform-origin","center").attr("transform","translate(6, 8) rotate(180)"),a.append("rect").attr("width","2").attr("height","12").attr("transform","translate(-7,-6)"),a.on("click.lineDotChart__playBt",function(){i.setIsStopped(!0)})}var r=this.line.append("clipPath").attr("id","lineClip").append("rect").attr("x",0).attr("y",0).attr("width",1).attr("height",1e4),s=d3.svg.line().x(function(t){return e.xAxis.scale(t.time)}).y(function(t){return e.yAxis.scale(t.sum)}),o=this.line.selectAll("path.plot").data([e.points]);o.enter().append("path"),o.classed("plot",!0).attr("stroke",function(t,i){return e.settings.lineFill}).attr("stroke-width",e.settings.lineThickness).attr("d",s);var n=o.node().getTotalLength(),l=o.node().getPointAtLength(0).x,c=o.node().getPointAtLength(n).x;o.attr("clip-path","url("+location.href+"#lineClip)"),e.settings.isanimated?r.attr("x",l).interrupt().transition().ease("linear").duration(1e3*e.settings.duration).attr("width",c-l):r.interrupt().attr("x",l).attr("width",c-l),o.exit().remove();var u=300,h=0,p=this.line.selectAll("circle.point").data(e.points),i=this;p.enter().append("circle").attr("fill",e.settings.dotFill).attr("opacity",.77).attr("r",function(t){return e.settings.dotSizeMin+t.dot*(e.settings.dotSizeMax-e.settings.dotSizeMin)}).classed("point",!0).on("mouseover.point",this.showDataPoint).on("mouseout.point",this.hideDataPoint).on("click.point",function(e){i.selectDot(this,e.selector)}),e.settings.isanimated?p.interrupt().attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(0.005)"}).transition().duration(u).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)}).ease("linear").attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(3.4)"}).transition().duration(u).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)+u}).ease("elastic").attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(1)"}):p.interrupt().attr("transform",function(t){return"translate("+e.xAxis.scale(t.time)+" "+e.yAxis.scale(t.sum)+") scale(1)"}),p.exit().remove();for(var d=0;d<p[0].length;d++)this.addTooltip(e,p[0][d]);var g=this.line.selectAll("text").data(e.points);g.enter().append("text").classed("text",!0).text(function(t,i){return e.settings.counterTitle+" "+(i+1)}).attr("x",c-260).attr("y",30),e.settings.isanimated?g.attr("opacity",0).interrupt().transition().duration(h).delay(function(i,a){return t.pointDelay(e.points,a,e.settings.duration)}).attr("transform","translate(0 0)").attr("opacity",1).transition().duration(h).delay(function(i,a){return e.points[a+1]?t.pointDelay(e.points,a+1,e.settings.duration):Number.POSITIVE_INFINITY}).attr("opacity",0):g.interrupt().attr("transform","translate(0 0)").attr("opacity",function(t,i){return Number(i===e.points.length-1)}),g.exit().remove()}},i.prototype.pointDelay=function(e,t,i){if(!e.length||!e[t]||0===t)return 0;if(this.isDateTime)var a=e[t].time,r=e[0].time.getTime(),s=e[e.length-1].time.getTime(),o=a.getTime();else var a=e[t].time,r=e[0].time,s=e[e.length-1].time,o=a;return 1e3*i*(o-r)/(s-r)},i.prototype.showDataPoint=function(e,t){d3.select(this).classed("show",!0)},i.prototype.hideDataPoint=function(e,t){d3.select(this).classed("show",!1)},i.prototype.addTooltip=function(e,i){var a=d3.select(i),r=a.datum();t.TooltipManager.addTooltip(a,function(t){return[{displayName:e.settings.xAxisTitle,value:e.xAxis.formatter.format(r.time)},{displayName:e.settings.yAxisTitle,value:r.value.toString()}]})},i.prototype.renderLegends=function(e){var t=this.legends.selectAll(i.Legend.selector).data(e.legends);t.enter().append("svg:text"),t.attr("x",0).attr("y",0).attr("dx",function(e){return e.dx}).attr("dy",function(e){return e.dy}).attr("transform",function(e){return e.transform}).text(function(e){return e.text}).classed(i.Legend["class"],!0),t.exit().remove()},i.DefaultSettings={lineFill:"rgb(102, 212, 204)",lineThickness:3,dotFill:"#005c55",dotSizeMin:4,dotSizeMax:38,counterTitle:"Total features",xAxisTitle:"",yAxisTitle:"",duration:20,isanimated:!0,isstopped:!0},i.capabilities={dataRoles:[{name:"Date",kind:e.VisualDataRoleKind.Grouping,displayName:"Date"},{name:"Values",kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],dataViewMappings:[{conditions:[{Date:{min:0,max:1},Values:{min:0,max:1},Labels:{min:0,max:1}}],categorical:{categories:{"for":{"in":"Date"},dataReductionAlgorithm:{sample:{}}},values:{"for":{"in":"Values"}}}}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}},lineoptions:{displayName:"Line",properties:{fill:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},lineThickness:{displayName:"Thickness",type:{numeric:!0}}}},dotoptions:{displayName:"Dot",properties:{color:{displayName:e.data.createDisplayNameGetter("Visual_Fill"),type:{fill:{solid:{color:!0}}}},dotSizeMin:{displayName:"Min size",type:{numeric:!0}},dotSizeMax:{displayName:"Min size",type:{numeric:!0}}}},counteroptions:{displayName:"Counter",properties:{counterTitle:{displayName:"Title",type:{text:!0}}}},misc:{displayName:"Animation",properties:{isanimated:{displayName:"Animated",type:{bool:!0}},isstopped:{displayName:"Stop on load",type:{bool:!0}},duration:{displayName:"Time",type:{numeric:!0}}}}}},i.Identity={"class":"lineDotChart",selector:".lineDotChart"},i.Axes={"class":"axes",selector:".axes"},i.Axis={"class":"axis",selector:".axis"},i.Legends={"class":"legends",selector:".legends"},i.Legend={"class":"legend",selector:".legend"},i.Values={"class":"line",selector:".line"},i.Properties={general:{formatString:{objectName:"general",propertyName:"formatString"}},lineoptions:{fill:{objectName:"lineoptions",propertyName:"fill"},lineThickness:{objectName:"lineoptions",propertyName:"lineThickness"}},dotoptions:{color:{objectName:"dotoptions",propertyName:"color"},dotSizeMin:{objectName:"dotoptions",propertyName:"dotSizeMin"},dotSizeMax:{objectName:"dotoptions",propertyName:"dotSizeMax"}},counteroptions:{counterTitle:{objectName:"counteroptions",propertyName:"counterTitle"}},misc:{isanimated:{objectName:"misc",propertyName:"isanimated"},isstopped:{objectName:"misc",propertyName:"isstopped"},duration:{objectName:"misc",propertyName:"duration"}}},i}();i.LineDotChart=r}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(t){var i;!function(i){var a=t.utility.SelectionManager;i.sunburstRoleNames={nodes:"Nodes",values:"Values"};var r=function(){function i(){this.total=0}return i.prototype.init=function(e){var t=this;this.arc=d3.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return Math.sqrt(e.y)}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)}),this.colors=e.style.colorPalette.dataColors,this.selectionManager=new a({hostServices:e.host}),this.svg=d3.select(e.element.get(0)).append("svg"),this.svg.classed("mainDrawArea",!0),this.g=this.svg.append("g"),this.g.classed("container",!0),this.svg.append("text").classed("sunBurstPercentageFixed",!0),this.svg.on("mousedown",function(e){t.svg.selectAll("path").style("opacity",1),t.svg.select(".sunBurstPercentageFixed").style("opacity",0),t.selectionManager.clear()})},i.setAllUnhide=function(e){e.attr("setUnHide","true")},i.prototype.update=function(e){if(e.dataViews.length>0){var t=this.converter(e.dataViews[0],this.colors);this.viewport=e.viewport,this.updateInternal(t)}},i.prototype.updateInternal=function(e){var a=this;this.svg.attr({height:this.viewport.height,width:this.viewport.width}),this.g.attr("transform",t.SVGUtil.translate(this.viewport.width/2,this.viewport.height/2));var r=Math.min(this.viewport.width,this.viewport.height)/2,s=d3.layout.partition().size([2*Math.PI,r*r]).value(function(e){return e.value}),o=this.g.datum(e).selectAll("path").data(s.nodes);o.enter().append("path"),o.attr("display",function(e){return e.depth?null:"none"}).attr("d",this.arc).style("stroke","#fff").style("fill",function(e){return e.color}).style("fill-rule","evenodd").on("mousedown",function(e){e.selector&&a.selectionManager.select(e.selector),d3.selectAll("path").call(i.setAllUnhide).attr("setUnHide",null),a.highlightPath(e,a,!0);var t=a.svg.select(".sunBurstPercentageFixed"),r=0===a.total?0:(100*e.total/a.total).toPrecision(3);t.text(e?r+"%":""),t.style("fill",e.color),a.onResize(),event.stopPropagation()}),this.renderTooltip(o),o.exit().remove(),this.onResize()},i.getTreePath=function(e){for(var t=[],i=e;i.parent;)t.unshift(i),i=i.parent;return t},i.prototype.onResize=function(){var t=this.viewport.width,i=this.viewport.height,a=this.svg.select(".sunBurstPercentageFixed"),r=e.TextMeasurementService.measureSvgTextElementWidth(a[0][0]);a.style("opacity",1),a.attr("y",i/2+4),a.attr("x",t/2-r/2)},i.prototype.highlightPath=function(e,t,a){var r=e?i.getTreePath(e):[];t.svg.selectAll("path").each(function(){"true"!==d3.select(this).attr("setUnHide")&&d3.select(this).style("opacity",i.minOpacity)}),t.svg.selectAll("path").filter(function(e){return r.indexOf(e)>=0}).each(function(){d3.select(this).style("opacity",1),a===!0&&d3.select(this).attr("setUnHide","true")})},i.prototype.renderTooltip=function(e){t.TooltipManager.addTooltip(e,function(e){return e.data.tooltipInfo})},i.getTooltipData=function(e,t){return[{displayName:e,value:0>t?"":t.toString()}]},i.prototype.covertTreeNodeToSunBurstNode=function(e,a,r,s,o){var n;e.identity&&(s=s.concat([e.identity]),n={data:s});var l=0===s.length?null:new t.SelectionId(n,!1),c=e.values?e.values[0].value:0,u={name:e.name,value:Math.max(c,0),selector:l,total:c};if(e.value&&(u.color=o?o:r.getColor(e.value).value),this.total+=u.value,e.children&&e.children.length>0){u.tooltipInfo=i.getTooltipData(e.value,-1),u.children=[];for(var h=0;h<e.children.length;h++){var p=this.covertTreeNodeToSunBurstNode(e.children[h],u,r,s,u.color);u.children.push(p),u.total+=p.total}}else u.tooltipInfo=i.getTooltipData(e.value,c);return a&&(u.parent=a),u},i.prototype.converter=function(e,t){var i=t.getNewColorScale();this.total=0;var a=this.covertTreeNodeToSunBurstNode(e.matrix.rows.root,null,i,[],void 0);return a},i.minOpacity=.2,i.roleNames={nodes:"Nodes",values:"Values"},i.capabilities={dataRoles:[{name:i.roleNames.nodes,kind:e.VisualDataRoleKind.Grouping,displayName:"Groups"},{name:i.roleNames.values,kind:e.VisualDataRoleKind.Measure,displayName:"Values"}],objects:{general:{displayName:e.data.createDisplayNameGetter("Visual_General"),properties:{formatString:{type:{formatting:{formatString:!0}}}}}},dataViewMappings:[{conditions:[{Groups:{min:0},Values:{max:1}}],matrix:{rows:{"for":{"in":i.roleNames.nodes}},values:{"for":{"in":i.roleNames.values}}}}]},i}();i.Sunburst=r}(i=t.samples||(t.samples={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))},function(e,t){var i,i=(window.jsCommon,window.powerbi);window.powerbitests,window.InJs,window.debug,window.jasmine,window.Microsoft;!function(e){var t;!function(e){var t;!function(t){t.sunburstCustom={name:"sunburstCustom",watermarkKey:"defaultWatermark",capabilities:e.samples.Sunburst.capabilities,create:function(){return new e.samples.Sunburst}},t.asterPlot={name:"asterPlot",capabilities:e.samples.AsterPlot.capabilities,create:function(){return new e.samples.AsterPlot}},t.tornadoChart={name:"tornadoChart",capabilities:e.samples.TornadoChart.capabilities,create:function(){return new e.samples.TornadoChart}},t.sankeyDiagram={name:"sankeyDiagram",capabilities:e.samples.SankeyDiagram.capabilities,create:function(){return new e.samples.SankeyDiagram}},t.mekkoChart={name:"mekkoChart",watermarkKey:"mekko",capabilities:e.samples.MekkoChart.capabilities,create:function(){return new e.samples.MekkoChart({chartType:e.samples.MekkoChartType.HundredPercentStackedColumn})},customizeQuery:e.ColumnChart.customizeQuery,getSortableRoles:function(t){return e.ColumnChart.getSortableRoles(t)}},t.bulletChart={name:"bulletChart",capabilities:e.samples.BulletChart.capabilities,create:function(){return new e.samples.BulletChart}},t.wordCloud={name:"wordCloud",capabilities:e.samples.WordCloud.capabilities,create:function(){return new e.samples.WordCloud}},t.chicletSlicer={name:"chicletSlicer",capabilities:e.samples.ChicletSlicer.capabilities,create:function(){return new e.samples.ChicletSlicer}},t.chordChart={name:"chordChart",capabilities:e.samples.ChordChart.capabilities,create:function(){return new e.samples.ChordChart}},t.enhancedScatterChart={name:"enhancedScatterChart",capabilities:e.samples.EnhancedScatterChart.capabilities,create:function(){return new e.samples.EnhancedScatterChart}},t.radarChart={name:"radarChart",capabilities:e.samples.RadarChart.capabilities,create:function(){return new e.samples.RadarChart}},t.dotPlot={name:"dotPlot",capabilities:e.samples.DotPlot.capabilities,create:function(){return new e.samples.DotPlot}},t.histogram={name:"histogram",capabilities:e.samples.Histogram.capabilities,create:function(){return new e.samples.Histogram}},t.timeline={name:"timeline",capabilities:e.samples.Timeline.capabilities,create:function(){return new e.samples.Timeline}},t.forceGraph={name:"forceGraph",capabilities:e.samples.ForceGraph.capabilities,create:function(){return new e.samples.ForceGraph}},t.gantt={name:"gantt",capabilities:e.samples.Gantt.capabilities,create:function(){return new e.samples.Gantt}},t.streamGraph={name:"streamGraph",capabilities:e.samples.StreamGraph.capabilities,create:function(){return new e.samples.StreamGraph}},t.pulseChart={name:"pulseChart",capabilities:e.samples.PulseChart.capabilities,create:function(){return new e.samples.PulseChart}},t.lineDotChart={name:"lineDotChart",capabilities:e.samples.LineDotChart.capabilities,create:function(){return new e.samples.LineDotChart}}}(t=e.plugins||(e.plugins={}))}(t=e.visuals||(e.visuals={}))}(i||(i={}))}]);